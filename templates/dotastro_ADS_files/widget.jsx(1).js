define(["jquery","underscore","backbone","react","react-redux","react-dom","redux","redux-thunk","js/components/api_targets","js/components/api_query","js/components/api_request","js/widgets/base/base_widget","./containers/App.jsx","./constants/actionNames","./actions/index","./reducers/index"],function(e,t,n,i,r,o,s,a,u,c,p,d,h,l,f,y){var E=n.View.extend({initialize:function(e){t.assign(this,e)},render:function(){return o.render(i.createElement(r.Provider,{store:this.store},i.createElement(h,null)),this.el),this},destroy:function(){o.unmountComponentAtNode(this.el)}});return d.extend({initialize:function(){var e=s.applyMiddleware(a.default.withExtraArgument(this)),t=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.compose;this.store=s.createStore(y,t(e)),this.view=new E({store:this.store})},activate:function(e){this.setBeeHive(e),this.activateWidget()},renderWidgetForCurrentQuery:function(e){var n=this,i=e.currentQuery,r=this.getPubSub();if(this.store.dispatch(f.appReset()),i){var o=i.clone();o.unlock(),o.set("rows",1e3),o.set("fl","bibcode");var s=this.composeRequest(o);s.set("options",{done:function(e){var i=t.map(e.response.docs,"bibcode");n.fetchAffiliationData(i)},fail:function(){return n.onError()},always:function(){n.store.dispatch({type:l.setLoading,value:!1})}}),r.publish(r.EXECUTE_REQUEST,s),this.store.dispatch({type:l.fetchData})}},renderWidgetForListOfBibcodes:function(e){return this.store.dispatch(f.appReset()),this.fetchAffiliationData(e)},fetchAffiliationData:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,o=this.getPubSub(),s=e.Deferred();this.store.dispatch({type:l.fetchData,value:n});var a=new p({target:u.AUTHOR_AFFILIATION_SEARCH,query:new c({bibcode:n,numyears:i,maxauthor:r}),options:{type:"post",processData:!1,dataType:"json",contentType:"application/json",done:function(){return s.resolve.apply(s,arguments)},fail:function(){return s.reject.apply(s,arguments)},always:function(){return s.always.apply(s,arguments)}}});return s.done(function(e){try{t.store.dispatch(f.setAffiliationData(e.data))}catch(e){console.error(e)}}),s.fail(function(){return t.onError()}),s.always(function(){return t.store.dispatch({type:l.setLoading,value:!1})}),o.publish(o.EXECUTE_REQUEST,a),s.promise()},exportAffiliationData:function(t){var n=this,i=this.getPubSub(),r=e.Deferred(),o=new p({target:u.AUTHOR_AFFILIATION_EXPORT,query:new c,options:{useFetch:!0,fetchOptions:{body:JSON.stringify(t),method:"POST",headers:{"Content-Type":"application/json"}},done:function(){return r.resolve.apply(r,arguments)},fail:function(){return r.reject.apply(r,arguments)},always:function(){return r.always.apply(r,arguments)}}});return r.fail(function(){return n.onError()}),r.always(function(){return n.store.dispatch({type:l.setLoading,value:!1})}),i.publish(i.EXECUTE_REQUEST,o),r.promise()},closeWidget:function(){var e=this.getPubSub();e.publish(e.NAVIGATE,"results-page")},onError:function(){(0,this.store.dispatch)(f.showMessage("danger","Something happened during the request, please try again",0))}})});