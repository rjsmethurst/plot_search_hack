define(["js/page_managers/toc_controller","js/page_managers/three_column_view","hbs!js/wraps/abstract_page_manager/abstract-page-layout","hbs!js/wraps/abstract_page_manager/abstract-nav","utils","analytics"],function(t,e,s,r,a){return t.extend({persistentWidgets:["SearchWidget","ShowAbstract","ShowCitations","ShowToc","ShowReferences","tocWidget"],TOCTemplate:r,initialize:function(){var e=this;t.prototype.initialize.apply(this,arguments),this.abstractTimer=new a.TimingEvent("abstract-loaded","workflow"),this.observer=new IntersectionObserver(function(){e.adjustStickyElements()},{threshold:0}),this.observing=!1,_.bindAll(this,"adjustStickyElements"),$(window).on("resize",_.throttle(this.adjustStickyElements,200))},adjustStickyElements:function(){if(window.matchMedia("(max-width: 788px)").matches&&$(".s-search-bar-widget").get(0)&&$(".s-search-bar-widget").get(0).getBoundingClientRect().bottom<=0){var t=$("#nav-button-container").outerHeight(!0);this.stickElements(t),$(".s-abstract-content").attr("style","overflow: unset")}else this.unStickElements(),$(".s-abstract-content").attr("style","overflow: hidden")},stickElements:function(t){$("#nav-button-container").addClass("sticky"),$(".s-nav-container").attr("style","position:fixed;top:".concat(t,"px;left:0")),$("#resources-container").attr("style","position:fixed;top:".concat(t,"px;left:100%"))},unStickElements:function(){$("#nav-button-container").removeClass("sticky"),$(".s-nav-container").attr("style",""),$("#resources-container").attr("style","")},createView:function(t){return(t=t||{}).template=t.template||s,new e({template:s})},activate:function(t){var e=this;this.setBeeHive(t),this.debug=t.getDebug(),this.view=this.createView({debug:this.debug,widgets:this.widgets});var s=this.getPubSub();this.onDetailsPage=!1,s.subscribe(s.DISPLAY_DOCUMENTS,_.bind(this.onDisplayDocuments,this)),s.subscribe(s.NAVIGATE,function(t,s){e.onDetailsPage=s&&s.href&&s.href.indexOf("abs/")>-1})},assemble:function(e){var s=this;return t.prototype.assemble.apply(this,arguments).done(function(){s.addQuery(s.getCurrentQuery());try{_.forEach(_.keys(s.widgets),function(t){var e=s.widgets[t],r=_.debounce(function(){"ShowAbstract"===t&&""!==$(s.widgetDoms[t]).text()&&s.abstractTimer.stop()},300);e.widgets&&e.widgets.length>0&&_.forEach(e.widgets,function(t){return t.onIdle=r}),e.onIdle=r})}catch(t){}})},addQuery:function(t){this.view.model&&this.view.model.set("query",t.url())},show:function(e){$("#abs-full-txt-toggle").text("Full Text Sources"),$("#abs-nav-menu-toggle").html('<i class="fa fa-bars" aria-hidden="true"></i> Show Menu'),$(".s-nav-container").removeClass("show"),$("#resources-container").removeClass("show"),!this.observing&&document.querySelector(".s-search-bar-widget")&&(this.observer.observe(document.querySelector(".s-search-bar-widget")),this.observing=!0);var s=t.prototype.show.apply(this,arguments),r=this.getCurrentQuery().url();return _.isEmpty(r)||s.$el.find(".s-back-button-container").empty().html('<a href="#search/'+r+'" class="back-button btn btn-sm btn-default"> <i class="fa fa-arrow-left" aria-hidden="true"></i> Back to results</a>'),"ShowAbstract"===e&&"function"==typeof window.scrollTo&&window.scrollTo(0,0),s},onDisplayDocuments:function(t){var e=this.parseIdentifierFromQuery(t);"null"!==e&&(this.widgets.tocWidget.model.set("bibcode",e),this.onDetailsPage||this.abstractTimer.start())},navConfig:{ShowAbstract:{title:"Abstract",path:"abstract",showCount:!1,isSelected:!0,category:"view",alwaysThere:"true",order:0},ShowCitations:{title:"Citations",path:"citations",category:"view",order:1},ShowReferences:{title:"References",path:"references",category:"view",order:2},ShowCoreads:{title:"Co-Reads",path:"coreads",category:"view",showCount:!1,order:3},ShowSimilar:{title:"Similar Papers",path:"similar",category:"view",showCount:!1,order:4},ShowToc:{title:"Volume Content",path:"toc",category:"view",showCount:!1,order:5},ShowGraphics:{title:"Graphics",path:"graphics",showCount:!1,category:"view",order:6},ShowMetrics:{title:"Metrics",path:"metrics",showCount:!1,category:"view",order:7},ShowExportcitation__default:{title:"Export",path:"exportcitation",category:"export",alwaysThere:"true",order:8},ShowFeedback__missingreferences:{title:"Missing/Incorrect References",path:"feedback/missingreferences",category:"feedback",alwaysThere:"true",order:9},ShowFeedback__associatedarticles:{title:"Associated References",path:"feedback/associatedarticles",category:"feedback",alwaysThere:"true",order:10},ShowFeedback__correctabstract:{title:"Submit/Correct Abstract",path:"feedback/correctabstract",category:"feedback",alwaysThere:"true",order:11}}})});