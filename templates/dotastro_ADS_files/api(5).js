define(["underscore","../modules/api","../modules/ui"],function(e,t,r){var n=t.actions,i=n.QUERY_PROVIDED,u=n.RECEIVED_RESPONSE,s=n.CURRENT_QUERY_UPDATED,a=n.FETCH_DATA,c=n.FETCHING_DATA,o=n.SEND_ANALYTICS,l=r.actions,p=l.SET_LOADING,d=l.SET_NO_RESULTS,f=l.SET_HAS_ERROR,y=l.SET_FULL_TEXT_SOURCES,E=l.SET_DATA_PRODUCTS;l.LINK_CLICKED;return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(t){return r.map(function(r){return e.partial(r,t)})}}(function(t,r){var n=r.dispatch;return function(r){return function(u){if(r(u),u.type===i){var c=u.result;if(n({type:p,result:!0}),n({type:s,result:c}),e.isPlainObject(c)){var o=c.q;e.isArray(o)&&o.length>0?/^(identifier|bibcode):/.test(o[0])?(o=o[0].replace(/^(identifier|bibcode):/,""),n({type:a,result:o}),t.trigger("page-manager-event","widget-ready",{isActive:!0})):n({type:f,result:"unable to parse bibcode from query"}):n({type:f,result:"did not receive a bibcode in query"})}else n({type:f,result:"query is not a plain object"})}}}},function(t,r){var n=r.dispatch,i=r.getState;return function(r){return function(s){if(r(s),s.type===u){t._updateLinkServer();var a=i().api.linkServer,c=s.result;if(e.isPlainObject(c)){var o=c.response&&c.response.docs;if(e.isArray(o)&&o.length>0){var l;e.isString(a)&&(o[0].link_server=a);try{l=t.parseResourcesData(o[0])}catch(e){return n({type:f,result:"unable to parse resource data"})}if(l.fullTextSources.length>0){var S=(v=l.fullTextSources,T={},0===v.length?T:(v.forEach(function(e){T[e.shortName]||(T[e.shortName]=[]),T[e.shortName].push(e)}),T));n({type:y,result:S})}l.dataProducts.length>0&&n({type:E,result:l.dataProducts}),0===l.dataProducts.length&&0===l.fullTextSources.length&&n({type:d,result:!0}),n({type:p,result:!1})}else n({type:f,result:"did not receive docs"})}else n({type:f,result:"did not receive docs"})}var v,T}}},function(e,t){var r=t.dispatch;return function(t){return function(n){if(t(n),n.type===a){var i={q:"identifier:".concat(n.result)};r({type:c,result:i}),r({type:p,result:!0}),e.dispatchRequest(i)}}}},function(e,t){t.dispatch,t.getState;return function(t){return function(r){t(r),r.type===o&&e.emitAnalytics(r.result)}}})});