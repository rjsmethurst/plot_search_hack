function _typeof2(e){"@babel/helpers - typeof";return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var s=t&&t.prototype instanceof h?t:h,o=Object.create(s.prototype),a=new A(r||[]);return i(o,"_invoke",{value:function(e,t,n){var i="suspendedStart";return function(r,s){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw s;return P()}for(n.method=r,n.arg=s;;){var o=n.delegate;if(o){var a=w(o,n);if(a){if(a===d)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var c=l(e,t,n);if("normal"===c.type){if(i=n.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a)}),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function h(){}function p(){}function f(){}var g={};c(g,s,function(){return this});var m=Object.getPrototypeOf,b=m&&m(m(x([])));b&&b!==t&&n.call(b,s)&&(g=b);var v=f.prototype=h.prototype=Object.create(g);function y(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function _(e,t){var r;i(this,"_invoke",{value:function(i,s){function o(){return new t(function(r,o){!function i(r,s,o,a){var c=l(e[r],e,s);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==_typeof(d)&&n.call(d,"__await")?t.resolve(d.__await).then(function(e){i("next",e,o,a)},function(e){i("throw",e,o,a)}):t.resolve(d).then(function(e){u.value=e,o(u)},function(e){return i("throw",e,o,a)})}a(c.arg)}(i,s,r,o)})}return r=r?r.then(o,o):o()}})}function w(e,t){var n=t.method,i=e.iterator[n];if(void 0===i)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var r=l(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var s=r.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function x(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:P}}function P(){return{value:void 0,done:!0}}return p.prototype=f,i(v,"constructor",{value:f,configurable:!0}),i(f,"constructor",{value:p,configurable:!0}),p.displayName=c(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(_.prototype),c(_.prototype,o,function(){return this}),e.AsyncIterator=_,e.async=function(t,n,i,r,s){void 0===s&&(s=Promise);var o=new _(u(t,n,i,r),s);return e.isGeneratorFunction(n)?o:o.next().then(function(e){return e.done?e.value:o.next()})},y(v),c(v,a,"Generator"),c(v,s,function(){return this}),c(v,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=x,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return o.type="throw",o.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],o=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var a=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(a&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;E(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:x(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function asyncGeneratorStep(e,t,n,i,r,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var s=e.apply(t,n);function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}o(void 0)})}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _wrapRegExp(){_wrapRegExp=function(e,t){return new n(e,void 0,t)};var e=RegExp.prototype,t=new WeakMap;function n(e,i,r){var s=new RegExp(e,i);return t.set(s,r||t.get(e)),_setPrototypeOf(s,n.prototype)}function i(e,n){var i=t.get(n);return Object.keys(i).reduce(function(t,n){var r=i[n];if("number"==typeof r)t[n]=e[r];else{for(var s=0;void 0===e[r[s]]&&s+1<r.length;)s++;t[n]=e[r[s]]}return t},Object.create(null))}return _inherits(n,RegExp),n.prototype.exec=function(t){var n=e.exec.call(this,t);if(n){n.groups=i(n,this);var r=n.indices;r&&(r.groups=i(r,this))}return n},n.prototype[Symbol.replace]=function(n,r){if("string"==typeof r){var s=t.get(this);return e[Symbol.replace].call(this,n,r.replace(/\$<([^>]+)>/g,function(e,t){var n=s[t];return"$"+(Array.isArray(n)?n.join("$"):n)}))}if("function"==typeof r){var o=this;return e[Symbol.replace].call(this,n,function(){var e=arguments;return"object"!=_typeof(e[e.length-1])&&(e=[].slice.call(e)).push(i(e,o)),r.apply(this,e)})}return e[Symbol.replace].call(this,n,r)},_wrapRegExp.apply(this,arguments)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define("config/common.config",[],function(){window.skipMain&&requirejs.config({baseUrl:"../../"}),requirejs.config({shim:{mathjax:{exports:"MathJax",init:function(){return MathJax.Hub.Config({messageStyle:"none",HTML:["input/TeX","output/HTML-CSS"],TeX:{extensions:["AMSmath.js","AMSsymbols.js"],equationNumbers:{autoNumber:"AMS"}},extensions:["tex2jax.js"],jax:["input/TeX","output/HTML-CSS"],tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0},"HTML-CSS":{availableFonts:["TeX"],linebreaks:{automatic:!0}}}),MathJax.Hub.Startup.onload(),MathJax}}}}),require(["config/discovery.vars","regenerator-runtime","array-flat-polyfill","polyfill","js/dark-mode-switch"],function(e){setTimeout(function(){require(["google-analytics","analytics"],function(t,n){n("create",e.googleTrackingCode||"",e.googleTrackingOptions),e.googleOptimizeCode&&(n("require",e.googleOptimizeCode),e.debugExportBBB||console.warn("AB testing will be loaded, but bbb object is not exposed. Change debugExportBBB if needed."))})},0)}),require(["hbs/handlebars"],function(e){e.registerHelper("compare",function(e,t,n){var i,r;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");if(!(i={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},typeof:function(e,t){return _typeof2(e)===t}})[r=void 0!==n&&n.hash&&n.hash.operator?n.hash.operator:"==="])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+r);return i[r](e,t)?n.fn(this):n.inverse(this)}),e.registerHelper("toJSON",function(e){return JSON.stringify(e)}),e.registerHelper("isdefined",function(e){return void 0!==e}),e.registerHelper("ifInSet",function(e,t,n){return e.has(t)?n.fn(this):n.inverse(this)}),e.registerHelper("ifSetEmpty",function(e,t){return 0===e.size?t.fn(this):t.inverse(this)})}),require(["backbone-validation"],function(){_.extend(Backbone.Validation.callbacks,{valid:function(e,t,n){e.$("input[name="+t+"]").closest(".form-group").removeClass("has-error").find(".help-block").html("").addClass("no-show")},invalid:function(e,t,n,i){var r=e.$("[name="+t+"]");$group=r.closest(".form-group"),!0===e.submit&&($group.addClass("has-error"),$group.find(".help-block").html(n).removeClass("no-show"))}})}),require(["d3","d3-cloud"],function(e,t){var n=window;n.d3||(n.d3=e),n.d3&&n.d3.layout&&!n.d3.layout.cloud&&(n.d3.layout.cloud=t),e.legend=function(t){return t.each(function(){var t=e.select(this),n={},i=e.select(t.property("nearestViewportElement")),r=t.attr("data-style-padding")||5,s=t.selectAll(".legend-box").data([!0]),o=t.selectAll(".legend-items").data([!0]);s.enter().append("rect").classed("legend-box",!0),o.enter().append("g").classed("legend-items",!0);try{i.selectAll("[data-legend]").each(function(){var t=e.select(this);n[t.attr("data-legend")]={pos:t.attr("data-legend-pos")||this.getBBox().y,color:void 0!=t.attr("data-legend-color")?t.attr("data-legend-color"):"none"!=t.style("fill")?t.style("fill"):t.style("stroke")}})}catch(e){}n=e.entries(n).sort(function(e,t){return e.value.pos-t.value.pos});var a=0;o.selectAll("text").data(n,function(e){return e.key}).call(function(e){e.enter().append("text")}).call(function(e){e.exit().remove()}).attr("y",function(e,t){return 0===t?"0em":t+(a+=.2)+"em"}).attr("x","1em").text(function(e){return e.key}),o.selectAll("circle").data(n,function(e){return e.key}).call(function(e){e.enter().append("circle")}).call(function(e){e.exit().remove()}).attr("cy",function(e,t){return t-.25+"em"}).attr("cx",0).attr("r","0.4em").style("fill",function(e){return e.value.color});var c=o[0][0].getBBox();s.attr("x",c.x-r).attr("y",c.y-r).attr("height",c.height+2*r).attr("width",c.width+2*r)}),t}}),require(["jquery"],function(e){e.fn.getCursorPosition=function(){var e=this.get(0);if(e){if("selectionStart"in e)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),n=document.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-n}}},e.fn.selectRange=function(e,t){return t||(t=e),this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}})}})}),require.config({deps:"undefined"!=typeof window&&window.skipMain?["common.config"]:["config/common.config","js/apps/discovery/main"],waitSeconds:7,config:{es6:{modules:void 0},"js/components/persistent_storage":{namespace:"bumblebee"},"js/apps/discovery/main":{core:{controllers:{FeedbackMediator:"js/wraps/discovery_mediator",QueryMediator:"js/components/query_mediator",Diagnostics:"js/bugutils/diagnostics",AlertsController:"js/wraps/alerts_mediator",Orcid:"js/modules/orcid/module",SecondOrderController:"js/components/second_order_controller",HotkeysController:"js/components/hotkeys_controller",Experiments:"js/components/experiments"},services:{Api:"js/services/api",PubSub:"js/services/pubsub",Navigator:"js/apps/discovery/navigator",PersistentStorage:"js/services/storage",HistoryManager:"js/components/history_manager"},objects:{User:"js/components/user",Session:"js/components/session",DynamicConfig:"config/discovery.vars",MasterPageManager:"js/page_managers/master",AppStorage:"js/components/app_storage",RecaptchaManager:"recaptcha!js/components/recaptcha_manager",CSRFManager:"js/components/csrf_manager",LibraryController:"js/components/library_controller",DocStashController:"js/components/doc_stash_controller",Utils:"utils"},modules:{FacetFactory:"js/widgets/facet/factory"}},widgets:{LandingPage:"js/wraps/landing_page_manager/landing_page_manager",SearchPage:"js/wraps/results_page_manager",DetailsPage:"js/wraps/abstract_page_manager/abstract_page_manager",AuthenticationPage:"js/wraps/authentication_page_manager",SettingsPage:"js/wraps/user_settings_page_manager/user_page_manager",OrcidPage:"js/wraps/orcid_page_manager/orcid_page_manager",OrcidInstructionsPage:"js/wraps/orcid-instructions-page-manager/manager",ReactPageManager:"js/react/PageManager",LibrariesPage:"js/wraps/libraries_page_manager/libraries_page_manager",HomePage:"js/wraps/home_page_manager/home_page_manager",PublicLibrariesPage:"js/wraps/public_libraries_page_manager/public_libraries_manager",ErrorPage:"js/wraps/error_page_manager/error_page_manager",Authentication:"js/widgets/authentication/widget",UserSettings:"js/widgets/user_settings/widget",UserPreferences:"js/widgets/preferences/widget",LibraryImport:"js/widgets/library_import/widget",BreadcrumbsWidget:"js/widgets/filter_visualizer/widget",NavbarWidget:"js/widgets/navbar/widget",UserNavbarWidget:"js/widgets/user_navbar/widget",AlertsWidget:"js/widgets/alerts/widget",ClassicSearchForm:"js/widgets/classic_form/widget",SearchWidget:"js/widgets/search_bar/search_bar_widget",PaperSearchForm:"js/widgets/paper_search_form/widget",Results:"js/widgets/results/widget",QueryInfo:"js/widgets/query_info/query_info_widget",QueryDebugInfo:"js/widgets/api_query/widget",ExportWidget:"js/widgets/export/widget.jsx",Sort:"js/widgets/sort/widget.jsx",ExportDropdown:"js/wraps/export_dropdown",VisualizationDropdown:"js/wraps/visualization_dropdown",AuthorNetwork:"js/wraps/author_network",PaperNetwork:"js/wraps/paper_network",ConceptCloud:"js/widgets/wordcloud/widget",BubbleChart:"js/widgets/bubble_chart/widget",AuthorAffiliationTool:"js/widgets/author_affiliation_tool/widget.jsx",Metrics:"js/widgets/metrics/widget",CitationHelper:"js/widgets/citation_helper/widget",OrcidBigWidget:"js/modules/orcid/widget/widget",OrcidSelector:"js/widgets/orcid-selector/widget.jsx",AffiliationFacet:"js/wraps/affiliation_facet",AuthorFacet:"js/wraps/author_facet",BibgroupFacet:"js/wraps/bibgroup_facet",BibstemFacet:"js/wraps/bibstem_facet",DataFacet:"js/wraps/data_facet",DatabaseFacet:"js/wraps/database_facet",GrantsFacet:"js/wraps/grants_facet",KeywordFacet:"js/wraps/keyword_facet",ObjectFacet:"js/wraps/simbad_object_facet",NedObjectFacet:"js/wraps/ned_object_facet",RefereedFacet:"js/wraps/refereed_facet",VizierFacet:"js/wraps/vizier_facet",GraphTabs:"js/wraps/graph_tabs",FooterWidget:"js/widgets/footer/widget",PubtypeFacet:"js/wraps/pubtype_facet",ShowAbstract:"js/widgets/abstract/widget",ShowGraphics:"js/widgets/graphics/widget",ShowGraphicsSidebar:"js/wraps/sidebar-graphics-widget",ShowReferences:"js/wraps/references",ShowCitations:"js/wraps/citations",ShowCoreads:"js/wraps/coreads",ShowSimilar:"js/wraps/similar",MetaTagsWidget:"js/widgets/meta_tags/widget",ShowToc:"js/wraps/table_of_contents",ShowResources:"js/widgets/resources/widget.jsx",ShowAssociated:"js/widgets/associated/widget.jsx",ShowRecommender:"js/widgets/recommender/widget",ShowMetrics:"js/wraps/paper_metrics",ShowExportcitation:"js/wraps/paper_export",ShowFeedback:"reactify!js/react/BumblebeeWidget?FeedbackForms",ShowLibraryAdd:"js/wraps/abstract_page_library_add/widget",IndividualLibraryWidget:"js/widgets/library_individual/widget",LibraryActionsWidget:"js/widgets/library_actions/widget.jsx",AllLibrariesWidget:"js/widgets/libraries_all/widget",LibraryListWidget:"js/widgets/library_list/widget",MyAdsFreeform:"reactify!js/react/BumblebeeWidget?MyAdsFreeform",MyAdsDashboard:"reactify!js/react/BumblebeeWidget?MyAdsDashboard",RecommenderWidget:"reactify!js/react/BumblebeeWidget?Recommender"},plugins:{}}},map:{"*":{pubsub_service_impl:"js/services/default_pubsub"}},paths:{router:"js/apps/discovery/router",analytics:"js/components/analytics",utils:"js/utils",recaptcha:"js/plugins/recaptcha",reactify:"js/plugins/reactify",es6:"js/plugins/es6",suit:"shared/dist/index.umd.production.min",babel:"libs/babel",async:"libs/requirejs-plugins/async",hbs:"libs/requirejs-plugins/hbs",sprintf:"libs/sprintf",sinon:"libs/sinon",enzyme:"libs/enzyme",mocha:"libs/mocha/mocha",chai:"libs/chai",underscore:["https://cdn.jsdelivr.net/npm/lodash@2.4.2/dist/lodash.compat.min","https://unpkg.com/lodash@2.4.2/dist/lodash.compat.min","libs/lodash"],backbone:["https://cdn.jsdelivr.net/npm/backbone@1.1.2/backbone-min","https://unpkg.com/backbone@1.1.2/backbone-min","libs/backbone"],"backbone-validation":["https://cdn.jsdelivr.net/npm/backbone-validation@0.11.3/dist/backbone-validation-amd-min","https://unpkg.com/backbone-validation@0.11.3/dist/backbone-validation-amd-min","libs/backbone-validation"],"backbone.stickit":["https://cdn.jsdelivr.net/npm/backbone.stickit@0.9.2/backbone.stickit","https://unpkg.com/backbone.stickit@0.9.2/backbone.stickit","libs/backbone.stickit"],"backbone.wreqr":["https://cdn.jsdelivr.net/npm/backbone.wreqr@1.4.0/lib/backbone.wreqr.min","https://unpkg.com/backbone.wreqr@1.4.0/lib/backbone.wreqr.min","libs/backbone.wreqr"],bootstrap:["https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min","https://unpkg.com/bootstrap@3.3.7/dist/js/bootstrap.min","libs/bootstrap/bootstrap"],bowser:["https://cdn.jsdelivr.net/npm/bowser@2.11.0/es5","https://unpkg.com/bowser@2.11.0/es5","libs/bowser"],clipboard:["https://cdn.jsdelivr.net/npm/clipboard@1.7.1/dist/clipboard.min","https://unpkg.com/clipboard@1.7.1/dist/clipboard.min","libs/clipboard"],d3:["https://cdn.jsdelivr.net/npm/d3@3.5.17/d3.min","https://unpkg.com/d3@3.5.17/d3.min","libs/d3"],"d3-cloud":["https://cdn.jsdelivr.net/npm/d3-cloud@1.2.5/build/d3.layout.cloud","https://unpkg.com/d3-cloud@1.2.5/build/d3.layout.cloud","libs/d3-cloud"],filesaver:["https://cdn.jsdelivr.net/npm/file-saver@1.3.8/FileSaver.min","https://unpkg.com/file-saver@1.3.8/FileSaver.min","libs/file-saver"],hotkeys:["https://cdn.jsdelivr.net/npm/hotkeys-js@3.8.7/dist/hotkeys.min","https://unpkg.com/hotkeys-js@3.8.7/dist/hotkeys.min","libs/hotkeys"],jquery:["https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min","https://unpkg.com/jquery@2.2.4/dist/jquery.min","libs/jquery"],"jquery-ui":["https://code.jquery.com/ui/1.12.1/jquery-ui.min","https://code.jquery.com/ui/1.12.1/jquery-ui.min","libs/jquery-ui"],jsonpath:["https://cdn.jsdelivr.net/npm/jsonpath@0.2.12/jsonpath.min","https://unpkg.com/jsonpath@0.2.12/jsonpath.min","libs/jsonpath"],marionette:["https://cdn.jsdelivr.net/npm/backbone.marionette@2.4.5/lib/backbone.marionette.min","https://unpkg.com/backbone.marionette@2.4.5/lib/backbone.marionette.min","libs/backbone.marionette"],mathjax:["https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS_HTML&amp;delayStartupUntil=configured","https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML&amp;delayStartupUntil=configured","libs/mathjax/mathjax"],moment:["https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment.min","https://unpkg.com/moment@2.22.2/min/moment.min","libs/moment"],"persist-js":["https://cdn.jsdelivr.net/npm/persist-js@0.3.1/persist-min","https://unpkg.com/persist-js@0.3.1/persist-min","libs/persist-js"],react:["https://cdn.jsdelivr.net/npm/react@16/umd/react.production.min","https://unpkg.com/react@16/umd/react.production.min","libs/react"],"react-bootstrap":["https://cdn.jsdelivr.net/npm/react-bootstrap@0.33.0/dist/react-bootstrap.min","https://unpkg.com/react-bootstrap@0.33.0/dist/react-bootstrap.min","libs/react-bootstrap"],"react-dom":["https://cdn.jsdelivr.net/npm/react-dom@17.0.2/umd/react-dom.production.min","https://unpkg.com/react-dom@17.0.2/umd/react-dom.production.min","libs/react-dom"],"prop-types":["https://cdn.jsdelivr.net/npm/prop-types@15.6/prop-types.min","https://unpkg.com/prop-types@15.6/prop-types.min","libs/prop-types"],"react-redux":["https://cdn.jsdelivr.net/npm/react-redux@7.2.4/dist/react-redux.min","https://unpkg.com/react-redux@7.2.4/dist/react-redux.min","libs/react-redux"],"react-transition-group":["https://cdn.jsdelivr.net/npm/react-transition-group@2.4.0/dist/react-transition-group.min","https://unpkg.com/react-transition-group@2.4.0/dist/react-transition-group.min","libs/react-transition-group"],redux:["https://cdn.jsdelivr.net/npm/redux@4.0.5/dist/redux.min","https://unpkg.com/redux@4.0.5/dist/redux.min","libs/redux"],"redux-thunk":["https://cdn.jsdelivr.net/npm/redux-thunk@2.3.0/dist/redux-thunk.min","https://unpkg.com/redux-thunk@2.3.0/dist/redux-thunk.min","libs/redux-thunk"],select2:["https://cdn.jsdelivr.net/npm/select2@4.0.3/dist/js/select2.min","https://unpkg.com/select2@4.0.3/dist/js/select2.min","libs/select2/select2"],"react-aria-menubutton":["https://cdn.jsdelivr.net/npm/react-aria-menubutton@7.0.3/umd/ReactAriaMenuButton","https://unpkg.com/react-aria-menubutton@7.0.3/umd/ReactAriaMenuButton","libs/react-aria-menubutton"],"react-hook-form":["https://cdn.jsdelivr.net/npm/react-hook-form@6.11.0/dist/index.umd.production.min","https://unpkg.com/react-hook-form@6.11.0/dist/index.umd.production.min","libs/react-hook-form"],"react-is":["https://cdn.jsdelivr.net/npm/react-is@17.0.2/umd/react-is.production.min","https://unpkg.com/react-is@17.0.2/umd/react-is.production.min","libs/react-is"],"react-data-table-component":["https://cdn.jsdelivr.net/npm/react-data-table-component@6.11.7/dist/react-data-table-component.umd","https://unpkg.com/react-data-table-component@6.11.7/dist/react-data-table-component.umd","libs/react-data-table-component"],"react-window":["https://cdn.jsdelivr.net/npm/react-window@1.8.6/dist/index-prod.umd","https://unpkg.com/react-window@1.8.6/dist/index-prod.umd","libs/react-window"],"react-async":["https://cdn.jsdelivr.net/npm/react-async@10.0.1/dist-umd/index","https://unpkg.com/react-async@10.0.1/dist-umd/index","libs/react-async"],"regenerator-runtime":["https://cdn.jsdelivr.net/npm/regenerator-runtime@0.13.9/runtime","https://unpkg.com/regenerator-runtime@0.13.9/runtime","libs/regenerator-runtime"],diff:["https://cdn.jsdelivr.net/npm/diff@4.0.2/dist/diff.min","https://unpkg.com/diff@4.0.2/dist/diff.min","libs/diff"],"styled-components":["https://cdn.jsdelivr.net/npm/styled-components@5.1.0/dist/styled-components.min","https://unpkg.com/styled-components@5.1.0/dist/styled-components.min","libs/styled-components"],"@hookform/resolvers":["https://cdn.jsdelivr.net/npm/@hookform/resolvers@0.1.0/dist/index.umd.production.min","https://unpkg.com/@hookform/resolvers@0.1.0/dist/index.umd.production.min","libs/hookform"],"google-analytics":["libs/g","data:application/javascript,"],yup:"libs/yup",cache:"libs/cache",polyfill:"libs/polyfill","react-flexview":"libs/react-flexview","array-flat-polyfill":"libs/array-flat-polyfill"},hbs:{templateExtension:"html",helpers:!1},babel:{presets:["env","react"]},shim:{Backbone:{deps:["backbone"],exports:"Backbone"},"backbone.stickit":{deps:["backbone"]},"backbone-validation":{deps:["backbone"]},bootstrap:{deps:["jquery","jquery-ui"]},backbone:{deps:["jquery","underscore"],exports:"Backbone"},marionette:{deps:["jquery","underscore","backbone"],exports:"Marionette"},cache:{exports:"Cache"},mocha:{exports:"mocha"},sinon:{exports:"sinon"},filesaver:{exports:"saveAs"},d3:{exports:"d3"},"d3-cloud":{deps:["d3"]},"google-analytics":{exports:"__ga__"},"jquery-ui":{deps:["jquery"]},"jquery-querybuilder":{deps:["jquery"]},sprintf:{exports:"sprintf"},"persist-js":{exports:"Persist"}}}),define("config/discovery.config",function(){}),define("js/apps/discovery/main",["config/discovery.config","module"],function(e,t){require(["router","js/components/application","js/mixins/discovery_bootstrap","js/mixins/api_access","js/components/api_feedback","analytics"],function(e,n,i,r,s,o){var a="function"==typeof window.__setAppLoadingProgress?window.__setAppLoadingProgress:function(){};n.prototype.shim();var c=window.location.href.indexOf("debug=true")>-1,u=new(n.extend(i))({debug:c,timeout:6e4}),l=u.loadModules(t.config());a(30,"Loading Modules");l.done(function(){a(80,"App Loaded"),u.activate();var t=u.getService("PubSub");t.publish(t.getCurrentPubSubKey(),t.APP_LOADED),u.configure(),a(95,"Finishing Up..."),u.bootstrap().done(function(n){a(100),u.onBootstrap(n);var i=u.getObject("DynamicConfig");i&&i.debugExportBBB&&(window.bbb=u),t.publish(t.getCurrentPubSubKey(),t.APP_BOOTSTRAPPED),t.publish(t.getCurrentPubSubKey(),t.APP_STARTING),u.start(e).done(function(){t.publish(t.getCurrentPubSubKey(),t.APP_STARTED);var e=_.debounce(function(){var e,t=function(){try{var e=_.isFunction(this.getBeeHive)&&this.getBeeHive(),t=_.isFunction(e.getObject)&&e.getObject("User");if(t)return t.getUserData("USER_DATA")}catch(e){}return{}}.call(u);"OPEN IN CURRENT TAB"===(t.externalLinkAction&&t.externalLinkAction.toUpperCase()||"AUTO")&&function t(n){clearTimeout(e),n<10&&($('a[target="_blank"]').attr("target",""),e=setTimeout(t,1e3,n+1))}(0)},3e3,{leading:!0,trailing:!1},!1);t.subscribe(t.getCurrentPubSubKey(),t.NAVIGATE,e),e();var n=function(e,t,n){e.toggleClass("show");var i='<i class="fa fa-close" aria-hidden="true"></i> Close Menu';e.hasClass("show")?t.removeClass("full-width"):(i='<i class="fa fa-bars" aria-hidden="true"></i> Show Menu',t.addClass("full-width")),n.html(i)};if($("body").on("click","button.toggle-menu",function(e){var t=$(e.target),i=t.parents().eq(1).find(".nav-container"),r=t.parents().eq(1).find(".user-pages__main-content");n(i,r,t),$("a",i).on("click",function(){n(i,r,t)})}),$("body").on("click","#abs-full-txt-toggle",function(){$("#resources-container").toggleClass("show"),$("#resources-container").hasClass("show")?$("#abs-full-txt-toggle").text("Hide Sources"):$("#abs-full-txt-toggle").text("Full Text Sources")}),$("body").on("click","#results-actions-toggle",function(){$("#query-info-container").toggleClass("show"),$("#query-info-container").hasClass("show")?$("#results-actions-toggle").html('<i class="fa fa-times" title="close actions" aria-hidden="true"></i> Actions'):$("#results-actions-toggle").html('<i class="fa fa-book" title="open actions" aria-hidden="true"></i> Actions')}),$("body").on("click","#skip-to-main-content",function(){return $("#main-content").trigger("focus"),!1}),$("body").hasClass("is-proxied")){var i=window.getCanonicalUrl(),r='\n              <p>\n                You are using a proxied version of ADS, we recommend you switch to the regular non-proxied URL: \n                <a href="'.concat(i).concat(location.pathname,'" rel="noopener noreferrer">').concat(i,'</a></p>\n              <p>\n                Configure authenticated access to publisher content via the Library Link Server in your account  \n                <a href="').concat(i,'/user/settings/librarylink" rel="noopener noreferrer">preferences</a>.\n              </p>\n            ');t.publish(t.getCurrentPubSubKey(),t.ALERT,new s({type:"danger",msg:r}))}if(window.__PAGE_LOAD_TIMESTAMP){var a=new Date-window.__PAGE_LOAD_TIMESTAMP;o("send",{hitType:"timing",timingCategory:"Application",timingVar:"Loaded",timingValue:a});var l=localStorage.getItem("darkSwitch"),d="systemSetting",h="light";null!==l?"on"===l?(d="appSetting",h="dark"):(d="appSetting",h="light"):window.matchMedia("(prefers-color-scheme: dark)").matches&&(d="systemSetting",h="dark"),o("send","event","uitheme",d,h),c&&console.log("Application Started: "+a+"ms")}window.clearTimeout(window.APP_LOADING_TIMER)})})}).fail(function(){o("send","event","introspection","failed-load",arguments),c||u.redirect("500.html")}).fail(function(){o("send","event","introspection","failed-reloading",arguments),c||u.reload("404.html")})})}),function(e){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("cache",[],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).dsjslib=e()}}(function(){return function(){return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){return r(t[o][1][e]||e)},l,l.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}}()({1:[function(e,t,n){var i,r,s=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(i===setTimeout)return setTimeout(e,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(e){i=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,l=[],d=!1,h=-1;function p(){d&&u&&(d=!1,u.length?l=u.concat(l):h=-1,l.length&&f())}function f(){if(!d){var e=c(p);d=!0;for(var t=l.length;t;){for(u=l,l=[];++h<t;)u&&u[h].run();h=-1,t=l.length}u=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new g(e,t)),1!==l.length||d||c(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],2:[function(e,t,n){(function(e){!function(){"use strict";function n(e){var t=this;!function(e){var n=e.maximumWeight,i=e.weigherFunction,r=e.maximumSize,s="number"==typeof n&&n>-1,o="function"==typeof i;if(!s&&o||s&&!o)throw new Error("Maximum weight or weight function has illegal values");if(s&&o&&"number"==typeof r&&r>-1)throw new Error("Both max weight and size can't be configured");t._spec={loaderFn:"function"==typeof e.loaderFunction&&e.loaderFunction,expiresAfterWrite:"number"==typeof e.expiresAfterWrite?1e3*e.expiresAfterWrite:null,recordStats:e.recordStats,maxSize:r,maxWeight:n,weighFn:i,onRemove:"function"==typeof e.onRemove&&e.onRemove}}(e),i.apply(this)}n.prototype._REMOVAL_CAUSE_I="explicit",n.prototype._REMOVAL_CAUSE_C="capacity",n.prototype._REMOVAL_CAUSE_E="expired";var i=function(){this._accessQueue=new r("A"),this._writeQueue=this._spec.expiresAfterWrite?new r("W"):null;var e=n(this._REMOVAL_CAUSE_C,this._canReap,this._accessQueue,this),t=n(this._REMOVAL_CAUSE_E,this.isExpired,this._writeQueue,this);function n(e,t,n,i){return n?function(r){if(r)for(var s=n.tail.prev(n),o=null;s&&t.apply(i,[s]);)s&&(o=s.prev(n),i._rmEntry(s,e),s=o)}.bind(n):function(){}}this._cleanup=function(n){e(n),t(this._writeQueue)},this.size=0,this.weight=0,this._cache=Object.create(null),Object.defineProperty(this,"stats",{value:{hitCount:0,missCount:0,requestCount:0},configurable:!0})};function r(e){this.tail=this.head=Object.create(s.prototype),this.type=e}function s(e,t,n,i){this.key=e,this.loading=n,n||this.setValue(t),this.onLoad=i?[i]:[],this.writeTime=Date.now()}s.prototype.setValue=function(e){if(void 0===e||null===e)throw new Error("Illegal value for key "+e);this.value=e,this.writeTime=Date.now()},s.prototype.moveToHead=function(e){var t=this;e.forEach(function(e){if(e){var n=e.head;t.next(e,n),n.prev(e,t),e.head=t}})},s.prototype.next=function(e,t){var n="next"+e.type;return void 0!==t&&(this[n]=t),this[n]},s.prototype.prev=function(e,t){var n="prev"+e.type;return void 0!==t&&(this[n]=t),this[n]},s.prototype.remove=function(e){if(e){var t=this.prev(e),n=this.next(e);t?(t.next(e,n),n.prev(e,t)):(n.prev(e,null),e.head=n),n.next(e)||(e.tail=n),this.next(e,null),this.prev(e,null)}},s.prototype.promote=function(){var e=this;Array.prototype.slice.call(arguments).forEach(function(t){t&&e.prev(t)&&(e.remove(t),e.moveToHead([t]))})},s.prototype.forEach=function(e,t){for(var n=this;n;)e.call(this,n),n=n.next(t)},n.prototype.put=function(e,t){var n=this._cache[e];n?(n.setValue(t),n.writeTime=Date.now(),n.promote(this._accessQueue,this._writeQueue),this._cleanup(!1)):this._createEntry(e,t)},n.prototype._createEntry=function(e,t,n,i){var r=new s(e,t,n,i);return this._cleanup(!0),this._cache[e]=r,this._updateCacheSize(r,!0),r.moveToHead([this._accessQueue,this._writeQueue]),r},n.prototype.isExpired=function(e){var t=this._spec.expiresAfterWrite,n=Date.now();return!e.loading&&t&&t>0&&n-e.writeTime>t},n.prototype._updateCacheSize=function(e,t){var n;this._spec.maxWeight&&(n=this._spec.weighFn.apply(this,[e.key,e.value]),this.weight+=t?n:-n),this.size+=t?1:-1},n.prototype.get=function(t,n){n=n||function(){},this.stats.requestCount++;var i=this;e.nextTick(function(){(function(e,t){var n=this._cache[e];if(n){if(n.loading)return this.stats.missCount++,void n.onLoad.push(t);this.isExpired(n)?(this.stats.missCount++,this._notify(n,this._REMOVAL_CAUSE_E),n.loading=!0,n.onLoad.push(t),o(this,a.bind(n),e)):(n.promote(this._accessQueue),this.stats.hitCount++,t.apply(null,[null,n.value]))}else this.stats.missCount++,n=this._createEntry(e,null,!0,t),o(this,a.bind(n),e)}).call(i,t,n)})};var o=function(e,t,n){var i=e._spec.loaderFn;i&&i.apply(null,[n,function(n,i){t(e,n,i)}])},a=function(e,t,n){if(!t)try{this.setValue(n),this.promote(e._accessQueue,e._writeQueue),this.onLoad.forEach(function(e){e.apply(null,[t,n])}),this.onLoad=[],this.loading=!1}catch(e){t=e}t&&(this.onLoad.forEach(function(e){e.apply(null,[t,n])}),e._rmEntry(this))};function c(e,t,n){var i,r=null,s=e._spec.loaderFn;return s&&(s.apply(null,[n,function(e,t){i=e,r=t}]),t(i,r)),r}n.prototype.getSync=function(e){var t=arguments.length>2&&arguments[2];this.stats.requestCount++;var n,i=this._cache[e],r=this;return i?this.isExpired(i)?(this.stats.missCount++,t?this._rmEntry(i,this._REMOVAL_CAUSE_E):n=c(r,function(e,t){if(e)throw e;r._notify(i,r._REMOVAL_CAUSE_E),i.setValue(t),i.promote(r._accessQueue,r._writeQueue)},e)):(i.promote(this._accessQueue),n=i.value,this.stats.hitCount++):(this.stats.missCount++,t||(n=c(r,function(t,n){if(t)throw t;r._createEntry(e,n)},e))),n},n.prototype.getIfPresent=function(e){return this.getSync(e,null,!0)},n.prototype.invalidate=function(e){var t=this._cache[e];this._rmEntry(t,this._REMOVAL_CAUSE_I)},n.prototype._notify=function(e,t){this._spec.onRemove&&this._spec.onRemove.apply(null,[e.key,e.value,t])},n.prototype._rmEntry=function(e,t){e.remove(this._accessQueue),e.remove(this._writeQueue),this._updateCacheSize(e,!1),delete this._cache[e.key],t&&this._notify(e,t)},n.prototype.invalidateAll=function(){var e=this;Object.keys(this._cache).forEach(function(t){e.invalidate(t)})},n.prototype._canReap=function(){return this._spec.maxSize&&this.size>=this._spec.maxSize||this._spec.maxWeight&&this.weight>this._spec.maxWeight},t.exports=n}()}).call(this,e("_process"))},{_process:1}]},{},[2])(2)}),define("js/components/generic_module",["backbone","underscore"],function(e,t){var n=["className","activate"],i=function(e){e=e||{},this.mid=t.uniqueId("module"),t.extend(this,t.pick(e,n)),this.initialize.call(this,e)};return t.extend(i.prototype,e.Events,{className:"GenericModule",initialize:function(){},destroy:function(){},activate:function(e){t.extend(this,t.pick(e,n))}}),i.extend=e.Model.extend,i}),define("js/components/pubsub_events",[],function(){return{START_SEARCH:"[PubSub]-New-Query",INVITING_REQUEST:"[PubSub]-Inviting-Request",DELIVERING_REQUEST:"[PubSub]-New-Request",EXECUTE_REQUEST:"[PubSub]-Execute-Request",EXECUTE_STORED_QUERY:"[PubSub]-Execute-Stored-Query",DELIVERING_RESPONSE:"[PubSub]-New-Response",CLOSING_GATES:"[PubSub]-Closing",CLOSED_FOR_BUSINESS:"[PubSub]-Closed",OPENING_GATES:"[PubSub]-Opening",OPEN_FOR_BUSINESS:"[PubSub]-Ready",SMALL_FIRE:"[PubSub]-Problem",BIG_FIRE:"[PubSub]-Big-Problem",CITY_BURNING:"[PubSub]-Disaster",FEEDBACK:"[FC]-FeedBack",DISPLAY_DOCUMENTS:"[Router]-Display-Documents",DISPLAY_DOCUMENTS_DETAILS:"[Router]-Display-Documents-Details",GET_QTREE:"[FC]-GetQTree",NAVIGATE:"[Router]-Navigate-With-Trigger",PAGE_CHANGE:"[Navigator]Page-Changed",CUSTOM_EVENT:"[PubSub]-Custom-Event",ARIA_ANNOUNCEMENT:"[PubSub]-Aria-Announcement",USER_ANNOUNCEMENT:"[PubSub]-User-Announcement",ALERT:"[Alert]-Message",ORCID_ANNOUNCEMENT:"[PubSub]-Orcid-Announcement",APP_LOADED:"[App]-Application-Loaded",APP_BOOTSTRAPPED:"[App]-Application-Bootstrapped",APP_STARTING:"[App]-Application-Starting",APP_STARTED:"[App]-Application-Started",APP_EXIT:"[App]-Exit",PAPER_SELECTION:"[User]-Paper-Selection",BULK_PAPER_SELECTION:"[User]-Bulk-Paper-Selection",STORAGE_PAPER_UPDATE:"[User]-Paper-Update",LIBRARY_CHANGE:"[PubSub]-Library-Change"}}),define("js/components/pubsub_key",["underscore"],function(e){var t=function(t){e.extend(this,t)};return e.extend(t,{newInstance:function(n){var i={id:e.has(n,"id")?n.id:e.uniqueId(":psk"),creator:e.has(n,"creator")?n.creator:null};return new t({getId:function(){return i.id},getCreator:function(){return i.creator}})}}),t}),define("js/mixins/dependon",["underscore","js/components/pubsub_events","js/components/pubsub_key"],function(e,t,n){return{BeeHive:{setBeeHive:function(t){if(e.isEmpty(t))throw new Error("Huh? Empty Beehive? Trying to be funny?");this.__beehive=t},getBeeHive:function(){if(!this.hasBeeHive())throw new Error("The BeeHive is inactivate (or dead :<})");return this.__beehive},hasBeeHive:function(){return!(!this.__beehive||!(this.__beehive.active||this.__beehive.__facade__&&this.__beehive.getActive()))},getPubSub:function(){if(!this.hasBeeHive())throw new Error("The BeeHive is inactive (or dead >:})");if(this.__ctx||(this.__ctx={}),this.__ctx.pubsub)return this.__ctx.pubsub;var i=this.__beehive.getService("PubSub");return i&&i.__facade__?i:(this.__ctx.pubsub={_key:i.getPubSubKey(),_exec:function(t,r){if((r=e.toArray(r))[0]instanceof n)throw Error("You have given us a PubSub key, this.publish() method does not need it.");r.unshift(this._key),i[t].apply(i,r)},publish:function(){this._exec("publish",arguments)},subscribe:function(){this._exec("subscribe",arguments)},subscribeOnce:function(){this._exec("subscribeOnce",arguments)},unsubscribe:function(){this._exec("unsubscribe",arguments)},getCurrentPubSubKey:function(){return this._key}},e.extend(this.__ctx.pubsub,t),this.__ctx.pubsub)},hasPubSub:function(){return!!this.hasBeeHive()&&e.isObject(this.__beehive.getService("PubSub"))}},App:{setApp:function(t){if(e.isUndefined(t))throw new Error("App object cannot be empty");this.__app=t},getApp:function(){return this.__app},hasApp:function(){return!e.isEmpty(this.__app)}}}}),define("js/components/transition",["underscore"],function(e){var t=function(t,n){if(!e.isString(t))throw new Error("Endpoint name must be a string");this.endpoint=t,e.extend(this,n)};return e.extend(t.prototype,{route:!1,trigger:!1,replace:!1,title:!1,execute:function(){throw new Error("You must override this method")}}),t}),define("js/components/transition_catalog",["underscore","js/components/transition"],function(e,t){var n=function(e){this._catalog={}};return e.extend(n.prototype,{add:function(e){if(!(e instanceof t))throw new Error("You can add only Transition objects");return this._catalog[e.endpoint]=e,e},get:function(e){return this._catalog[e]},remove:function(e){delete this._catalog[e]}}),n}),define("analytics",["underscore","jquery"],function(e,t){var n={resolver:{hooks:["toc-link-followed","abstract-link-followed","citations-link-followed","associated-link-followed"],types:["abstract","citations","references","metrics","coreads","similar","graphics","associated","toc"],url:e.template("link_gateway/<%= bibcode %>/<%= target %>")}},i=function(i,r){e.isString(i)&&e.isPlainObject(r)&&e.has(r,"target")&&e.forEach(n,function(n){var s,o=null;if(e.forEach(n.types,function(t){e.isArray(t)?t[0]===r.target&&e.has(t[1],"redirectTo")&&(o=t[1].redirectTo):t===r.target&&(o=t)}),e.contains(n.hooks,i)&&o){var a=e.assign({},r,{target:o});s=r.url?r.url:n.url(a),t.ajax({url:s,type:"GET"})}})},r=[],s=window.GoogleAnalyticsObject||"ga",o=function(){if(window[s]){for(var e=0;e<r.length;e++)window[s].apply(this,r[e]);r=[]}};return function(){return i.apply(null,e.rest(arguments,3)),window[s]?(r.length>0&&o(),window[s].apply(this,arguments),!0):(console.log("Buffering GA signal",arguments),r.push(arguments),setTimeout(o,1e3),!1)}}),define("js/components/navigator",["underscore","jquery","cache","js/components/generic_module","js/mixins/dependon","js/components/transition","js/components/transition_catalog","analytics"],function(e,t,n,i,r,s,o,a){var c=i.extend({initialize:function(e){e=e||{},this.router=e.router,this.catalog=new o},activate:function(t){this.setBeeHive(t),this.storage=t.getObject("AppStorage");var n=this.getPubSub();n.subscribe(n.NAVIGATE,e.bind(this.navigate,this)),n.subscribe(n.CUSTOM_EVENT,e.bind(this._onCustomEvent,this))},_onCustomEvent:function(e,t){"update-document-title"===e&&this._updateDocumentTitle(t)},_cleanRoute:function(e){var t=e.match(/[#\/]?([^\/]*)\//);return t&&t.length>1?"/"+t[1]:e},_setPageAndEmitEvent:e.debounce(function(e,t){a("set","page",this._cleanRoute(e)),a("send","pageview",{dimension1:t})},300),navigate:function(n,i,r){var s=t.Deferred();if(!(this.router&&this.router instanceof Backbone.Router))return s.reject(new Error("Navigator must be given 'router' instance")),s.promise();var o=this.catalog.get(n);if(!o)return this.handleMissingTransition(arguments),s.reject(new Error("Missing route; going to 404")),s.promise();if(!o.execute)return s.resolve().promise();var a,c=e.bind(function(){var e=!!(o.replace||i&&i.replace);if(""===o.route||o.route){var r=""===o.route?"/":o.route;this._setPageAndEmitEvent(r,n),this.router.navigate(r,{trigger:!1,replace:e})}t("head").find("meta[data-highwire]").remove(),this._updateDocumentTitle(o.title),s.resolve()},this);try{(a=o.execute.apply(o,arguments))&&e.isFunction(a.then)?a.then(c):c()}catch(e){this.handleTransitionError(o,e,arguments);var u=new Error("Error transitioning to route; going to 404");return s.reject(u).promise()}return s.promise()},_updateDocumentTitle:function(t){if(!e.isUndefined(t)&&!1!==t){var n=this.storage.getDocumentTitle(),i=e.bind(function(e){document.title=""===e?"NASA/ADS":e+" - NASA/ADS",this.storage.setDocumentTitle(e)},this);t!==n&&i(t)}},handleMissingTransition:function(e){console.error("Cannot handle 'navigate' event: "+JSON.stringify(arguments));var t=this.getPubSub();t.publish(t.BIG_FIRE,"navigation-error",arguments),this.catalog.get("404")&&t.publish(t.NAVIGATE,"404")},handleTransitionError:function(e,t,n){console.error("Error while executing transition",e,n),console.error(t.stack);var i=this.getPubSub();i.publish(i.CITY_BURNING,"navigation-error",arguments),this.catalog.get("404")&&i.publish(i.NAVIGATE,"404")},set:function(){if(1==arguments.length){if(arguments[1]instanceof s)return this.catalog.add(arguments[1]);throw new Error("You must be kiddin' sir!")}if(2==arguments.length){var t=arguments[0];if(e.isFunction(arguments[1]))return this.catalog.add(new s(t,{execute:arguments[1]}));if(e.isObject(arguments[1])&&arguments[1].execute)return this.catalog.add(new s(t,arguments[1]));throw new Error("Himmm, I dont know how to create a catalog rule with this input:",arguments)}throw new Error("Himmm, I dont know how to create a catalog rule with this input:",arguments)},get:function(e){return this.catalog.get(e)}});return e.extend(c.prototype,r.BeeHive),c}),define("js/components/facade",["underscore","js/components/facade"],function(e,t){return(t=function(e,t){var n;return n={},this.mixIn(e,t,n),n.mixIn=this.mixIn,n}).prototype.mixIn=function(t,n,i){var r,s;for(r in i=i||this,t)if(s=t[r],r in n){var o=n[r];if("function"==typeof s)i[r]=e.bind(s,n);else if("function"==typeof o)i[r]=e.bind(o,n);else if(e.isUndefined(o));else if(e.isString(o)||e.isNumber(o)||e.isBoolean(o)||e.isDate(o)||e.isNull(o)||e.isRegExp(o))i["get"+r.substring(0,1).toUpperCase()+r.substring(1)]=e.bind(function(){return this.ctx[this.name]},{ctx:n,name:r}),i[r]=o;else if(o.hasOwnProperty("__facade__")&&o.__facade__)i[r]=o;else{if(!(e.isObject(o)&&"getHardenedInstance"in o))throw new Error("Sorry, you can't wrap '"+r+"': "+o);i[r]=o.getHardenedInstance()}}else{if("function"!=typeof s)throw new Error("Unknown key: "+r+"("+s+")");i[r]=e.bind(s,n)}return i.__facade__=!n||Boolean(!n.constructor||(!n.constructor.name||n.constructor.name)),i},t}),define("js/mixins/hardened",["underscore","js/components/facade"],function(e,t){return{_getHardenedInstance:function(e,n){if(!("hardenedInterface"in this||e))throw Error("Error: this.hardenedInterface is not defined");return new t(e||("hardenedInterface"in this?this.hardenedInterface:{}),n)},getHardenedInstance:function(e){return this._getHardenedInstance(e,this)}}}),define("js/components/api_feedback",["underscore","backbone","js/mixins/hardened"],function(e,t,n){var i=function(t){e.extend(this,e.defaults(t||{},{code:200,msg:void 0})),this.setCode(this.code)};i.CODES={INVALID_PASSWORD:498,ACCOUNT_NOT_FOUND:495,ALREADY_LOGGED_IN:493,REQUIRES_LOGIN:491,TOO_MANY_CHARACTERS:486,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,INTERNAL_SERVER_ERROR:500,BAD_GATEWAY:502,SERVER_ERROR:503,TOO_MANY_FAILURES:580,ALL_FINE:200,KEEP_WAITING:190,TESTING:0,MAKE_SPACE:-1,UNMAKE_SPACE:-1.1,SEARCH_CYCLE_STARTED:-2,SEARCH_CYCLE_FAILED_TO_START:-3,SEARCH_CYCLE_PROGRESS:-4,SEARCH_CYCLE_STOP_MONITORING:-5,SEARCH_CYCLE_FINISHED:-6,QUERY_ASSISTANT:-7,ALERT:-8,CANNOT_ROUTE:-9,API_REQUEST_ERROR:-10,BIBCODE_DATA_REQUESTED:-11};var r={};return e.each(e.pairs(i.CODES),function(e){r[e[1]]=e[0]}),e.extend(i.prototype,{hardenedInterface:{code:"integer value of the code",msg:"string message",toJSON:"for cloning",getApiRequest:"to get the original request",getSenderKey:"retrieve the senders key"},initialize:function(){},toJSON:function(){return{code:this.code,msg:this.msg}},setCode:function(e){if(!r[e])throw new Error("This code is not in the list ApiCodes - please extend js/components/api_feedback first:",this.code);this.code=e},setApiRequest:function(e){this.req=e},getApiRequest:function(){return this.req},setMsg:function(e){this.msg=e},getSenderKey:function(){return this.senderKey},setSenderKey:function(e){this.senderKey=e}},n),i.extend=t.Model.extend,i}),define("js/components/multi_params",["backbone","underscore","jquery"],function(e,t,n){return e.Model.extend({locked:!1,_checkLock:function(){if(!0===this.locked)throw Error("Object locked for modifications")},isLocked:function(){return this.locked},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},clone:function(){if(this.isLocked()){var e=new this.constructor(this.attributes);return e.lock(),e}return new this.constructor(this.attributes)},hasVal:function(e){return!t.isEmpty(this.get(e))},_validate:function(e,n){for(var i in e){if(!t.isString(i))throw new Error("Keys must be strings, not: "+i);var r=e[i];if(r=t.without(t.flatten(r),"",!1,null,void 0,NaN),!t.isArray(r))throw new Error("Values were not converted to an Array");if(t.isEmpty(r)&&!0!==n.unset)throw new Error("Empty values not allowed");if(!t.every(r,function(e){return t.isString(e)||t.isNumber(e)&&!t.isNaN(e)}))throw new Error("Invalid value (not a string or number): "+r);e[i]=r}return!0},set:function(n,i,r){var s;if(this._checkLock(),null==n)return this;for(var o in"object"===_typeof(n)?(s=n,r=i):(s={})[n]=i,s){var a=s[o];t.isArray(a)||(s[o]=t.flatten([a]))}e.Model.prototype.set.call(this,s,r)},unset:function(){this._checkLock(),e.Model.prototype.unset.apply(this,arguments)},add:function(n,i,r){var s;if(this._checkLock(),null==n)return this;for(var o in"object"===_typeof(n)?(s=n,r=i):(s={})[n]=i,s){var a=s[o];t.isArray(a)||(a=t.flatten([a])),this.has(o)&&(a=t.clone(this.get(o)).concat(a)),s[o]=a}e.Model.prototype.set.call(this,s,r)},sync:function(){throw Error("MultiParams cannot be saved to server")},url:function(e){e||(e=this.attributes);var i=t.pairs(e).sort(function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}),r=n.param(t.object(i),!0);return r=(r=r.replace(/\+/g,"%20")).replace(/%E2%80%9[ECD]/g,"%22")},parse:function(e,n){if(t.isString(e)){var i={};return(e=decodeURI(e)).indexOf("?")>-1&&(i["#path"]=[e.slice(0,e.indexOf("?"))],e=e.slice(e.indexOf("?")+1)),e.indexOf("#")>-1&&(i["#hash"]=this._parse(e.slice(e.indexOf("#")+1)),e=e.slice(0,e.indexOf("#"))),i["#query"]=this._parse(e),this._checkParsed(i)}return this._checkParsed(e)},_parse:function(e){var t,n={};if(!e.trim())return n;for(var i,r,s=e.slice(e.indexOf("?")+1).split("&"),o=0;o<s.length;o++){t=s[o].split("="),i=decodeURIComponent(t[0].split("+").join(" "));var a=t[1];t.length>2&&(t.shift(),a=t.join("=")),r=decodeURIComponent(a.replace(/%(?!\d|[ABCDEF]+)/gi,"%25").split("+").join(" ")),void 0!==n[i]?n[i].push(r):n[i]=[r]}return n},_checkParsed:function(e){return t.isObject(e)&&"#query"in e?e["#query"]:e},load:function(e){this._checkLock();var t=this.parse(e);return this.clear(),this.set(t),this}})}),define("js/components/solr_params",["js/components/multi_params","backbone","underscore","jquery"],function(e,t,n,i){return e.extend({fieldsToConcatenate:[],defaultOperator:" ",fieldProcessors:{"*":function(e,t){return[e.join(t.defaultOperator)]}},initialize:function(e,t){t&&n.extend(this,n.pick(t,["fieldsToConcatenate","defaultOperator","fieldProcessors"]))},url:function(t,i){for(var r=n.clone(this.attributes),s=this.fieldsToConcatenate.length,o="",a=0;a<s;a++)o=this.fieldsToConcatenate[a],this.has(o)&&(this.fieldProcessors[o]?r[o]=this.fieldProcessors[o](this.get(o),this):r[o]=this.fieldProcessors["*"](this.get(o),this));return e.prototype.url.call(this,r)}})}),define("js/components/api_query",["backbone","underscore","js/components/solr_params","js/components/facade"],function(e,t,n,i){var r={add:"add values",set:"set (replace existing)",get:"get values",has:"has a key",hasVal:"more specific `has` using _.isEmpty",url:"url string of the params",load:"loads query as a string",clear:"clears all values",unset:"removes a key",toJSON:"values back as JSON object",clone:"make a copy",isLocked:!0,lock:!0,unlock:!0,pairs:"get all values as pairs",keys:"as keys",values:"only values",hasChanged:"whether this object has modification (since its creation)",previousAttributes:"get all changed attributes",previous:"previous values for a given attribute"},s=function(e,t){this.innerQuery=new i(r,e instanceof n?e:new n(e,t))},o={};return t.each(t.keys(r),function(e,t,n){o[e]=function(){return this.innerQuery[e].apply(this.innerQuery,arguments)}}),t.extend(s.prototype,o,{clone:function(){var e=this.innerQuery.clone.apply(this.innerQuery,arguments);return new s(e)},load:function(){var e=this.innerQuery.load.apply(this.innerQuery,arguments);return new s(e)}}),s}),define("js/components/api_query_updater",["underscore","js/components/api_query"],function(e,t){var n=function(t,n){if(!t||!e.isString(t))throw new Error("You must initialize the ApiQueryUpdater with a context (which is a string)");this.context=t,this.defaultOperator=" ",this.operators=[" ","AND","OR","NOT","NEAR"],this.defaultMode="limit",this.operationModes=["limit","exclude","expand","replace","remove"],this.impossibleString="",e.extend(this,n)};return e.extend(n.prototype,{updateQuery:function(t,n,i,r,s){if(s=e.defaults({},s,{prefix:"__"}),!n||!e.isString(n))throw new Error("You must tell us what parameter to update in the ApiQuery");var o,a,c,u,l,d=this._n(n,s.prefix),h=e.clone(t.get(n));if(u=this._getExistingVals(t,d),r=this._sanitizeConditionAsArray(r),"limit"==(i=this._sanitizeMode(i)))l="AND";else if("exclude"==i)l="NOT";else if("expand"==i)l="OR";else{if("replace"==i)return this._closeExistingVals(t,this._n(n,s.prefix)),t.set(this._n(n,s.prefix),["AND",r[0]]),t.set(n,r[0]);if("remove"!=i)throw new Error("Unsupported mode/operator:",i);l=u[0]}if(!t.has(n)){var p=[l].concat(r);return t.set(n,this._buildQueryFromConditions(p)),void t.set(this._n(n,s.prefix),p)}if(u){if(u[0]!==l)return this._closeExistingVals(t,d),this.updateQuery(t,n,i,r);o=this._buildQueryFromConditions(u)}else if(u=[l],1==h.length)if(-1==h[0].indexOf(" "))o=h[0],u.push(h[0]);else{o=h[0];var f=h[0].toLowerCase();f.indexOf(" and ")>-1||f.indexOf(" or ")>-1||f.indexOf(" not ")>-1||f.indexOf(" near")>-1||f.indexOf("(")>2?u.push("("+h[0]+")"):u.push(h[0])}else o=this.impossibleString;if("limit"==i||"expand"==i){c=e.union(u,r),a=this._buildQueryFromConditions(c);var g=e.clone(h);if(this._modifyArrayReplaceString(g,o,a))return t.set(n,g),void t.set(d,c)}if("exclude"==i){var m=e.clone(u);m[0]="OR",o=" NOT "+this._buildQueryFromConditions(m),c=e.union(u,r);var b=e.clone(c);b[0]="OR",a=" NOT "+this._buildQueryFromConditions(b);g=e.clone(h);if(this._modifyArrayReplaceString(g,o,a))return t.set(n,g),void t.set(d,c)}else if("remove"==i){c=e.difference(u,r),a=this._buildQueryFromConditions(c);g=e.clone(h);if(this._modifyArrayReplaceString(g,o,a))return t.set(n,g),void t.set(d,c)}"limit"==i?c=this._modifyArrayAddString(h,r,"AND"):"exclude"==i?c=this._modifyArrayAddString(h,r,"NOT"):"expand"==i&&(c=this._modifyArrayAddString(h,r,"OR")),t.set(d,c),t.set(n,h)},needsEscape:function(e){for(var t,n=0;n<e.length;n++)if("\\"==(t=e[n])||"+"==t||"-"==t||"!"==t||"("==t||")"==t||":"==t||"^"==t||"["==t||"]"==t||'"'==t||"{"==t||"}"==t||"~"==t||"*"==t||"?"==t||"|"==t||"&"==t||"/"==t)return!0;return!1},escape:function(e){for(var t,n=[],i=0;i<e.length;i++)"\\"!=(t=e[i])&&"+"!=t&&"-"!=t&&"!"!=t&&"("!=t&&")"!=t&&":"!=t&&"^"!=t&&"["!=t&&"]"!=t&&'"'!=t&&"{"!=t&&"}"!=t&&"~"!=t&&"*"!=t&&"?"!=t&&"|"!=t&&"&"!=t&&"/"!=t||n.push("\\"),n.push(t);return n.join("")},escapeInclWhitespace:function(e){for(var t,n=[],i=0;i<e.length;i++)"\\"!=(t=e[i])&&"+"!=t&&"-"!=t&&"!"!=t&&"("!=t&&")"!=t&&":"!=t&&"^"!=t&&"["!=t&&"]"!=t&&'"'!=t&&"{"!=t&&"}"!=t&&"~"!=t&&"*"!=t&&"?"!=t&&"|"!=t&&"&"!=t&&"/"!=t&&" "!=t&&"\t"!=t||n.push("\\"),n.push(t);return n.join("")},quoteIfNecessary:function(e,t,n){return this.quote(e,t,n,!0)},quote:function(t,n,i,r){n||(n='"'),i||(i=n),e.isUndefined(r)&&(r=!1);for(var s,o=[],a=!1,c=0;c<t.length;c++)"\\"!=(s=t[c])&&"+"!=s&&"-"!=s&&"!"!=s&&"("!=s&&")"!=s&&":"!=s&&"^"!=s&&"["!=s&&"]"!=s&&'"'!=s&&"{"!=s&&"}"!=s&&"~"!=s&&"|"!=s&&"&"!=s&&"/"!=s&&" "!=s&&"\t"!=s||(a=!0),s!=n&&s!=i||!(0==c||c>0&&"\\"!==t[c-1])||o.push("\\"),o.push(s);return 1==r&&"\\"==o[0]&&'"'==o[1]&&"\\"==o[o.length-2]&&'"'==o[o.length-1]?(o[0]="",o[o.length-2]="",o.join("")):a||0==r?n+o.join("")+i:o.join("")},saveTmpEntry:function(e,t,n){var i,r=this._getTmpStorage(e,!0);return t in r&&(i=r[t]),r[t]=n,i},removeTmpEntry:function(e,t){var n=this._getTmpStorage(e,!0),i=n[t];return delete n[t],i},getTmpEntry:function(e,t,n){var i;return t in(i=n?this._getTmpStorage(e,!0):this._getTmpStorage(e,!1))?i[t]:(i[t]=n,n)},hasTmpEntry:function(e,t){return t in this._getTmpStorage(e)},_getTmpStorage:function(e,t){var n=this._n("__tmpStorage");if(!e.hasOwnProperty(n)){if(!t)return{};e[n]={}}return e[n]},_n:function(t,n){return(e.isString(n)?n:"__")+this.context+"_"+t},_buildQueryFromConditions:function(e){if(e.length<=1)throw new Error("Violation of contract: first condition is always an operator");var t=e[0];return" "!=t&&(t=" "+t+" "),"("+e.slice(1).join(t)+")"},_modifyArrayReplaceString:function(t,n,i,r){var s=0;if(r||(r=-1),!n)throw new Error("Your search is empty, you fool");return e.each(t,function(e,o){r>0&&s>r||e.indexOf(n)>-1&&(t[o]=e.replace(n,i),s+=1)}),s},_modifyArrayAddString:function(e,t,n){if(!(0!=e.length&&""!=e[e.length-1].trim()||"NOT"!=n&&"NEAR"!=n))throw new Error("Invalid operation; cannot apply NOT/NEAR on single clause");var i=[n,e[e.length-1]].concat(t);return e[e.length-1]=this._buildQueryFromConditions(i),i},_getExistingVals:function(e,t,n){return e.has(t)?e.get(t):n},_closeExistingVals:function(e,t){e.unset(t)},_sanitizeMode:function(t){if(!t)return this.defaultMode;var n=e.indexOf(this.operationModes,t);if(-1==n)throw new Error("Unkwnown mode: "+t);return this.operationModes[n]},_sanitizeOperator:function(t){if(!t)return this.defaultOperator;if(!e.isString(t))throw new Error("Operator must be a string");if(""==t.trim())return this.defaultOperator;t=t.toUpperCase();var n=e.indexOf(this.operators,t);if(-1==n)throw new Error("Unknown operator: ",t);return this.operators[n]},_sanitizeConditionAsArray:function(t){if(!t)throw new Error("The condition must be set (string/array of strings)");if(e.isString(t))return[t];if(0==(t=e.without(e.flatten(t),"",!1,null,void 0,NaN)).length)throw new Error("After removing empty values, no condition was left");return t},clean:function(n){var i={};return n&&n.keys&&e.each(n.keys(),function(e){"__"!=e.substring(0,2)&&(i[e]=n.get(e))}),new t(i)}}),n}),define("js/components/json_response",["underscore","backbone","js/components/api_query"],function(e,t,n){var i=function(t,n){var i,r=t||{};n||(n={}),this.rid=e.uniqueId("r"),this.readOnly=!n.hasOwnProperty("readOnly")||n.readOnly,this._url=n.hasOwnProperty("url")?n.url:null,n.parse&&(r=this.parse(r,n)||{}),(i=e.result(this,"defaults"))&&(r=e.defaults({},r,i)),this.attributes=r,this.initialize.apply(this,arguments)};return e.extend(i.prototype,{initialize:function(){},getApiQuery:function(){return this.apiQuery},setApiQuery:function(e){if(e){if(!(e instanceof n))throw new Error("Only ApiQuery instances accepted");this.apiQuery=e}},toJSON:function(e){return this._clone(this.attributes)},url:function(){return this._url?this._url:this.rid},set:function(e,t,n){if(this.readOnly)throw Error("You can't change read-only response object");var i=this._split(e);if(1==i.length)this.attributes[i[0]]=t;else{this.get(e);t}},_split:function(e){for(var t=[],n=0,i=e.length,r=0,s=[];n<i;)e[n]==s[s.length-1]?s.pop():'"'==e[n]||"'"==e[n]?s.push(e[n]):"."==e[n]&&0==s.length?(t.push(e.substring(r,n)),r=n+1):"["==e[n]&&0==s.length&&(t.push(e.substring(r,n)),t.push(e.substring(n,e.indexOf("]",n+1)+1)),r=n=e.indexOf("]",n+1)+1),n+=1;return r<i&&t.push(e.substring(r)),t},has:function(e){return this.get(e,!0)},get:function(t,n,i){if(!t)return this._clone(this.attributes);for(var r=this._split(t),s=[],o=this.attributes;r.length>0;){var a=r.shift();if(o.hasOwnProperty(a))o=o[a],s.push(a);else{if(!(a.indexOf("[")>-1)){if(n)return!1;if(void 0!==i)return i;throw new Error("Can't find: "+t+(s.length>0?" (worked up to: "+s.join(".")+")":""))}var c=a.trim().substring(1,a.length-1);if((c.indexOf('"')>-1||c.indexOf("'")>-1)&&o.hasOwnProperty(c.substring(1,c.length-1)))o=o[c.substring(1,c.length-1)],s.push(c);else{if(!e.isArray(o)){if(n)return!1;if(void 0!==i)return i;throw new Error("Can't find: "+t+(s.length>0?" (worked up to: "+s.join(".")+")":""))}var u=null;try{if(u=parseInt(c),e.isNaN(u)||o.length<=u||u<0){if(n)return!1;if(void 0!==i)return i;throw new Error}o=o[u],s.push(c)}catch(e){if(n)return!1;if(void 0!==i)return i;throw new Error("Can't find: "+t+(s.length>0?" (worked up to: "+s.join(".")+")":""))}}}}return!!n||this._clone(o)},clone:function(){return new this.constructor(this.attributes)},_clone:function(t){return this.readOnly&&e.isObject(t)?e.cloneDeep?e.cloneDeep(t):JSON.parse(JSON.stringify(t)):t},isLocked:function(){return this.readOnly},lock:function(){return this.readOnly=!0},unlock:function(){return this.readOnly=!1}}),i.extend=t.Model.extend,i}),define("js/components/default_request",["underscore","backbone","js/components/api_query","js/components/multi_params"],function(e,t,n,i){var r=function(t){if(e.isString(t))return!0;if(e.isArray(t))for(var n=t.length,i=0;i<n;i++){var r=t[i];if(!e.isString(r)&&!e.isNumber(r))return!1}return!0},s={query:function(t){return!!e.isUndefined(t)||t instanceof n},target:r,sender:r,options:r};return i.extend({_validate:function(t,n){return e.forOwn(t,function(e,n){var i=t[n];if(!(n in s))throw new Error("Invalid attr: "+n);if(!s[n].call(s,i))throw new Error("Invalid value:key "+n+i)}),!0},set:function(e,n,i){var r;if(this._checkLock(),null==e)return this;"object"===_typeof(e)?(r=e,i=n):(r={})[e]=n,t.Model.prototype.set.call(this,r,i)},_checkParsed:function(t){if(e.isObject(t)){var i={};return"#query"in t&&!e.isEmpty(t["#query"])&&(i.query=new n(t["#query"])),"#path"in t&&(i.target=t["#path"][0]),"#hash"in t&&e.extend(i,e.each(t["#hash"],function(e,t,n){1==e.length&&(n[t]=e[0])})),i}return t},url:function(t){t||(t=this.attributes);var n=t.target,r=n?e.isArray(n)?n.join("/"):n:"";return"query"in t&&(r+="?"+t.query.url()),"sender"in t&&(r+="#"+i.prototype.url.call(this,{sender:t.sender})),r},load:function(e){return i.prototype.load.call(this,e.indexOf("?")>-1?e:e+"?")}})}),define("js/components/api_request",["underscore","backbone","js/components/facade","js/components/default_request"],function(e,t,n,i){var r={get:"get a key",set:"set (replace existing)",url:"url string defining this request",has:"has a key",load:"loads request as a string",clear:"clears all values",unset:"removes a key",toJSON:"values back as JSON object",clone:"make a copy",isLocked:!0,lock:!0,unlock:!0,pairs:"get all values as pairs",keys:"as keys",values:"only values",hasChanged:"whether this object has modification (since its creation)",previousAttributes:"get all changed attributes",previous:"previous values for a given attribute"},s=function(e,t){this.innerRequest=new n(r,e instanceof i?e:new i(e,t))},o={};return e.each(e.keys(r),function(e,t,n){o[e]=function(){return this.innerRequest[e].apply(this.innerRequest,arguments)}}),e.extend(s.prototype,o,{clone:function(){var e=this.innerRequest.clone.apply(this.innerRequest,arguments);return new s(e)},load:function(){var e=this.innerRequest.load.apply(this.innerRequest,arguments);return new s(e)}}),s}),define("js/components/api_targets",[],function(){var e={BOOTSTRAP:"/accounts/bootstrap",SEARCH:"search/query",QTREE:"search/qtree",BIGQUERY:"search/bigquery",EXPORT:"export/",SERVICE_AUTHOR_NETWORK:"vis/author-network",SERVICE_PAPER_NETWORK:"vis/paper-network",SERVICE_WORDCLOUD:"vis/word-cloud",SERVICE_METRICS:"metrics",SERVICE_OBJECTS:"objects",SERVICE_OBJECTS_QUERY:"objects/query",SERVICE_CITATION_HELPER:"citation_helper",SERVICE_AUTHOR_AFFILIATION_EXPORT:"authoraff",MYADS_STORAGE:"vault",MYADS_NOTIFICATIONS:"vault/_notifications",AUTHOR_AFFILIATION_SEARCH:"author-affiliation/search",AUTHOR_AFFILIATION_EXPORT:"author-affiliation/export",RESOLVER:"resolver",CSRF:"accounts/csrf",USER:"accounts/user",USER_DATA:"vault/user-data",SITE_CONFIGURATION:"vault/configuration",TOKEN:"accounts/token",LOGOUT:"accounts/logout",REGISTER:"accounts/register",VERIFY:"accounts/verify",DELETE:"accounts/user/delete",RESET_PASSWORD:"accounts/reset-password",CHANGE_PASSWORD:"accounts/change-password",CHANGE_EMAIL:"accounts/change-email",RECOMMENDER:"recommender",GRAPHICS:"graphics",FEEDBACK:"feedback/userfeedback",LIBRARY_IMPORT_CLASSIC_AUTH:"harbour/auth/classic",LIBRARY_IMPORT_CLASSIC_MIRRORS:"harbour/mirrors",LIBRARY_IMPORT_CLASSIC_TO_BBB:"biblib/classic",LIBRARY_IMPORT_ADS2_AUTH:"harbour/auth/twopointoh",LIBRARY_IMPORT_ADS2_TO_BBB:"biblib/twopointoh",LIBRARY_IMPORT_ZOTERO:"harbour/export/twopointoh/zotero",LIBRARY_IMPORT_MENDELEY:"harbour/export/twopointoh/mendeley",LIBRARY_IMPORT_CREDENTIALS:"harbour/user",ORCID_PREFERENCES:"orcid/preferences",ORCID_NAME:"orcid/orcid-name",LIBRARIES:"biblib/libraries",LIBRARY_TRANSFER:"biblib/transfer",DOCUMENTS:"biblib/documents",PERMISSIONS:"biblib/permissions",REFERENCE:"reference/text",_limits:{ExportWidget:{default:500,limit:3e3},Metrics:{default:7e3,limit:7e3},AuthorNetwork:{default:400,limit:1e3},PaperNetwork:{default:400,limit:1e3},ConceptCloud:{default:150,limit:150},BubbleChart:{default:1500}}};return e._doesntNeedCredentials=[e.SEARCH,e.QTREE,e.BIGQUERY,e.EXPORT,e.SERVICE_AUTHOR_NETWORK,e.SERVICE_PAPER_NETWORK,e.SERVICE_WORDCLOUD,e.SERVICE_METRICS,e.RECOMMENDER,e.GRAPHICS,e.FEEDBACK],e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=t():"function"==typeof define&&define.amd?define("hbs/handlebars",t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?exports.Handlebars=t():e.Handlebars=t()}(this,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var r=i(n(1)),s=i(n(2)),o=n(3),a=n(4),c=i(n(5)),u=i(n(6)),l=i(n(7)),d=r.default.create;function h(){var e=d();return e.compile=function(t,n){return a.compile(t,n,e)},e.precompile=function(t,n){return a.precompile(t,n,e)},e.AST=s.default,e.Compiler=a.Compiler,e.JavaScriptCompiler=c.default,e.Parser=o.parser,e.parse=o.parse,e}var p=h();p.create=h,l.default(p),p.Visitor=u.default,p.default=p,t.default=p,e.exports=t.default},function(e,t,n){"use strict";var i=n(9).default,r=n(8).default;t.__esModule=!0;var s=i(n(10)),o=r(n(11)),a=r(n(12)),c=i(n(13)),u=i(n(14)),l=r(n(7));function d(){var e=new s.HandlebarsEnvironment;return c.extend(e,s),e.SafeString=o.default,e.Exception=a.default,e.Utils=c,e.escapeExpression=c.escapeExpression,e.VM=u,e.template=function(t){return u.template(t,e)},e}var h=d();h.create=d,l.default(h),h.default=h,t.default=h,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i={Program:function(e,t,n,i){this.loc=i,this.type="Program",this.body=e,this.blockParams=t,this.strip=n},MustacheStatement:function(e,t,n,i,r,s){this.loc=s,this.type="MustacheStatement",this.path=e,this.params=t||[],this.hash=n,this.escaped=i,this.strip=r},BlockStatement:function(e,t,n,i,r,s,o,a,c){this.loc=c,this.type="BlockStatement",this.path=e,this.params=t||[],this.hash=n,this.program=i,this.inverse=r,this.openStrip=s,this.inverseStrip=o,this.closeStrip=a},PartialStatement:function(e,t,n,i,r){this.loc=r,this.type="PartialStatement",this.name=e,this.params=t||[],this.hash=n,this.indent="",this.strip=i},ContentStatement:function(e,t){this.loc=t,this.type="ContentStatement",this.original=this.value=e},CommentStatement:function(e,t,n){this.loc=n,this.type="CommentStatement",this.value=e,this.strip=t},SubExpression:function(e,t,n,i){this.loc=i,this.type="SubExpression",this.path=e,this.params=t||[],this.hash=n},PathExpression:function(e,t,n,i,r){this.loc=r,this.type="PathExpression",this.data=e,this.original=i,this.parts=n,this.depth=t},StringLiteral:function(e,t){this.loc=t,this.type="StringLiteral",this.original=this.value=e},NumberLiteral:function(e,t){this.loc=t,this.type="NumberLiteral",this.original=this.value=Number(e)},BooleanLiteral:function(e,t){this.loc=t,this.type="BooleanLiteral",this.original=this.value="true"===e},UndefinedLiteral:function(e){this.loc=e,this.type="UndefinedLiteral",this.original=this.value=void 0},NullLiteral:function(e){this.loc=e,this.type="NullLiteral",this.original=this.value=null},Hash:function(e,t){this.loc=t,this.type="Hash",this.pairs=e},HashPair:function(e,t,n){this.loc=n,this.type="HashPair",this.key=e,this.value=t},helpers:{helperExpression:function(e){return!("SubExpression"!==e.type&&!e.params.length&&!e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return 1===e.parts.length&&!i.helpers.scopedId(e)&&!e.depth}}};t.default=i,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default,r=n(9).default;t.__esModule=!0,t.parse=function(e,t){if("Program"===e.type)return e;return s.default.yy=l,l.locInfo=function(e){return new l.SourceLocation(t&&t.srcName,e)},(new a.default).accept(s.default.parse(e))};var s=i(n(15)),o=i(n(2)),a=i(n(16)),c=r(n(17)),u=n(13);t.parser=s.default;var l={};u.extend(l,c,o.default)},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0,t.Compiler=c,t.precompile=function(e,t,n){if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new r.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);"data"in(t=t||{})||(t.data=!0);t.compat&&(t.useDepths=!0);var i=n.parse(e,t),s=(new n.Compiler).compile(i,t);return(new n.JavaScriptCompiler).compile(s,t)},t.compile=function(e,t,n){var i=void 0===arguments[1]?{}:arguments[1];if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new r.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in i||(i.data=!0);i.compat&&(i.useDepths=!0);var s=void 0;function o(){var t=n.parse(e,i),r=(new n.Compiler).compile(t,i),s=(new n.JavaScriptCompiler).compile(r,i,void 0,!0);return n.template(s)}function a(e,t){return s||(s=o()),s.call(this,e,t)}return a._setup=function(e){return s||(s=o()),s._setup(e)},a._child=function(e,t,n,i){return s||(s=o()),s._child(e,t,n,i)},a};var r=i(n(12)),s=n(13),o=i(n(2)),a=[].slice;function c(){}function u(e,t){if(e===t)return!0;if(s.isArray(e)&&s.isArray(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!u(e[n],t[n]))return!1;return!0}}function l(e){if(!e.path.parts){var t=e.path;e.path=new o.default.PathExpression(!1,0,[t.original+""],t.original+"",t.loc)}}c.prototype={compiler:c,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var i=this.opcodes[n],r=e.opcodes[n];if(i.opcode!==r.opcode||!u(i.args,r.args))return!1}t=this.children.length;for(n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.sourceNode=[],this.opcodes=[],this.children=[],this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds,t.blockParams=t.blockParams||[];var n=t.knownHelpers;if(t.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},n)for(var i in n)i in n&&(t.knownHelpers[i]=n[i]);return this.accept(e)},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++;return this.usePartial=this.usePartial||t.usePartial,this.children[n]=t,this.useDepths=this.useDepths||t.useDepths,n},accept:function(e){this.sourceNode.unshift(e);var t=this[e.type](e);return this.sourceNode.shift(),t},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var t=e.body,n=t.length,i=0;i<n;i++)this.accept(t[i]);return this.options.blockParams.shift(),this.isSimple=1===n,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){l(e);var t=e.program,n=e.inverse;t=t&&this.compileProgram(t),n=n&&this.compileProgram(n);var i=this.classifySexpr(e);"helper"===i?this.helperSexpr(e,t,n):"simple"===i?(this.simpleSexpr(e),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,t,n),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},PartialStatement:function(e){this.usePartial=!0;var t=e.params;if(t.length>1)throw new r.default("Unsupported number of partial arguments: "+t.length,e);t.length||t.push({type:"PathExpression",parts:[],depth:0});var n=e.name.original,i="SubExpression"===e.name.type;i&&this.accept(e.name),this.setupFullMustacheParams(e,void 0,void 0,!0);var s=e.indent||"";this.options.preventIndent&&s&&(this.opcode("appendContent",s),s=""),this.opcode("invokePartial",i,n,s),this.opcode("append")},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){l(e);var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,t,n){var i=e.path,r=i.parts[0],s=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.accept(i),this.opcode("invokeAmbiguous",r,s)},simpleSexpr:function(e){this.accept(e.path),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),s=e.path,a=s.parts[0];if(this.options.knownHelpers[a])this.opcode("invokeKnownHelper",i.length,a);else{if(this.options.knownHelpersOnly)throw new r.default("You specified knownHelpersOnly, but used the unknown helper "+a,e);s.falsy=!0,this.accept(s),this.opcode("invokeHelper",i.length,s.original,o.default.helpers.simpleId(s))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0],n=o.default.helpers.scopedId(e),i=!e.depth&&!n&&this.blockParamIndex(t);i?this.opcode("lookupBlockParam",i,e.parts):t?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts)):this.opcode("lookupOnContext",e.parts,e.falsy,n):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var t=e.pairs,n=0,i=t.length;for(this.opcode("pushHash");n<i;n++)this.pushParam(t[n].value);for(;n--;)this.opcode("assignToHash",t[n].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:a.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var t=o.default.helpers.simpleId(e.path),n=t&&!!this.blockParamIndex(e.path.parts[0]),i=!n&&o.default.helpers.helperExpression(e),r=!n&&(i||t);if(r&&!i){var s=e.path.parts[0],a=this.options;a.knownHelpers[s]?i=!0:a.knownHelpersOnly&&(r=!1)}return i?"helper":r?"ambiguous":"simple"},pushParams:function(e){for(var t=0,n=e.length;t<n;t++)this.pushParam(e[t])},pushParam:function(e){var t=null!=e.value?e.value:e.original||"";if(this.stringParams)t.replace&&(t=t.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",t,e.type),"SubExpression"===e.type&&this.accept(e);else{if(this.trackIds){var n=void 0;if(!e.parts||o.default.helpers.scopedId(e)||e.depth||(n=this.blockParamIndex(e.parts[0])),n){var i=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",n,i)}else(t=e.original||t).replace&&(t=t.replace(/^\.\//g,"").replace(/^\.$/g,"")),this.opcode("pushId",e.type,t)}this.accept(e)}},setupFullMustacheParams:function(e,t,n,i){var r=e.params;return this.pushParams(r),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.accept(e.hash):this.opcode("emptyHash",i),r},blockParamIndex:function(e){for(var t=0,n=this.options.blockParams.length;t<n;t++){var i=this.options.blockParams[t],r=i&&s.indexOf(i,e);if(i&&r>=0)return[t,r]}}}},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var r=n(10),s=i(n(12)),o=n(13),a=i(n(18));function c(e){this.value=e}function u(){}u.prototype={nameLookup:function(e,t){return u.isValidJavaScriptVariableName(t)?[e,".",t]:[e,"['",t,"']"]},depthedLookup:function(e){return[this.aliasable("this.lookup"),'(depths, "',e,'")']},compilerInfo:function(){var e=r.COMPILER_REVISION;return[e,r.REVISION_CHANGES[e]]},appendToBuffer:function(e,t,n){return o.isArray(e)||(e=[e]),e=this.source.wrap(e,t),this.environment.isSimple?["return ",e,";"]:n?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},compile:function(e,t,n,i){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!i,this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.useDepths||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var r=e.opcodes,o=void 0,a=void 0,c=void 0,u=void 0;for(c=0,u=r.length;c<u;c++)o=r[c],this.source.currentLocation=o.loc,a=a||o.loc,this[o.opcode].apply(this,o.args);if(this.source.currentLocation=a,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new s.default("Compile completed with content left on stack");var l=this.createFunctionContext(i);if(this.isChild)return l;var d={compiler:this.compilerInfo(),main:l},h=this.context.programs;for(c=0,u=h.length;c<u;c++)h[c]&&(d[c]=h[c]);return this.environment.usePartial&&(d.usePartial=!0),this.options.data&&(d.useData=!0),this.useDepths&&(d.useDepths=!0),this.useBlockParams&&(d.useBlockParams=!0),this.options.compat&&(d.compat=!0),i?d.compilerOptions=this.options:(d.compiler=JSON.stringify(d.compiler),this.source.currentLocation={start:{line:1,column:0}},d=this.objectLiteral(d),t.srcName?(d=d.toStringWithSourceMap({file:t.destName})).map=d.map&&d.map.toString():d=d.toString()),d},preamble:function(){this.lastContext=0,this.source=new a.default(this.options.srcName)},createFunctionContext:function(e){var t="",n=this.stackVars.concat(this.registers.list);n.length>0&&(t+=", "+n.join(", "));var i=0;for(var r in this.aliases){var s=this.aliases[r];this.aliases.hasOwnProperty(r)&&s.children&&s.referenceCount>1&&(t+=", alias"+ ++i+"="+r,s.children[0]="alias"+i)}var o=["depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&o.push("blockParams"),this.useDepths&&o.push("depths");var a=this.mergeSource(t);return e?(o.push(a),Function.apply(this,o)):this.source.wrap(["function(",o.join(","),") {\n  ",a,"}"])},mergeSource:function(e){var t=this.environment.isSimple,n=!this.forceBuffer,i=void 0,r=void 0,s=void 0,o=void 0;return this.source.each(function(e){e.appendToBuffer?(s?e.prepend("  + "):s=e,o=e):(s&&(r?s.prepend("buffer += "):i=!0,o.add(";"),s=o=void 0),r=!0,t||(n=!1))}),n?s?(s.prepend("return "),o.add(";")):r||this.source.push('return "";'):(e+=", buffer = "+(i?"":this.initializeBuffer()),s?(s.prepend("return buffer + "),o.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(i?"":";\n")),this.source.merge()},blockValue:function(e){var t=this.aliasable("helpers.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs(e,0,n);var i=this.popStack();n.splice(1,0,i),this.push(this.source.functionCall(t,"call",n))},ambiguousBlockValue:function(){var e=this.aliasable("helpers.blockHelperMissing"),t=[this.contextName(0)];this.setupHelperArgs("",0,t,!0),this.flushInline();var n=this.topStack();t.splice(1,0,n),this.pushSource(["if (!",this.lastHelper,") { ",n," = ",this.source.functionCall(e,"call",t),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack(function(e){return[" != null ? ",e,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("this.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,n){var i=0;n||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[i++])),this.resolvePath("context",e,i,t)},lookupBlockParam:function(e,t){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",t,1)},lookupData:function(e,t){e?this.pushStackLiteral("this.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",t,0,!0)},resolvePath:function(e,t,n,i){var r=this;if(this.options.strict||this.options.assumeObjects)this.push(function(e,t,n,i){var r=t.popStack(),s=0,o=n.length;e&&o--;for(;s<o;s++)r=t.nameLookup(r,n[s],i);return e?[t.aliasable("this.strict"),"(",r,", ",t.quotedString(n[s]),")"]:r}(this.options.strict,this,t,e));else for(var s=t.length;n<s;n++)this.replaceStack(function(s){var o=r.nameLookup(s,t[n],e);return i?[" && ",o]:[" != null ? ",o," : ",s]})},resolvePossibleLambda:function(){this.push([this.aliasable("this.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"SubExpression"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t,n){var i=this.popStack(),r=this.setupHelper(e,t),s=n?[r.name," || "]:"",o=["("].concat(s,i);this.options.strict||o.push(" || ",this.aliasable("helpers.helperMissing")),o.push(")"),this.push(this.source.functionCall(o,"call",r.callParams))},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(this.source.functionCall(n.name,"call",n.callParams))},invokeAmbiguous:function(e,t){this.useRegister("helper");var n=this.popStack();this.emptyHash();var i=this.setupHelper(0,e,t),r=["(","(helper = ",this.lastHelper=this.nameLookup("helpers",e,"helper")," || ",n,")"];this.options.strict||(r[0]="(helper = ",r.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))),this.push(["(",r,i.paramsInit?["),(",i.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",i.callParams)," : helper))"])},invokePartial:function(e,t,n){var i=[],r=this.setupParams(t,1,i,!1);e&&(t=this.popStack(),delete r.name),n&&(r.indent=JSON.stringify(n)),r.helpers="helpers",r.partials="partials",e?i.unshift(t):i.unshift(this.nameLookup("partials",t,"partial")),this.options.compat&&(r.depths="depths"),r=this.objectLiteral(r),i.push(r),this.push(this.source.functionCall("this.invokePartial","",i))},assignToHash:function(e){var t=this.popStack(),n=void 0,i=void 0,r=void 0;this.trackIds&&(r=this.popStack()),this.stringParams&&(i=this.popStack(),n=this.popStack());var s=this.hash;n&&(s.contexts[e]=n),i&&(s.types[e]=i),r&&(s.ids[e]=r),s.values[e]=t},pushId:function(e,t,n){"BlockParam"===e?this.pushStackLiteral("blockParams["+t[0]+"].path["+t[1]+"]"+(n?" + "+JSON.stringify("."+n):"")):"PathExpression"===e?this.pushString(t):"SubExpression"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:u,compileChildren:function(e,t){for(var n=e.children,i=void 0,r=void 0,s=0,o=n.length;s<o;s++){i=n[s],r=new this.compiler;var a=this.matchExistingProgram(i);null==a?(this.context.programs.push(""),a=this.context.programs.length,i.index=a,i.name="program"+a,this.context.programs[a]=r.compile(i,t,this.context,!this.precompile),this.context.environments[a]=i,this.useDepths=this.useDepths||r.useDepths,this.useBlockParams=this.useBlockParams||r.useBlockParams):(i.index=a,i.name="program"+a,this.useDepths=this.useDepths||i.useDepths,this.useBlockParams=this.useBlockParams||i.useBlockParams)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){var t=this.environment.children[e],n=[t.index,"data",t.blockParams];return(this.useBlockParams||this.useDepths)&&n.push("blockParams"),this.useDepths&&n.push("depths"),"this.program("+n.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof c||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new c(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var t=["("],n=void 0,i=void 0,r=void 0;if(!this.isInline())throw new s.default("replaceStack on non-inline");var o=this.popStack(!0);if(o instanceof c)t=["(",n=[o.value]],r=!0;else{i=!0;var a=this.incrStack();t=["((",this.push(a)," = ",o,")"],n=this.topStack()}var u=e.call(this,n);r||this.popStack(),i&&this.stackSlot--,this.push(t.concat(u,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];if(i instanceof c)this.compileStack.push(i);else{var r=this.incrStack();this.pushSource([r," = ",i,";"]),this.compileStack.push(r)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();if(!e&&n instanceof c)return n.value;if(!t){if(!this.stackSlot)throw new s.default("Invalid stack pop");this.stackSlot--}return n},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof c?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var t=this.aliases[e];return t?(t.referenceCount++,t):((t=this.aliases[e]=this.source.wrap(e)).aliasable=!0,t.referenceCount=1,t)},setupHelper:function(e,t,n){var i=[];return{params:i,paramsInit:this.setupHelperArgs(t,e,i,n),name:this.nameLookup("helpers",t,"helper"),callParams:[this.contextName(0)].concat(i)}},setupParams:function(e,t,n){var i={},r=[],s=[],o=[],a=void 0;i.name=this.quotedString(e),i.hash=this.popStack(),this.trackIds&&(i.hashIds=this.popStack()),this.stringParams&&(i.hashTypes=this.popStack(),i.hashContexts=this.popStack());var c=this.popStack(),u=this.popStack();(u||c)&&(i.fn=u||"this.noop",i.inverse=c||"this.noop");for(var l=t;l--;)a=this.popStack(),n[l]=a,this.trackIds&&(o[l]=this.popStack()),this.stringParams&&(s[l]=this.popStack(),r[l]=this.popStack());return this.trackIds&&(i.ids=this.source.generateArray(o)),this.stringParams&&(i.types=this.source.generateArray(s),i.contexts=this.source.generateArray(r)),this.options.data&&(i.data="data"),this.useBlockParams&&(i.blockParams="blockParams"),i},setupHelperArgs:function(e,t,n,i){var r=this.setupParams(e,t,n,!0);return r=this.objectLiteral(r),i?(this.useRegister("options"),n.push("options"),["options=",r]):(n.push(r),"")}},function(){for(var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),t=u.RESERVED_WORDS={},n=0,i=e.length;n<i;n++)t[e[n]]=!0}(),u.isValidJavaScriptVariableName=function(e){return!u.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},t.default=u,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var r=i(n(12)),s=i(n(2));function o(){this.parents=[]}o.prototype={constructor:o,mutating:!1,acceptKey:function(e,t){var n=this.accept(e[t]);if(this.mutating){if(n&&(!n.type||!s.default[n.type]))throw new r.default('Unexpected node type "'+n.type+'" found when accepting '+t+" on "+e.type);e[t]=n}},acceptRequired:function(e,t){if(this.acceptKey(e,t),!e[t])throw new r.default(e.type+" requires "+t)},acceptArray:function(e){for(var t=0,n=e.length;t<n;t++)this.acceptKey(e,t),e[t]||(e.splice(t,1),t--,n--)},accept:function(e){if(e){this.current&&this.parents.unshift(this.current),this.current=e;var t=this[e.type](e);return this.current=this.parents.shift(),!this.mutating||t?t:!1!==t?e:void 0}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")},BlockStatement:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash"),this.acceptKey(e,"program"),this.acceptKey(e,"inverse")},PartialStatement:function(e){this.acceptRequired(e,"name"),this.acceptArray(e.params),this.acceptKey(e,"hash")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")},PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}},t.default=o,e.exports=t.default},function(e,t,n){(function(n){"use strict";t.__esModule=!0,t.default=function(e){var t=void 0!==n?n:window,i=t.Handlebars;e.noConflict=function(){t.Handlebars===e&&(t.Handlebars=i)}},e.exports=t.default}).call(t,function(){return this}())},function(e,t,n){"use strict";t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,n){"use strict";t.default=function(e){if(e&&e.__esModule)return e;var t={};if("object"===_typeof(e)&&null!==e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},t.__esModule=!0},function(e,t,n){"use strict";var i=n(9).default,r=n(8).default;t.__esModule=!0,t.HandlebarsEnvironment=l,t.createFrame=p;var s=i(n(13)),o=r(n(12));t.VERSION="3.0.1";t.COMPILER_REVISION=6;t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};var a=s.isArray,c=s.isFunction,u=s.toString;function l(e,t){var n;this.helpers=e||{},this.partials=t||{},(n=this).registerHelper("helperMissing",function(){if(1!==arguments.length)throw new o.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}),n.registerHelper("blockHelperMissing",function(e,t){var i=t.inverse,r=t.fn;if(!0===e)return r(this);if(!1===e||null==e)return i(this);if(a(e))return e.length>0?(t.ids&&(t.ids=[t.name]),n.helpers.each(e,t)):i(this);if(t.data&&t.ids){var o=p(t.data);o.contextPath=s.appendContextPath(t.data.contextPath,t.name),t={data:o}}return r(e,t)}),n.registerHelper("each",function(e,t){if(!t)throw new o.default("Must pass iterator to #each");var n=t.fn,i=t.inverse,r=0,u="",l=void 0,d=void 0;function h(t,i,r){l&&(l.key=t,l.index=i,l.first=0===i,l.last=!!r,d&&(l.contextPath=d+t)),u+=n(e[t],{data:l,blockParams:s.blockParams([e[t],t],[d+t,null])})}if(t.data&&t.ids&&(d=s.appendContextPath(t.data.contextPath,t.ids[0])+"."),c(e)&&(e=e.call(this)),t.data&&(l=p(t.data)),e&&"object"===_typeof(e))if(a(e))for(var f=e.length;r<f;r++)h(r,r,r===e.length-1);else{var g=void 0;for(var m in e)e.hasOwnProperty(m)&&(g&&h(g,r-1),g=m,r++);g&&h(g,r-1,!0)}return 0===r&&(u=i(this)),u}),n.registerHelper("if",function(e,t){return c(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||s.isEmpty(e)?t.inverse(this):t.fn(this)}),n.registerHelper("unless",function(e,t){return n.helpers.if.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})}),n.registerHelper("with",function(e,t){c(e)&&(e=e.call(this));var n=t.fn;if(s.isEmpty(e))return t.inverse(this);if(t.data&&t.ids){var i=p(t.data);i.contextPath=s.appendContextPath(t.data.contextPath,t.ids[0]),t={data:i}}return n(e,t)}),n.registerHelper("log",function(e,t){var i=t.data&&null!=t.data.level?parseInt(t.data.level,10):1;n.log(i,e)}),n.registerHelper("lookup",function(e,t){return e&&e[t]})}l.prototype={constructor:l,logger:d,log:h,registerHelper:function(e,t){if("[object Object]"===u.call(e)){if(t)throw new o.default("Arg not supported with multiple helpers");s.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if("[object Object]"===u.call(e))s.extend(this.partials,e);else{if(void 0===t)throw new o.default("Attempting to register a partial as undefined");this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]}};var d={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:1,log:function(e,t){if("undefined"!=typeof console&&d.level<=e){var n=d.methodMap[e];(console[n]||console.log).call(console,t)}}};t.logger=d;var h=d.log;function p(e){var t=s.extend({},e);return t._parent=e,t}t.log=h},function(e,t,n){"use strict";function i(e){this.string=e}t.__esModule=!0,i.prototype.toString=i.prototype.toHTML=function(){return""+this.string},t.default=i,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i=["description","fileName","lineNumber","message","name","number","stack"];function r(e,t){var n=t&&t.loc,s=void 0,o=void 0;n&&(e+=" - "+(s=n.start.line)+":"+(o=n.start.column));for(var a=Error.prototype.constructor.call(this,e),c=0;c<i.length;c++)this[i[c]]=a[i[c]];Error.captureStackTrace&&Error.captureStackTrace(this,r),n&&(this.lineNumber=s,this.column=o)}r.prototype=new Error,t.default=r,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0,t.extend=function(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e},t.indexOf=function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}if(!s.test(e))return e;return e.replace(r,o)},t.isEmpty=function(e){return!e&&0!==e||!(!u(e)||0!==e.length)},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},r=/[&<>"'`]/g,s=/[&<>"'`]/;function o(e){return i[e]}var a,c=Object.prototype.toString;t.toString=c,(a=function(e){return"function"==typeof e})(/x/)&&(t.isFunction=a=function(e){return"function"==typeof e&&"[object Function]"===c.call(e)}),t.isFunction=a;var u=Array.isArray||function(e){return!(!e||"object"!==_typeof(e))&&"[object Array]"===c.call(e)};t.isArray=u},function(e,t,n){"use strict";var i=n(9).default,r=n(8).default;t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,n=a.COMPILER_REVISION;if(t!==n){if(t<n){var i=a.REVISION_CHANGES[n],r=a.REVISION_CHANGES[t];throw new o.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+r+").")}throw new o.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},t.template=function(e,t){if(!t)throw new o.default("No environment passed to template");if(!e||!e.main)throw new o.default("Unknown template object: "+_typeof(e));t.VM.checkRevision(e.compiler);var n={strict:function(e,t){if(!(t in e))throw new o.default('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:s.escapeExpression,invokePartial:function(n,i,r){r.hash&&(i=s.extend({},i,r.hash));n=t.VM.resolvePartial.call(this,n,i,r);var a=t.VM.invokePartial.call(this,n,i,r);null==a&&t.compile&&(r.partials[r.name]=t.compile(n,e.compilerOptions,t),a=r.partials[r.name](i,r));if(null!=a){if(r.indent){for(var c=a.split("\n"),u=0,l=c.length;u<l&&(c[u]||u+1!==l);u++)c[u]=r.indent+c[u];a=c.join("\n")}return a}throw new o.default("The partial "+r.name+" could not be compiled when running in runtime-only mode")},fn:function(t){return e[t]},programs:[],program:function(e,t,n,i,r){var s=this.programs[e],o=this.fn(e);return t||r||i||n?s=c(this,e,o,t,n,i,r):s||(s=this.programs[e]=c(this,e,o)),s},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=s.extend({},t,e)),n},noop:t.VM.noop,compilerInfo:e.compiler};function i(t){var r=void 0===arguments[1]?{}:arguments[1],s=r.data;i._setup(r),!r.partial&&e.useData&&(s=function(e,t){t&&"root"in t||((t=t?a.createFrame(t):{}).root=e);return t}(t,s));var o=void 0,c=e.useBlockParams?[]:void 0;return e.useDepths&&(o=r.depths?[t].concat(r.depths):[t]),e.main.call(n,t,n.helpers,n.partials,s,c,o)}return i.isTop=!0,i._setup=function(i){i.partial?(n.helpers=i.helpers,n.partials=i.partials):(n.helpers=n.merge(i.helpers,t.helpers),e.usePartial&&(n.partials=n.merge(i.partials,t.partials)))},i._child=function(t,i,r,s){if(e.useBlockParams&&!r)throw new o.default("must pass block params");if(e.useDepths&&!s)throw new o.default("must pass parent depths");return c(n,t,e[t],i,0,r,s)},i},t.wrapProgram=c,t.resolvePartial=function(e,t,n){e?e.call||n.name||(n.name=e,e=n.partials[e]):e=n.partials[n.name];return e},t.invokePartial=function(e,t,n){if(n.partial=!0,void 0===e)throw new o.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)},t.noop=function(){return""};var s=i(n(13)),o=r(n(12)),a=n(10);function c(e,t,n,i,r,s,o){function a(t){var r=void 0===arguments[1]?{}:arguments[1];return n.call(e,t,e.helpers,e.partials,r.data||i,s&&[r.blockParams].concat(s),o&&[t].concat(o))}return a.program=t,a.depth=o?o.length:0,a.blockParams=r||0,a}},function(e,t,n){"use strict";t.__esModule=!0;var i=function(){var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,content:12,COMMENT:13,CONTENT:14,openRawBlock:15,END_RAW_BLOCK:16,OPEN_RAW_BLOCK:17,helperName:18,openRawBlock_repetition0:19,openRawBlock_option0:20,CLOSE_RAW_BLOCK:21,openBlock:22,block_option0:23,closeBlock:24,openInverse:25,block_option1:26,OPEN_BLOCK:27,openBlock_repetition0:28,openBlock_option0:29,openBlock_option1:30,CLOSE:31,OPEN_INVERSE:32,openInverse_repetition0:33,openInverse_option0:34,openInverse_option1:35,openInverseChain:36,OPEN_INVERSE_CHAIN:37,openInverseChain_repetition0:38,openInverseChain_option0:39,openInverseChain_option1:40,inverseAndProgram:41,INVERSE:42,inverseChain:43,inverseChain_option0:44,OPEN_ENDBLOCK:45,OPEN:46,mustache_repetition0:47,mustache_option0:48,OPEN_UNESCAPED:49,mustache_repetition1:50,mustache_option1:51,CLOSE_UNESCAPED:52,OPEN_PARTIAL:53,partialName:54,partial_repetition0:55,partial_option0:56,param:57,sexpr:58,OPEN_SEXPR:59,sexpr_repetition0:60,sexpr_option0:61,CLOSE_SEXPR:62,hash:63,hash_repetition_plus0:64,hashSegment:65,ID:66,EQUALS:67,blockParams:68,OPEN_BLOCK_PARAMS:69,blockParams_repetition_plus0:70,CLOSE_BLOCK_PARAMS:71,path:72,dataName:73,STRING:74,NUMBER:75,BOOLEAN:76,UNDEFINED:77,NULL:78,DATA:79,pathSegments:80,SEP:81,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",13:"COMMENT",14:"CONTENT",16:"END_RAW_BLOCK",17:"OPEN_RAW_BLOCK",21:"CLOSE_RAW_BLOCK",27:"OPEN_BLOCK",31:"CLOSE",32:"OPEN_INVERSE",37:"OPEN_INVERSE_CHAIN",42:"INVERSE",45:"OPEN_ENDBLOCK",46:"OPEN",49:"OPEN_UNESCAPED",52:"CLOSE_UNESCAPED",53:"OPEN_PARTIAL",59:"OPEN_SEXPR",62:"CLOSE_SEXPR",66:"ID",67:"EQUALS",69:"OPEN_BLOCK_PARAMS",71:"CLOSE_BLOCK_PARAMS",74:"STRING",75:"NUMBER",76:"BOOLEAN",77:"UNDEFINED",78:"NULL",79:"DATA",81:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[12,1],[10,3],[15,5],[9,4],[9,4],[22,6],[25,6],[36,6],[41,2],[43,3],[43,1],[24,3],[8,5],[8,5],[11,5],[57,1],[57,1],[58,5],[63,1],[65,3],[68,3],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[54,1],[54,1],[73,2],[72,1],[80,3],[80,1],[6,0],[6,2],[19,0],[19,2],[20,0],[20,1],[23,0],[23,1],[26,0],[26,1],[28,0],[28,2],[29,0],[29,1],[30,0],[30,1],[33,0],[33,2],[34,0],[34,1],[35,0],[35,1],[38,0],[38,2],[39,0],[39,1],[40,0],[40,1],[44,0],[44,1],[47,0],[47,2],[48,0],[48,1],[50,0],[50,2],[51,0],[51,1],[55,0],[55,2],[56,0],[56,1],[60,0],[60,2],[61,0],[61,1],[64,1],[64,2],[70,1],[70,2]],performAction:function(e,t,n,i,r,s,o){var a=s.length-1;switch(r){case 1:return s[a-1];case 2:this.$=new i.Program(s[a],null,{},i.locInfo(this._$));break;case 3:case 4:case 5:case 6:case 7:this.$=s[a];break;case 8:this.$=new i.CommentStatement(i.stripComment(s[a]),i.stripFlags(s[a],s[a]),i.locInfo(this._$));break;case 9:this.$=new i.ContentStatement(s[a],i.locInfo(this._$));break;case 10:this.$=i.prepareRawBlock(s[a-2],s[a-1],s[a],this._$);break;case 11:this.$={path:s[a-3],params:s[a-2],hash:s[a-1]};break;case 12:this.$=i.prepareBlock(s[a-3],s[a-2],s[a-1],s[a],!1,this._$);break;case 13:this.$=i.prepareBlock(s[a-3],s[a-2],s[a-1],s[a],!0,this._$);break;case 14:case 15:case 16:this.$={path:s[a-4],params:s[a-3],hash:s[a-2],blockParams:s[a-1],strip:i.stripFlags(s[a-5],s[a])};break;case 17:this.$={strip:i.stripFlags(s[a-1],s[a-1]),program:s[a]};break;case 18:var c=i.prepareBlock(s[a-2],s[a-1],s[a],s[a],!1,this._$),u=new i.Program([c],null,{},i.locInfo(this._$));u.chained=!0,this.$={strip:s[a-2].strip,program:u,chain:!0};break;case 19:this.$=s[a];break;case 20:this.$={path:s[a-1],strip:i.stripFlags(s[a-2],s[a])};break;case 21:case 22:this.$=i.prepareMustache(s[a-3],s[a-2],s[a-1],s[a-4],i.stripFlags(s[a-4],s[a]),this._$);break;case 23:this.$=new i.PartialStatement(s[a-3],s[a-2],s[a-1],i.stripFlags(s[a-4],s[a]),i.locInfo(this._$));break;case 24:case 25:this.$=s[a];break;case 26:this.$=new i.SubExpression(s[a-3],s[a-2],s[a-1],i.locInfo(this._$));break;case 27:this.$=new i.Hash(s[a],i.locInfo(this._$));break;case 28:this.$=new i.HashPair(i.id(s[a-2]),s[a],i.locInfo(this._$));break;case 29:this.$=i.id(s[a-1]);break;case 30:case 31:this.$=s[a];break;case 32:this.$=new i.StringLiteral(s[a],i.locInfo(this._$));break;case 33:this.$=new i.NumberLiteral(s[a],i.locInfo(this._$));break;case 34:this.$=new i.BooleanLiteral(s[a],i.locInfo(this._$));break;case 35:this.$=new i.UndefinedLiteral(i.locInfo(this._$));break;case 36:this.$=new i.NullLiteral(i.locInfo(this._$));break;case 37:case 38:this.$=s[a];break;case 39:this.$=i.preparePath(!0,s[a],this._$);break;case 40:this.$=i.preparePath(!1,s[a],this._$);break;case 41:s[a-2].push({part:i.id(s[a]),original:s[a],separator:s[a-1]}),this.$=s[a-2];break;case 42:this.$=[{part:i.id(s[a]),original:s[a]}];break;case 43:this.$=[];break;case 44:s[a-1].push(s[a]);break;case 45:this.$=[];break;case 46:s[a-1].push(s[a]);break;case 53:this.$=[];break;case 54:s[a-1].push(s[a]);break;case 59:this.$=[];break;case 60:s[a-1].push(s[a]);break;case 65:this.$=[];break;case 66:s[a-1].push(s[a]);break;case 73:this.$=[];break;case 74:s[a-1].push(s[a]);break;case 77:this.$=[];break;case 78:s[a-1].push(s[a]);break;case 81:this.$=[];break;case 82:s[a-1].push(s[a]);break;case 85:this.$=[];break;case 86:s[a-1].push(s[a]);break;case 89:this.$=[s[a]];break;case 90:s[a-1].push(s[a]);break;case 91:this.$=[s[a]];break;case 92:s[a-1].push(s[a])}},table:[{3:1,4:2,5:[2,43],6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],46:[2,43],49:[2,43],53:[2,43]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:[1,11],14:[1,18],15:16,17:[1,21],22:14,25:15,27:[1,19],32:[1,20],37:[2,2],42:[2,2],45:[2,2],46:[1,12],49:[1,13],53:[1,17]},{1:[2,1]},{5:[2,44],13:[2,44],14:[2,44],17:[2,44],27:[2,44],32:[2,44],37:[2,44],42:[2,44],45:[2,44],46:[2,44],49:[2,44],53:[2,44]},{5:[2,3],13:[2,3],14:[2,3],17:[2,3],27:[2,3],32:[2,3],37:[2,3],42:[2,3],45:[2,3],46:[2,3],49:[2,3],53:[2,3]},{5:[2,4],13:[2,4],14:[2,4],17:[2,4],27:[2,4],32:[2,4],37:[2,4],42:[2,4],45:[2,4],46:[2,4],49:[2,4],53:[2,4]},{5:[2,5],13:[2,5],14:[2,5],17:[2,5],27:[2,5],32:[2,5],37:[2,5],42:[2,5],45:[2,5],46:[2,5],49:[2,5],53:[2,5]},{5:[2,6],13:[2,6],14:[2,6],17:[2,6],27:[2,6],32:[2,6],37:[2,6],42:[2,6],45:[2,6],46:[2,6],49:[2,6],53:[2,6]},{5:[2,7],13:[2,7],14:[2,7],17:[2,7],27:[2,7],32:[2,7],37:[2,7],42:[2,7],45:[2,7],46:[2,7],49:[2,7],53:[2,7]},{5:[2,8],13:[2,8],14:[2,8],17:[2,8],27:[2,8],32:[2,8],37:[2,8],42:[2,8],45:[2,8],46:[2,8],49:[2,8],53:[2,8]},{18:22,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:33,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{4:34,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],37:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{4:35,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{12:36,14:[1,18]},{18:38,54:37,58:39,59:[1,40],66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,9],13:[2,9],14:[2,9],16:[2,9],17:[2,9],27:[2,9],32:[2,9],37:[2,9],42:[2,9],45:[2,9],46:[2,9],49:[2,9],53:[2,9]},{18:41,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:42,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:43,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{31:[2,73],47:44,59:[2,73],66:[2,73],74:[2,73],75:[2,73],76:[2,73],77:[2,73],78:[2,73],79:[2,73]},{21:[2,30],31:[2,30],52:[2,30],59:[2,30],62:[2,30],66:[2,30],69:[2,30],74:[2,30],75:[2,30],76:[2,30],77:[2,30],78:[2,30],79:[2,30]},{21:[2,31],31:[2,31],52:[2,31],59:[2,31],62:[2,31],66:[2,31],69:[2,31],74:[2,31],75:[2,31],76:[2,31],77:[2,31],78:[2,31],79:[2,31]},{21:[2,32],31:[2,32],52:[2,32],59:[2,32],62:[2,32],66:[2,32],69:[2,32],74:[2,32],75:[2,32],76:[2,32],77:[2,32],78:[2,32],79:[2,32]},{21:[2,33],31:[2,33],52:[2,33],59:[2,33],62:[2,33],66:[2,33],69:[2,33],74:[2,33],75:[2,33],76:[2,33],77:[2,33],78:[2,33],79:[2,33]},{21:[2,34],31:[2,34],52:[2,34],59:[2,34],62:[2,34],66:[2,34],69:[2,34],74:[2,34],75:[2,34],76:[2,34],77:[2,34],78:[2,34],79:[2,34]},{21:[2,35],31:[2,35],52:[2,35],59:[2,35],62:[2,35],66:[2,35],69:[2,35],74:[2,35],75:[2,35],76:[2,35],77:[2,35],78:[2,35],79:[2,35]},{21:[2,36],31:[2,36],52:[2,36],59:[2,36],62:[2,36],66:[2,36],69:[2,36],74:[2,36],75:[2,36],76:[2,36],77:[2,36],78:[2,36],79:[2,36]},{21:[2,40],31:[2,40],52:[2,40],59:[2,40],62:[2,40],66:[2,40],69:[2,40],74:[2,40],75:[2,40],76:[2,40],77:[2,40],78:[2,40],79:[2,40],81:[1,45]},{66:[1,32],80:46},{21:[2,42],31:[2,42],52:[2,42],59:[2,42],62:[2,42],66:[2,42],69:[2,42],74:[2,42],75:[2,42],76:[2,42],77:[2,42],78:[2,42],79:[2,42],81:[2,42]},{50:47,52:[2,77],59:[2,77],66:[2,77],74:[2,77],75:[2,77],76:[2,77],77:[2,77],78:[2,77],79:[2,77]},{23:48,36:50,37:[1,52],41:51,42:[1,53],43:49,45:[2,49]},{26:54,41:55,42:[1,53],45:[2,51]},{16:[1,56]},{31:[2,81],55:57,59:[2,81],66:[2,81],74:[2,81],75:[2,81],76:[2,81],77:[2,81],78:[2,81],79:[2,81]},{31:[2,37],59:[2,37],66:[2,37],74:[2,37],75:[2,37],76:[2,37],77:[2,37],78:[2,37],79:[2,37]},{31:[2,38],59:[2,38],66:[2,38],74:[2,38],75:[2,38],76:[2,38],77:[2,38],78:[2,38],79:[2,38]},{18:58,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{28:59,31:[2,53],59:[2,53],66:[2,53],69:[2,53],74:[2,53],75:[2,53],76:[2,53],77:[2,53],78:[2,53],79:[2,53]},{31:[2,59],33:60,59:[2,59],66:[2,59],69:[2,59],74:[2,59],75:[2,59],76:[2,59],77:[2,59],78:[2,59],79:[2,59]},{19:61,21:[2,45],59:[2,45],66:[2,45],74:[2,45],75:[2,45],76:[2,45],77:[2,45],78:[2,45],79:[2,45]},{18:65,31:[2,75],48:62,57:63,58:66,59:[1,40],63:64,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{66:[1,70]},{21:[2,39],31:[2,39],52:[2,39],59:[2,39],62:[2,39],66:[2,39],69:[2,39],74:[2,39],75:[2,39],76:[2,39],77:[2,39],78:[2,39],79:[2,39],81:[1,45]},{18:65,51:71,52:[2,79],57:72,58:66,59:[1,40],63:73,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{24:74,45:[1,75]},{45:[2,50]},{4:76,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],37:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{45:[2,19]},{18:77,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{4:78,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{24:79,45:[1,75]},{45:[2,52]},{5:[2,10],13:[2,10],14:[2,10],17:[2,10],27:[2,10],32:[2,10],37:[2,10],42:[2,10],45:[2,10],46:[2,10],49:[2,10],53:[2,10]},{18:65,31:[2,83],56:80,57:81,58:66,59:[1,40],63:82,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{59:[2,85],60:83,62:[2,85],66:[2,85],74:[2,85],75:[2,85],76:[2,85],77:[2,85],78:[2,85],79:[2,85]},{18:65,29:84,31:[2,55],57:85,58:66,59:[1,40],63:86,64:67,65:68,66:[1,69],69:[2,55],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:65,31:[2,61],34:87,57:88,58:66,59:[1,40],63:89,64:67,65:68,66:[1,69],69:[2,61],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:65,20:90,21:[2,47],57:91,58:66,59:[1,40],63:92,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{31:[1,93]},{31:[2,74],59:[2,74],66:[2,74],74:[2,74],75:[2,74],76:[2,74],77:[2,74],78:[2,74],79:[2,74]},{31:[2,76]},{21:[2,24],31:[2,24],52:[2,24],59:[2,24],62:[2,24],66:[2,24],69:[2,24],74:[2,24],75:[2,24],76:[2,24],77:[2,24],78:[2,24],79:[2,24]},{21:[2,25],31:[2,25],52:[2,25],59:[2,25],62:[2,25],66:[2,25],69:[2,25],74:[2,25],75:[2,25],76:[2,25],77:[2,25],78:[2,25],79:[2,25]},{21:[2,27],31:[2,27],52:[2,27],62:[2,27],65:94,66:[1,95],69:[2,27]},{21:[2,89],31:[2,89],52:[2,89],62:[2,89],66:[2,89],69:[2,89]},{21:[2,42],31:[2,42],52:[2,42],59:[2,42],62:[2,42],66:[2,42],67:[1,96],69:[2,42],74:[2,42],75:[2,42],76:[2,42],77:[2,42],78:[2,42],79:[2,42],81:[2,42]},{21:[2,41],31:[2,41],52:[2,41],59:[2,41],62:[2,41],66:[2,41],69:[2,41],74:[2,41],75:[2,41],76:[2,41],77:[2,41],78:[2,41],79:[2,41],81:[2,41]},{52:[1,97]},{52:[2,78],59:[2,78],66:[2,78],74:[2,78],75:[2,78],76:[2,78],77:[2,78],78:[2,78],79:[2,78]},{52:[2,80]},{5:[2,12],13:[2,12],14:[2,12],17:[2,12],27:[2,12],32:[2,12],37:[2,12],42:[2,12],45:[2,12],46:[2,12],49:[2,12],53:[2,12]},{18:98,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{36:50,37:[1,52],41:51,42:[1,53],43:100,44:99,45:[2,71]},{31:[2,65],38:101,59:[2,65],66:[2,65],69:[2,65],74:[2,65],75:[2,65],76:[2,65],77:[2,65],78:[2,65],79:[2,65]},{45:[2,17]},{5:[2,13],13:[2,13],14:[2,13],17:[2,13],27:[2,13],32:[2,13],37:[2,13],42:[2,13],45:[2,13],46:[2,13],49:[2,13],53:[2,13]},{31:[1,102]},{31:[2,82],59:[2,82],66:[2,82],74:[2,82],75:[2,82],76:[2,82],77:[2,82],78:[2,82],79:[2,82]},{31:[2,84]},{18:65,57:104,58:66,59:[1,40],61:103,62:[2,87],63:105,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{30:106,31:[2,57],68:107,69:[1,108]},{31:[2,54],59:[2,54],66:[2,54],69:[2,54],74:[2,54],75:[2,54],76:[2,54],77:[2,54],78:[2,54],79:[2,54]},{31:[2,56],69:[2,56]},{31:[2,63],35:109,68:110,69:[1,108]},{31:[2,60],59:[2,60],66:[2,60],69:[2,60],74:[2,60],75:[2,60],76:[2,60],77:[2,60],78:[2,60],79:[2,60]},{31:[2,62],69:[2,62]},{21:[1,111]},{21:[2,46],59:[2,46],66:[2,46],74:[2,46],75:[2,46],76:[2,46],77:[2,46],78:[2,46],79:[2,46]},{21:[2,48]},{5:[2,21],13:[2,21],14:[2,21],17:[2,21],27:[2,21],32:[2,21],37:[2,21],42:[2,21],45:[2,21],46:[2,21],49:[2,21],53:[2,21]},{21:[2,90],31:[2,90],52:[2,90],62:[2,90],66:[2,90],69:[2,90]},{67:[1,96]},{18:65,57:112,58:66,59:[1,40],66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,22],13:[2,22],14:[2,22],17:[2,22],27:[2,22],32:[2,22],37:[2,22],42:[2,22],45:[2,22],46:[2,22],49:[2,22],53:[2,22]},{31:[1,113]},{45:[2,18]},{45:[2,72]},{18:65,31:[2,67],39:114,57:115,58:66,59:[1,40],63:116,64:67,65:68,66:[1,69],69:[2,67],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,23],13:[2,23],14:[2,23],17:[2,23],27:[2,23],32:[2,23],37:[2,23],42:[2,23],45:[2,23],46:[2,23],49:[2,23],53:[2,23]},{62:[1,117]},{59:[2,86],62:[2,86],66:[2,86],74:[2,86],75:[2,86],76:[2,86],77:[2,86],78:[2,86],79:[2,86]},{62:[2,88]},{31:[1,118]},{31:[2,58]},{66:[1,120],70:119},{31:[1,121]},{31:[2,64]},{14:[2,11]},{21:[2,28],31:[2,28],52:[2,28],62:[2,28],66:[2,28],69:[2,28]},{5:[2,20],13:[2,20],14:[2,20],17:[2,20],27:[2,20],32:[2,20],37:[2,20],42:[2,20],45:[2,20],46:[2,20],49:[2,20],53:[2,20]},{31:[2,69],40:122,68:123,69:[1,108]},{31:[2,66],59:[2,66],66:[2,66],69:[2,66],74:[2,66],75:[2,66],76:[2,66],77:[2,66],78:[2,66],79:[2,66]},{31:[2,68],69:[2,68]},{21:[2,26],31:[2,26],52:[2,26],59:[2,26],62:[2,26],66:[2,26],69:[2,26],74:[2,26],75:[2,26],76:[2,26],77:[2,26],78:[2,26],79:[2,26]},{13:[2,14],14:[2,14],17:[2,14],27:[2,14],32:[2,14],37:[2,14],42:[2,14],45:[2,14],46:[2,14],49:[2,14],53:[2,14]},{66:[1,125],71:[1,124]},{66:[2,91],71:[2,91]},{13:[2,15],14:[2,15],17:[2,15],27:[2,15],32:[2,15],42:[2,15],45:[2,15],46:[2,15],49:[2,15],53:[2,15]},{31:[1,126]},{31:[2,70]},{31:[2,29]},{66:[2,92],71:[2,92]},{13:[2,16],14:[2,16],17:[2,16],27:[2,16],32:[2,16],37:[2,16],42:[2,16],45:[2,16],46:[2,16],49:[2,16],53:[2,16]}],defaultActions:{4:[2,1],49:[2,50],51:[2,19],55:[2,52],64:[2,76],73:[2,80],78:[2,17],82:[2,84],92:[2,48],99:[2,18],100:[2,72],105:[2,88],107:[2,58],110:[2,64],111:[2,11],123:[2,70],124:[2,29]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],i=[null],r=[],s=this.table,o="",a=0,c=0,u=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;r.push(l);var d=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,p,f,g,m,b,v,y,_,w,S={};;){if(f=n[n.length-1],this.defaultActions[f]?g=this.defaultActions[f]:(null!==h&&void 0!==h||(w=void 0,"number"!=typeof(w=t.lexer.lex()||1)&&(w=t.symbols_[w]||w),h=w),g=s[f]&&s[f][h]),void 0===g||!g.length||!g[0]){var E="";if(!u){for(b in _=[],s[f])this.terminals_[b]&&b>2&&_.push("'"+this.terminals_[b]+"'");E=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+_.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(E,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:l,expected:_})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+h);switch(g[0]){case 1:n.push(h),i.push(this.lexer.yytext),r.push(this.lexer.yylloc),n.push(g[1]),h=null,p?(h=p,p=null):(c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,l=this.lexer.yylloc,u>0&&u--);break;case 2:if(v=this.productions_[g[1]][1],S.$=i[i.length-v],S._$={first_line:r[r.length-(v||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(v||1)].first_column,last_column:r[r.length-1].last_column},d&&(S._$.range=[r[r.length-(v||1)].range[0],r[r.length-1].range[1]]),void 0!==(m=this.performAction.call(S,o,c,a,this.yy,g[1],i,r)))return m;v&&(n=n.slice(0,-1*v*2),i=i.slice(0,-1*v),r=r.slice(0,-1*v)),n.push(this.productions_[g[1]][0]),i.push(S.$),r.push(S._$),y=s[n[n.length-2]][n[n.length-1]],n.push(y);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t,n,i,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var s=this._currentRules(),o=0;o<s.length&&(!(n=this._input.match(this.rules[s[o]]))||t&&!(n[0].length>t[0].length)||(t=n,i=o,this.options.flex));o++);return t?((r=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,s[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},options:{},performAction:function(e,t,n,i){function r(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(r(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(r(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return t.yytext=t.yytext.substr(5,t.yyleng-9),this.popState(),16;case 4:return 14;case 5:return this.popState(),13;case 6:return 59;case 7:return 62;case 8:return 17;case 9:return this.popState(),this.begin("raw"),21;case 10:return 53;case 11:return 27;case 12:return 45;case 13:case 14:return this.popState(),42;case 15:return 32;case 16:return 37;case 17:return 49;case 18:return 46;case 19:this.unput(t.yytext),this.popState(),this.begin("com");break;case 20:return this.popState(),13;case 21:return 46;case 22:return 67;case 23:case 24:return 66;case 25:return 81;case 26:break;case 27:return this.popState(),52;case 28:return this.popState(),31;case 29:return t.yytext=r(1,2).replace(/\\"/g,'"'),74;case 30:return t.yytext=r(1,2).replace(/\\'/g,"'"),74;case 31:return 79;case 32:case 33:return 76;case 34:return 77;case 35:return 78;case 36:return 75;case 37:return 69;case 38:return 71;case 39:case 40:return 66;case 41:return"INVALID";case 42:return 5}},rules:[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],conditions:{mu:{rules:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[5],inclusive:!1},raw:{rules:[3,4],inclusive:!1},INITIAL:{rules:[0,1,42],inclusive:!0}}};return e}();function n(){this.yy={}}return e.lexer=t,n.prototype=e,e.Parser=n,new n}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var r=i(n(6));function s(){}function o(e,t,n){void 0===t&&(t=e.length);var i=e[t-1],r=e[t-2];return i?"ContentStatement"===i.type?(r||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(i.original):void 0:n}function a(e,t,n){void 0===t&&(t=-1);var i=e[t+1],r=e[t+2];return i?"ContentStatement"===i.type?(r||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(i.original):void 0:n}function c(e,t,n){var i=e[null==t?0:t+1];if(i&&"ContentStatement"===i.type&&(n||!i.rightStripped)){var r=i.value;i.value=i.value.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),i.rightStripped=i.value!==r}}function u(e,t,n){var i=e[null==t?e.length-1:t-1];if(i&&"ContentStatement"===i.type&&(n||!i.leftStripped)){var r=i.value;return i.value=i.value.replace(n?/\s+$/:/[ \t]+$/,""),i.leftStripped=i.value!==r,i.leftStripped}}s.prototype=new r.default,s.prototype.Program=function(e){var t=!this.isRootSeen;this.isRootSeen=!0;for(var n=e.body,i=0,r=n.length;i<r;i++){var s=n[i],l=this.accept(s);if(l){var d=o(n,i,t),h=a(n,i,t),p=l.openStandalone&&d,f=l.closeStandalone&&h,g=l.inlineStandalone&&d&&h;l.close&&c(n,i,!0),l.open&&u(n,i,!0),g&&(c(n,i),u(n,i)&&"PartialStatement"===s.type&&(s.indent=/([ \t]+$)/.exec(n[i-1].original)[1])),p&&(c((s.program||s.inverse).body),u(n,i)),f&&(c(n,i),u((s.inverse||s.program).body))}}return e},s.prototype.BlockStatement=function(e){this.accept(e.program),this.accept(e.inverse);var t=e.program||e.inverse,n=e.program&&e.inverse,i=n,r=n;if(n&&n.chained)for(i=n.body[0].program;r.chained;)r=r.body[r.body.length-1].program;var s={open:e.openStrip.open,close:e.closeStrip.close,openStandalone:a(t.body),closeStandalone:o((i||t).body)};if(e.openStrip.close&&c(t.body,null,!0),n){var l=e.inverseStrip;l.open&&u(t.body,null,!0),l.close&&c(i.body,null,!0),e.closeStrip.open&&u(r.body,null,!0),o(t.body)&&a(i.body)&&(u(t.body),c(i.body))}else e.closeStrip.open&&u(t.body,null,!0);return s},s.prototype.MustacheStatement=function(e){return e.strip},s.prototype.PartialStatement=s.prototype.CommentStatement=function(e){var t=e.strip||{};return{inlineStandalone:!0,open:t.open,close:t.close}},t.default=s,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0,t.SourceLocation=function(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}},t.id=function(e){return/^\[.*\]$/.test(e)?e.substr(1,e.length-2):e},t.stripFlags=function(e,t){return{open:"~"===e.charAt(2),close:"~"===t.charAt(t.length-3)}},t.stripComment=function(e){return e.replace(/^\{\{~?\!-?-?/,"").replace(/-?-?~?\}\}$/,"")},t.preparePath=function(e,t,n){n=this.locInfo(n);for(var i=e?"@":"",s=[],o=0,a=0,c=t.length;a<c;a++){var u=t[a].part,l=t[a].original!==u;if(i+=(t[a].separator||"")+u,l||".."!==u&&"."!==u&&"this"!==u)s.push(u);else{if(s.length>0)throw new r.default("Invalid path: "+i,{loc:n});".."===u&&(o++,"../")}}return new this.PathExpression(e,o,s,i,n)},t.prepareMustache=function(e,t,n,i,r,s){var o=i.charAt(3)||i.charAt(2),a="{"!==o&&"&"!==o;return new this.MustacheStatement(e,t,n,a,r,this.locInfo(s))},t.prepareRawBlock=function(e,t,n,i){if(e.path.original!==n){var s={loc:e.path.loc};throw new r.default(e.path.original+" doesn't match "+n,s)}i=this.locInfo(i);var o=new this.Program([t],null,{},i);return new this.BlockStatement(e.path,e.params,e.hash,o,void 0,{},{},{},i)},t.prepareBlock=function(e,t,n,i,s,o){if(i&&i.path&&e.path.original!==i.path.original){var a={loc:e.path.loc};throw new r.default(e.path.original+" doesn't match "+i.path.original,a)}t.blockParams=e.blockParams;var c=void 0,u=void 0;n&&(n.chain&&(n.program.body[0].closeStrip=i.strip),u=n.strip,c=n.program);s&&(s=c,c=t,t=s);return new this.BlockStatement(e.path,e.params,e.hash,t,c,e.strip,u,i&&i.strip,this.locInfo(o))};var r=i(n(12))},function(e,t,n){"use strict";t.__esModule=!0;var i=n(13),r=void 0;try{}catch(e){}function s(e,t,n){if(i.isArray(e)){for(var r=[],s=0,o=e.length;s<o;s++)r.push(t.wrap(e[s],n));return r}return"boolean"==typeof e||"number"==typeof e?e+"":e}function o(e){this.srcFile=e,this.source=[]}r||((r=function(e,t,n,i){this.src="",i&&this.add(i)}).prototype={add:function(e){i.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){i.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),o.prototype={prepend:function(e,t){this.source.unshift(this.wrap(e,t))},push:function(e,t){this.source.push(this.wrap(e,t))},merge:function(){var e=this.empty();return this.each(function(t){e.add(["  ",t,"\n"])}),e},each:function(e){for(var t=0,n=this.source.length;t<n;t++)e(this.source[t])},empty:function(){var e=void 0===arguments[0]?this.currentLocation||{start:{}}:arguments[0];return new r(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var t=void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return e instanceof r?e:(e=s(e,this,t),new r(t.start.line,t.start.column,this.srcFile,e))},functionCall:function(e,t,n){return n=this.generateList(n),this.wrap([e,t?"."+t+"(":"(",n,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var i=s(e[n],this);"undefined"!==i&&t.push([this.quotedString(n),":",i])}var r=this.generateList(t);return r.prepend("{"),r.add("}"),r},generateList:function(e,t){for(var n=this.empty(t),i=0,r=e.length;i<r;i++)i&&n.add(","),n.add(s(e[i],this,t));return n},generateArray:function(e,t){var n=this.generateList(e,t);return n.prepend("["),n.add("]"),n}},t.default=o,e.exports=t.default}])}),define("hbs/underscore",[],function(){var e={},t=Array.prototype,n=Object.prototype,i=Function.prototype,r=t.slice,s=t.unshift,o=n.toString,a=n.hasOwnProperty,c=t.forEach,u=t.map,l=t.reduce,d=t.reduceRight,h=t.filter,p=t.every,f=t.some,g=t.indexOf,m=t.lastIndexOf,b=Array.isArray,v=Object.keys,y=i.bind,_=function(e){return new R(e)};_.VERSION="1.3.3";var w=_.each=_.forEach=function(t,n,i){if(null!=t)if(c&&t.forEach===c)t.forEach(n,i);else if(t.length===+t.length){for(var r=0,s=t.length;r<s;r++)if(r in t&&n.call(i,t[r],r,t)===e)return}else for(var o in t)if(_.has(t,o)&&n.call(i,t[o],o,t)===e)return};_.map=_.collect=function(e,t,n){var i=[];return null==e?i:u&&e.map===u?e.map(t,n):(w(e,function(e,r,s){i[i.length]=t.call(n,e,r,s)}),e.length===+e.length&&(i.length=e.length),i)},_.reduce=_.foldl=_.inject=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),l&&e.reduce===l)return i&&(t=_.bind(t,i)),r?e.reduce(t,n):e.reduce(t);if(w(e,function(e,s,o){r?n=t.call(i,n,e,s,o):(n=e,r=!0)}),!r)throw new TypeError("Reduce of empty array with no initial value");return n},_.reduceRight=_.foldr=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return i&&(t=_.bind(t,i)),r?e.reduceRight(t,n):e.reduceRight(t);var s=_.toArray(e).reverse();return i&&!r&&(t=_.bind(t,i)),r?_.reduce(s,t,n,i):_.reduce(s,t)},_.find=_.detect=function(e,t,n){var i;return S(e,function(e,r,s){if(t.call(n,e,r,s))return i=e,!0}),i},_.filter=_.select=function(e,t,n){var i=[];return null==e?i:h&&e.filter===h?e.filter(t,n):(w(e,function(e,r,s){t.call(n,e,r,s)&&(i[i.length]=e)}),i)},_.reject=function(e,t,n){var i=[];return null==e?i:(w(e,function(e,r,s){t.call(n,e,r,s)||(i[i.length]=e)}),i)},_.every=_.all=function(t,n,i){var r=!0;return null==t?r:p&&t.every===p?t.every(n,i):(w(t,function(t,s,o){if(!(r=r&&n.call(i,t,s,o)))return e}),!!r)};var S=_.some=_.any=function(t,n,i){n||(n=_.identity);var r=!1;return null==t?r:f&&t.some===f?t.some(n,i):(w(t,function(t,s,o){if(r||(r=n.call(i,t,s,o)))return e}),!!r)};_.include=_.contains=function(e,t){var n=!1;return null==e?n:g&&e.indexOf===g?-1!=e.indexOf(t):n=S(e,function(e){return e===t})},_.invoke=function(e,t){var n=r.call(arguments,2);return _.map(e,function(e){return(_.isFunction(t)?t||e:e[t]).apply(e,n)})},_.pluck=function(e,t){return _.map(e,function(e){return e[t]})},_.max=function(e,t,n){if(!t&&_.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&_.isEmpty(e))return-1/0;var i={computed:-1/0};return w(e,function(e,r,s){var o=t?t.call(n,e,r,s):e;o>=i.computed&&(i={value:e,computed:o})}),i.value},_.min=function(e,t,n){if(!t&&_.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&_.isEmpty(e))return 1/0;var i={computed:1/0};return w(e,function(e,r,s){var o=t?t.call(n,e,r,s):e;o<i.computed&&(i={value:e,computed:o})}),i.value},_.shuffle=function(e){var t,n=[];return w(e,function(e,i,r){t=Math.floor(Math.random()*(i+1)),n[i]=n[t],n[t]=e}),n},_.sortBy=function(e,t,n){var i=_.isFunction(t)?t:function(e){return e[t]};return _.pluck(_.map(e,function(e,t,r){return{value:e,criteria:i.call(n,e,t,r)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;return void 0===n?1:void 0===i?-1:n<i?-1:n>i?1:0}),"value")},_.groupBy=function(e,t){var n={},i=_.isFunction(t)?t:function(e){return e[t]};return w(e,function(e,t){var r=i(e,t);(n[r]||(n[r]=[])).push(e)}),n},_.sortedIndex=function(e,t,n){n||(n=_.identity);for(var i=0,r=e.length;i<r;){var s=i+r>>1;n(e[s])<n(t)?i=s+1:r=s}return i},_.toArray=function(e){return e?_.isArray(e)?r.call(e):_.isArguments(e)?r.call(e):e.toArray&&_.isFunction(e.toArray)?e.toArray():_.values(e):[]},_.size=function(e){return _.isArray(e)?e.length:_.keys(e).length},_.first=_.head=_.take=function(e,t,n){return null==t||n?e[0]:r.call(e,0,t)},_.initial=function(e,t,n){return r.call(e,0,e.length-(null==t||n?1:t))},_.last=function(e,t,n){return null==t||n?e[e.length-1]:r.call(e,Math.max(e.length-t,0))},_.rest=_.tail=function(e,t,n){return r.call(e,null==t||n?1:t)},_.compact=function(e){return _.filter(e,function(e){return!!e})},_.flatten=function(e,t){return _.reduce(e,function(e,n){return _.isArray(n)?e.concat(t?n:_.flatten(n)):(e[e.length]=n,e)},[])},_.without=function(e){return _.difference(e,r.call(arguments,1))},_.uniq=_.unique=function(e,t,n){var i=n?_.map(e,n):e,r=[];return e.length<3&&(t=!0),_.reduce(i,function(n,i,s){return(t?_.last(n)===i&&n.length:_.include(n,i))||(n.push(i),r.push(e[s])),n},[]),r},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=_.intersect=function(e){var t=r.call(arguments,1);return _.filter(_.uniq(e),function(e){return _.every(t,function(t){return _.indexOf(t,e)>=0})})},_.difference=function(e){var t=_.flatten(r.call(arguments,1),!0);return _.filter(e,function(e){return!_.include(t,e)})},_.zip=function(){for(var e=r.call(arguments),t=_.max(_.pluck(e,"length")),n=new Array(t),i=0;i<t;i++)n[i]=_.pluck(e,""+i);return n},_.indexOf=function(e,t,n){if(null==e)return-1;var i,r;if(n)return e[i=_.sortedIndex(e,t)]===t?i:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(i in e&&e[i]===t)return i;return-1},_.lastIndexOf=function(e,t){if(null==e)return-1;if(m&&e.lastIndexOf===m)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},_.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=0,s=new Array(i);r<i;)s[r++]=e,e+=n;return s};var E=function(){};_.bind=function(e,t){var n,i;if(e.bind===y&&y)return y.apply(e,r.call(arguments,1));if(!_.isFunction(e))throw new TypeError;return i=r.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(r.call(arguments)));E.prototype=e.prototype;var s=new E,o=e.apply(s,i.concat(r.call(arguments)));return Object(o)===o?o:s}},_.bindAll=function(e){var t=r.call(arguments,1);return 0==t.length&&(t=_.functions(e)),w(t,function(t){e[t]=_.bind(e[t],e)}),e},_.memoize=function(e,t){var n={};return t||(t=_.identity),function(){var i=t.apply(this,arguments);return _.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},_.delay=function(e,t){var n=r.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},_.defer=function(e){return _.delay.apply(_,[e,1].concat(r.call(arguments,1)))},_.throttle=function(e,t){var n,i,r,s,o,a,c=_.debounce(function(){o=s=!1},t);return function(){n=this,i=arguments;return r||(r=setTimeout(function(){r=null,o&&e.apply(n,i),c()},t)),s?o=!0:a=e.apply(n,i),c(),s=!0,a}},_.debounce=function(e,t,n){var i;return function(){var r=this,s=arguments;n&&!i&&e.apply(r,s),clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(r,s)},t)}},_.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments))}},_.wrap=function(e,t){return function(){var n=[e].concat(r.call(arguments,0));return t.apply(this,n)}},_.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},_.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},_.keys=v||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)_.has(e,n)&&(t[t.length]=n);return t},_.values=function(e){return _.map(e,_.identity)},_.functions=_.methods=function(e){var t=[];for(var n in e)_.isFunction(e[n])&&t.push(n);return t.sort()},_.extend=function(e){return w(r.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},_.pick=function(e){var t={};return w(_.flatten(r.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},_.defaults=function(e){return w(r.call(arguments,1),function(t){for(var n in t)null==e[n]&&(e[n]=t[n])}),e},_.clone=function(e){return _.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},_.tap=function(e,t){return t(e),e},_.isEqual=function(e,t){return function e(t,n,i){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;if(t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped),t.isEqual&&_.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&_.isFunction(n.isEqual))return n.isEqual(t);var r=o.call(t);if(r!=o.call(n))return!1;switch(r){case"[object String]":return t==String(n);case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=_typeof(t)||"object"!=_typeof(n))return!1;for(var s=i.length;s--;)if(i[s]==t)return!0;i.push(t);var a=0,c=!0;if("[object Array]"==r){if(c=(a=t.length)==n.length)for(;a--&&(c=a in t==a in n&&e(t[a],n[a],i)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var u in t)if(_.has(t,u)&&(a++,!(c=_.has(n,u)&&e(t[u],n[u],i))))break;if(c){for(u in n)if(_.has(n,u)&&!a--)break;c=!a}}return i.pop(),c}(e,t,[])},_.isEmpty=function(e){if(null==e)return!0;if(_.isArray(e)||_.isString(e))return 0===e.length;for(var t in e)if(_.has(e,t))return!1;return!0},_.isElement=function(e){return!(!e||1!=e.nodeType)},_.isArray=b||function(e){return"[object Array]"==o.call(e)},_.isObject=function(e){return e===Object(e)},_.isArguments=function(e){return"[object Arguments]"==o.call(e)},_.isArguments(arguments)||(_.isArguments=function(e){return!(!e||!_.has(e,"callee"))}),_.isFunction=function(e){return"[object Function]"==o.call(e)},_.isString=function(e){return"[object String]"==o.call(e)},_.isNumber=function(e){return"[object Number]"==o.call(e)},_.isFinite=function(e){return _.isNumber(e)&&isFinite(e)},_.isNaN=function(e){return e!=e},_.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==o.call(e)},_.isDate=function(e){return"[object Date]"==o.call(e)},_.isRegExp=function(e){return"[object RegExp]"==o.call(e)},_.isNull=function(e){return null===e},_.isUndefined=function(e){return void 0===e},_.has=function(e,t){return a.call(e,t)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(e){return e},_.times=function(e,t,n){for(var i=0;i<e;i++)t.call(n,i)},_.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},_.result=function(e,t){if(null==e)return null;var n=e[t];return _.isFunction(n)?n.call(e):n},_.mixin=function(e){w(_.functions(e),function(t){T(t,_[t]=e[t])})};var A=0;_.uniqueId=function(e){var t=A++;return e?e+t:t},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var x=/.^/,P={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var k in P)P[P[k]]=k;var C=/\\|'|\r|\n|\t|\u2028|\u2029/g,O=/\\(\\|'|r|n|t|u2028|u2029)/g,j=function(e){return e.replace(O,function(e,t){return P[t]})};_.template=function(e,t,n){n=_.defaults(n||{},_.templateSettings);var i="__p+='"+e.replace(C,function(e){return"\\"+P[e]}).replace(n.escape||x,function(e,t){return"'+\n_.escape("+j(t)+")+\n'"}).replace(n.interpolate||x,function(e,t){return"'+\n("+j(t)+")+\n'"}).replace(n.evaluate||x,function(e,t){return"';\n"+j(t)+"\n;__p+='"})+"';\n";n.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+i+"return __p;\n";var r=new Function(n.variable||"obj","_",i);if(t)return r(t,_);var s=function(e){return r.call(this,e,_)};return s.source="function("+(n.variable||"obj")+"){\n"+i+"}",s},_.chain=function(e){return _(e).chain()};var R=function(e){this._wrapped=e};_.prototype=R.prototype;var I=function(e,t){return t?_(e).chain():e},T=function(e,t){R.prototype[e]=function(){var e=r.call(arguments);return s.call(e,this._wrapped),I(t.apply(_,e),this._chain)}};return _.mixin(_),w(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var n=t[e];R.prototype[e]=function(){var t=this._wrapped;n.apply(t,arguments);var i=t.length;return"shift"!=e&&"splice"!=e||0!==i||delete t[0],I(t,this._chain)}}),w(["concat","join","slice"],function(e){var n=t[e];R.prototype[e]=function(){return I(n.apply(this._wrapped,arguments),this._chain)}}),R.prototype.chain=function(){return this._chain=!0,this},R.prototype.value=function(){return this._wrapped},_}),function(window){var JSON=window.JSON||{};!function(){"use strict";function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,s,o,a=gap,c=t[e];switch(c&&"object"===_typeof(c)&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),_typeof(c)){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,n=0;n<s;n+=1)o[n]=str(n,c)||"null";return r=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,r}if(rep&&"object"===_typeof(rep))for(s=rep.length,n=0;n<s;n+=1)"string"==typeof rep[n]&&(r=str(i=rep[n],c))&&o.push(quote(i)+(gap?": ":":")+r);else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(r=str(i,c))&&o.push(quote(i)+(gap?": ":":")+r);return r=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,r}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!==_typeof(t)||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var n,i,r=e[t];if(r&&"object"===_typeof(r))for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(void 0!==(i=walk(r,n))?r[n]=i:delete r[n]);return reviver.call(e,t,r)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("hbs/json2",[],function(){return JSON})}.call(this,this),define("hbs",["hbs/handlebars","hbs/underscore","hbs/json2"],function(e,t,n){var i,r,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=function(){throw new Error("Environment unsupported.")},a=[],c="w+",u="hbs",l="/styles/",d="/demo-build/styles/",h="templates/helpers/",p="screen.build.css",f="onHbsRead";e.registerHelper("$",function(){}),"undefined"!=typeof window&&window.navigator&&window.document&&!window.navigator.userAgent.match(/Node.js/)?(r=function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return!0===arguments[0]?new XDomainRequest:new XMLHttpRequest;for(t=0;t<3;t++){n=s[t];try{e=new ActiveXObject(n)}catch(e){}if(e){s=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},getIEVersion=function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))}return e},o=function(e,t){var n=!1;if(0!=e.indexOf("http"))n=!1;else{var i="https"===e.substr(0,5)?8:7,s="https"===window.location.href.substr(0,5)?8:7,o=e.substr(i).split("/").shift(),a=getIEVersion();n=o!=window.location.href.substr(s).split("/").shift()&&a>=7}if(n){var c=r(!0);c.open("GET",e),c.onload=function(){t(c.responseText,e)},c.onprogress=function(){},c.ontimeout=function(){},c.onerror=function(){},setTimeout(function(){c.send()},0)}else{var u=r();u.open("GET",e,!0),u.onreadystatechange=function(n){4===u.readyState&&t(u.responseText,e)},u.send(null)}}):"undefined"!=typeof process&&process.versions&&process.versions.node?(i=require.nodeRequire("fs"),o=function(e,t){var n=i.readFileSync(e,"utf8")||"";t(n=n.replace(/^\uFEFF/,""),e)}):"undefined"!=typeof java&&void 0!==java.io&&(o=function(e,t){for(var n,i=new java.io.FileInputStream(e),r=new java.io.InputStreamReader(i,"UTF-8"),s=new java.io.BufferedReader(r),o="";null!==(n=s.readLine());)o+=new String(n)+"\n";s.close(),t(o,e)});var g,m=[],b={},v=[];return{get:function(){return e},write:function(e,t,n){if(t+"@hbs"in a){var i=a[t+"@hbs"];n.asModule(e+"!"+t,i)}},version:"3.0.3",load:function(i,r,s,y){var _=i+"@hbs";(g=g||y).hbs=g.hbs||{};var w=0==g.hbs.helpers,S="";g.hbs.partialsUrl&&((S=g.hbs.partialsUrl).match(/\/$/)||(S+="/")),g.hbs.fetchText&&(o=g.hbs.fetchText);var E;function A(e,n){var i=[];return e&&e.body&&(i=function e(n,i){return t(n).forEach(function(t){t&&t.type&&"PartialStatement"===t.type&&"SubExpression"!==t.name.type&&i.push(t.name.original),t&&t.program&&t.program.body&&e(t.program.body,i),t&&t.inverse&&t.inverse.body&&e(t.inverse.body,i)}),i}(e.body,[])),n&&n.partials&&n.partials.length&&t(n.partials).forEach(function(e){i.push(e)}),t.unique(i)}function x(e){return!!("SubExpression"===e.type||e.params&&e.params.length||e.hash)}function P(n,i){x(n)&&void 0!==n.path&&function(t,n){void 0===e.helpers[t]&&n.push(t)}(n.path.original,i),n&&n.params&&n.params.forEach(function(e){P(e,i)}),n&&n.hash&&n.hash.pairs&&t(n.hash.pairs).forEach(function(e){P(e.value,i)})}function k(e){var n=[],i=[];e&&e.body&&(n=function e(n,i,r,s){r=r?r+".":"";return t(n).forEach(function(t){var n;(x(t)||"MustacheStatement"===t.type)&&P(t,s),t&&t.mustache&&e([t.mustache],i,r+"",s),t&&t.program&&t.program.body&&(n=e([t.path],[],"",s)[0]||"",t.inverse&&t.inverse.body&&e(t.inverse.body,i,r+""+(n?r+""?"."+n:n:""),s),e(t.program.body,i,r+""+(n?r+""?"."+n:n:""),s))}),i}(e.body,[],void 0,i));var r=["helperMissing","blockHelperMissing","each","if","unless","with","log","lookup"];return{vars:t(n).chain().unique().map(function(e){return""===e?".":e.length&&"."===e[e.length-1]?e.substr(0,e.length-1)+"[]":e}).value(),helpers:t(i).chain().unique().map(function(e){if(!t(r).contains(e))return e}).compact().value()}}function C(e){for(var t=e.split("/"),n=0;n<t.length;n++)".."===t[n]?(delete t[n-1],delete t[n]):"."===t[n]&&delete t[n];return t.join("/").replace(/\/\/+/g,"/")}var O=g.hbs&&!1===g.hbs.templateExtension;E=O?r.toUrl(i):r.toUrl(i+"."+(g.hbs&&g.hbs.templateExtension?g.hbs.templateExtension:u)),o(E,function(o,y){var E,x,P,j,R,I=g.isBuild&&g[f]?g[f]:function(e,t,n){return n},T=e.parse(I(i,y,o)),N=function(e){var t,i;if(e&&e.body&&(t=e.body[0])&&"CommentStatement"===t.type)try{return i=t.value.replace(new RegExp("^[\\s]+|[\\s]+$","g"),""),n.parse(i),i}catch(e){return n.stringify({description:i})}return"{}"}(T),D=k(T),M=D.vars,L=D.helpers||[],q="",B=[],U=i.substr(0,i.lastIndexOf("/")+1);if("{}"!==N)try{P=n.parse(N)}catch(e){console.log("couldn't parse meta for %s",y)}var H,F,W=A(T,P);for(var $ in g.hbs=g.hbs||{},g.hbs._partials=g.hbs._partials||{},W)if(W.hasOwnProperty($)&&"string"==typeof W[$]){var V,Q=W[$];if(V=Q.match(/^(\.|\/)+/)?C(U+Q):C(S+Q),O){if(y===r.toUrl(V))continue}else if(y===r.toUrl(V+"."+(g.hbs&&g.hbs.templateExtension?g.hbs.templateExtension:u)))continue;g.hbs._partials[V]=g.hbs._partials[V]||[],g.hbs._partials[V].references=g.hbs._partials[V].references||[],g.hbs._partials[V].references.push(Q),g.hbs._loadedDeps=g.hbs._loadedDeps||{},B[$]="hbs!"+V}if(E=B.join("', '"),L=L.concat(P&&P.helpers?P.helpers:[]),(x=w?"":function(){var e,t=[],n=g.hbs&&g.hbs.helperPathCallback?g.hbs.helperPathCallback:function(e){return(g.hbs&&g.hbs.helperDirectory?g.hbs.helperDirectory:h)+e};for(e=0;e<L.length;e++)t[e]="'"+n(L[e],y)+"'";return t}().join(","))&&(x=","+x),P)try{P.styles&&(m=t.union(m,P.styles),require.isBrowser&&!g.isBuild?(j=document.head||document.getElementsByTagName("head")[0],t(P.styles).forEach(function(e){b[e]||((R=document.createElement("link")).href=g.baseUrl+l+e+".css",R.media="all",R.rel="stylesheet",R.type="text/css",j.appendChild(R),b[e]=R)})):g.isBuild&&(H=require.nodeRequire("fs"),F=t(P.styles).map(function(e){return b[e]?"":(b[e]=!0,"@import url("+e+".css);\n")}).join("\n"),H.open(__dirname+d+p,c,"0666",function(e,t){H.writeSync(t,F,null,encoding="utf8"),H.close(t)}),c="a"))}catch(e){console.log("error injecting styles")}g.isBuild||g.serverRender||(q="t.meta = "+N+";\nt.helpers = "+n.stringify(L)+";\nt.deps = "+n.stringify(B)+";\nt.vars = "+n.stringify(M)+";\n");var G=g.hbs||{},K=t.extend(G.compileOptions||{},{originalKeyFallback:G.originalKeyFallback}),z=function(t,n,i){var r,s;return"data"in(i=i||{})||(i.data=!0),i.compat&&(i.useDepths=!0),r=e.parse(t),s=(new e.Compiler).compile(r,i),(new e.JavaScriptCompiler).compile(s,i)}(o,0,K),Y="'hbs!"+i+"',";E&&(E=", '"+E+"'");var J=[];g.hbs._partials[i]&&(J=g.hbs._partials[i].references);var X=g.hbs&&g.hbs.handlebarsPath?g.hbs.handlebarsPath:"hbs/handlebars";for(o="/* START_TEMPLATE */\ndefine("+Y+"['"+X+"'"+E+x+"], function( Handlebars ){ \nvar t = Handlebars.template("+z+");\nHandlebars.registerPartial('"+i+"', t);\n",$=0;$<J.length;$++)o+="Handlebars.registerPartial('"+J[$]+"', t);\n";o+=q+"return t;\n});\n/* END_TEMPLATE */\n",g.isBuild&&(a[_]=o),g.isBuild||(o+="\r\n//# sourceURL="+y),g.isBuild?(s.fromText(i,o),r([i],function(e){s(e)})):r(B,function(){s.fromText(o),r([i],function(e){s(e)})}),g.removeCombined&&y&&v.push(y)})},onLayerEnd:function(){g.removeCombined&&i&&v.forEach(function(e){i.existsSync(e)&&i.unlinkSync(e)})}}}),define("hbs!404",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<!DOCTYPE html>\n<html>\n  <head>\n    <link rel="preload" href="./styles/css/styles.css" as="style" />\n    <link rel="stylesheet" href="./styles/css/styles.css" />\n    <link rel="preload" href="./libs/require.js" as="script" />\n    \x3c!-- favicon --\x3e\n    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />\n    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />\n    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />\n    <link rel="manifest" href="/site.webmanifest" />\n    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />\n    <meta name="apple-mobile-web-app-title" content="NASA ADS" />\n    <meta name="application-name" content="NASA ADS" />\n    <meta name="msapplication-TileColor" content="#ffc40d" />\n    <meta name="theme-color" content="#ffffff" />\n    \x3c!-- /favicon --\x3e\n    <script src="./libs/require.js"><\/script>\n    <script>\n      require.config({\n        paths: {\n          underscore: [\n            \'https://unpkg.com/lodash@2.4.2/dist/lodash.compat.min\',\n            \'libs/lodash\',\n          ],\n          \'google-analytics\': [\'libs/g\', \'data:application/javascript,\'],\n          analytics: \'js/components/analytics\',\n          jquery: [\n            \'https://unpkg.com/jquery@2.2.4/dist/jquery.min\',\n            \'libs/jquery\',\n          ],\n        },\n        shim: {\n          \'google-analytics\': {\n            exports: \'__ga__\',\n          },\n        },\n        callback: function() {\n          window.GoogleAnalyticsObject = \'__ga__\';\n\n          require([\'config/discovery.vars\'], function(config) {\n            setTimeout(function() {\n              require([\'google-analytics\', \'analytics\'], function() {\n                var qa = window[window.GoogleAnalyticsObject];\n                qa.l = Date.now();\n                qa(\n                  \'create\',\n                  config.googleTrackingCode || \'\',\n                  config.googleTrackingOptions\n                );\n              });\n            }, 0);\n          });\n        },\n      });\n      require([\'analytics\'], function(analytics) {\n        analytics(\'send\', \'pageview\');\n        analytics(\n          \'send\',\n          \'event\',\n          \'error\',\n          \'automatic_redirection\',\n          \'404.html\'\n        );\n      });\n    <\/script>\n  </head>\n  <body>\n    <div\n      style="display: flex; flex-direction: column; min-height: screen; min-width: screen; justify-content: center; align-items: center;"\n    >\n      <h1>Bumblebee failed to load. Please try again.</h1>\n\n      <h2>\n        <a href="javascript:history.back()">Go Back</a>\n      </h2>\n    </div>\n  </body>\n</html>\n'},useData:!0});return e.registerPartial("404",t),t}),define("hbs!js/apps/discovery/templates/orcid-modal-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'\n    <p>\n        If you <strong>wish for your ORCID claims to be accessible in the ADS,</strong> please first\n        <a href="#user/settings/orcid">fill out this brief form. </a>\n    </p>\n\n    <p>\n        After you have completed the form, you can immediately begin claiming papers.\n    </p>\n\n\n'},3:function(e,t,n,i){return'\n    <p>\n        If you <strong>want your ORCID claims to be accessible in the ADS,</strong>\n        please sign in to ADS or create an account and provide us with your permission to\n        make your claims public, along with a few other key pieces of information.\n\n    </p>\n    <p>\n        <a href="#user/account/login" class="btn btn-primary">log in to ADS </a>\n        or\n        <a href="#user/account/register" class="btn btn-primary">create a new account</a>\n\n    </p>\n    <p>\n        After you are signed in to your account, go to the "User Preferences" page,\n        click on the "ORCID Settings" tab, and fill in the brief form.\n    </p>\n\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return"\n\n"+(null!=(r=t.if.call(e,null!=e?e.adsLoggedIn:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+"\n<p>\n    <b>If you don't care about your information being searchable in the ADS, just close this message and continue.</b>\n</p>"},useData:!0});return e.registerPartial("js/apps/discovery/templates/orcid-modal-template",t),t}),define("js/mixins/api_access",["underscore","backbone","js/components/api_query","js/components/api_request"],function(e,t,n,i){return{onBootstrap:function(e){var t=this.getBeeHive();if(e.access_token){t.getService("Api").setVals({access_token:e.token_type+":"+e.access_token,refresh_token:e.refresh_token,expire_in:e.expire_in}),console.warn("Redefining access_token: "+e.access_token);var n=t.getObject("User"),i=e.anonymous?void 0:e.username;n.setUser(i);var r=t.getService("PersistentStorage");r&&r.set&&r.set("appConfig",e)}else console.warn("bootstrap didn't provide access_token!")},getApiAccess:function(e){e=e||{};var t=this.getBeeHive().getService("Api"),r=this,s=$.Deferred();return t[e.tokenRefresh?"_request":"request"](new i({query:new n,target:this.bootstrapUrls?this.bootstrapUrls[0]:"/accounts/bootstrap"}),{done:function(t){e.reconnect&&r.onBootstrap(t),s.resolve(t)},fail:function(){s.reject.apply(s,arguments)},type:"GET"}),s}}}),define("js/apps/discovery/navigator",["jquery","backbone","underscore","js/components/navigator","js/components/api_feedback","js/components/api_query_updater","js/components/json_response","js/components/api_query","js/components/api_request","js/components/api_targets","hbs!404","hbs!js/apps/discovery/templates/orcid-modal-template","js/mixins/api_access","react-redux"],function(e,t,n,i,r,s,o,a,c,u,l,d,h,p){var f=i.extend({start:function(t){var i=this,o=new s("navigator"),l=function(e){i.getPubSub().publish(i.getPubSub().FEEDBACK,new r(e))},h=function(e){i.getPubSub().publish(i.getPubSub().PAGE_CHANGE,e)},f=["Results","MyAdsFreeform","QueryInfo","AffiliationFacet","AuthorFacet","DatabaseFacet","RefereedFacet","KeywordFacet","BibstemFacet","BibgroupFacet","DataFacet","ObjectFacet","NedObjectFacet","VizierFacet","GraphTabs","QueryDebugInfo","ExportDropdown","VisualizationDropdown","SearchWidget","Sort","BreadcrumbsWidget","PubtypeFacet","OrcidSelector"],g=["TOCWidget","SearchWidget","ShowResources","ShowAssociated","ShowGraphicsSidebar","ShowLibraryAdd","MetaTagsWidget"];function m(e){return!t.getBeeHive().getObject("User").isLoggedIn()&&(t.getService("Navigator").navigate("authentication-page",{subView:"login",redirect:!0,next:e}),!0)}function b(n,i,r){return function(s,o){var a=e.Deferred(),c=this;if(m(c.endpoint))return a.resolve(),a.promise();var u=o.subView||i;return u||console.error("no subview or default view provided /to the navigator function!"),t.getObject("MasterPageManager").show("SettingsPage",[n,"UserNavbarWidget"]).then(function(){t.getWidget("SettingsPage").done(function(e){e.setActive(n,u)}),c.route="#user/settings/"+u,c.title="Settings"+(r?" | "+r:""),h("settings-page"),a.resolve()}),a.promise()}}function v(i,r){var s=e.Deferred(),o=this,a=r.widgetName,c=r.additional,u=c.format||"bibtex",l=r.subView,d=r.id,p=r.publicView;function f(i){var r=e.Deferred();return t.getObject("LibraryController").getLibraryBibcodes(i).done(function(e){t.getWidget("LibraryListWidget").then(function(s){var o=s.model.get("sort");t.getWidget(a).then(function(s){c=n.extend({},c,{sort:o}),s.renderWidgetForListOfBibcodes(e,c),t.getWidget("IndividualLibraryWidget").then(function(e){e.setSubView({subView:l,publicView:p,id:i}),r.resolve()})})})}),r.promise()}return"ExportWidget"===a&&"authoraff"===u&&(a="AuthorAffiliationTool"),t.getWidget(a).done(function(e){e.reset?e.reset():e.resetWidget&&e.resetWidget()}).done(function(){"ExportWidget"!==a||"classic"!==u?p?t.getObject("MasterPageManager").show("PublicLibrariesPage",["IndividualLibraryWidget",a]).then(function(){f(d).done(function(){o.route="#public-libraries/"+r.id,s.resolve()})}):t.getObject("MasterPageManager").show("LibrariesPage",["IndividualLibraryWidget","UserNavbarWidget",a]).then(function(){f(d).done(function(){o.route="#user/libraries/"+r.id,h("libraries-page"),s.resolve()})}):s.resolve()}),s.promise()}function y(i,s){var a=e.Deferred(),c=this;s=s||{};var u=t.getObject("AppStorage").getCurrentQuery();if(!u&&s.q)u=s.q;else if(!u&&!s.q)return a.resolve().promise();l({code:r.CODES.MAKE_SPACE});var d=n.map(i.split("-").slice(1),function(e){return e[0].toUpperCase()+e.slice(1)}).join("");return t.getObject("MasterPageManager").show("SearchPage",[d].concat(f.slice(1))).done(function(){var e="#search/"+o.clean(u.clone()).url()+"/"+i.split("-").slice(1).join("-");s&&s.onlySelected?t.getWidget(d).done(function(n){var i=t.getObject("AppStorage").getSelectedPapers();n.renderWidgetForListOfBibcodes(i),c.route=e,a.resolve()}):t.getWidget(d).done(function(t){t.renderWidgetForCurrentQuery({currentQuery:u}),c.route=e,a.resolve()})}),a.promise()}this.set("index-page",function(n){var i=this,r=e.Deferred();return t.getObject("MasterPageManager").show("LandingPage",["SearchWidget","RecommenderWidget"]).then(function(){return t.getWidget("LandingPage").then(function(e){n&&"SearchWidget"===n.origin?e.setActive("SearchWidget"):e.setActive("SearchWidget",null,{origin:"index-page"}),i.route="",i.title="",r.resolve()})}),r.promise()}),this.set("SearchWidget",function(){var t=this,r=e.Deferred();return n.bind(i.get("index-page").execute,this,{origin:"SearchWidget"})().then(function(){t.route="",t.title="",r.resolve()}),r.promise()}),this.set("404",function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function e(n){var i,r=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,t.getObject("MasterPageManager");case 3:return e.sent.show("ErrorPage"),e.next=6,t.getWidget("ErrorPage");case 6:e.sent.setMessage(i),Object.keys(i).length>0&&(this.replace=!0),this.route="404";case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),this.set("ClassicSearchForm",function(n,i){var r=i.query,s=e.Deferred(),o=this;return t.getObject("MasterPageManager").show("LandingPage",[n]).then(function(){t.getWidget("LandingPage").done(function(e){e.setActive(n),e.widgets[n].applyQueryParams(r)}),o.route="#classic-form",o.title="Classic Form",s.resolve()}),s.promise()}),this.set("PaperSearchForm",function(){var n=e.Deferred(),i=this;return t.getObject("MasterPageManager").show("LandingPage",["PaperSearchForm"]).then(function(){t.getWidget("LandingPage").done(function(e){e.setActive("PaperSearchForm")}),i.route="#paper-form",i.title="Paper Form",n.resolve()}),n.promise()}),this.set("LibraryImport",function(n,i){var r=e.Deferred(),s=this;return m(s.endpoint)?(r.resolve(),r.promise()):(t.getObject("MasterPageManager").show("SettingsPage",["LibraryImport","UserNavbarWidget"]).then(function(){t.getWidget("SettingsPage").done(function(e){e.setActive("LibraryImport"),s.route="#user/settings/libraryimport",s.title="Library Import",h("settings-page"),r.resolve()})}),r.promise())}),this.set("UserSettings",b("UserSettings",void 0)),this.set("UserPreferences",b("UserPreferences","application","Search Settings")),this.set("MyAdsDashboard",function(){var n=e.Deferred(),i=this;return m(i.endpoint)?(n.resolve(),n.promise()):(t.getObject("MasterPageManager").show("SettingsPage",["MyAdsDashboard","UserNavbarWidget"]).then(function(){t.getWidget("SettingsPage").done(function(e){e.setActive("MyAdsDashboard"),i.route="#user/settings/myads",i.title="myADS Notifications",h("settings-page"),n.resolve()})}),n.promise())}),this.set("LibraryActionsWidget",function(){var n=e.Deferred(),i=this;return m(i.endpoint)?n.resolve().promise():(t.getObject("MasterPageManager").show("LibrariesPage",["LibraryActionsWidget","UserNavbarWidget"]).then(function(){t.getWidget("LibraryActionsWidget").done(function(e){e.reset(),i.route="#user/libraries/actions",h("libraries-page"),n.resolve()})}),n.promise())}),this.set("AllLibrariesWidget",function(n,i){var r=e.Deferred(),s=this;if(m(s.endpoint))return r.resolve(),r.promise();i=i||"libraries";return t.getObject("MasterPageManager").show("LibrariesPage",["AllLibrariesWidget","UserNavbarWidget"]).then(function(){t.getWidget("AllLibrariesWidget").done(function(e){e.setSubView({view:i}),e.reset(),s.route="#user/libraries/",s.title="My Libraries",h("libraries-page")}),r.resolve()}),r.promise()}),this.set("LibraryAdminView",function(n){var i=e.Deferred();return t.getObject("MasterPageManager").show("LibrariesPage",["IndividualLibraryWidget","UserNavbarWidget"]).then(function(){t.getWidget("IndividualLibraryWidget").done(function(e){e.setSubView({subView:"admin"})}),h("libraries-page"),i.resolve()}),i.promise()}),this.set("IndividualLibraryWidget",function(i,r){var s=e.Deferred(),o=this;if(r.publicView=!!r.publicView&&r.publicView,!r.publicView&&m(o.endpoint))return s.resolve().promise();this.route=r.publicView?"#public-libraries/"+r.id:"#user/libraries/"+r.id;var a=r.publicView;return t.getObject("MasterPageManager").show(a?"PublicLibrariesPage":"LibrariesPage",a?["IndividualLibraryWidget","LibraryListWidget"]:["IndividualLibraryWidget","LibraryListWidget","UserNavbarWidget"]).then(function(){t.getObject("LibraryController").getLibraryMetadata(r.id,!r.publicView).done(function(e){r.editRecords=n.contains(["write","admin","owner"],e.permission)&&!r.publicView,o.title=r.publicView?"Public":"Private Library | "+e.name,t.getWidget("LibraryListWidget","IndividualLibraryWidget").then(function(e){e.LibraryListWidget.setData(r),e.IndividualLibraryWidget.setSubView(r),a&&h("libraries-page"),s.resolve()})})}),s.promise()}),this.set("library-export",v),this.set("library-visualization",v),this.set("library-metrics",v),this.set("library-citation_helper",v),this.set("home-page",function(){var n=e.Deferred(),i=this;return m(i.endpoint)?n.resolve().promise():(t.getObject("MasterPageManager").show("HomePage",[]).then(function(){h("home-page"),i.title="Home",i.route="#user/home",n.resolve()}),n.promise())}),this.set("authentication-page",function(n,r){var s=e.Deferred(),o=(r=r||{}).subView||"login",a=this;return t.getBeeHive().getObject("User").isLoggedIn()?i.get("index-page").execute().then(function(){s.resolve()}):(r.redirect&&(a.replace=!0),t.getObject("MasterPageManager").show("AuthenticationPage",["Authentication"]).then(function(){t.getWidget("Authentication").done(function(e){r.next&&e.setNextNavigation(r.next),e.setSubView(o),a.route="#user/account/"+o,a.title="login"===o?"Sign In":"Register",s.resolve()})})),s.promise()}),this.set("results-page",function(i,s){var c=this,u=e.Deferred();return t.getObject("MasterPageManager").show("SearchPage",f).done(function(){var e=t.getObject("AppStorage").getCurrentQuery();if(e&&e.get("__original_url")){var i="#search/"+e.get("__original_url");e.unset("__original_url")}else i="#search/"+o.clean(e).url();if(e instanceof a){var s={};if(e.has("p_")){var d=function(e){if(n.isString(e))try{return parseInt(e)}catch(e){}return!1}(e.get("p_")[0]);s.page=d}else i+="&p_=0";n.isEmpty(s)||t.getWidget("Results").then(function(e){n.isFunction(e.updatePagination)&&e.updatePagination(s)})}e&&e.get("__qid")&&(i+="&__qid="+e.get("__qid")[0]),c.title=e&&e.get("q").length&&e.get("q")[0],c.route=i,l({code:r.CODES.UNMAKE_SPACE}),u.resolve()}),u.promise()}),this.set("export",function(n,s){var o=e.Deferred(),a=s.format||"bibtex",c=t.getObject("AppStorage");return t.getObject("MasterPageManager").show("SearchPage",["ExportWidget"].concat(f.slice(1))).then(function(){t.getWidget("ExportWidget").done(function(e){if("authoraff"!==a)if(l({code:r.CODES.MAKE_SPACE}),s.onlySelected&&c.hasSelectedPapers())e.renderWidgetForListOfBibcodes(c.getSelectedPapers(),{format:a,sort:c.hasCurrentQuery()&&c.getCurrentQuery().get("sort")[0]});else if(!1===s.onlySelected&&c.hasCurrentQuery())e.renderWidgetForCurrentQuery({format:a,currentQuery:c.getCurrentQuery(),numFound:c.get("numFound")});else if(void 0===s.onlySelected&&c.hasSelectedPapers())e.renderWidgetForListOfBibcodes(c.getSelectedPapers(),{format:a});else if(c.hasCurrentQuery())e.exportQuery({format:a,currentQuery:c.getCurrentQuery(),numFound:c.get("numFound")});else{t.getController("AlertsController").alert({msg:"There are no records to export yet (please search or select some)"}),i.get("results-page")()}else s.onlySelected&&c.hasSelectedPapers()?e.getAuthorAffForm({bibcodes:c.getSelectedPapers()}):e.getAuthorAffForm({currentQuery:c.getCurrentQuery()})}).done(function(){o.resolve()})}),o.promise()}),this.set("export-query",function(){var n=e.Deferred(),i=t.getService("Api"),s=t.getObject("AppStorage").getCurrentQuery(),o=t.getController("AlertsController");return s=new a({query:s.url()}),i.request(new c({query:s,target:u.MYADS_STORAGE+"/query",options:{done:function(){},type:"POST",xhrFields:{withCredentials:!1}}})).done(function(e){o.alert(new r({code:r.CODES.ALERT,msg:'The query has been saved. You can insert the following snippet in a webpage: <br/><img src="'+u.MYADS_STORAGE+"/query2svg/"+e.qid+'"></img><br/><br/><textarea rows="10" cols="50"><a href="'+location.protocol+"//"+location.host+location.pathname+"#execute-query/"+e.qid+'"><img src="'+u.MYADS_STORAGE+"/query2svg/"+e.qid+'"></img></a></textarea>',modal:!0})),n.resolve()}),n.promise()}),this.set("search-page",function(s,c){var u=!1;try{u=document.referrer.indexOf("tugboat/adsabs")>-1}catch(e){}var d,h,p=e.Deferred();c.page&&(d=n.map(c.page.split("-").slice(1),function(e){return e[0].toUpperCase()+e.slice(1)}).join("")),h=d&&["Metrics","AuthorNetwork","PaperNetwork","ConceptCloud","BubbleChart"].indexOf(d)>-1?[d].concat(f.slice(1)):f;var g=this,m=c&&c.context||{};return _(h,m).then(function(){l({code:r.CODES.UNMAKE_SPACE});var e=i.getPubSub();e.subscribe(e.FEEDBACK,function s(l){l&&l.code===r.CODES.SEARCH_CYCLE_FINISHED&&(function(){var e=i.getBeeHive().getObject("AppStorage").getCurrentQuery();e||(e=c.q);var r=o.clean(e);e.has("__qid")&&r.set("__qid",e.get("__qid")),g.route="#search/"+r.url(),e.has("__bigquerySource")?g.title=e.get("__bigquerySource")[0]:g.title=e.get("q").length&&e.get("q")[0],u&&(g.route+="&__tb=1");var s=e;if(s instanceof a){var l={};if(s.has("p_")){var d=function(e){if(n.isString(e))try{return parseInt(e)}catch(e){}return!1}(s.get("p_")[0]);l.page=d}else g.route+="&p_=0";n.isEmpty(l)||t.getWidget("Results").then(function(e){n.isFunction(e.updatePagination)&&e.updatePagination(l)})}c.page&&i.get(c.page)?n.bind(i.get(c.page).execute,g,c.page,{q:e})(c.page).then(function(){p.resolve()}):p.resolve()}(),e.unsubscribe(e.FEEDBACK,s))}),e.publish(e.START_SEARCH,c.q)}),p.promise()}),this.set("execute-query",function(n,s){var o=e.Deferred();return t.getService("Api").request(new c({target:u.MYADS_STORAGE+"/query/"+s,options:{done:function(e){var t=(new a).load(JSON.parse(e.query).query);i.getPubSub().publish(i.getPubSub().START_SEARCH,t),o.resolve()},fail:function(){t.getController("AlertsController").alert(new r({code:r.CODES.ERROR,msg:"The query with the given UUID cannot be found"})),i.get("index-page").execute().then(function(){o.resolve()})},type:"GET",xhrFields:{withCredentials:!1}}})),o.promise()}),this.set("user-action",function(t,n){var s,o,a="",l="",d=e.Deferred(),h=n.token,p=n.subView;function f(e,t,n){i.get("index-page").execute().then(function(){var t=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:"error unknown";i.getPubSub().publish(i.getPubSub().ALERT,new r({code:0,title:l,msg:" <b>"+t+"</b> <br/>"+a,modal:!0,type:"danger"})),d.reject()})}if("register"===p)l="Registration failed.",a="<p>Please try again, or contact <b> adshelp@cfa.harvard.edu for support </b></p>",s=u.VERIFY+"/"+h,o=function(e){i.getApiAccess({reconnect:!0}).done(function(){i.get("index-page").execute().then(function(){var t="<p>You have been successfully registered with the username</p> <p><b>"+e.email+"</b></p>";i.getPubSub().publish(i.getPubSub().ALERT,new r({code:0,title:"Welcome to ADS",msg:t,modal:!0,type:"success"})),d.resolve()})}).fail(function(){this.apply(f,arguments)})};else if("change-email"===p)l="Attempt to change email failed",a="Please try again, or contact adshelp@cfa.harvard.edu for support",s=u.VERIFY+"/"+h,o=function(e){i.getApiAccess({reconnect:!0}).done(function(){i.get("index-page").execute().then(function(){var t="Your new ADS email is <b>"+e.email+"</b>";i.getPubSub().publish(i.getPubSub().ALERT,new r({code:0,title:"Email has been changed.",msg:t,modal:!0,type:"success"})),d.resolve()})}).fail(function(){this.apply(f,arguments)})};else{if("reset-password"!==p)return d.reject("Unknown subView: "+p),d.promise();o=function(){i.getBeeHive().getObject("Session").setChangeToken(h),i.getPubSub().publish(i.getPubSub().NAVIGATE,"authentication-page",{subView:"reset-password-2"}),d.resolve()},l="Password reset failed",a="Reset password token was invalid.",s=u.RESET_PASSWORD+"/"+h}var g=new c({target:s,options:{type:"GET",context:i,done:o,fail:f}});return i.getBeeHive().getService("Api").request(g),d.promise()}),this.set("orcid-instructions",function(){var n=this,i=e.Deferred();return t.getObject("MasterPageManager").show("OrcidInstructionsPage").then(function(){n.route="#orcid-instructions",n.title="Orcid Instructions"}),i.promise()}),this.set("orcid-page",function(s,o){var a=e.Deferred(),c=t.getService("OrcidApi"),u=t.getService("PersistentStorage"),l=t.getObject("AppStorage"),h=t.getObject("User"),p=this;return!c.hasAccess()&&c.hasExchangeCode()?(u?u.set("orcidAuthenticating",!0):console.warn("no persistent storage service available"),void c.getAccessData(c.getExchangeCode()).done(function(e){c.saveAccessData(e),h.setOrcidMode(!0),i.getPubSub().publish(i.getPubSub().APP_EXIT,{url:window.location.pathname+(o&&n.isString(o)?o:window.location.hash)})}).fail(function(){h.setOrcidMode(!1),console.warn("Unsuccessful login to ORCID"),t.getController("AlertsController").alert(new r({code:r.CODES.ALERT,msg:"Error getting OAuth code to access ORCID",modal:!0,events:{click:"button[data-dismiss=modal]"}})).done(function(){i.get("index-page").execute()})})):(c.hasAccess()?(u.get("orcidAuthenticating")&&(u.remove("orcidAuthenticating"),c.getADSUserData().done(function(e){e.hasOwnProperty("authorizedUser")||'["UserPreferences",{"subView":"orcid"}]'===JSON.stringify(l.get("stashedNav"))||t.getController("AlertsController").alert(new r({code:r.CODES.ALERT,msg:d({adsLoggedIn:t.getObject("User").isLoggedIn()}),type:"success",title:"You are now logged in to ORCID",modal:!0}))}).fail(function(e){console.warn(e)})),t.getObject("MasterPageManager").show("OrcidPage",["OrcidBigWidget","SearchWidget"]).then(function(){p.route="/user/orcid",p.title="My Orcid",a.resolve()})):i.get("index-page").execute().then(function(){p.route="",a.resolve()}),a.promise())}),this.set("show-author-network",function(e,t){return y.apply(this,arguments)}),this.set("show-concept-cloud",function(e,t){return y.apply(this,arguments)}),this.set("show-paper-network",function(e,t){return y.apply(this,arguments)}),this.set("show-bubble-chart",function(e,t){return y.apply(this,arguments)}),this.set("show-metrics",function(e,t){return y.apply(this,arguments)}),this.set("visualization-closed",this.get("results-page"));var _=function(e,n){return t.getObject("MasterPageManager").show("SearchPage",e,n)},w=function(n,i){var r=e.Deferred();return t.getObject("MasterPageManager").show("DetailsPage",n).then(function(){return t.getWidget("DetailsPage").then(function(e){r.resolve(e)})}),r.promise()};this.set("verify-abstract",function(){var t,n;e.Deferred;t=new a({q:"identifier:"+this.queryUpdater.quoteIfNecessary(bibcode),fl:"bibcode"}),n=new c({query:t,target:u.SEARCH,options:{done:function(e){subPage&&("Show"+subPage[0].toUpperCase()+subPage.slice(1),bibcode,subPage),e.response&&e.response.docs&&e.response.docs[0]?(bibcode=e.response.docs[0].bibcode,i.getPubSub().publish(i.getPubSub().DISPLAY_DOCUMENTS,new a({q:"bibcode:"+bibcode}))):e.response&&e.response.docs&&!e.response.docs.length&&console.error("the query  "+t.get("q")[0]+"  did not return any bibcodes")},fail:function(){console.log("Cannot identify page to load, bibcode: "+bibcode),i.getPubSub().publish(this.getPubSub().NAVIGATE,"index-page")}}}),this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,n)});var S=function(t){var n=e.Deferred(),r=i.getPubSub();if(19===t.length&&/^\d{4}[A-z].*\d[A-z]$/.test(t))return n.resolve(t).promise();var s=new c({target:u.SEARCH,query:new a({q:"identifier:"+t,fl:"bibcode",rows:1}),options:{done:function(e){e&&e.response&&e.response.numFound>0&&n.resolve(e.response.docs[0].bibcode),n.resolve("null")},fail:function(){n.resolve("null")}}});return r.publish(r.EXECUTE_REQUEST,s),n.promise()},E=function(e){var r=e.id,s=e.bibcode,o=e.page,c=e.prefix,u=e.subView,l=i.getPubSub();if(l.publish(l.DISPLAY_DOCUMENTS,new a({q:"identifier:".concat(s)})),o.setActive(r,u),c){var d=t.getObject("AppStorage").getDocumentTitle();d&&-1===d.indexOf(c)&&(this.title=c+" | "+d)}else{var h=n.find(i.getBeeHive().getObject("DocStashController").getDocs()||[],{bibcode:s});h&&(this.title=h.title&&h.title[0])}};this.set("ShowAbstract",function(t,n){var i=this,r=e.Deferred();return w([t].concat(g)).then(function(e){n.bibcode&&S(n.bibcode).then(function(s){E.call(i,{id:t,bibcode:s,page:e}),i.route=n.href,i.replace=!0,r.resolve()})}),r.promise()}),this.set("ShowCitations",function(t,n){var i=this,r=e.Deferred();return w([t].concat(g)).then(function(e){n.bibcode&&S(n.bibcode).then(function(s){E.call(i,{id:t,bibcode:s,page:e,prefix:"Citations"}),i.route=n.href,i.replace=!0,r.resolve()})}),r.promise()}),this.set("ShowReferences",function(t,n){var i=this,r=e.Deferred();return w([t].concat(g)).then(function(e){n.bibcode&&S(n.bibcode).then(function(s){E.call(i,{id:t,bibcode:s,page:e,prefix:"References"}),i.route=n.href,i.replace=!0,r.resolve()})}),r.promise()}),this.set("ShowCoreads",function(t,n){var i=this,r=e.Deferred();return w([t].concat(g)).then(function(e){n.bibcode&&S(n.bibcode).then(function(s){E.call(i,{id:t,bibcode:s,page:e,prefix:"Co-Reads"}),i.route=n.href,i.replace=!0,r.resolve()})}),r.promise()}),this.set("ShowSimilar",function(t,n){var i=this,r=e.Deferred();return w([t].concat(g)).then(function(e){n.bibcode&&S(n.bibcode).then(function(s){E.call(i,{id:t,bibcode:s,page:e,prefix:"Similar Papers"}),i.route=n.href,i.replace=!0,r.resolve()})}),r.promise()}),this.set("ShowToc",function(t,n){var i=this,r=e.Deferred();return w([t].concat(g)).then(function(e){n.bibcode&&S(n.bibcode).then(function(s){E.call(i,{id:t,bibcode:s,page:e,prefix:"Volume Content"}),i.route=n.href,i.replace=!0,r.resolve()})}),r.promise()}),this.set("ShowMetrics",function(t,n){var i=this,r=e.Deferred();return w([t].concat(g)).then(function(e){n.bibcode&&S(n.bibcode).then(function(s){E.call(i,{id:t,bibcode:s,page:e,prefix:"Metrics"}),i.route=n.href,i.replace=!0,r.resolve()})}),r.promise()}),this.set("ShowExportcitation",function(n,r){var s=this,o=e.Deferred(),c=r.subView||"default";return t.getObject("MasterPageManager").show("DetailsPage",[n].concat(g)).done(function(){t.getWidget("DetailsPage").done(function(e){r.bibcode&&S(r.bibcode).then(function(t){if(i.getPubSub().publish(i.getPubSub().DISPLAY_DOCUMENTS,new a({q:"identifier:"+t})),"null"===t)return e.setActive(null);e.widgets[n].ingestBroadcastedPayload(t),e.setActive(n,c),s.route=r.href,s.replace=!0,o.resolve()})})}),o.promise()}),this.set("ShowGraphics",function(t,n){var i=this,r=e.Deferred();return w([t].concat(g)).then(function(e){n.bibcode&&S(n.bibcode).then(function(s){E.call(i,{bibcode:s,page:e,id:t,prefix:"Graphics"}),i.route=n.href,i.replace=!0,r.resolve()})}),r.promise()}),this.set("show-author-affiliation-tool",function(n,i){var s=e.Deferred(),a=this,c=t.getObject("AppStorage").getCurrentQuery();return t.getObject("MasterPageManager").show("SearchPage",["AuthorAffiliationTool"].concat(f.slice(1))).done(function(){l({code:r.CODES.MAKE_SPACE}),t.getWidget("AuthorAffiliationTool").done(function(e){if(i&&i.onlySelected){var n=t.getObject("AppStorage").getSelectedPapers();e.renderWidgetForListOfBibcodes(n)}else e.renderWidgetForCurrentQuery({currentQuery:c});a.route="#search/"+o.clean(c).url(),s.resolve()})}),s.promise()});var A=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function e(n){var i,r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._getWidget("ReactPageManager");case 2:return i=e.sent,e.next=5,t._getWidget(n);case 5:return r=e.sent,i.widgets[n]=r.render(),i.view=i.createView({widgets:_defineProperty({},n,i.widgets[n])}),e.next=10,t.getObject("MasterPageManager").show("ReactPageManager",[n]);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();this.set("ShowFeedback",function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var i,r,s,o;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.subview,r=n.bibcode,e.next=3,A("ShowFeedback");case 3:s=e.sent,p.batch(function(){s.dispatch({type:"SET_FORM",payload:i}),s.dispatch({type:"SET_BIBCODE",payload:r})}),o=s.getState().main.form,h("feedback-".concat(o)),this.title="Feedback";case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}())}});return n.extend(f.prototype,h),f}),define("js/components/alerts",["backbone","js/mixins/hardened"],function(e,t){return{TYPE:{ERROR:"error",INFO:"info",WARNING:"warning",SUCCESS:"success",DANGER:"danger"},ACTION:{CALL_PUBSUB:2,TRIGGER_FEEDBACK:1}}}),define("js/components/alerts_mediator",["underscore","jquery","cache","js/components/generic_module","js/mixins/dependon","js/components/api_feedback","js/mixins/hardened","js/components/alerts"],function(e,t,n,i,r,s,o,a){var c=i.extend({initialize:function(t){e.extend(this,e.pick(t,["debug","widgetName"]))},activate:function(t,n){this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();i.subscribe(i.ALERT,e.bind(this.onAlert,this)),i.subscribe(i.NAVIGATE,e.bind(this.onNavigate,this)),this.getWidget().fail(function(){console.error("If you want to use AlertController, you also need to have a Widget capable of displaying the messages (default: AlertsWidget)"),i.publish(i.BIG_FIRE,"Alerts Widget not available")})},onNavigate:function(e){var t=this,n=this.getPubSub();"authentication-page"===e&&n.subscribeOnce(n.NAVIGATE,function(){var e=t.getWidget();e&&e.closeView&&e.closeView()})},onAlert:function(t,n){var i=this;return this.alert(t).done(function(t){if(e.isFunction(t))t();else if(e.isObject(t)&&t.action){switch(t.action){case a.ACTION.TRIGGER_FEEDBACK:i.getPubSub().publish(i.getPubSub().FEEDBACK,new s(t.arguments));break;case a.ACTION.CALL_PUBSUB:i.getPubSub().publish(t.signal,t.arguments);break;default:throw new Error("Unknown action type:"+t)}i._widget&&i._widget.closeView&&i._widget.closeView()}})},getWidget:function(){var e=t.Deferred(),n=this;return this._widget?e.resolve(this._widget):this.getApp()._getWidget(this.widgetName||"AlertsWidget").done(function(t){n._widget=t,e.resolve(t)}).fail(function(){e.reject()}),e.promise()},alert:function(e){var n=t.Deferred();return this.getWidget().done(function(t){t?t.alert(e).done(function(){n.resolve.apply(n,arguments)}):(console.warn('"AlertsWidget" has disappeared, we cant display messages to the user'),n.reject("AlertsWidget has disappeared"))}).fail(function(){n.reject("AlertsWidget not available")}),n.promise()},hardenedInterface:{debug:"state of the alerts",getHardenedInstance:"allow to create clone of the already hardened instance"}});return e.extend(c.prototype,r.BeeHive,r.App),e.extend(c.prototype,o),c}),define("js/components/api_request_queue",["underscore","js/components/api_request"],function(e,t){return t.extend({_queue:[],_lock:!1,_options:{},successAllCallback:null,initialize:function(t,n){e.extend(this,e.pick(t,["successAllCallback"]))},push:function(e){if(!(e instanceof t))throw Error("ApiRequestQueue works only with ApiRequest instances");this._queue.push(e),this.isLocked()||(this.lock(),this._processQueue())},_processQueue:function(){if(!this.isEmpty()){var e=function(){},t=this._queue.shift(),n=t.success?t.success:e,i=t.error?t.error:e,r=this;t.success=function(e){(r._callAllSuccessCallbacks||r.isEmpty())&&n(e),r.isEmpty()&&r.unlock(),r._processQueue()},t.error=function(e){i(e),r.isEmpty()||(console.error("Error encountered while processing queued commands. Remaining commands will not be processed."),r._queue=[]),r.unlock()},R.Api.request(t)}},lock:function(){this._lock=!0},unlock:function(){this._lock=!1},isLocked:function(){return this._lock},isEmpty:function(){return 0===this._queue.length}})}),define("js/components/solr_response",["js/components/json_response","js/components/solr_params","backbone","underscore","jquery"],function(e,t,n,i,r){return e.extend({initialize:function(){if(!this.has("responseHeader.params"))throw new Error("SOLR data error - missing: responseHeader.params");if(i.isString(this._url)){var e=new t;this._url=new t(e.parse(this._url)).url()}else{var n=this.get("responseHeader.params");this._url=new t(n).url()}},url:function(e,t){return this._url}})}),define("js/components/api_response",["underscore","backbone","js/components/solr_response","js/components/facade"],function(e,t,n,i){var r={set:"set (replace existing)",get:"get values",has:"has a key",toJSON:"values back as JSON object",clone:"make a copy",url:"url string of the params",isLocked:!0,lock:!0,unlock:!0,setApiQuery:"sets the ApiQuery",getApiQuery:"gets the query"},s=function(e,t){this.innerResponse=new i(r,e instanceof n?e:new n(e,t))},o={};return e.each(e.keys(r),function(e,t,n){o[e]=function(){return this.innerResponse[e].apply(this.innerResponse,arguments)}}),e.extend(s.prototype,o,{clone:function(){var e=this.innerResponse.clone.apply(this.innerResponse,arguments);return new s(e)}}),s}),define("js/components/app_storage",["backbone","underscore","js/components/api_query","js/mixins/hardened","js/mixins/dependon"],function(e,t,n,i,r){var s=e.Model.extend({activate:function(e){this.setBeeHive(e),t.bindAll(this,"onPaperSelection","onBulkPaperSelection");var n=this.getPubSub();n.subscribe(n.PAPER_SELECTION,this.onPaperSelection),n.subscribe(n.BULK_PAPER_SELECTION,this.onBulkPaperSelection)},initialize:function(){this.on("change:selectedPapers",function(e){if(this._updateNumSelected(),this.hasPubSub())var t=this.getPubSub();t.publish(t.STORAGE_PAPER_UPDATE,this.getNumSelectedPapers())})},setCurrentQuery:function(e){if(e||(e=new n),!(e instanceof n))throw new Error("You must save ApiQuery instance");this.set("currentQuery",e),this.getBeeHive().hasService("PersistentStorage")&&this.getBeeHive().getService("PersistentStorage").set("currentQuery",e.toJSON())},setCurrentNumFound:function(e){this.set("numFound",e)},getCurrentQuery:function(){return this.get("currentQuery")},hasCurrentQuery:function(){return this.has("currentQuery")},hasSelectedPapers:function(){return!!t.keys(this.get("selectedPapers")).length},getSelectedPapers:function(){return t.keys(this.get("selectedPapers")||{})},clearSelectedPapers:function(){this.set("selectedPapers",{})},addSelectedPapers:function(e){var n=t.clone(this.get("selectedPapers")||{}),i=!1;t.isArray(e)?t.each(e,function(e){n[e]||(n[e]=!0,i=!0)}):n[e]||(n[e]=!0,i=!0),i&&this.set("selectedPapers",n)},isPaperSelected:function(e){if(t.isArray(e))throw new Error("Identifier must be a string or a number");return!!(this.get("selectedPapers")||{})[e]},removeSelectedPapers:function(e){var n=t.clone(this.get("selectedPapers")||{});t.isArray(e)?t.each(e,function(e){delete n[e]}):e?delete n[e]:n={},this.set("selectedPapers",n)},getNumSelectedPapers:function(){return this._numSelectedPapers||0},_updateNumSelected:function(){this._numSelectedPapers=t.keys(this.get("selectedPapers")||{}).length},onPaperSelection:function(e){this.isPaperSelected(e)?this.removeSelectedPapers(e):this.addSelectedPapers(e)},onBulkPaperSelection:function(e,t){"remove"!=t?this.addSelectedPapers(e):this.removeSelectedPapers(e)},setConfig:function(e){this.set("dynamicConfig",e)},getConfigCopy:function(){return JSON.parse(JSON.stringify(this.get("dynamicConfig")))},setDocumentTitle:function(e){this.set("documentTitle",e)},getDocumentTitle:function(){return this.get("documentTitle")},hardenedInterface:{getNumSelectedPapers:"getNumSelectedPapers",isPaperSelected:"isPaperSelected",hasSelectedPapers:"hasSelectedPapers",getSelectedPapers:"getSelectedPapers",clearSelectedPapers:"clearSelectedPapers",getCurrentQuery:"getCurrentQuery",hasCurrentQuery:"hasCurrentQuery",setDocumentTitle:"setDocumentTitle",getDocumentTitle:"getDocumentTitle",getConfigCopy:"get read-only copy of dynamic config",set:"set a value into app storage",get:"get a val from app storage"}});return t.extend(s.prototype,i,r.BeeHive),s}),define("js/components/services_container",["js/components/facade","js/components/generic_module","js/mixins/hardened","underscore"],function(e,t,n,i){var r=t.extend({initialize:function(e){this._services=i.has(e,"services")?i.clone(e.services):{}},activate:function(){var e=arguments;i.each(i.values(this._services),function(t){i.isObject(t)&&"activate"in t&&t.activate.apply(t,e)})},destroy:function(){for(var e in this._services)this.remove(e)},add:function(e,t){if(this._services.hasOwnProperty(e))throw new Error("The service: "+e+" is already registered, remove it first!");if(!e||!t||!i.isString(e))throw new Error("The key must be a string and the service is an object");this._services[e]=t},remove:function(e,t){if(this._services.hasOwnProperty(e)){var n=this._services[e];return"destroy"in n&&n.destroy(),delete this._services[e],n}return null},has:function(e){return this._services.hasOwnProperty(e)},get:function(e){return this._services[e]},getAll:function(){return i.pairs(this._services)}});return i.extend(r.prototype,n,{getHardenedInstance:function(){var e,t={};for(var n in this._services)e=this._services[n],i.isObject(e)&&"getHardenedInstance"in e&&(t[n]=!0);var r=new this.constructor({services:this._getHardenedInstance(t,this._services)});return this._getHardenedInstance({get:!0,has:!0},r)}}),r}),define("js/components/beehive",["backbone","underscore","js/components/generic_module","js/mixins/dependon","js/mixins/hardened","js/components/services_container"],function(e,t,n,i,r,s){var o=[],a=n.extend({initialize:function(e){t.extend(this,t.pick(e,o)),this.Services=new s,this.Objects=new s,this.debug=!1,this.active=!0},activate:function(){this.Services.activate.apply(this.Services,arguments),this.Objects.activate(this),this.active=!0},destroy:function(){this.Services.destroy(arguments),this.Objects.destroy(arguments),this.active=!1},getService:function(e){return this.Services.get(e)},hasService:function(e){return this.Services.has(e)},addService:function(e,t){return this.Services.add(e,t)},removeService:function(e){return this.Services.remove(e)},getObject:function(e){return this.Objects.get(e)},hasObject:function(e){return this.Objects.has(e)},addObject:function(e,t){return this.Objects.add(e,t)},removeObject:function(e){return this.Objects.remove(e)},getDebug:function(){return this.debug},getAllServices:function(){return this.Services.getAll()},getAllObjects:function(){return this.Objects.getAll()},hardenedInterface:{Services:"services container",Objects:"objects container",debug:"state of the app",active:"active or not",getHardenedInstance:"allow to create clone of the already hardened instance"}});return t.extend(a.prototype,r,{getHardenedInstance:function(e){(e=t.clone(e||this.hardenedInterface)).getService=function(e){return n.Services.get(e)},e.hasService=function(e){return n.Services.has(e)},e.getObject=function(e){return n.Objects.get(e)},e.hasObject=function(e){return n.Objects.has(e)};var n=this._getHardenedInstance(e,this);return n}}),a}),define("js/components/application",["underscore","jquery","backbone","module","js/components/beehive","js/mixins/api_access"],function(e,t,n,i,r,s){var o="function"==typeof window.__setAppLoadingProgress?window.__setAppLoadingProgress:function(){},a=function(t){t||(t={}),this.aid=e.uniqueId("application"),this.debug=!0,e.extend(this,e.pick(t,["timeout","debug"])),this.initialize.apply(this,arguments)},c=function(){this.container={}};return e.extend(c.prototype,{has:function(e){return this.container.hasOwnProperty(e)},get:function(e){return this.container[e]},remove:function(e){delete this.container[e]},add:function(e,t){this.container[e]=t}}),e.extend(a.prototype,{initialize:function(e,t){this.__beehive=new r,this.__modules=new c,this.__controllers=new c,this.__widgets=new c,this.__plugins=new c,this.__barbarianRegistry={},this.__barbarianInstances={}},shim:function(){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))},loadModules:function(n,i){var r,s=[],o=this,a=n.core;a&&e.each(["controllers","modules","services","objects"],function(e){a[e]&&(r=o._loadModules(e,a[e]))&&s.push(r)});var c=n.plugins,u=n.widgets;i&&i.eagerLoad?(c&&(r=o._loadModules("plugins",c))&&s.push(r),u&&(r=o._loadModules("widgets",u))&&s.push(r)):(c&&e.each(c,function(e,t){var n={};n[t]=e,o.__plugins.add(t,o._loadModules("plugins",n,!1,!0))}),u&&e.each(u,function(e,t){var n={};n[t]=e,o.__widgets.add(t,o._loadModules("widgets",n,!1,!0))})),1===s.length&&s.push(r);var l=0;s.map(function(e){return e.then(function(){o.logModuleLoaded(l+=1,s.length)})});var d=t.Deferred();return t.when.apply(t,s).then(function(){e.each(arguments,function(t,n){e.isArray(t)&&(o.debug&&console.log("application: registering "+t[0]),o._registerLoadedModules.apply(o,t))})}).done(function(){d.resolve()}).fail(function(){console.error("Generic error - we were not successul in loading all modules for config",n),arguments.length&&console.error(arguments),d.reject.apply(d,arguments)}),d.promise()},getBeeHive:function(){return this.__beehive},_registerLoadedModules:function(t,n){var i,r,s,o,a,c,u=this.getBeeHive(),l=this;if(c=function(e,t){if(t)return l.debug&&console.log("Creating instance of: "+e),t.prototype?new t:t&&t.hasOwnProperty(e)?t[e]:t;console.warn("Object "+e+" is empty, cannot instantiate it!")},"controllers"===t)s=e.bind(this.hasController,this),a=e.bind(function(e){this.__controllers.remove(e)},this),o=e.bind(function(e,t){this.__controllers.add(e,t)},this);else if("services"===t)s=e.bind(u.hasService,u),a=e.bind(u.removeService,u),o=e.bind(u.addService,u);else if("objects"===t)s=e.bind(u.hasObject,u),a=e.bind(u.removeObject,u),o=e.bind(u.addObject,u);else if("modules"===t)c=function(e,t){return t},s=e.bind(this.hasModule,this),a=e.bind(function(e){this.__modules.remove(e)},this),o=e.bind(function(e,t){this.__modules.add(e,t)},this);else if("widgets"===t)s=e.bind(this.hasWidget,this),a=e.bind(function(e){this.__widgets.remove(e)},this),o=e.bind(function(e,t){this.__widgets.add(e,t)},this),c=function(e,t){return t};else{if("plugins"!==t)throw new Error("Unknown section: "+t);s=e.bind(this.hasPlugin,this),a=e.bind(function(e){this.__plugins.remove(e)},this),o=e.bind(function(e,t){this.__plugins.add(e,t)},this),c=function(e,t){return t}}e.each(e.pairs(n),function(e){i=e[0],r=e[1],s(i)&&a(i);var t=c(i,r);t?o(i,t):console.warn("Removing "+i+"(because it is null!)")})},_checkPrescription:function(t){e.each(e.pairs(t),function(t,n,i){var r=t[0],s=t[1];if(!e.isString(r)||!e.isString(s))throw new Error("You are kidding me, the key/implementation must be string values")})},_loadModules:function(n,i,r,s){var o=this;this._checkPrescription(i),this.debug&&console.log("application: loading "+n,i);var a={},c=e.keys(i),u=e.values(i),l=t.Deferred(),d=function(){o.debug&&console.timeEnd("startLoading"+n);var t=arguments;e.each(c,function(e,n,i){a[e]=t[n]});try{l.resolve(n,a)}catch(e){var i=o.getService("PubSub").getHardenedInstance();i.publish(i.NAVIGATE,"404",{message:"Page Not Found or Internal Error\n              <p>Error: <code>".concat(e.message,"</code></p>\n            ")})}o.debug&&console.log("Loaded: type="+n+" state="+l.state(),a)},h=function(e){var t=e.requireModules&&e.requireModules[0];o.debug&&console.warn("Error loading impl="+t,e.requireMap),r?o.debug&&console.warn("Ignoring error"):l.reject(e)},p=function(){return o.debug&&console.time("startLoading"+n),require(u,d,h),o._setTimeout(l).promise()};return p.lazyLoad=s,s?p:p()},_setTimeout:function(e){return setTimeout(function(){"resolved"!==e.state()&&e.reject("Timeout, application is loading too long")},this.timeout||6e4),e},logModuleLoaded:function(e,t){o(function(e){return e+50/t},"Loading Modules ".concat(e," of ").concat(t))},destroy:function(){this.getBeeHive().destroy()},activate:function(t){var n=this.getBeeHive(),i=this;i.debug&&console.log("application: beehive.activate()"),n.activate(n),e.each(this.getAllControllers(),function(e){i.debug&&console.log("application: controllers: "+e[0]+".activate(beehive, app)");var t=e[1];"activate"in t&&t.activate(n,i)}),e.each(this.getAllModules(),function(e){try{i.debug&&console.log("application: modules: "+e[0]+".activate(beehive)");var t=e[1];"activate"in t&&t.activate(n)}catch(t){console.error("Error activating:"+e[0]),console.error(t)}}),this.__activated=!0},isActivated:function(){return this.__activated||!1},hasService:function(e){return this.getBeeHive().hasService(e)},getService:function(e){return this.getBeeHive().getService(e)},hasObject:function(e){return this.getBeeHive().hasObject(e)},getObject:function(e){return this.getBeeHive().getObject(e)},hasController:function(e){return this.__controllers.has(e)},getController:function(e){return this.__controllers.get(e)},hasModule:function(e){return this.__modules.has(e)},getModule:function(e){return this.__modules.get(e)},hasWidget:function(e){return this.__widgets.has(e)},getWidgetRefCount:function(e,t){var n=this.__barbarianInstances[(t||"widget:")+e];return n?n.counter:-1},incrRefCount:function(e,t){var n=e+":"+t;if(!this.__barbarianInstances[n])throw Error("Invalid operation"+n+" is not initialized");this.__barbarianInstances[n].counter++},getWidget:function(n){var i=t.Deferred(),r=this;if(arguments.length>1){var s={},o=[];e.each(arguments,function(t){var n=t;o.push(r._getWidget(t).fail(function(){throw console.error("Error loading: "+t),e.each(s,function(e,t){r.returnWidget(t),delete s[t]}),er}).done(function(e){s[n]=e}))}),t.when.apply(t,o).done(function(){i.resolve(s)})}else n&&this._getWidget(n).done(function(e){i.resolve(e)});return setTimeout(function(){i.done(function(t){e.isArray(n)?e.each(n,function(e){r.returnWidget(e)}):r.returnWidget(n)})},1),i.promise()},_getWidget:function(e){return this._getThing("widget",e)},_getThing:function(e,n){var i=t.Deferred(),r=this;return this._lazyLoadIfNecessary(e,n).done(function(){var t=r._getOrCreateBarbarian(e,n);r.incrRefCount(e,n),i.resolve(t)}),i.promise()},returnWidget:function(e){var t=this.__barbarianInstances["widget:"+e];if(!t||!t.parent.dontKillMe)return t?(t.counter--,this._killBarbarian("widget:"+e),t.counter):-1},hasPlugin:function(e){return this.__plugins.has(e)},getPlugin:function(n){var i=t.Deferred(),r=this,s={};return arguments.length>1?(s={},e.each(arguments,function(t){if(t)try{s[t]=r._getPlugin(t)}catch(n){throw console.error("Error loading: "+t),e.each(s,function(e,t){r.returnPlugin(t),delete s[t]}),n}})):n&&(s=this._getPlugin(n)),setTimeout(function(){i.done(function(t){e.isArray(n)?e.each(n,function(e){r.returnPlugin(e)}):r.returnPlugin(n)})},1),i.resolve(s),i.promise()},getPluginRefCount:function(e){return this.getWidgetRefCount(e,"plugin:")},_getPlugin:function(e){return this._getThing("plugin",e)},returnPlugin:function(e){var t=this.__barbarianInstances["plugin:"+e];return t?(t.counter--,this._killBarbarian("plugin:"+e),t.counter):-1},getPluginOrWidgetName:function(t){if(!e.isString(t))throw Error("The psk argument must be a string");if(this.__barbarianRegistry[t])return this.__barbarianRegistry[t]},getPluginOrWidgetByPubSubKey:function(e){var t=this.getPluginOrWidgetName(e);if(void 0!==t){if(this._isBarbarianAlive(t))return this._getBarbarian(t);throw new Error("Eeeek, thisis unexpectEED bEhAvjor! Cant find barbarian with ID: "+e)}},getPskOfPluginOrWidget:function(e){e.split(":");if(this._isBarbarianAlive(e)){var t=this._getBarbarian(e);if(t.getPubSub&&t.getPubSub().getCurrentPubSubKey)return t.getPubSub().getCurrentPubSubKey().getId()}},_getOrCreateBarbarian:function(t,n){var i=t+":"+n;if("plugin"===t&&!this.hasPlugin(n)||"widget"===t&&!this.hasWidget(n))throw new Error("We cannot give you "+i+" (cause there is no constructor for it)");if(this._isBarbarianAlive(i))return this._getBarbarian(i);var r,s=new("plugin"===t?this.__plugins.get(n):this.__widgets.get(n)),o=this.getBeeHive().getHardenedInstance(),a=this.getService("PubSub");e.keys(a._issuedKeys);"activate"in s&&(this.debug&&console.log("application: "+i+".activate(beehive)"),r=s.activate(o));var c=e.without(e.keys(a._issuedKeys),e.keys(a._issuedKeys));return this._registerBarbarian(i,s,r,o,c),s},_lazyLoadIfNecessary:function(e,n){var i,r=t.Deferred(),s=this;if("plugin"===e)i=s.__plugins;else{if("widget"!==e)throw new Error(e+" cannot be lazy loaded, sorry");i=s.__widgets}var o=i.get(n);return void 0===o||null===o?r.reject(n+" does not exist"):o&&o.lazyLoad?o().done(function(e,t){s._registerLoadedModules(e,t),r.resolve()}):r.resolve(),r.promise()},_isBarbarianAlive:function(e){return!!this.__barbarianInstances[e]},_getBarbarian:function(e){return this.__barbarianInstances[e].parent},_registerBarbarian:function(t,n,i,r,s){this._killBarbarian(t),"getBeeHive"in n?this.__barbarianRegistry[n.getBeeHive().getService("PubSub").getCurrentPubSubKey().getId()]=t:this.__barbarianRegistry[r.getService("PubSub").getCurrentPubSubKey().getId()]=t;var o=[];i&&(o=this._registerBarbarianChildren(t,i)),s&&e.each(s,function(e){this.__barbarianRegistry[e]&&delete s[e]},this),this.__barbarianInstances[t]={parent:n,children:o,beehive:r,counter:0,psk:r.getService("PubSub").getCurrentPubSubKey(),bastards:s}},_registerBarbarianChildren:function(t,n){var i=[];return e.each(n,function(e,n){var r=t+"-"+(e.name||n);if(this.debug&&console.log("adding child object to registry: "+r),this._isBarbarianAlive(r))throw new Error("Contract breach, there already exists instance with a name: "+r);if("getBeeHive"in e){var s=e.getBeeHive().getService("PubSub").getCurrentPubSubKey().getId();if(this.__barbarianRegistry[s])throw new Error("Contract breach, the child of "+t+"is using the same pub-sub-key");this.__barbarianRegistry[s]=r}i.unshift(r)},this),i},_killBarbarian:function(t,n){var i=this.__barbarianInstances[t];if(i&&!(i.counter>0&&!0!==n)){i.children&&e.each(i.children,function(e){this._killBarbarian(e,!0)},this),e.each(this.__barbarianRegistry,function(e,n){e===t&&delete this.__barbarianRegistry[n]},this);var r=this.getService("PubSub");i.psk&&r.unsubscribe(i.psk),i.bastards,i.parent.destroy(),delete this.__barbarianInstances[t],"setBeeHive"in i.parent&&i.parent.setBeeHive({fake:"one"}),i=null,this.debug&&console.log("Destroyed: "+t)}},getAllControllers:function(){return e.pairs(this.__controllers.container)},getAllModules:function(){return e.pairs(this.__modules.container)},getAllPlugins:function(n){n=n||"plugin:";var i=t.Deferred(),r=[];return e.each(this.__barbarianInstances,function(e,t){t.indexOf(n)>-1&&r.unshift(t.replace(n,""))}),(n.indexOf("plugin:")>-1?this.getPlugin:this.getWidget).apply(this,r).done(function(t){var n=[];r.length>1?n=e.pairs(t):1===r.length&&(n=[[r[0],t]]),i.resolve(n)}),i.promise()},getAllWidgets:function(){return this.getAllPlugins("widget:")},getAllServices:function(){return this.getBeeHive().getAllServices()},getAllObjects:function(){return this.getBeeHive().getAllObjects()},triggerMethodOnAll:function(e,t){this.triggerMethod(this.getAllControllers(),"controllers",e,t),this.triggerMethod(this.getAllModules(),"modules",e,t);var n=this;this.getAllPlugins().done(function(i){i.length&&n.triggerMethod(i,"plugins",e,t)}),this.getAllWidgets().done(function(i){i.length&&n.triggerMethod(i,"widgets",e,t)}),this.triggerMethod(this.getBeeHive().getAllServices(),"BeeHive:services",e,t),this.triggerMethod(this.getBeeHive().getAllObjects(),"BeeHive:objects",e,t)},triggerMethod:function(t,n,i,r){var s=this;return e.map(t,function(t){var o=t[1];i in o?(s.debug&&console.log("application.triggerMethod: "+n+": "+t[0]+"."+i+"()"),o[i].call(o,r)):e.isFunction(i)&&(s.debug&&console.log("application.triggerMethod: "+n+": "+t[0]+" customCallback()"),i.call(o,n+":"+t[0],r))})}}),a.extend=n.Model.extend,a.extend(s)}),define("js/components/csrf_manager",["backbone","js/components/generic_module","js/mixins/hardened","js/components/api_request","js/components/api_targets","js/mixins/dependon"],function(e,t,n,i,r,s){var o=t.extend({activate:function(e){this.setBeeHive(e);var t=this.getPubSub();_.bindAll(this,["resolvePromiseWithNewKey"]),t.subscribe(t.DELIVERING_RESPONSE,this.resolvePromiseWithNewKey)},getCSRF:function(){this.deferred=$.Deferred();var e=new i({target:r.CSRF}),t=this.getPubSub();return t.publish(t.EXECUTE_REQUEST,e),this.deferred.promise()},resolvePromiseWithNewKey:function(e){var t=e.toJSON().csrf;this.deferred.resolve(t)},hardenedInterface:{getCSRF:"getCSRF"}});return _.extend(o.prototype,n,s.BeeHive),o}),define("js/components/doc_stash_controller",["backbone","js/components/generic_module","js/mixins/hardened","js/mixins/dependon"],function(e,t,n,i){var r=t.extend({_docs:[],activate:function(e){this.setBeeHive(e.getHardenedInstance());var t=this.getBeeHive().getService("PubSub");t.subscribe(t.START_SEARCH,_.bind(this.emptyStash,this))},stashDocs:function(e){this._docs.push.apply(this._docs,e)},getDocs:function(){return _.cloneDeep(this._docs)},emptyStash:function(){this._docs=[]},hardenedInterface:{stashDocs:"stash docs",getDocs:"getDocs"}});return _.extend(r.prototype,n,i.BeeHive),r}),define("js/components/experiments",["underscore","jquery","js/components/generic_module","js/mixins/dependon","analytics","js/components/pubsub_events"],function(e,t,n,i,r,s){var o=n.extend({initialize:function(){this.isRunning=!1},activate:function(t,n){this.setApp(n),this.setBeeHive(t);var i=this.getPubSub();window.gtag||(window.gtag=function(){e.isArray(window.dataLayer)&&window.dataLayer.push(arguments)},window.gtag("event","optimize.callback",{callback:function(e,t){console.log("Experiment with ID: "+t+" is on variant: "+e)}})),i.subscribe(i.APP_BOOTSTRAPPED,e.bind(this.onAppStarted,this))},subscribe:function(e,t){var n=this.getPubSub();s[e]&&n.subscribe(s[e],t)},subscribeOnce:function(e,t){var n=this.getPubSub();s[e]&&n.subscribeOnce(s[e],t)},onAppStarted:function(){this.toggleOptimize()},toggleOptimize:function(){window.dataLayer?(this.isRunning?window.dataLayer.push({event:"optimize.deactivate"}):window.dataLayer.push({event:"optimize.activate"}),this.isRunning=!this.isRunning):console.warn("Optimize is not available, we are not running any experiment")}});return e.extend(o.prototype,i.BeeHive,i.App),o}),define("js/components/feedback_mediator",["underscore","jquery","cache","js/components/generic_module","js/components/api_request","js/components/api_response","js/components/api_query_updater","js/components/api_feedback","js/components/pubsub_key","js/mixins/dependon"],function(e,t,n,i,r,s,o,a,c,u){var l=i.extend({initialize:function(e){this._cache=this._getNewCache(e.cache),this.debug=e.debug||!1,this._handlers={},this.app=null},_getNewCache:function(t){return new n(e.extend({maximumSize:150,expiresAfterWrite:1800},e.isObject(t)?t:{}))},activate:function(t,n){if(!n)throw new Error("This controller absolutely needs access to the app");this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();i.subscribe(i.FEEDBACK,e.bind(this.receiveFeedback,this))},receiveFeedback:function(e,t){this.debug&&console.log("[EM]: received feedback:",e.toJSON(),t?t.getId():null);var n=this._getCacheKey(e,t),i=this._retrieveCacheEntry(n);i||(i=this.createNewCacheEntry(n),this._cache.put(n,i));var r=this.getFeedbackHandler(e,i);if(r){if(r.execute&&r.execute(e,i))return;if(r.call(this,e,i))return}this.handleFeedback(e,i)},removeFeedbackHandler:function(e){e.toString()in this._handlers&&delete this._handlers[e.toString()]},addFeedbackHandler:function(t,n){if(!t&&!e.isNumber(t))throw new Error("first argument must be code or code:string or string");if(!e.isFunction(n))throw new Error("second argument must be executable");this._handlers[t.toString()]=n},getFeedbackHandler:function(e,t){for(var n=[e.code+":"+t.id,t.id,e.code?e.code.toString():Date.now()],i=0;i<n.length;i++)if(n[i]in this._handlers)return this._handlers[n[i]]},_retrieveCacheEntry:function(e){return this._cache.getSync(e)},_getCacheKey:function(t,n){if(!t)throw new Error("ApiFeedback cannot be empty");if(t.getSenderKey())return t.getSenderKey();if(n){if(n instanceof c)return n.getId();if(e.isString(n))return n}var i=t.getApiRequest();if(i)return i.url();throw new Error("We cannot identify the origin (recipient) of this feedback")},createNewCacheEntry:function(e){return{waiting:0,max:0,errors:0,counter:0,created:Date.now(),id:e}},handleFeedback:function(e,t){var n=a.CODES;switch(t.counter+=1,e.code){case n.ALL_FINE:t.errors=0;break;case n.KEEP_WAITING:t.waiting+=t.started;break;case n.SERVER_ERROR:break;case n.ALERT:this.getApp().getController("AlertsController").onAlert(e,t)}}});return e.extend(l.prototype,u.BeeHive,u.App),l}),define("js/components/history_manager",["js/components/generic_module","js/mixins/dependon","js/mixins/hardened","js/components/pubsub_key"],function(e,t,n,i){var r=e.extend({initialize:function(){this._history=[]},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.NAVIGATE,_.bind(this.recordNav,this))},recordNav:function(){this._history.push([].slice.apply(arguments))},getCurrentNav:function(){return this._history[this._history.length-1]},getPreviousNav:function(){return this._history[this._history.length-2]},hardenedInterface:{getPreviousNav:"",getCurrentNav:""}});return _.extend(r.prototype,t.BeeHive,n),r}),define("js/components/hotkeys_controller",["js/components/generic_module","js/mixins/dependon","js/mixins/hardened","js/components/api_feedback","hotkeys"],function(e,t,n,i,r){var s=function(e){return(Array.isArray(e)?e:[e]).map(function(e){return"".concat("alt+shift","+").concat(e)}).join(", ")},o=[{hotkey:s("a"),event:"search",description:"Focus on search bar"},{hotkey:s("left"),event:"prev",description:"Previous results page"},{hotkey:s("right"),event:"next",description:"Next results page"},{hotkey:s("down"),event:"item-next",description:"Focus on next result entry"},{hotkey:s("up"),event:"item-prev",description:"Focus on previous result entry"},{hotkey:s("s"),event:"item-select",description:"Select currently focused result entry"},{hotkey:s("`"),event:"show-help",description:"Show help dialog"}],a=e.extend({initialize:function(){},createEvent:function(e){var t=this.getPubSub();return function(n){t.publish(t.CUSTOM_EVENT,e,n)}},activate:function(e){var t=this;this.setBeeHive(e),o.forEach(function(e){var n=e.hotkey,i=e.event;r(n,t.createEvent("hotkey/".concat(i)))});var n=this.getPubSub();n.subscribe(n.CUSTOM_EVENT,function(e){"hotkey/show-help"===e&&t.showHelpModal()})},getHotkeys:function(){return o},showHelpModal:function(){var e=this.getPubSub();e.publish(e.FEEDBACK,new i({code:i.CODES.ALERT,msg:this.getModalMessage(),title:"Hotkeys",modal:!0}))},getModalMessage:function(){return['<dl style="display: flex; flex-flow: row wrap;">'].concat(_toConsumableArray(o.map(function(e){var t=e.hotkey,n=e.description,i=t.split(", ").map(function(e){return"<code>".concat(e,"</code>")}).join(", ");return'\n            <dt style="flex-basis: 40%; text-align: right; padding-right: 10px">'.concat(i,'</dt>\n            <dd style="flex-basis: 60%">').concat(n,"</dd>\n          ")})),["</dl>"]).join("")},hardenedInterface:{}});return _.extend(a.prototype,t.BeeHive,n),a}),define("utils",["jquery","underscore","analytics","react","js/components/api_query","js/components/api_request"],function(e,t,n,i,r,s){return{qs:function(e,n,i){var r=e.replace(/[*+?^$.[\]{}()|\\\/]/g,"\\$&"),s="(^|[\\?&])"+r+"=[^&]*",o=(n||window.location.hash).match(new RegExp(s,"g"));if(!o)return null;for(var a=[],c=0;c<o.length;c+=1)a.push(o[c].replace(new RegExp("(^|[\\?&])"+r+"="),""));if(i){var u=a.join(i);return decodeURIComponent(u.replace(/\+/g," "))}return!1===i?t.map(a,function(e){return decodeURIComponent(e.replace(/\+/g," "))}):null},updateHash:function(e,n,i){var r=e.replace(/[*+?^$.[\]{}()|\\\/]/g,"\\$&"),s=t.isString(i)?i:window.location.hash,o=s.match(new RegExp("&?"+r+"=([^&]+)(&|$)"));if(o){var a=o[0].replace(o[1],n);return s.replace(o[0],a)}return i},difference:function e(n,i){return t.transform(n,function(n,r,s){t.isEqual(r,i[s])||(n[s]=t.isObject(r)&&t.isObject(i[s])?e(r,i[s]):r)})},getBrowserInfo:function(){var t=e.Deferred(),n=setTimeout(function(){t.reject()},3e3);return window.require(["bowser"],function(e){window.clearTimeout(n),t.resolve(e.parse(window.navigator.userAgent))},function(){t.reject()}),t.promise()},TimingEvent:function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Timers",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Generic Timer",i=arguments.length>2?arguments[2]:void 0;_classCallCheck(this,e),this.timingCategory=n,this.timingVar=t,this.timingLabel=i,this.time=null}return _createClass(e,[{key:"start",value:function(){this.time=+new Date,this._emitted=!1}},{key:"stop",value:function(){if(!this._emitted){var e=+new Date-this.time;n("send",{hitType:"timing",timingCategory:this.timingCategory,timingVar:this.timingVar,timingLabel:this.timingLabel,timingValue:e}),this._emitted=!0}}}]),e}(),waitForSelector:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=e.Deferred(),s=null;return function t(i){var o=e.apply(void 0,n);return o.length?r.resolve(o):i>=3100?r.reject("timeout"):(s=setTimeout(function(){window.requestAnimationFrame(function(){t(i+=1)})},100),null)}(0),r.promise.destroy=function(){window.clearTimeout(s),r.reject()},r.promise()},withPrerenderedContent:function(t){return t.handlePrerenderedContent=function(n,i){var r=t.tagName+"."+t.className;t.$el=e(r,i),e(">",t.$el).addClass("tex2jax_ignore"),t.el=t.$el.get(0),t.delegateEvents();var s=t._renderTemplate;t._renderTemplate=function(){},t.model.once("change",function(){t._renderTemplate=s})},t},escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},makeApiQuery:function(e){return new r(e)},makeApiRequest:function(e){return new s(e)},extractErrorMessageFromAjax:function(e,t){if(void 0!==e&&void 0!==e.responseJSON){if("string"==typeof e.responseJSON.error)return e.responseJSON.error;if("string"==typeof e.responseJSON.message)return e.responseJSON.message}return t}}}),define("js/components/library_controller",["backbone","js/components/generic_module","js/mixins/hardened","js/components/api_targets","js/components/api_request","js/components/api_feedback","js/components/api_query","js/mixins/dependon","utils"],function(e,t,n,i,r,s,o,a,c){var u=e.Model.extend({defaults:function(){return{num_documents:0,date_last_modified:void 0,permission:void 0,description:"",public:!1,num_users:1,owner:void 0,date_created:void 0,id:void 0,title:""}}}),l=e.Collection.extend({model:u}),d=t.extend({initialize:function(){this.collection=new l},activate:function(t){var n=this;this.setBeeHive(t.getHardenedInstance());var i=this.getBeeHive().getService("PubSub");i.subscribe(i.INVITING_REQUEST,_.bind(this.updateCurrentQuery,this)),i.subscribe(i.USER_ANNOUNCEMENT,_.bind(this.handleUserAnnouncement,this)),i.subscribe(i.CUSTOM_EVENT,function(e){"invalidate-library-metadata"===e&&(n._metadataLoaded=!1)}),_.each(["change","add","reset","remove"],function(t){this.listenTo(this.collection,t,function(n,r){"change"==t&&n instanceof e.Model?(i.publish(i.LIBRARY_CHANGE,this.collection.toJSON(),{ev:t,id:n.id}),delete this._libraryBibcodeCache[n.id]):i.publish(i.LIBRARY_CHANGE,this.collection.toJSON(),{ev:t})})},this)},handleUserAnnouncement:function(e){"user_signed_in"==e?this._fetchAllMetadata():"user_signed_out"==e&&this.collection.reset({})},updateCurrentQuery:function(e){this._currentQuery=e},composeRequest:function(e,t,n){var i,s=(n=n||{}).data||void 0,o=$.Deferred();return i=new r({target:e,options:{context:this,type:t,data:JSON.stringify(s),contentType:"application/json",done:function(){var e=[_.extend(arguments[0],n.extraArguments),[].slice(arguments,1)];o.resolve.apply(void 0,e)},fail:function(e){var t=this.getPubSub();t.publish(t.CUSTOM_EVENT,"libraries:request:fail",e),o.reject.apply(void 0,arguments)}}}),this.getBeeHive().getService("Api").request(i),o.promise()},_executeApiRequest:function(e){var t=new r({target:i.SEARCH,query:e}),n=$.Deferred(),s=this.getPubSub();return s.subscribeOnce(s.DELIVERING_RESPONSE,_.bind(function(e){n.resolve(e)}),this),s.publish(s.EXECUTE_REQUEST,t),n.promise()},_getBibcodes:function(e){var t=$.Deferred(),n=this;if("all"==e.bibcodes){var i=e.limit||2e3,r=0,s=100,o=[],a=this._currentQuery.clone();a.unlock(),a.set("rows",100),a.set("fl","bibcode"),function e(){a.set("start",r),this._executeApiRequest(a).done(function(a){var c=_.map(a.get("response.docs"),function(e){return e.bibcode});[].push.apply(o,c),(r+=s)<i?e.call(n):t.resolve(o)})}.call(this)}else if("selected"==e.bibcodes){var c=this.getBeeHive().getObject("AppStorage").getSelectedPapers();t.resolve(c)}else{if(!_.isArray(e.bibcodes))throw new Error("should we add all bibcodes or only selected ones?");t.resolve(e.bibcodes)}return t.promise()},_fetchAllMetadata:function(){var e=this,t=i.LIBRARIES;return this.composeRequest(t,"GET").done(function(t){e._metadataLoaded=!0,e.collection.reset(t.libraries)})},getLibraryMetadata:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&!this.collection.get(e))return this.fetchLibraryMetadata(e,t);var n=$.Deferred(),i=this;if(this._metadataLoaded){var r=e?i.collection.get(e).toJSON():i.collection.toJSON();n.resolve(r)}else this._fetchAllMetadata().done(function(t){setTimeout(function(){var t=e?i.collection.get(e).toJSON():i.collection.toJSON();n.resolve(t)},1)});return n.promise()},fetchLibraryMetadata:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this;if(!e)throw new Error("need to provide a library id");var r=$.Deferred();return this.composeRequest(i.LIBRARIES+"/"+e).done(function(e){r.resolve(e.metadata),t&&n.collection.add(e.metadata,{merge:!0})}).fail(function(t){r.reject(t),n.getPubSub().publish(n.getPubSub().NAVIGATE,"404",{xhr:t,message:"Cannot find library ID: <strong>".concat(e,"</strong>")})}),r.promise()},_libraryBibcodeCache:{},getLibraryBibcodes:function(e){var t=$.Deferred(),n=this,s=1e4;if(this._libraryBibcodeCache[e])return t.resolve(this._libraryBibcodeCache[e]),t.promise();var a=s,c=0,u=100,l=[],d=i.LIBRARIES+"/"+e;n=this;function h(i){a=i.solr.response.numFound>s?s:i.solr.response.numFound;var r=_.pluck(i.solr.response.docs,"bibcode");[].push.apply(l,r),(c+=u)<a?p():(n._libraryBibcodeCache[e]=l,t.resolve(l))}function p(){var e=new o;e.set("rows",100),e.set("fl","bibcode"),e.set("start",c);var t=new r({target:d,query:e,options:{context:this,contentType:"application/x-www-form-urlencoded",done:h,fail:this.handleError}});n.getBeeHive().getService("Api").request(t)}return p.call(this),t.promise()},createLibrary:function(e){var t=this,n=i.LIBRARIES;return this.composeRequest(n,"POST",{data:e}).done(function(){t._fetchAllMetadata()})},deleteLibrary:function(e,t){var n=this,r=i.DOCUMENTS+"/"+e;return this.composeRequest(r,"DELETE").done(function(){n.collection.remove(e),n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").NAVIGATE,"AllLibrariesWidget","libraries");var i="Library <b>"+t+"</b> was successfully deleted";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new s({code:0,msg:i,type:"success"}))}).fail(function(e){var i=JSON.parse(e.responseText).error,r="Library <b>"+t+"</b> could not be deleted : ("+i+")";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new s({code:0,msg:r,type:"danger"}))})},updateLibraryContents:function(e,t){var n=this,r={data:t,extraArguments:{numBibcodesRequested:t.bibcode.length}},o=i.DOCUMENTS+"/"+e;return this.composeRequest(o,"POST",r).done(function(){n.fetchLibraryMetadata(e)}).fail(function(t){var i=JSON.parse(t.responseText).error,r="Library <b>"+n.collection.get(e).title+"</b> could not be updated: ("+i+")";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new s({code:0,msg:r,type:"danger"}))})},performLibraryOperation:function(e,t){if(!t)throw new Error("must provide options object with action and set of secondary libraries (if necessary)");var n={},r=t.action&&t.action.toLowerCase(),s=t.libraries,o=t.name,a=/^(union|intersection|difference)$/.test(r),c=/^copy$/.test(r),u=/^empty$/.test(r);if(!_.isString(r)||!a&&!c&&!u)throw new Error(r+" is not one of the defined actions");if(!_.isString(e))throw new Error("must pass library ID as first parameter");if(a&&!_.isArray(s))throw new Error("libraries must be an array");if(c&&(!_.isArray(s)||1!==s.length))throw new Error("for copy action, libraries must have exactly 1 entry");s=_.unique(s),_.extend(n,{action:r}),a?_.extend(n,{libraries:s,name:o}):c&&_.extend(n,{libraries:s});var l=i.LIBRARIES+"/operations/"+e;return this.composeRequest(l,"POST",{data:n})},transferOwnership:function(e,t){if(!t||!_.isString(t))throw"new owner email address must be a string";if(!e||!_.isString(e))throw"library Id must be a string";var n=i.LIBRARY_TRANSFER+"/"+e,r={email:t};return this.composeRequest(n,"POST",{data:r})},updateLibraryMetadata:function(e,t){var n=this,r=i.DOCUMENTS+"/"+e;return this.composeRequest(r,"PUT",{data:t}).done(function(t){n.collection.get(e).set(t)}).fail(function(t){var i=JSON.parse(t.responseText).error,r="Library <b>"+n.collection.get(e).get("name")+"</b> could not be updated: ("+i+")";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new s({code:0,msg:r,type:"danger"}))})},addBibcodesToLib:function(e){var t=this;return this._getBibcodes(e).then(function(n){return t.updateLibraryContents(e.library,{bibcode:n,action:"add"}).fail(function(){var n="Library <b>"+t.collection.get(e.library).title+"</b> could not be updated";t.getBeeHive().getService("PubSub").publish(t.getBeeHive().getService("PubSub").ALERT,new s({code:0,msg:n,type:"danger"}))})})},createLibAndAddBibcodes:function(e){var t=this;return this._getBibcodes(e).then(function(n){if(!n)throw new Error("Solr returned no bibcodes, can't put them in the new library");return e.bibcode=n,t.createLibrary(e).fail(function(){var e="Library <b>"+name+"</b> could not be created";t.getBeeHive().getService("PubSub").publish(t.getBeeHive().getService("PubSub").ALERT,new s({code:0,msg:e,type:"danger"}))})})},importLibraries:function(e){var t,n=$.Deferred(),s=this;if("classic"===e)t=i.LIBRARY_IMPORT_CLASSIC_TO_BBB;else{if("twopointoh"!==e)return void console.error("didn't recognize library endpoint! should be one of 'classic' or 'twopointoh' ");t=i.LIBRARY_IMPORT_ADS2_TO_BBB}return this.getBeeHive().getService("Api").request(new r({target:t,options:{done:function(e){n.resolve.apply(void 0,[].slice.apply(arguments)),s._fetchAllMetadata()},fail:function(e){n.reject.apply(void 0,[].slice.apply(arguments))}}})),n.promise()},hardenedInterface:{getLibraryMetadata:"returns json list of libraries, optional lib id as param",createLibrary:"createLibrary",createLibAndAddBibcodes:"createLibAndAddBibcodes",addBibcodesToLib:"addBibcodesToLib",deleteLibrary:"deleteLibrary",updateLibraryContents:"updateLibraryContents",updateLibraryMetadata:"updateLibraryMetadata",importLibraries:"importLibraries",transferOwnership:"transferOwnership",getLibraryBibcodes:"getLibraryBibcodes",performLibraryOperation:"performLibraryOperation"}});return _.extend(d.prototype,n,a.BeeHive),d}),define("js/components/paginator",["underscore"],function(e){var t=function(e){this.start=e.start||0,this.rows=e.rows||20,this.initialStart=e.start||0,this.startName=e.startName||"start",this.rowsName=e.rowsName||"rows",this.cycle=0,this.maxNum=-1};return e.extend(t.prototype,{run:function(e){return this.hasMore()?(e.set(this.startName,this.start),e.set(this.rowsName,this.rows),this.start+=this.rows,this.maxNum>0&&this.maxNum<this.start&&(this.start=this.maxNum),this.cycle+=1,e):e},reset:function(e){this.start=e||this.initialStart,this.maxNum=-1,this.cycle=0},getCycle:function(){return this.cycle},setMaxNum:function(e){this.maxNum=e},hasMore:function(){return-1==this.maxNum||this.maxNum>this.start},cleanQuery:function(e){return e.unset(this.startName),e.unset(this.rowsName),e}}),t}),define("js/components/persistent_storage",["underscore","js/components/generic_module","js/mixins/dependon","persist-js","module"],function(e,t,n,i,r){var s=r.config().namespace||"",o=t.extend({constructor:function(e){e=e||{},this._store=this.createStore(s+(e.name||""))},createStore:function(e){return this._createStore(e)},_createStore:function(t){var n=new i.Store(t,{about:"This is bumblebee persistent storage",defer:!0}),r=n.get("#keys");if(r)try{r=JSON.parse(r),e.isObject(r)||n.set("#keys","{}")}catch(e){n.set("#keys","{}")}else n.set("#keys","{}");return n},set:function(t,n){this._checkKey(t),e.isString(n)||(n=JSON.stringify(n)),this._store.set(t,n),this._setKey(t)},get:function(e){this._checkKey(e);var t=this._store.get(e);if(!t)return t;try{return JSON.parse(t)}catch(e){return t}},remove:function(e){this._checkKey(e),this._store.remove(e),this._delKey(e)},clear:function(){var e=this.get("#keys");for(var t in e)this._store.remove(t);this._store.set("#keys","{}")},keys:function(){return JSON.parse(this._store.get("#keys"))},_setKey:function(e){var t=this.keys()||{};t[e]=1,this._store.set("#keys",JSON.stringify(t))},_delKey:function(e){var t=this.keys()||{};delete t[e],this._store.set("#keys",JSON.stringify(t))},_checkKey:function(t){if(!e.isString(t))throw new Error("key must be string, received: "+t)}});return e.extend(o.prototype,n.BeeHive),o}),define("js/mixins/add_secondary_sort",[],function(){return{addSecondarySort:function(e){e.has("sort")||e.set("sort","date desc");var t=e.get("sort")[0].split(",")[0],n=t.indexOf(" asc")>-1?"bibcode asc":"bibcode desc";e.set("sort",t+", "+n)}}}),define("js/components/query_mediator",["underscore","jquery","cache","js/components/generic_module","js/mixins/dependon","js/mixins/add_secondary_sort","js/components/api_request","js/components/api_response","js/components/api_query_updater","js/components/api_feedback","js/components/json_response","js/components/api_targets","js/components/api_query","js/components/alerts","utils","analytics"],function(e,t,n,i,r,s,o,a,c,u,l,d,h,p,f,g){var m=i.extend({initialize:function(t){t=t||{},this._cache=null,this.debug=t.debug||!1,this.queryUpdater=new c("QueryMediator"),this.failedRequestsCache=this._getNewCache({expiresAfterWrite:5}),this.maxRetries=t.maxRetries||3,this.recoveryDelayInMs=e.isNumber(t.recoveryDelayInMs)?t.recoveryDelayInMs:700,this.__searchCycle={waiting:{},inprogress:{},done:{},failed:{}},this.shortDelayInMs=e.isNumber(t.shortDelayInMs)?t.shortDelayInMs:300,this.longDelayInMs=e.isNumber(t.longDelayInMs)?t.longDelayInMs:100,this.monitoringDelayInMs=e.isNumber(t.monitoringDelayInMs)?t.monitoringDelayInMs:200,this.mostRecentQuery=new h},activateCache:function(e){this._cache=this._getNewCache((e||{}).cache)},_getNewCache:function(t){return new n(e.extend({maximumSize:100,expiresAfterWrite:1800},e.isObject(t)?t:{}))},activate:function(t,n){this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();i.subscribe(i.START_SEARCH,e.bind(this.getQueryAndStartSearchCycle,this)),i.subscribe(i.DELIVERING_REQUEST,e.bind(this.receiveRequests,this)),i.subscribe(i.EXECUTE_REQUEST,e.bind(this.executeRequest,this)),i.subscribe(i.GET_QTREE,e.bind(this.getQTree,this))},getQTree:function(e,t){var n=new o({query:e,target:d.QTREE});this._executeRequest(n,t)},doQueryTranslation:function(e){var n=t.Deferred(),i=this.getPubSub(),r=new o({target:d.SERVICE_OBJECTS_QUERY,query:new h({query:e}),options:{type:"POST",contentType:"application/json"}});return i.subscribeOnce(i.DELIVERING_RESPONSE,function(e){n.resolve(e.toJSON())}),i.publish(i.EXECUTE_REQUEST,r),n.promise()},getQueryAndStartSearchCycle:function(e,t){var n=this,i=this.getPubSub();if(s.addSecondarySort(e),this.original_url&&e.get("q")&&-1!==e.get("q")[0].indexOf("simbid")){var r=e.clone(),a=e.get("q")[0];e.has("__original_query")&&(a=e.get("__original_query")[0]),r.set("q",a),this.original_url=this.queryUpdater.clean(r).url()}else this.original_url=this.queryUpdater.clean(e).url();if(this.original_query=e.get("q"),e.get("__bigquery")){e.set("bigquery","bibcode\n"+e.get("__bigquery").join("\n")),e.unset("__bigquery"),e.get("q")||e.set("q","*:*"),e.add("fq","{!bitset}");var c=new o({target:d.MYADS_STORAGE+"/query",query:e,options:{type:"POST",contentType:"application/json",done:function(i){var r=new h({q:e.get("q"),__qid:i.qid}),s=e.get("__bigquerySource");s&&r.set("__bigquerySource",s[0]),e.get("sort")&&r.set("sort",e.get("sort")),n.startSearchCycle(r,t)},fail:function(e,t,n){console.warn("bigquery failed:",[].slice.apply(arguments).join(",")),i.publish(i.FEEDBACK,new u({code:u.CODES.SEARCH_CYCLE_FAILED_TO_START,error:{jqXHR:e,textStatus:t,errorThrown:n}}))}}});this.getBeeHive().getService("Api").request(c)}else if(e.get("q")[0].indexOf("object:")>-1){var l=function(n){e.set({q:n.query}),this.startSearchCycle(e,t)}.bind(this);this.doQueryTranslation(e.get("q")[0]).done(l)}else this.startSearchCycle.apply(this,arguments)},startSearchCycle:function(t,n){if(this.resetFailures(),this.getBeeHive().getObject("AppStorage")&&this.getBeeHive().getObject("AppStorage").clearSelectedPapers(),t.has("__saveBigQuery")&&this.mostRecentQuery.has("__qid")&&!t.has("__qid")&&(this.mostRecentQuery.set("q",t.get("q")),t=this.mostRecentQuery),this.mostRecentQuery=t,this.debug&&console.log("[QM]: received query:",this.hasApp()&&this.getApp().getPluginOrWidgetName(n.getId())||n.getId(),t.url()),t.keys().length<=0)console.error("[QM] : received empty query (huh?!)");else{t.get("q")[0].indexOf("simbid")>-1&&(t.add("__original_url",this.original_url),t.add("__original_query",this.original_query));var i=this.getPubSub();this.__searchCycle.running&&this.__searchCycle.waiting&&e.keys(this.__searchCycle.waiting)&&(console.error("The previous search cycle did not finish, and there already comes the next!"),e.forEach(e.extend({},this.__searchCycle.waiting,this.__searchCycle.inprogress),function(e){e.request.__STALE=!0})),this.reset(),this.__searchCycle.initiator=n.getId(),this.__searchCycle.collectingRequests=!0,this.__searchCycle.query=t.clone();var r=t.clone();r.unset("fl"),r.lock(),i.publish(i.INVITING_REQUEST,r);var s=this,o=function(){s.__searchCycle.collectingRequests=!1,s.startExecutingQueries()&&s.monitorExecution()};this.shortDelayInMs?setTimeout(o,this.shortDelayInMs):o()}},startExecutingQueries:function(t){var n=this,i=this.__searchCycle;if(!i.running&&!e.isEmpty(i.waiting)&&this.hasBeeHive()){var r;i.running=!0;var s=this.getBeeHive().getService("Api"),o=this.getPubSub();if(o&&s){var a,c;if((a=this.getApp().getPskOfPluginOrWidget("widget:Results"))&&i.waiting[a]&&(r=i.waiting[a],delete i.waiting[a]),!r&&i.waiting[i.initiator]&&(r=i.waiting[i.initiator],delete i.waiting[i.initiator]),!r)this.debug&&console.warn("DynamicConfig does not tell us which request to execute first (grabbing random one)."),r=i.waiting[c=e.keys(i.waiting)[0]],delete i.waiting[c];var l=r.key.getId();return i.inprogress[l]=r,this._executeRequest(r.request,r.key).done(function(t){if(!r.request.__STALE){var s;i.done[l]=r,delete i.inprogress[l],t.response&&t.response.numFound&&(s=t.response.numFound),o.publish(o.FEEDBACK,new u({code:u.CODES.SEARCH_CYCLE_STARTED,query:i.query,request:r.request,numFound:s,cycle:i,response:t})),n.displayTugboatMessages();var a=function(){e.each(e.keys(i.waiting),function(t){r=i.waiting[t],delete i.waiting[t],i.inprogress[t]=r;var s=t;n._executeRequest.call(n,r.request,r.key).done(function(){r.request.__STALE||(i.done[s]=i.inprogress[s],delete i.inprogress[s])}).fail(function(){r.request.__STALE||(i.failed[s]=i.inprogress[s],delete i.inprogress[s])}).always(function(){i.finished||e.isEmpty(i.inprogress)&&(o.publish(o.FEEDBACK,new u({code:u.CODES.SEARCH_CYCLE_FINISHED,cycle:i})),i.finished=!0)})})};n.longDelayInMs&&n.longDelayInMs>0?setTimeout(function(){a()},n.longDelayInMs):a()}}).fail(function(e,t,r){n.__searchCycle.error=!0,o.publish(o.FEEDBACK,new u({code:u.CODES.SEARCH_CYCLE_FAILED_TO_START,cycle:i,request:this.request,error:{jqXHR:e,textStatus:t,errorThrown:r}}))}),!0}}},monitorExecution:function(){if(this.hasBeeHive()){var t=this,n=this.getPubSub();if(n){if(this.__searchCycle.monitor+=1,this.__searchCycle.monitor>100)return console.warn("Stopping monitoring of queries, it is running too long"),void n.publish(n.FEEDBACK,new u({code:u.CODES.SEARCH_CYCLE_STOP_MONITORING,cycle:this.__searchCycle}));if(this.__searchCycle.inprogress&&e.isEmpty(this.__searchCycle.inprogress)){if(this.__searchCycle.finished)return;n.publish(n.FEEDBACK,new u({code:u.CODES.SEARCH_CYCLE_FINISHED,cycle:this.__searchCycle}))}else{var i=e.keys(this.__searchCycle.waiting).length,r=i+e.keys(this.__searchCycle.done).length+e.keys(this.__searchCycle.inprogress).length+e.keys(this.__searchCycle.failed).length;n.publish(n.FEEDBACK,new u({code:u.CODES.SEARCH_CYCLE_PROGRESS,msg:i/r,total:r,todo:i,cycle:this.__searchCycle})),setTimeout(function(){t.monitorExecution()},t.monitoringDelayInMs)}}}},receiveRequests:function(e,t){this.debug&&console.log("[QM]: received request:",this.hasApp()&&this.getApp().getPluginOrWidgetName(t.getId())||t.getId(),e.url()),this.__searchCycle.collectingRequests?this.__searchCycle.waiting[t.getId()]={request:e,key:t}:this.executeRequest(e,t)},executeRequest:function(e,t){if(!(e instanceof o))throw new Error("Sir, I belive you forgot to send me a valid ApiRequest!");if(!t)throw new Error("Request executed, but no widget id provided!");return this._executeRequest(e,t)},getFailCacheValue:function(e){var t=this.failedRequestsCache;return t&&t.getSync(e)||t._cache[e]&&t._cache[e].value},_executeRequest:function(e,n){if(e.get("query")&&e.get("query").get("__qid")){var i=e.get("query").get("__qid")[0];e.set("target",d.MYADS_STORAGE+"/execute_query/"+i)}var r=this.getPubSub(),s=this.getBeeHive().getService("Api"),o=this._getCacheKey(e);if((this.getFailCacheValue(o)||0)>=this.maxRetries)return this.onApiRequestFailure.apply({request:e,key:n,requestKey:o,qm:this},[{status:u.CODES.TOO_MANY_FAILURES},"Error","This request has reached maximum number of failures (wait before retrying)"]),t.Deferred().reject();if(this._cache){var a=this._cache.getSync(o),c=this;if(a&&a.promise)return a.done(function(){c._cache.put(o,arguments),c.onApiResponse.apply({request:e,key:n,requestKey:o,qm:c},arguments)}),a.fail(function(){c._cache.invalidate(o),c.onApiRequestFailure.apply({request:e,pubsub:r,key:n,requestKey:o,qm:c},arguments)}),a;if(a){var l=t.Deferred();return l.done(function(){c.onApiResponse.apply({request:e,key:n,requestKey:o,qm:c},a)}),l.resolve(),l.promise()}var h=s.request(e,{done:function(){c._cache.put(o,arguments),c.onApiResponse.apply(this,arguments)},fail:function(){c._cache.invalidate(o),c.onApiRequestFailure.apply(this,arguments)},context:{request:e,key:n,requestKey:o,qm:c}});return this._cache.put(o,h),h}return s.request(e,{done:this.onApiResponse,fail:this.onApiRequestFailure,context:{request:e,key:n,requestKey:o,qm:this}})},onApiResponse:function(e,t,n){var i=this.qm;if(!this.request.__STALE){var r=e.responseHeader&&e.responseHeader.params?new a(e):new l(e);r.setApiQuery(this.request.get("query")),i.debug&&console.log("[QM]: sending response:",i.hasApp()&&i.getApp().getPluginOrWidgetName(this.key.getId())||this.key.getId(),e);var s=i.getBeeHive().getService("PubSub");s&&s.publish(this.key,s.DELIVERING_RESPONSE+this.key.getId(),r),i.failedRequestsCache.getIfPresent(this.requestKey)&&i.failedRequestsCache.invalidate(this.requestKey)}},onApiRequestFailure:function(e,t,n){var i=this.qm;if(!this.request.__STALE){this.request.get("query");i.debug&&console.warn("[QM]: request failed",e,t,n);var r=i.getFailCacheValue(this.requestKey)||0;if(i.failedRequestsCache.put(this.requestKey,r+1),i.tryToRecover.apply(this,arguments))return console.warn("[QM]: attempting recovery"),!0;var s=new u({code:u.CODES.API_REQUEST_ERROR,msg:t,request:this.request,error:e,psk:this.key,errorThrown:n,text:t}),o=i.getBeeHive().getService("PubSub");return o&&o.publish(this.key,o.FEEDBACK,s),!1}},tryToRecover:function(e,t,n){var i=this.qm,r=this.key,s=this.request,o=this.requestKey,a=e.status;if(a)switch(a){case 408:case 409:case 500:case 502:case 503:case 504:return g("send","event","introspection","retrying",a),setTimeout(function(){if(i._cache){var e=i._cache.getSync(o);if(e&&e.promise)i._cache.invalidate(o);else if(e)return}i._executeRequest.call(i,s,r)},i.recoveryDelayInMs),!0;default:g("send","event","introspection","not-retrying",a,JSON.stringify(i.mostRecentQuery.toJSON()))}},_getCacheKey:function(e){var t=e.get("query"),n=this.queryUpdater.clean(t);e.set("query",n);var i=e.url();return e.set("query",t),i},reset:function(){this.__searchCycle={waiting:{},inprogress:{},done:{},failed:{}},this._cache&&this._cache.invalidateAll()},getAlerter:function(){return this.getApp().getController(this.alertsController||"AlertsController")},displayTugboatMessages:function(){var t={AUTHOR_ANDED_WARNING:"Author search terms combined with AND rather than OR",ENTRY_DATE_OFFSET_ERROR:"Can not combine a date and offset (negative value) for the Entry Date",ENTRY_DATE_NON_NUMERIC_ERROR:"Found a non numeric value in the Entry Date",UNRECOGNIZABLE_VALUE:"Invalid value for {} supplied"};if(this.original_url){var n,i=[].concat(f.qs("error_message",this.original_url,!1)||[],f.qs("warning_message",this.original_url,!1)||[]),r=f.qs("unprocessed_parameter",this.original_url,!1)||[];(i=e.reduce(i,function(n,i){if(i=i.toUpperCase(),e.has(t,i)){var s=t[i];if("UNRECOGNIZABLE_VALUE"===i&&r.length>0){var o=encodeURIComponent(r.pop());s=s.replace("{}",/^\w+$/.test(o)?o:"parameter")}n.push(s)}return n},[])).length>0&&(i.push('See our <a style="text-decoration: underline; font-weight: bold" href="/help/faq/#classic-search-translator">docs</a> for more information'),n=i.join("<br/>"),this.getAlerter().alert(new u({type:p.TYPE.INFO,msg:n})))}},resetFailures:function(){this.failedRequestsCache.invalidateAll()}});return e.extend(m.prototype,r.BeeHive,r.App),m}),define("js/components/query_validator",["underscore"],function(e){function t(e,t){var n=new RegExp(e,t);return function(e){return n.test(e)?null:e}}function n(e,t,n){this.field=e,this.value=t,this.token=n}return function(){var i=function(e){return null!==e};this.validate=function(r){var s={result:!0},o=[i,new t(/^""$/),new t(/^\(\)$/),new t(/^\(\^\)$/),new t(/^\(""\)$/),new t(/^\("\^"\)$/),new t(/^"\^"$/)];try{var a=r.get("q").join(" ").trim();if(!a.length)return s;var c=function(e){for(var t=new RegExp(/:/),i=e.split(/\s+\b/),r=[],s=0;s<i.length;s++){var o=i[s].split(t);2===o.length&&r.push(new n(o[0],o[1],i[s]))}return r}(a)}catch(e){return s}var u=function(t,n){var i=[];for(var r in n){var s=e.compose.apply(e,t)(n[r].value);s||i.push({token:n[r].token,result:s})}return i}(o,c);return s.result=e.every(e.pluck(u,"result")),u.length&&(s.tests=u),s}}}),define("js/components/recaptcha_manager",["backbone","js/components/generic_module","js/mixins/hardened","js/mixins/dependon"],function(e,t,n,i){var r=t.extend({initialize:function(){this.grecaptchaDeferred=window.__grecaptcha__,this.siteKeyDeferred=$.Deferred(),this.when=$.when(this.siteKeyDeferred,this.grecaptchaDeferred),this.execPromise=$.Deferred()},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();_.bindAll(this,["getRecaptchaKey"]),t.subscribe(t.APP_STARTED,this.getRecaptchaKey)},getRecaptchaKey:function(){var e=this.getBeeHive().getObject("AppStorage").getConfigCopy().recaptchaKey;this.siteKeyDeferred.resolve(e)},activateRecaptcha:function(e){"resolved"!==this.when.state()&&this.renderLoading(e);var t=this;clearTimeout(this.to),this.to=setTimeout(function(){"resolved"!==t.when.state()&&t.renderError(e)},5e3),this.when.done(_.partial(_.bind(this.renderRecaptcha,this),e)).fail(function(){t.renderError(e)})},getEl:function(e){return"function"==typeof e.$?e.$(".g-recaptcha"):e.el?$(".g-recaptcha",e.el):$(".g-recaptcha")},execute:function(){return this.execPromise=$.Deferred(),grecaptcha.execute(),this.execPromise.promise()},renderLoading:function(e){this.getEl(e).html('<p><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></p>'),this.enableSubmit(e,!1)},enableSubmit:function(e,t){var n,i="button[type=submit],input[type=submit]";(n="function"==typeof e.$?e.$(i):e.el?$(i,e.el):$(i)).length>0&&n.attr("disabled",!t)},renderError:function(e){this.getEl(e).html('<p class="text-danger">Error loading ReCAPTCHA, please try again</p>'),this.enableSubmit(e,!1)},googleMsg:function(){return'<small class="recaptcha-msg">This site is protected by reCAPTCHA and the Google\n      <a href="https://policies.google.com/privacy" target="_blank" rel="noreferrer">Privacy Policy</a> and\n      <a href="https://policies.google.com/terms" target="_blank" rel="noreferrer">Terms of Service</a> apply.</small>'},renderRecaptcha:function(e,t){var n=this,i=this.getEl(e),r=$('<div class="form-group"></div>').append(this.googleMsg());i.closest("form").append(r),grecaptcha.render(i[0],{sitekey:t,size:"invisible",badge:"inline",callback:function(t){e.model&&e.model.set("g-recaptcha-response",t),n.execPromise.resolve(t)}}),this.enableSubmit(e,!0)},hardenedInterface:{activateRecaptcha:"activateRecaptcha",execute:"execute"}});return _.extend(r.prototype,n,i.BeeHive),r}),define("js/components/second_order_controller",["js/components/generic_module","js/mixins/dependon","js/components/api_query","js/components/api_request","js/components/api_targets","analytics"],function(e,t,n,i,r,s){var o=e.extend({initialize:function(e){this.options=_.defaults({},e,{maxQueryRows:6e3,transformDebounce:1e3}),this.options.transformDebounce&&(this.transform=_.debounce(this.transform,this.options.transformDebounce))},activate:function(e){this.setBeeHive(e.getHardenedInstance());var t=this.getBeeHive().getService("PubSub");t.subscribe(t.CUSTOM_EVENT,_.bind(this.onCustomEvent,this))},onCustomEvent:function(e){e.startsWith("second-order-search/")&&this.transform.apply(this,[e.split("/")[1]].concat(_.rest(arguments)))},getSelectedIds:function(){var e=this.getBeeHive().getObject("AppStorage");return e&&e.getSelectedPapers&&e.getSelectedPapers()||[]},getCurrentQuery:function(){var e=this.getBeeHive().getObject("AppStorage");if(e&&e.getCurrentQuery&&e.getCurrentQuery()instanceof n)return e.getCurrentQuery()},getBigQueryResponse:function(e){var t=this.getPubSub(),s=$.Deferred(),o=new n({bigquery:"bibcode\n".concat(e.join("\n")),q:"*:*",fq:"{!bitset}",sort:"date desc"}),a=new i({target:r.MYADS_STORAGE+"/query",query:o,options:{type:"POST",done:function(e){var t=e.qid;return s.resolve(t)},fail:function(e){return s.reject(e)}}});return t.publish(t.EXECUTE_REQUEST,a),s.promise()},sendQuery:function(e){var t=this.getPubSub(),n=$.Deferred(),s=new i({target:r.SEARCH,query:e,options:{type:"GET",done:function(e){return n.resolve(e)},fail:function(e){return n.reject(e)}}});return t.publish(t.EXECUTE_REQUEST,s),n.promise()},validField:function(e){return _.contains(_.values(o.FIELDS),e)},submitAnalyticsEvent:function(e){s("send","event","interaction","second-order-operation",e)},transform:function(e,t){if(!e||!this.validField(e))throw"must pass in a valid field";var n=_.defaults({},t,{onlySelected:!1,libraryId:null,ids:[],query:null}),i=n.ids.length>0?n.ids:this.getSelectedIds();0!==i.length&&n.onlySelected||e===o.FIELDS.LIMIT||e===o.FIELDS.LIBRARY||e===o.FIELDS.EXCLUDE?e===o.FIELDS.LIBRARY?this.startSearch(e,n.libraryId):this.getQidAndStartSearch(e,i):this.transformCurrentQuery(e,n.query)},handleError:function(e){var t="Error occurred";e.responseJSON&&e.responseJSON.error&&(t=e.responseJSON.error);var n=this.getPubSub();throw n.publish(n.CUSTOM_EVENT,"second-order-search/error",{message:t}),t},transformCurrentQuery:function(e,t){var i=this.getPubSub(),r=t instanceof n?t:this.getCurrentQuery();if(r){var s=r.clone(),o=[];o.push(s.get("q")),_.forEach(Object.keys(s.toJSON()),function(e){e.startsWith("fq_")&&o.push(s.get(e))});var a=new n({q:"".concat(e,"(").concat(o.join(" AND "),")"),sort:"score desc"});i.publish(i.NAVIGATE,"search-page",{q:a})}},getQidAndStartSearch:function(e,t){var n=this;this.getBigQueryResponse(t).then(function(t){n.startSearch(e,t)}).fail(function(){return n.handleError.apply(n,arguments)})},startSearch:function(e,t){if(!t)throw"no id";var i;if(e===o.FIELDS.LIMIT){var r=this.getCurrentQuery()||new n;i=new n({q:"docs(".concat(t,")"),sort:r.get("sort")||"score desc"})}else if(e===o.FIELDS.LIBRARY)i=new n({q:"docs(library/".concat(t,")"),sort:"date desc"});else if(e===o.FIELDS.EXCLUDE){var s=this.getCurrentQuery()||new n;(i=s.clone()).set({q:"-docs(".concat(t,") ").concat(s.get("q"))})}else i=new n({q:"".concat(e,"(docs(").concat(t,"))"),sort:"score desc"});var a=this.getPubSub();a.publish(a.NAVIGATE,"search-page",{q:i}),this.submitAnalyticsEvent(e)}});return o.FIELDS={USEFUL:"useful",SIMILAR:"similar",TRENDING:"trending",REVIEWS:"reviews",LIMIT:"limit",LIBRARY:"library",EXCLUDE:"exclude"},_.extend(o.prototype,t.BeeHive),o}),define("js/components/user",["underscore","backbone","js/components/api_request","js/components/api_targets","js/components/generic_module","js/mixins/dependon","js/mixins/hardened","js/components/api_feedback","js/mixins/api_access"],function(e,t,n,i,r,s,o,a,c){var u,l,d;return u=t.Model.extend({defaults:function(){return{isOrcidModeOn:!1,perPage:void 0}}}),l=t.Model.extend({defaults:function(){return{user:void 0,link_server:void 0,minAuthorPerResult:4,externalLinkAction:"Open in new tab",defaultDatabase:[{name:"Physics",value:!1},{name:"Astronomy",value:!1},{name:"General",value:!1}],defaultExportFormat:"BibTeX",defaultHideSidebars:"Show",customFormats:[],recentQueries:[]}}}),d=r.extend({initialize:function(t){this.localStorageModel=new u,this.listenTo(this.localStorageModel,"change",this.broadcastUserDataChange),this.userModel=new l,this.listenTo(this.userModel,"change:user",this.broadcastUserChange),this.listenTo(this.userModel,"change",function(e){"user"!==e&&this.broadcastUserDataChange.apply(this,arguments)}),e.bindAll(this,"completeLogIn","completeLogOut"),this.base_url=this.test?"location.origin":location.origin,this.buildAdditionalParameters()},activate:function(e){this.setBeeHive(e);this.getPubSub().subscribe(this.getPubSub().APP_STARTING,function(){var t=e.getService("OrcidApi"),n=e.getObject("User");null!==t.authData&&t.checkAccessOrcidApiAccess().fail(function(e){var i=e&&e.status;i&&"401"===i&&(t.signOut(),n.setOrcidMode(0))})});var t=e.getService("PersistentStorage");if(t){var n=t.get("UserPreferences");n&&this.localStorageModel.set(n)}},_persistModel:function(){var e=this.getBeeHive().getService("PersistentStorage");e&&e.set("UserPreferences",this.localStorageModel.toJSON())},setLocalStorage:function(e){this.localStorageModel.set(e),this._persistModel()},getLocalStorage:function(e){return this.localStorageModel.toJSON()},addToRecentQueries:function(e){try{var t=this.userModel.get("recentQueries");t.length>=10&&t.pop(),t.unshift(e.clone().toJSON()),this.userModel.set("recentQueries",t),this.setUserData({recentQueries:t})}catch(e){t=[]}return t},getRecentQueries:function(){return this.userModel.get("recentQueries")||[]},setOrcidMode:function(e){this.localStorageModel.set("isOrcidModeOn",e),this._persistModel()},isOrcidModeOn:function(){return this.localStorageModel.get("isOrcidModeOn")},broadcastUserDataChange:function(e){this.getPubSub().publish(this.getPubSub().USER_ANNOUNCEMENT,this.USER_INFO_CHANGE,e.changed)},broadcastUserChange:function(){var e=this.userModel.get("user")?this.USER_SIGNED_IN:this.USER_SIGNED_OUT;this.getPubSub().publish(this.getPubSub().USER_ANNOUNCEMENT,e,this.userModel.get("user")),this.redirectIfNecessary()},buildAdditionalParameters:function(){var e={};e.CHANGE_EMAIL={verify_url:this.base_url+"/#user/account/verify/change-email"},this.additionalParameters=e},handleFailedPOST:function(e,t,n,i){var r;this.getPubSub();r=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:e.responseText?e.responseText:"error unknown",console.error("POST request failed for endpoint: ["+i+"]",r)},handleFailedGET:function(e,t,n,i){var r;this.getPubSub();r=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:e.responseText?e.responseText:"error unknown",console.error("GET request failed for endpoint: ["+i+"]",r)},fetchData:function(e){return this.composeRequest({target:e,method:"GET"})},postData:function(t,n){return this.additionalParameters[t]&&e.extend(n,this.additionalParameters[t]),this.composeRequest({target:t,method:"POST",data:n})},putData:function(t,n){return this.additionalParameters[t]&&e.extend(n,this.additionalParameters[t]),this.composeRequest({target:t,method:"PUT",data:n})},sendRequestWithNewCSRF:function(t){t=e.bind(t,this),this.getBeeHive().getObject("CSRFManager").getCSRF().done(t)},composeRequest:function(t){var r,s=t.target,o=t.method,a=(c=t.data||{}).csrf,c=e.omit(c,"csrf"),u=i[s],l=this,d=$.Deferred();return r={target:u,options:{context:this,type:o,data:e.isEmpty(c)?void 0:JSON.stringify(c),contentType:"application/json",done:function(){d.resolve.apply(d,arguments)},fail:function(){var e="GET"==o?l.handleFailedGET:l.handleFailedPOST,t=[].slice.apply(arguments);t.push(s),e.apply(l,t),d.reject.apply(d,arguments)}}},a?this.sendRequestWithNewCSRF(function(e){r.options.headers={"X-CSRFToken":e},this.getBeeHive().getService("Api").request(new n(r))}):this.getBeeHive().getService("Api").request(new n(r)),d.promise()},redirectIfNecessary:function(){var e=this.getPubSub();if("AuthenticationPage"===this.getBeeHive().getObject("MasterPageManager").currentChild&&this.isLoggedIn()){var t=this.getBeeHive().getService("HistoryManager").getPreviousNav();t||(t="index-page"),e.publish.apply(e,[e.NAVIGATE].concat(t))}else"SettingsPage"!==this.getBeeHive().getObject("MasterPageManager").currentChild||this.isLoggedIn()||e.publish(e.NAVIGATE,"authentication-page")},setUser:function(e){this.userModel.set("user",e),this.isLoggedIn()&&this.completeLogIn()},completeLogIn:function(){var e=this;this.fetchData("USER_DATA").done(function(t){e.userModel.set(t)})},completeLogOut:function(){this.userModel.clear()},deleteAccount:function(){var e=this;return this.postData("DELETE",{csrf:!0}).done(function(){e.getApiAccess({reconnect:!0}).done(function(){e.completeLogOut()})})},changeEmail:function(t){var n=this,i=t.email;return t=e.extend(t,{csrf:!0}),this.postData("CHANGE_EMAIL",t).done(function(){n.getPubSub().subscribeOnce(n.getPubSub().NAVIGATE,function(){setTimeout(function(){var e="<p>Please check <b>"+i+"</b> for further instructions</p><p>(If you don't see the email, please <b>check your spam folder</b>)</p>";n.getPubSub().publish(n.getPubSub().ALERT,new a({code:0,msg:e,type:"success",title:"Success",modal:!0}))},100)}),n.getPubSub().publish(n.getPubSub().NAVIGATE,"index-page")})},changePassword:function(t){return t=e.extend(t,{csrf:!0}),this.postData("CHANGE_PASSWORD",t)},getToken:function(){return this.fetchData("TOKEN")},generateToken:function(){return this.putData("TOKEN",{csrf:!0})},getUserData:function(){return this.userModel.toJSON()},setUserData:function(e){var t=this;return this.postData("USER_DATA",e).done(function(e){t.userModel.set(e)})},getUserName:function(){return this.userModel.get("user")},isLoggedIn:function(){return!!this.userModel.get("user")},setMyADSData:function(e){return this.postData("USER_DATA",e)},getOpenURLConfig:function(){return this.getSiteConfig("link_servers")},getSiteConfig:function(e){var t=$.Deferred();var r=new n({target:e?i.SITE_CONFIGURATION+"/"+e:i.SITE_CONFIGURATION,options:{type:"GET",done:function(e){t.resolve(e)},fail:function(e){t.reject(e)}}});return this.getBeeHive().getService("Api").request(r),t.promise()},hardenedInterface:{setUser:"set username into user",isLoggedIn:"whether the user is logged in",getUserName:"get the user's email before the @",setLocalStorage:"sets an object in to user's local storage",getLocalStorage:"gives you a json object for user's local storage",isOrcidModeOn:"figure out if user has Orcid mode activated",setOrcidMode:"set orcid ui on or off",getOpenURLConfig:"get list of openurl endpoints",getUserData:"myads data",setUserData:"POST user data to myads endpoint",getRecentQueries:"get the 10 most recent queries as array",addToRecentQueries:"add a query to the set of recent queries",generateToken:"PUT to token endpoint to make a new token",getToken:"GET from token endpoint",deleteAccount:"POST to delete account endpoint",changePassword:"POST to change password endpoint",changeEmail:"POST to change email endpoint",setMyADSData:"",USER_SIGNED_IN:"constant",USER_SIGNED_OUT:"constant",USER_INFO_CHANGE:"constant"}}),e.extend(d.prototype,o,s.BeeHive,s.App,c,{USER_SIGNED_IN:"user_signed_in",USER_SIGNED_OUT:"user_signed_out",USER_INFO_CHANGE:"user_info_change"}),d}),define("js/components/session",["backbone","js/components/api_request","js/components/api_targets","js/mixins/hardened","js/components/generic_module","js/mixins/dependon","js/components/api_query","js/components/user","js/components/api_feedback","js/mixins/api_access","utils"],function(e,t,n,i,r,s,o,a,c,u,l){var d=e.Model.extend({defaults:function(){return{resetPasswordToken:void 0}}}),h=r.extend({initialize:function(e){e=e||{};this.model=new d,this.test=!!e.test||void 0,_.bindAll(this,["loginSuccess","loginFail","registerSuccess","registerFail","resetPassword1Success","resetPassword1Fail","resetPassword2Success","resetPassword2Fail"])},activate:function(e){this.setBeeHive(e)},login:function(e){var i=$.Deferred(),r=this;return this.sendRequestWithNewCSRF(function(s){var a=new t({target:n.USER,query:new o({}),options:{type:"POST",data:JSON.stringify(e),contentType:"application/json",headers:{"X-CSRFToken":s},done:function(){i.resolve.apply(i,arguments),r.loginSuccess.apply(r,arguments)},fail:function(){i.reject.apply(i,arguments),r.loginFail.apply(r,arguments)},beforeSend:function(e,t){e.session=this}}});return this.getBeeHive().getService("Api").request(a)}),i.promise()},sendRequestWithNewCSRF:function(e){e=_.bind(e,this),this.getBeeHive().getObject("CSRFManager").getCSRF().done(e)},logout:function(){this.sendRequestWithNewCSRF(function(e){var i=new t({target:n.LOGOUT,query:new o({}),options:{context:this,type:"POST",headers:{"X-CSRFToken":e},contentType:"application/json",fail:this.logoutSuccess,done:this.logoutSuccess}});return this.getBeeHive().getService("Api").request(i)})},register:function(e){var i=this.test?"location.origin":location.origin;_.extend(e,{verify_url:i+"/#user/account/verify/register"}),this.sendRequestWithNewCSRF(function(i){var r=new t({target:n.REGISTER,query:new o({}),options:{type:"POST",data:JSON.stringify(e),contentType:"application/json",headers:{"X-CSRFToken":i},done:this.registerSuccess,fail:this.registerFail}});return this.getBeeHive().getService("Api").request(r)})},resetPassword1:function(e){var i=this.test?"location.origin":location.origin;_.extend(e,{reset_url:i+"/#user/account/verify/reset-password"});var r=e.email;e=_.omit(e,"email");this.sendRequestWithNewCSRF(function(i){var s=new t({target:n.RESET_PASSWORD+"/"+r,query:new o({}),options:{type:"POST",data:JSON.stringify(e),headers:{"X-CSRFToken":i},contentType:"application/json",done:this.resetPassword1Success,fail:this.resetPassword1Fail}});return this.getBeeHive().getService("Api").request(s)})},resetPassword2:function(e){this.sendRequestWithNewCSRF(function(i){var r=new t({target:n.RESET_PASSWORD+"/"+this.model.get("resetPasswordToken"),query:new o({}),options:{type:"PUT",data:JSON.stringify(e),contentType:"application/json",headers:{"X-CSRFToken":i},done:this.resetPassword2Success,fail:this.resetPassword2Fail}});return this.getBeeHive().getService("Api").request(r)})},setChangeToken:function(e){this.model.set("resetPasswordToken",e)},loginSuccess:function(e,t,n){this.getApiAccess({reconnect:!0}).done(function(){})},loginFail:function(e,t,n){var i=this.getPubSub(),r=l.extractErrorMessageFromAjax(e,"error unknown"),s="Login was unsuccessful (".concat(r,")");i.publish(i.ALERT,new c({code:0,msg:s,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"login_fail",s)},logoutSuccess:function(e,t,n){var i=this;this.getApiAccess({reconnect:!0}).done(function(){i.getBeeHive().getObject("User").completeLogOut()})},registerSuccess:function(e,t,n){var i=this.getPubSub();i.publish(i.USER_ANNOUNCEMENT,"register_success")},registerFail:function(e,t,n){var i=this.getPubSub(),r=l.extractErrorMessageFromAjax(e,"error unknown"),s="Registration was unsuccessful (".concat(r,")");i.publish(i.ALERT,new c({code:0,msg:s,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"register_fail",s)},resetPassword1Success:function(e,t,n){var i=this.getPubSub();i.publish(i.USER_ANNOUNCEMENT,"reset_password_1_success")},resetPassword1Fail:function(e,t,n){var i=this.getPubSub(),r=l.extractErrorMessageFromAjax(e,"error unknown"),s="password reset step 1 was unsuccessful (".concat(r,")");i.publish(i.ALERT,new c({code:0,msg:s,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"reset_password_1_fail",s)},resetPassword2Success:function(e,t,n){var i,r;i=this.getApiAccess({reconnect:!0}),r=this.getPubSub(),i.done(function(){r.publish(r.USER_ANNOUNCEMENT,"reset_password_2_success");r.publish(r.NAVIGATE,"index-page"),r.publish(r.ALERT,new c({code:0,msg:"Your password has been successfully reset!",type:"success",modal:!0}))}),i.fail(function(e){var t=l.extractErrorMessageFromAjax(e,"error unknown"),n="Your password was not successfully reset. Please try to follow the link from the email you received again.\n\n(".concat(t,")");r.publish(r.USER_ANNOUNCEMENT,"reset_password_2_fail",n),r.publish(r.ALERT,new c({code:0,msg:n,type:"danger",modal:!0}))})},resetPassword2Fail:function(e,t,n){var i=this.getPubSub(),r=l.extractErrorMessageFromAjax(e,"error unknown"),s="password reset step 2 was unsuccessful (".concat(r,")");i.publish(i.ALERT,new c({code:0,msg:s,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"reset_password_2_fail",s)},hardenedInterface:{login:"log the user in",logout:"log the user out",register:"registers a new user",resetPassword1:"sends an email to account",resetPassword2:"updates the password",setChangeToken:"the router stores the token to reset password here"}});return _.extend(h.prototype,s.BeeHive,i,u),h}),define("js/mixins/add_stable_index_to_collection",["underscore"],function(e){return{getPageStart:function(e,t,n){return n?Math.min(e*t,n):e*t},getPageEnd:function(e,t,n){var i=this.getPageStart(e,t)+t;return i>n?n:i},getPageVal:function(e,t){return Math.floor(e/t)},addPaginationToDocs:function(t,n){var i=e.isArray(n)?n[0]:parseInt(n);return e.each(t,function(e){e.resultsIndex=i,e.indexToShow=i+1,i+=1}),t}}}),define("js/mixins/discovery_bootstrap",["underscore","backbone","js/components/api_query","js/components/api_request","js/components/pubsub_events","hbs","js/components/api_targets"],function(e,t,n,i,r,s,o){var a=function(){var n=new RegExp("^#?(/?("+["classic-form","paper-form","index","search","execute-query","abs","user","orcid-instructions","public-libraries"].join("|")+").*/?)?$","i"),i=e.memoize(function(e){return!!n.test(e)&&e.replace(/^\/?#\/?/,"/")}),r=function(e){if(window.bbb)try{return bbb.getBeeHive().getService("Navigator").router.navigate(e.data.url,{trigger:!0,replace:!1}),!1}catch(e){console.error(e.message)}else console.error("cannot find application object")},s=!1;$(document).on("mousedown focus","a",function(e){if(t.history&&t.history.options&&t.history.options.pushState){var n=$(this);if(!n.data().dontHandle){var o=i(n.attr("href"));if(o){var a=n.attr("href");return n.attr("href",o),e.metaKey||e.ctrlKey?void(s=!0):s&&"focusin"===e.type?void(s=!1):(s=!1,n.one("click",{url:o},r),n.one("mouseup blur",function(){n.attr("href",a)}),!1)}}}})};return{configure:function(){var e=this.getObject("DynamicConfig");if(e){var t=this.getBeeHive(),n=t.getService("Api");e.root&&(n.url=e.root+"/"+n.url,this.root=e.root),void 0!==e.debug&&(t.debug=e.debug,this.getController("QueryMediator").debug=e.debug),e.apiRoot&&(n.url=e.apiRoot),e.version&&(n.clientVersion=e.version),n.modifyRequestOptions=function(e,t){-1==o._doesntNeedCredentials.indexOf(t.get("target"))&&(e.xhrFields={withCredentials:!0})};var i=t.getService("OrcidApi");e.orcidProxy&&(i.orcidProxyUri=location.origin+e.orcidProxy),this.bootstrapUrls=e.bootstrapUrls,e.useCache&&this.triggerMethodOnAll("activateCache")}},bootstrap:function(){var t=this.getBeeHive(),r=(this.getObject("DynamicConfig"),$.Deferred()),s=t.getService("PersistentStorage").get("appConfig");if(s&&s.expire_in&&new Date(s.expire_in)>new Date)return r.resolve(s).promise();var o=this.getBeeHive().getService("Api");if(this.bootstrapUrls){var a=this.bootstrapUrls.length,c={},u={done:function(t){a--,e.extend(c,t),a<=0&&r.resolve(c)},fail:function(){--a<=0&&r.resolve(c)},type:"GET",timeout:9999};e.each(this.bootstrapUrls,function(e){e.indexOf("http")>-1?(u.u=e,o.request(new i({query:new n,target:""}),u)):(delete u.u,o.request(new i({query:new n,target:e}),u))}),setTimeout(function(){"resolved"!==r.state()&&r.reject(new Error("Timed out while loading modules"))},1e4)}else setTimeout(function(){r.resolve({})},1);return r},reload:function(e){if(!(location.search.indexOf("debug")>-1))return location.search&&location.search.indexOf("bbbRedirect=1")>-1?this.redirect(e):void(location.search=location.search?location.search+"&bbbRedirect=1":"bbbRedirect=1");console.warn("Debug stop, normally would reload to: "+e)},redirect:function(e){this.router&&(location.pathname=this.router.root+e),location.href=location.protocol+"//"+location.hostname+":"+location.port+location.pathname.substring(0,location.pathname.lastIndexOf("/"))+"/"+e},start:function(n){var i=$.Deferred(),r=this,s=this.getBeeHive(),o=(s.getService("Api"),this.getObject("DynamicConfig"));this.getBeeHive().getObject("AppStorage").setConfig(o);var c=function(e){throw new Error("Ooops. Check you config! There is no "+e+" component @#!")},u=r.getBeeHive().Services.get("Navigator");u||c("services.Navigator");var l=r.getObject("MasterPageManager");return l||c("objects.MasterPageManager"),l.assemble(r).done(function(){var c=$("div#body-template-container");if(window.__PRERENDERED){var d=$("div#content-container");$(d.selector,l.view.el).html(d.html()),c.html(l.view.el)}else c.html(l.view.el);r.router=new n,r.router.activate(s.getHardenedInstance()),u.start(r),u.router=r.router;var h=location.search.indexOf("pushstate=false")>-1,p=e.defaults({pushState:!h&&void 0},o&&o.routerConf);t.history.start(p),a(),i.resolve()}),i.promise()}}}),define("js/mixins/expose_metadata",["underscore","js/components/api_targets","js/components/api_query","js/components/api_request"],function(e,t,n,i){return{__exposeMetadata:function(){var r=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];window.__EXPORT_RESULTS_AS_BIBTEX__=e.once(function(){return new Promise(function(o,a){var c=s.map(function(t){return e.isArray(t.identifier)?t.identifier[0]:t.identifier}),u=r.getPubSub(),l=new i({target:t.EXPORT+"bibtex",query:new n({bibcode:c}),options:{type:"POST",done:function(e){var t=e.export;o({identifiers:c,bibtexString:t})},fail:function(e){return a(e)}}});u.publish(u.EXECUTE_REQUEST,l)})})}}}),define("js/mixins/form_view_functions",["underscore"],function(e){return{checkValidationState:function(){this.model.isValidSafe()&&this.$("button[type=submit]").prev(".help-block").html("").addClass("no-show")},triggerSubmit:function(e){if(this.submit=!0,this.model.isValid(!0)){this.trigger("submit-form",this.model),this.$("button[type=submit]").prev(".help-block").addClass("no-show"),this.$("button[type=submit]").removeClass("btn-success").addClass("disabled").html('<i class="fa fa-lg fa-spinner fa-pulse" aria-hidden="true"></i> Working...')}else this.$("button[type=submit]").prev(".help-block").removeClass("no-show").html("Fields missing or incomplete");return!1},activateValidation:function(){Backbone.Validation.bind(this,{forceUpdate:!0}),this.stickit()},isValidSafe:function(){var t=!0;if(e.each(this.validation,function(e,n){e.required&&!this.get(n)&&(t=!1)},this),t&&this.isValid(!0))return!0},reset:function(){var t=e.keys(this.validation),n=Array.isArray(this.skipReset)?this.skipReset:[];e.each(this.attributes,function(i,r){e.contains(t,r)&&!e.contains(n,r)&&this.unset(r,{silent:!0})},this)}}}),define("js/mixins/formatter",[],function(){var e={formatNum:function(e){var t=[],n=(e+="").split("."),i="";return 2===n.length&&(e=n[0],i="."+n[1]),e.length<4?e+i:(e=e.split("").reverse(),_.each(e,function(n,i){t.unshift(n),(i+1)%3==0&&i!==e.length-1&&t.unshift(",")}),t.join("")+i)}};return e}),define("js/mixins/openurl_generator",["underscore"],function(e){var t=function(t){return e.isString(t)},n=function(t){return e.isArray(t)},i={url_ver:"Z39.88-2004",rft_val_fmt:"info:ofi/fmt:kev:mtx:",rfr_id:"info:sid/ADS",sid:"ADS"};return{getOpenUrl:function(e){var r=e||{},s=r.metadata,o=r.linkServer,a=void 0===o?"":o,c=s||{},u=c.page,l=c.doi,d=c.doctype,h=c.bibcode,p=c.author,f=c.issue,g=c.volume,m=c.pub,b=c.year,v=c.title,y=c.issn,_=c.isbn,w=t(h)&&(h.includes("PhDT")?"PhD":!!h.includes("MsT")&&"Masters"),S=t(d)&&t(h)&&h.includes("PhDT")?"dissertation":t(d)?d:"article",E=_objectSpread(_objectSpread({},i),{},{"rft.spage":!!n(u)&&u[0].split("-")[0],id:!!n(l)&&"doi:"+l[0],genre:S,rft_id:[!!n(l)&&"info:doi/"+l[0],!!t(h)&&"info:bibcode/"+h],"rft.degree":w,"rft.aulast":!!t(p)&&p.split(", ")[0],"rft.aufirst":!!t(p)&&p.split(", ")[1],"rft.issue":!!t(f)&&f,"rft.volume":!!t(g)&&g,"rft.jtitle":!!t(m)&&m,"rft.date":!!t(b)&&b,"rft.atitle":!!n(v)&&v[0],"rft.issn":!!n(y)&&y[0],"rft.isbn":!!n(_)&&_[0],"rft.genre":S,rft_val_fmt:i.rft_val_fmt+(t(d)?d:"article")}),A=_objectSpread(_objectSpread({},E),{},{spage:E["rft.spage"],volume:E["rft.volume"],title:E["rft.jtitle"],atitle:E["rft.atitle"],aulast:E["rft.aulast"],aufirst:E["rft.aufirst"],date:E["rft.date"],isbn:E["rft.isbn"],issn:E["rft.issn"]}),x=a.includes("?")?a+"&":a+"?",P=Object.keys(A).filter(function(e){return A[e]}).map(function(e){if(A[e])return n(A[e])?A[e].filter(function(e){return e}).map(function(t){return"".concat(e,"=").concat(t)}).join("&"):"".concat(e,"=").concat(A[e])});return encodeURI(x+P.join("&"))}}}),define("js/mixins/link_generator_mixin",["underscore","js/mixins/openurl_generator"],function(e,t){var n=t.getOpenUrl,i=["ADS_PDF","ADS_SCAN","INSTITUTION","PUB_PDF","PUB_HTML","EPRINT_PDF","EPRINT_HTML","AUTHOR_PDF","AUTHOR_HTML"],r={"4TU.ResearchData":{shortName:"4TU.ResearchData",description:"International data repository for science, engineering and design"},AcA:{shortName:"AcA",description:"Acta Astronomica Data Files"},ADS_PDF:{name:"ADS PDF",shortName:"ADS",description:"ADS PDF",type:"PDF"},ADS_SCAN:{name:"ADS Scanned Article",description:"ADS scanned article",shortName:"ADS",type:"SCAN"},AHED:{shortName:"AHED",description:"Astrobiology Habitable Environments Database"},ALMA:{shortName:"ALMA",description:"Atacama Large Millimeter/submillimeter Array"},ArcticData:{shortName:"ArcticData",description:"Arctic Data Center"},ARI:{shortName:"ARI",description:"Astronomisches Rechen-Institut"},ARTEMIS:{shortName:"ARTEMIS",description:"Acceleration Reconnection Turbulence & Electrodynamics of Moon Interaction with the Sun"},AstroGeo:{shortName:"AstroGeo",description:"USGS Astrogeology Science Center"},Astroverse:{shortName:"Astroverse",description:"CfA Dataverse"},ASU:{shortName:"ASU",description:"Arizona State University"},ATNF:{shortName:"ATNF",description:"Australia Telescope Online Archive"},Author:{shortName:"Author",description:"Author Hosted Dataset"},AUTHOR_HTML:{name:"Author Article",shortName:"Author",description:"Link to HTML page provided by author",type:"HTML"},AUTHOR_PDF:{name:"Author PDF",shortName:"Author",description:"Link to PDF page provided by author",type:"PDF"},BAS:{shortName:"BAS",description:"British Antarctic Survey"},BAVJ:{shortName:"BAVJ",description:"Data of the German Association for Variable Stars"},BICEP2:{shortName:"BICEP2",description:"BICEP/Keck Data"},CADC:{shortName:"CADC",description:"Canadian Astronomy Data Center"},Caltech:{shortName:"Caltech",description:"California Institute of Technology"},CDS:{shortName:"CDS",description:"Strasbourg Astronomical Data Center"},Chandra:{shortName:"Chandra",description:"Chandra X-Ray Observatory"},ClimateDataStore:{shortName:"ClimateDataStore",description:"Climate Data Store"},CMDN:{shortName:"CMDN",description:"China Meteorological Data Service Centre"},CXO:{shortName:"CXO",description:"Chandra Data Archive"},DARTS:{shortName:"DARTS",description:"Data ARchives and Transmission System"},Dataverse:{shortName:"Dataverse",description:"Dataverse Project"},Dryad:{shortName:"Dryad",description:"International Repository of Research Data"},EARTHCHEM:{shortName:"EARTHCHEM",description:"Open-access repository for geochemical datasets"},ECMWF:{shortName:"ECMWF",description:"European Centre for Medium-Range Weather Forecasts"},EMFISIS:{shortName:"EMFISIS",description:"An instrument suite on the Van Allen Probes"},EPRINT_HTML:{name:"arXiv Article",shortName:"arXiv",description:"Arxiv article",type:"HTML"},EPRINT_PDF:{name:"arXiv PDF",shortName:"arXiv",description:"ArXiv eprint",type:"PDF"},ERGSC:{shortName:"ERGSC",description:"ERG Science Center"},ESA:{shortName:"ESA",description:"ESAC Science Data Center"},ESGF:{shortName:"ESGF",description:"Earth System Grid Federation"},ESO:{shortName:"ESO",description:"European Southern Observatory"},ETHZ:{shortName:"ETHZ",description:"ETH Zurich Research Collection"},FDSN:{shortName:"FDSN",description:"International Federation of Digital Seismograph Networks"},Figshare:{shortName:"Figshare",description:"Online Open Access Repository"},figshare:{shortName:"figshare",description:"Online Open Access Repository"},GCPD:{shortName:"GCPD",description:"The General Catalogue of Photometric Data"},Gemini:{shortName:"Gemini",description:"Gemini Observatory Archive"},Github:{shortName:"Github",description:"Web-based version-control and collaboration platform for software developers."},GRAS:{shortName:"GRAS",description:"Lunar and Planet Exploration Program Ground Application System"},GTC:{shortName:"GTC",description:"Gran Telescopio CANARIAS Public Archive"},HEASARC:{shortName:"HEASARC",description:"NASA High Energy Astrophysics Science Archive Research Center"},Herschel:{shortName:"Herschel",description:"Herschel Science Center"},IBVS:{shortName:"IBVS",description:"Information Bulletin on Variable Stars"},INES:{shortName:"INES",description:"IUE Newly Extracted Spectra"},IRIS:{shortName:"IRIS",description:"Incorporated Research Institutions for Seismology"},IRSA:{shortName:"IRSA",description:"NASA/IPAC Infrared Science Archive"},ISO:{shortName:"ISO",description:"Infrared Space Observatory"},JOSS:{shortName:"JOSS",description:"Journal of Open Source Software"},JWST:{shortName:"JWST",description:"JWST Proposal Info"},KOA:{shortName:"KOA",description:"Keck Observatory Archive"},LAADS:{shortName:"LAADS",description:"Level-1 and Atmosphere Archive & Distribution System Distributed Active Archive Center"},label:{shortName:"label",description:"name"},LASP:{shortName:"LASP",description:"Laboratory for Atmospheric and Space Physics"},LPL:{shortName:"LPL",description:"Lunar and Planetary Laboratory"},MAST:{shortName:"MAST",description:"Mikulski Archive for Space Telescopes"},MetOffice:{shortName:"MetOffice",description:"Met Office"},MIT:{shortName:"MIT",description:"Massachusetts Institute of Technology"},NASA:{shortName:"NASA",description:"NASA Data Portal"},NCAR:{shortName:"NCAR",description:"National Center for Atmospheric Research"},NED:{shortName:"NED",description:"NASA/IPAC Extragalactic Database"},NExScI:{shortName:"NExScI",description:"NASA Exoplanet Archive"},NOAA:{shortName:"NOAA",description:"National Oceanic and Atmospheric Administration"},NOAO:{shortName:"NOAO",description:"National Optical Astronomy Observatory"},OSF:{shortName:"OSF",description:"Open Science Foundation"},PANGAEA:{shortName:"PANGAEA",description:"Digital Data Library and a Data Publisher for Earth System Science"},pangaea:{shortName:"pangaea",description:"Digital Data Library and a Data Publisher for Earth System Science"},PASA:{shortName:"PASA",description:"Publication of the Astronomical Society of Australia Datasets"},PDG:{shortName:"PDG",description:"Particle Data Group"},PDS:{shortName:"PDS",description:"The NASA Planetary Data System"},PDSS:{shortName:"PDSS",description:"The NASA Planetary Data System"},PIK:{shortName:"PIK",description:"Potsdam Institute for Climate Impact Research"},protocols:{shortName:"protocols",description:"Collaborative Platform and Preprint Server for Science Methods and Protocols"},PUB_HTML:{name:"Publisher Article",shortName:"Publisher",description:"Electronic on-line publisher article (HTML)",type:"HTML"},PUB_PDF:{name:"Publisher PDF",shortName:"Publisher",description:"Publisher PDF",type:"PDF"},ScienceBase:{shortName:"ScienceBase",description:"ScienceBase"},SIMBAD:{shortName:"SIMBAD",description:"SIMBAD Database at the CDS"},Spitzer:{shortName:"Spitzer",description:"Spitzer Space Telescope"},TDR:{shortName:"TDR",description:"Texas Data Respository"},THEMIS:{shortName:"THEMIS",description:"Time History of Events and Macroscopic Interactions During Substorms"},TNS:{shortName:"TNS",description:"Transient Name Server"},UNAVCO:{shortName:"UNAVCO",description:"UNAVCO"},Vizier:{shortName:"VizieR",description:"VizieR Catalog Service"},XMM:{shortName:"XMM",description:"XMM Newton Science Archive"},Zenodo:{shortName:"Zenodo",description:"Zenodo Archive"}},s=function(e){return encodeURIComponent(e)};return{LINK_TYPES:r,parseLinksData:function(t){var n=e.bind(this._parseLinksDataForModel,this),i=e.bind(this.parseResourcesData,this);return e.isArray(t)?e.map(t,function(e){try{var t=i(e);return n(e,t)}catch(t){return e}}):[]},parseResourcesData:function(t){var n=e.bind(this._processLinkData,this);if(e.isPlainObject(t)){if(e.isArray(t.property)&&e.isString(t.bibcode)){if(e.contains(t.property,"ESOURCE")&&!e.has(t,"esources"))throw new Error("if `property` property contains `ESOURCE`, then data must have `esources` field");if(e.contains(t.property,"DATA")&&!e.has(t,"data"))throw new Error("if `property` property contains `DATA`, then data must have `data` field");return n(e.extend({},t))}throw new Error("data must have `property` and `bibcode`")}throw new Error("data must be a plain object")},createUrlByType:function(t,n,i){var r=i;return e.isArray(r)&&(r=r[0]),e.isString(t)&&e.isString(n)&&e.isString(r)?"/link_gateway/"+t+"/"+n+":"+r:""},_createGatewayUrl:function(t,n){return e.isString(t)&&e.isString(n)?"/link_gateway/"+s(t)+"/"+n:""},_processLinkData:function(t){var s,o,a=this._createGatewayUrl,c=[],u=[],l=0,d=t.property;return e.forEach(t.esources,function(i){var s=i.split("_"),o=r[i],u=t.link_server;(t.doi||t.issn||t.isbn)&&u&&l<1&&(c.push({url:n({metadata:t,linkServer:u}),openUrl:!0,type:"INSTITUTION",shortName:"My Institution",name:"My Institution",description:"Find Article At My Institution",rawType:"INSTITUTION"}),l+=1),s.length>1?c.push({url:a(t.bibcode,i),open:e.contains(d,s[0]+"_OPENACCESS"),shortName:o&&o.shortName||i,name:o&&o.name||i,type:o&&o.type||"HTML",description:o&&o.description,rawType:i}):c.push({url:a(t.bibcode,i),open:!1,shortName:o&&o.shortName||i,name:o&&o.name||i,type:o&&o.type||"HTML",description:o&&o.description,rawType:i})}),!e.find(c,{name:r.EPRINT_PDF.name})&&e.isArray(t.links_data)&&e.forEach(t.links_data,function(e){var t=JSON.parse(e);if(/preprint/i.test(t.type)){var n=r.EPRINT_PDF;c.push({url:t.url,open:!0,shortName:n&&n.shortName||t.type,name:n&&n.name||t.type,type:n&&n.type||"HTML",description:n&&n.description,rawType:"EPRINT_PDF"})}}),e.forEach(t.data,function(e){var n=e.split(":"),i=r[n[0]];n.length>1?u.push({url:a(t.bibcode,n[0]),count:n[1],name:i?i.shortName:n[0],description:i?i.description:n[0]}):u.push({url:a(t.bibcode,e),count:"1",name:i?i.shortName:e,description:i?i.description:e})}),u=e.sortBy(u,"count").reverse(),{fullTextSources:(s=c,o=s.sort(function(e,t){var n=i.indexOf(e.rawType),r=i.indexOf(t.rawType);return-1!==n&&-1!==r?n-r:-1!==n?-1:-1!==r?1:0}),[].concat(_toConsumableArray(o.filter(function(e){return i.includes(e.rawType)})),_toConsumableArray(o.filter(function(e){return!i.includes(e.rawType)})))),dataProducts:u}},_parseLinksDataForModel:function(t,n){var i={list:[],data:[],text:[]},r=e.extend({},t,{links:i});if(e.isPlainObject(n)&&(i=e.assign(i,{data:i.data.concat(n.dataProducts||[]),text:i.text.concat(n.fullTextSources||[])})),!e.isPlainObject(r))throw new Error("data must be a plain object");if(e.isPlainObject(r["[citations]"])&&e.isString(r.bibcode)){var o=r["[citations]"];e.isNumber(o.num_citations)&&o.num_citations>0&&i.list.push({letter:"C",name:"Citations ("+o.num_citations+")",url:"#abs/"+s(r.bibcode)+"/citations"}),e.isNumber(o.num_references)&&o.num_references>0&&i.list.push({letter:"R",name:"References ("+o.num_references+")",url:"#abs/"+s(r.bibcode)+"/references"})}return e.isArray(r.property)&&e.isString(r.bibcode)&&e.contains(r.property,"TOC")&&i.list.push({letter:"T",name:"Table of Contents",url:"#abs/"+s(r.bibcode)+"/toc"}),r}}}),define("js/mixins/papers_utils",["underscore","jquery-ui","jquery","moment"],function(e,t,n,i){return{formatDate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.format,r=void 0===n?"YYYY/MM":n,s=t.missing,o=_objectSpread({day:"YYYY/MM",month:"YYYY",dayAndMonth:"YYYY"},void 0===s?{}:s),a=_wrapRegExp(/^(\d{4})\x2D(\d{2}|00)\x2D(\d{2}|00)$/,{year:1,month:2,day:3}),c=e.match(a);if(c){var u=c.groups,l=u.year,d=u.month,h=u.day,p="00"===d,f="00"===h,g=[Number.parseInt(l,10),p?0:Number.parseInt(d,10)-1,f?1:Number.parseInt(h,10)],m=i.utc(g);return m.isValid()?p&&f?m.format(o.dayAndMonth):p?m.format(o.month):f?m.format(o.day):m.format(r):l}return null},shortenAbstract:function(e,t){if(t=t||300,!(e.length<=t)){var n=e.slice(0,t).lastIndexOf(" ");return e.slice(0,n+1)+"..."}},prepareDocForViewing:function(t){var n;if(t.author&&t.author.length>3?(t.extraAuthors=t.author.length-3,n=t.author.slice(0,3)):t.author&&(n=t.author),t.author){var i=function(e,t,n){var i=n.length-1;return t===i||0===i?e:e+";"};t.authorFormatted=e.map(n,i),t.allAuthorFormatted=e.map(t.author,i)}return t.formattedDate=t.formattedDate||(t.pubdate?this.formatDate(t.pubdate):void 0),t.shortAbstract=t.abstract?this.shortenAbstract(t.abstract):void 0,t.details=t.details||{shortAbstract:t.shortAbstract,pub:t.pub,abstract:t.abstract},t.num_citations=t["[citations]"]?t["[citations]"].num_citations:void 0,t.identifier=t.bibcode?t.bibcode:t.identifier,t.encodedIdentifier=e.isUndefined(t.identifier)?t.identifier:encodeURIComponent(t.identifier),(t.pubdate||t.shortAbstract)&&(t.popover=!0),this.model&&(t.orderNum=this.model.get("resultsIndex")+1),t}}}),define("js/mixins/side_bar_manager",["backbone","js/components/api_feedback"],function(e,t){var n=new(e.Model.extend({defaults:{recent:!0,show:!0}}));return{_getUpdateFromUserData:function(){try{var e=this.getBeeHive().getObject("User").getUserData();return!!e&&(!!e.defaultHideSidebars&&/show/i.test(e.defaultHideSidebars))}catch(e){return!1}},init:function(){this.setSidebarState(this._getUpdateFromUserData()),_.bindAll(this,["_onFeedback","_onUserAnnouncement","_updateSidebarState"]);var e=this.getPubSub();e&&(e.subscribe(e.FEEDBACK,this._onFeedback),e.subscribe(e.USER_ANNOUNCEMENT,this._onUserAnnouncement),n.on("change:show",this._updateSidebarState))},_updateSidebarState:_.throttle(function(){var e=this.getSidebarState(),t=this.view;t&&t.showCols&&t.showCols({left:e,right:e}),this.broadcast("page-manager-message","side-bars-update",e),this.trigger("page-manager-message","side-bars-update",e)},100),_onUserAnnouncement:function(e,t){_.contains(_.keys(t),"defaultHideSidebars")&&this.setSidebarState(!t.defaultHideSidebars||/show/i.test(t.defaultHideSidebars))},_onFeedback:function(e){switch(e.code){case t.CODES.MAKE_SPACE:return this.onMakeSpace();case t.CODES.UNMAKE_SPACE:return this.onUnMakeSpace();default:return null}},onMakeSpace:function(){n.has("recent")||n.set("recent",this.getSidebarState()),this.setSidebarState(!1)},onUnMakeSpace:function(){n.has("recent")&&(this.setSidebarState(n.get("recent")),n.unset("recent"))},toggleSidebarState:function(){this.setSidebarState(!this.getSidebarState())},setSidebarState:function(e){n.set("show",e),n.trigger("change:show")},getSidebarState:function(){return n.get("show")}}}),define("js/mixins/user_change_rows",["marionette","js/components/api_targets"],function(e,t){var n={};return n.Model=Backbone.Model.extend({initialize:function(e){if(this.on("change:numFound",this.updateMax),this.on("change:rows",this.updateCurrent),!e.widgetName)throw new Error("need to configure with widget name so we can get limit/default info from api_targets._limits");var n={rows:void 0,numFound:void 0,current:void 0,max:void 0,userVal:void 0};_.extend(n,t._limits[e.widgetName]),this.defaults=function(){return n},this.set(this.defaults())},updateMax:function(){var e=_.min([this.get("limit"),this.get("numFound")]);this.set("max",e)},updateCurrent:function(){this.set("current",_.min([this.get("rows"),this.get("numFound")]))}}),n}),define("js/mixins/widget_utility",[],function(){var e={extendMethod:function(e,t,n){if(!_.isUndefined(t[n])){var i=e[n];e[n]=function(){var e=i.apply(this,arguments);return t[n].apply(this,arguments),e}}}};return e}),define("js/mixins/widget_mixin_method",["js/mixins/widget_utility"],function(e){return function(t,n){var i=this.prototype;_.extend(t,i),_.extend(t.events,i.events),_.each(Array.prototype.slice.call(arguments,1),function(n){e.extendMethod(i,t,n)})}}),define("js/mixins/widget_pagination",["underscore"],function(e){return{handlePagination:function(t,n,i,r,s,o){var a=function(e,t){var i=n-e;return i<t?i:t};if(!(e.isNumber(t)&&t>0&&e.isNumber(n)&&n>0&&e.isNumber(i)&&i>=0))throw new Error("Wrong arguments");if(!(r&&r.hasMore&&s&&s.displayMore&&s.disableShowMore))throw new Error("Your paginator (hasMore) and/or view are missing important methods (displayMore/disableShowMore)");if(!o||!o.models)throw new Error("You collection is weird");if(r.hasMore()){var c=o.models.length-i;if(c>=n)return void s.disableShowMore("Reached max "+this.maxDisplayNum);if(i>0){var u=t;if(i>t)return void s.displayMore(a(c,u));var l=a(c,i);s.displayMore(l),u=a(c+=l,u-l)}var d={runQuery:!1};return u>0&&(d.before=function(){s.once("add:child",function(){var e=this;setTimeout(function(){e.displayMore(u)},50)},s)}),u+c>=n?s.disableShowMore("Reached max "+n):d.runQuery=!0,d}s.displayMore(i),s.disableShowMore()}}}),define("js/widgets/widget_states",[],function(){return{READY:0,LOADING:1,IDLE:2,FAILED:3}}),define("hbs!js/widgets/base/templates/loading-template",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-loading" aria-label="loading indicator">\n\n</div>\n'},useData:!0});return e.registerPartial("js/widgets/base/templates/loading-template",t),t}),define("hbs!js/widgets/base/templates/loading-template-small",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-loading s-small" aria-label="loading indicator">\n\n</div>\n'},useData:!0});return e.registerPartial("js/widgets/base/templates/loading-template-small",t),t}),define("js/mixins/widget_state_handling",["underscore","jquery","js/widgets/widget_states","hbs!js/widgets/base/templates/loading-template","hbs!js/widgets/base/templates/loading-template-small"],function(e,t,n,i,r){var s=function(t){return t.view&&t.view.itemContainerView?t.view.itemContainerView:e.isFunction(t.getView)?t.getView():t.view?t.view:void 0},o={};return o[n.ERRORED]={set:function(e){var t=s(this);t&&t.$el&&t.$el.addClass("s-error")},revert:function(){var e=s(this);e&&e.$el&&e.$el.removeClass("s-error")}},o[n.IDLE]={set:function(e){this._getStateHandler({state:n.WAITING}).revert.apply(this,e)},revert:function(){}},{widgetStateHandlers:o,changeState:function(e){if(this._states=this._states||[],e.state!=n.RESET){var t=this._getStateHandler(e);if(!t)throw new Error("This is unknown/unhandled widget state: ",e);t.set.call(this,e),this._saveNewState(e)}else{if(this._states.length>0)for(var i=this._states.length-1;i>=0;i--){var r=this._states[i];this._getStateHandler(r).revert.call(this,r)}this._states=[]}},_getStateHandler:function(e){return this.widgetStateHandlers[e.state]},_saveNewState:function(t){var n=e.object(e.filter(e.pairs(t),function(t){return!e.isObject(t[1])&&!e.isArray(t[1])}));this._states.push(n)}}}),define("js/mixins/widget_state_manager",["underscore","js/components/api_feedback"],function(e,t){return{STATES:{LOADING:"loading",ERRORED:"errored",IDLE:"idle",READY:"ready"},activateWidget:function(){this.__widgetHandlerManager=new function(){this.handlers={},this.on=function(e,t){this.handlers[e].push(t)},this.off=function(t){e.forEach(this.handlers,function(e,n){var i=e.indexOf(t);i>-1&&e.splice(i,1)})},this.fire=function(t,n,i){e.forEach(this.handlers[t],function(e){e.apply(i,n)})},e.reduce(t.CODES,function(e,t){return e[t]=[],e},this.handlers)};var n=this.getPubSub();n.subscribe(n.FEEDBACK,e.bind(this.__handleFeedback,this)),this.updateState("ready")},__handleFeedback:function(e,t){this.getPubSub().getCurrentPubSubKey().getId()===t.getId()&&this.__widgetHandlerManager.fire(e.code,arguments,this)},attachHandler:function(e,t){try{this.__widgetHandlerManager.on(e,t)}catch(e){console.error(e)}},attachGeneralHandler:function(n){e.forEach(t.CODES,e.bind(function(e){(e>0||e===t.CODES.API_REQUEST_ERROR)&&this.attachHandler(e,n)},this))},detachHandler:function(e){this.__widgetHandlerManager.off(e)},onReady:e.noop,onLoading:e.noop,onIdle:e.noop,onErrored:e.noop,onStateChange:e.noop,updateState:function(t){if(t&&e.isString(t)&&t!==this.__state){var n=this.__state;this.__state=t,this.__fireStateHandler(),this.onStateChange.call(this,t,n)}},getState:function(){return this.__state},__fireStateHandler:function(){var e={};e.ready=this.onReady,e.loading=this.onLoading,e.idle=this.onIdle,e.errored=this.onErrored,e[this.__state]&&e[this.__state].call(this,this)}}}),define("js/modules/hello",["underscore","jquery"],function(e,t){return{showName:function(n,i){console.log(n),console.log(i);var r=e.template("Hello <%= name %>");t(n).html(r({name:i}))}}}),define("js/modules/orcid/work",["underscore","jsonpath"],function(e,t){var n={status:"$.status",title:"$.title",publicationDateMonth:"$.pubmonth",publicationDateYear:"$.pubyear",lastModifiedDate:"$.updated",sourceName:"$.source",putCode:"$.putcode",identifier:"$.identifier"},i={createdDate:'$["created-date"].value',lastModifiedDate:'$["last-modified-date"].value',sourceOrcidIdUri:'$.source["source-orcid"].uri',sourceOrcidIdPath:'$.source["source-orcid"].path',sourceOrcidIdHost:'$.source["source-orcid"].host',sourceClientIdUri:'$.source["source-client-id"].uri',sourceClientIdPath:'$.source["source-client-id"].path',sourceClientIdHost:'$.source["source-client-id"].host',sourceName:'$.source["source-name"].value',putCode:'$["put-code"]',path:"$.path",title:'$["title"].title.value',subtitle:'$["title"].subtitle.value',translatedTitle:'$["title"]["translated-title"].value',translatedTitleLang:'$["title"]["translated-title"]["language-code"]',journalTitle:'$["journal-title"].value',shortDescription:'$["short-description"]',citationType:'$.citation["citation-type"]',citationValue:'$.citation["citation-value"]',type:"$.type",publicationDateYear:'$["publication-date"].year.value',publicationDateMonth:'$["publication-date"].month.value',publicationDateDay:'$["publication-date"].day.value',publicationDateMedia:'$["publication-date"]["media-type"]',url:"$.url.value",contributorOrcidUri:'$["contributors"].contributor..["contributor-orcid"].uri',contributorOrcidPath:'$["contributors"].contributor..["contributor-orcid"].path',contributorOrcidHost:'$["contributors"].contributor..["contributor-orcid"].host',contributorName:'$["contributors"].contributor..["credit-name"].value',contributorEmail:'$["contributors"].contributor..["contributor-email"].value',contributorAttributes:'$["contributors"].contributor..["contributor-attributes"]',contributorSequence:'$["contributors"].contributor..["contributor-attributes"]["contributor-sequence"]',contributorRole:'$["contributors"].contributor..["contributor-attributes"]["contributor-role"]',externalIdValue:'$["external-ids"]["external-id"]..["external-id-value"]',externalIdType:'$["external-ids"]["external-id"]..["external-id-type"]',externalIdUrl:'$["external-ids"]["external-id"]..["external-id-url"]',externalIdRelationship:'$["external-ids"]["external-id"]..["external-id-relationship"]',country:"$.country.value",visibility:"$.visibility.value",identifier:"$.identifier"},r=function(r,s){r=r||{},this.useOrcidPaths=s,this._root=r,this.sources=[],this.getSources=function(){return e.isEmpty(this.sources)?[this.getSourceName()]:this.sources},this.setSources=function(t){return e.isArray(t)&&(this.sources=t),this.sources},this.get=function(n){var i=t.query(this._root,n);return e.isEmpty(i)?null:e.isArray(i)&&i.length<=1?i[0]:i},this.getAsOrcid=function(){return e.reduce(i,e.bind(function(n,i){var r=this.get(i);return r&&(e.isArray(r)?e.forEach(r,function(e,r){t.value(n,i.replace("..","["+r+"]"),e)}):t.value(n,i,r)),n},this),{})},this.toADSFormat=function(){var t;return this.useOrcidPaths&&((t=this.getExternalIds()).doi&&(t.doi=[t.doi]),t.identifier=e.values(t)[0]),e.extend({},{title:[this.getTitle()],formattedDate:this.getFormattedPubDate(),source_name:this.getSources().join("; "),identifier:this.getIdentifier(),_work:this},t)},this.getExternalIds=function(){var t=this.getExternalIdType(),n=this.getExternalIdValue();return t=e.isArray(t)?t:[t],n=e.isArray(n)?n:[n],t.length!==n.length?{}:e.reduce(t,function(e,t,i){return e[t]=n[i],e},{})},this.getFormattedPubDate=function(){return(this.getPublicationDateYear()||"????")+"/"+(this.getPublicationDateMonth()||"??")};var o=this.useOrcidPaths?i:n;e.reduce(o,function(t,n,i){e.isString(i)&&i.slice&&(t["get"+(i[0].toUpperCase()+i.slice(1))]=e.partial(t.get,n));return t},this)};return r.adsToOrcid=function(n,r){var s="$.pubdate",o="$.abstract",a="$.bibcode",c="$.pub",u="$.doi[0]",l="$.author[*]",d="$.title[0]",h="$.doctype",p="$.all_ids",f=function(n,i,r){return r&&(e.isArray(r)?e.forEach(r,function(e,r){t.value(n,i.replace("..","["+r+"]"),e)}):t.value(n,i,r)),n},g=function(i){var r=t.query(n,i);return e.isEmpty(r)?null:e.isArray(r)&&r.length<=1?r[0]||"":r||""},m={};try{var b={types:[],values:[],relationships:[]},v=g(a),y=g(u);v&&(b.types.push("bibcode"),b.values.push(v),b.relationships.push("SELF")),y&&(b.types.push("doi"),b.values.push(y),b.relationships.push("SELF"));var _=g(p),w=!1;e.isArray(_)&&(w=_.find(function(e){return e.toLowerCase().startsWith("arxiv")})),w&&(w=w.substr(6),b.types.push("arxiv"),b.values.push(w),b.relationships.push("SELF")),f(m,i.publicationDateYear,g(s).split("-")[0]),"00"===g(s).split("-")[1]?f(m,i.publicationDateMonth,null):f(m,i.publicationDateMonth,g(s).split("-")[1]),f(m,i.shortDescription,g(o).slice(0,4997)+"..."),f(m,i.externalIdType,b.types),f(m,i.externalIdValue,b.values),f(m,i.externalIdRelationship,b.relationships),f(m,i.journalTitle,g(c)),f(m,i.type,{article:"JOURNAL_ARTICLE",inproceedings:"CONFERENCE_PAPER",abstract:"CONFERENCE_ABSTRACT",eprint:"WORKING_PAPER",phdthesis:"DISSERTATION",techreport:"RESEARCH_TECHNIQUE",inbook:"BOOK_CHAPTER",circular:"RESEARCH_TOOL",misc:"OTHER",book:"BOOK",proceedings:"BOOK",bookreview:"BOOK_REVIEW",erratum:"JOURNAL_ARTICLE",proposal:"OTHER",newsletter:"NEWSLETTER_ARTICLE",catalog:"DATA_SET",intechreport:"RESEARCH_TECHNIQUE",mastersthesis:"DISSERTATION",obituary:"OTHER",pressrelease:"OTHER",software:"RESEARCH_TECHNIQUE",talk:"LECTURE_SPEECH"}[g(h)]||"JOURNAL_ARTICLE");var S=g(l);S=e.isArray(S)?S:[S],f(m,i.contributorName,S);var E=e.map(S,function(){return"AUTHOR"});f(m,i.contributorRole,E),f(m,i.title,g(d)),r&&f(m,i.putCode,r)}catch(e){return null}return m},r}),define("js/modules/orcid/bio",["underscore","jsonpath","js/modules/orcid/work"],function(e,t,n){var i={firstName:'$.name["given-names"].value',lastName:'$.name["family-name"].value',orcid:"$.name.path"};return function(n){this._root=n||{},this.get=function(e){return t.query(this._root,e)[0]},this.toADSFormat=function(){return{responseHeader:{params:{orcid:this.getOrcid(),firstName:this.getFirstName(),lastName:this.getLastName()}}}},e.reduce(i,function(t,n,i){return e.isString(i)&&i.slice&&(t["get"+(i[0].toUpperCase()+i.slice(1))]=e.partial(t.get,n)),t},this)}}),define("js/modules/orcid/extension",["underscore","js/components/api_query","js/components/api_request","js/components/api_query_updater","js/components/api_targets","js/modules/orcid/work","js/components/api_feedback","js/mixins/dependon"],function(e,t,n,i,r,s,o){return function(o){var a=new i("OrcidExtension"),c=o.prototype.processDocs,u=o.prototype.activate,l=o.prototype.onAllInternalEvents;return o.prototype.activate=function(t){this.setBeeHive(t),u.apply(this,arguments);var n=t.hasService("PubSub")&&t.getService("PubSub");n.subscribe(n.CUSTOM_EVENT,e.bind(this.onCustomEvent))},o.prototype.onCustomEvent=function(t,n){var i=e.bind(function(t,n){var i=e.filter(this.collection.models,function(t){return e.contains(n,t.get("bibcode"))});e.forEach(i,e.bind(function(n){var i=e.map(n.get("orcid").actions,"action");if(e.contains(i,t)){var r=this.view.children.findByModel(n);r&&r.trigger("OrcidAction",{action:t,view:r,model:n})}},this))},this);switch(t){case"orcid-bulk-claim":i("orcid-add",n);break;case"orcid-bulk-update":i("orcid-update",n);break;case"orcid-bulk-delete":i("orcid-delete",n)}},o.prototype._getOrcidInfo=e.memoize(function(e){var t={actions:{},provenance:null};return e.isCreatedByOthers&&e.isCreatedByADS?(t.actions.update={title:"update in ORCID",caption:"Update ADS version with latest data",action:"orcid-update"},t.actions.delete={title:"delete from ORCID",caption:"Delete ADS version from ORCID",action:"orcid-delete"},t.actions.view={title:"view in ORCID",caption:"Another version exists (we don't have rights to update it)",action:"orcid-view"}):e.isCreatedByOthers&&!e.isCreatedByADS?(e.isKnownToADS&&(t.actions.add={title:"add ADS version ORCID",caption:"ORCID already has a record for this article (we don't have rights to update it).",action:"orcid-add"}),t.actions.view={title:"view in ORCID",caption:"Another version exists (we don't have rights to update it)",action:"orcid-view"}):!e.isCreatedByOthers&&e.isCreatedByADS?(t.actions.update={title:"update in ORCID",caption:"Update ADS version with latest data",action:"orcid-update"},t.actions.delete={title:"delete from ORCID",caption:"Delete ADS version from ORCID",action:"orcid-delete"}):t.actions.add={title:"add to ORCID",caption:"Add ADS version to ORCID",action:"orcid-add"},e.isCreatedByADS&&e.isCreatedByOthers?t.provenance="ads":e.isCreatedByADS?t.provenance="ads":e.isCreatedByOthers?t.provenance="others":t.provenance=null,t},function(e){return[e.isCreatedByADS,e.isCreatedByOthers,e.isKnownToADS,e.provenance]}),o.prototype._setDocsToPending=function(t,n){e.forEach(t,function(t){var i=!e.isBoolean(n)||n;t.orcid=e.extend({},t.orcid,{pending:i})})},o.prototype.addOrcidInfo=function(t){var n=this,i=!1,r=e.noop,s=this.getBeeHive().getService("OrcidApi");if(!s||!s.hasAccess())return t;var o=e.debounce(function(){e.forEach(n.hiddenCollection.models,function(t){var n=t.get("orcid");n.pending&&(n=e.extend({},n,{pending:!1,error:"Error while applying Orcid Data"}),t.set("orcid",n))})},100),a=(e.debounce(function(){var t=n._getOrcidInfo({});e.forEach(n.hiddenCollection.models,function(e){e.get("orcid")&&e.get("orcid").pending&&e.set("orcid",t)})},100),function t(i,r){e.forEach(e.rest(arguments),function(s,o){var a=i[o],c=n._getOrcidInfo(s);s.sourcedByADS&&e.isUndefined(a.source_name)&&(a.source_name="NASA Astrophysics Data System"),a.orcid=e.extend({},a.orcid,c,{pending:!1}),e.isUndefined(a.identifier)&&(a.identifier=a._work.getIdentifier());var u,l=e.find(n.hiddenCollection.models,function(t){return e.isPlainObject(a._work)&&a._work===t.get("_work")||!e.isUndefined(a.identifier)&&a.identifier===t.get("identifier")});l?(e.isPlainObject(a._work)&&(u=a._work.getSources()),e.isUndefined(l.get("identifier"))&&n.orcidWidget&&l.set("identifier",a.identifier),l.set({orcid:c,source_name:e.isArray(u)?u.join("; "):l.get("source_name")})):r<60&&e.delay(e.bind(t,n,[a],r+1),500);e.isArray(s.children)&&e.forEach(s.children,function(t){var i=e.find(n.hiddenCollection.models,function(n){return e.isString(t)&&t===n.get("_work").getPutCode()});i&&n.removeModel(i)})})}),c=function(t){return i?e.defer(o):(i=!0,r(t))};return(r=function(t){var i=e.map(t,function(t){return s.getRecordInfo(t).done(function(i){i.sourcedByADS&&e.isUndefined(t.source_name)&&(t.source_name="NASA Astrophysics Data System"),t.orcid=e.extend({},t.orcid,n._getOrcidInfo(i),{pending:!1})})});n._setDocsToPending(t),$.when.apply($,i).then(e.partial(a,t),e.partial(c,t))})(t),t},o.prototype._paginationUpdate=function(){var t=this;e.forEach(this.hiddenCollection.models,function(n){var i=e.find(t.collection.models,function(e){return e.get("_work")===n.get("_work")});i&&i.get("orcid").pending&&i.set("orcid",n.get("orcid"))})},o.prototype._updateModelsWithOrcid=function(t,n){var i=e.filter(t||this.hiddenCollection.models,function(e){return!e.has("_work")&&e.has("identifier")});e.isEmpty(i)?n<60&&e.delay(e.bind(self._updateModelsWithOrcid,self,null,n+1),500):this.getBeeHive().getService("OrcidApi").getUserProfile().done(function(t){var r=t.getWorks();e.forEach(i,function(t){var i=e.flatten(e.values(e.pick(t.attributes,["identifier"])));e.forEach(r,function(r){var s=e.flatten(e.values(r.getIdentifier()));e.intersection(i,s).length>0?t.set({source_name:r.getSources().join("; "),_work:r}):n<60&&e.delay(e.bind(self._updateModelsWithOrcid,self,[t],n+1),500)})})})},o.prototype.processDocs=function(t,n,i){n=c.apply(this,arguments);var r=this.getBeeHive().getObject("User");if(r&&r.isOrcidModeOn()||this.orcidWidget){var s=t.get("responseHeader.params"),o=parseInt(s.start)+parseInt(s.rows),a=this.addOrcidInfo(n,o);return i.numFound!==a.length&&e.extend(i,this.getPaginationInfo(t,n)),e.delay(e.bind(this._updateModelsWithOrcid,this,0),1e3),a}return n},o.prototype.mergeADSAndOrcidData=function(i){var o=this,c=$.Deferred(),u=o.getBeeHive().getService("OrcidApi"),l=function(t,n){var r=n.response&&n.response.docs&&n.response.docs[0],o=(t=new s(t._root,!0)).toADSFormat();o=e.isPlainObject(o)?o:{},r=e.isPlainObject(r)?r:{},i.set(e.extend({},i.attributes,o,r)),c.resolve(i)},d=function(){c.reject.apply(c,arguments)},h=function(){c.reject.apply(c,arguments)},p=function(s){var c=i.get("identifier"),u=new t({q:"identifier:"+a.quoteIfNecessary(c),fl:"title,abstract,bibcode,author,pub,pubdate,doi,doctype"}),h=new n({query:u,target:r.SEARCH,options:{done:e.partial(l,s),fail:d}}),p=o.getPubSub();p.publish(p.EXECUTE_REQUEST,h)},f=i.get("_work");return f?u.getWork(f.getPutCode()).done(p).fail(h):this._findWorkByModel(i).done(function(e){u.getWork(e.getPutCode()).done(p).fail(h)}).fail(h),c.promise()},o.prototype._findWorkByModel=function(t,n){var i=$.Deferred(),r=this.getBeeHive().getService("OrcidApi"),o=e.pick(t.attributes,["identifier"]),a=e.pick(t.attributes,["all_ids"]),c=e.clone(t.get("orcid")||{}),u=null;e.isUndefined(n)&&(u=r.getUserProfile());var l=function(n){var u=n.getWorks(),l=!0,d=null,h=e.find(u,function(t){var n=t.getIdentifier();return l=o.identifier===n,d=t.getPutCode(),e.contains(a.all_ids,n)});if(h){if(!l){var p=s.adsToOrcid(t.attributes,d);r.updateWork(p)}i.resolve(h)}else{i.reject();var f="Could not find a matching ORCiD Record";console.error.apply(console,[f].concat(arguments)),t.set("orcid",e.extend(c,{pending:!1,error:f}))}};return e.isUndefined(n)?(u.done(l),u.fail(function(){i.reject.apply(i,arguments);var n="Error retrieving ORCiD profile";console.error.apply(console,[n].concat(arguments)),t.set("orcid",e.extend(c,{pending:!1,error:n}))})):l(n),i.promise()},o.prototype.removeModel=function(t){var n=t.resultsIndex;this.hiddenCollection.remove(t);var i=this.hiddenCollection.models;e.forEach(e.rest(i,n),function(e){e.set("resultsIndex",e.get("resultsIndex")-1),e.set("indexToShow",e.get("indexToShow")-1)});var r=this.model.get("showRange"),s=e.range(r[0],r[1]+1),o=[];e.forEach(s,function(e){i[e]&&i[e].set&&(i[e].set("visible",!0),i[e].resultsIndex=e,i[e].set("resultsIndex",e),i[e].set("indexToShow",e+1),o.push(i[e]))}),this.hiddenCollection.reset(i),this.collection.reset(o),this.model.set("totalPapers",i.length)},o.prototype.onAllInternalEvents=function(t,n,i){if("childview:OrcidAction"===t){var r=this,o=i.action,a=this.getBeeHive().getService("OrcidApi"),c=e.clone(i.model.get("orcid")||{}),u=this.getPubSub();u.publish(u.CUSTOM_EVENT,"orcid-action",o);var d={"orcid-add":function(t){t.set("orcid",{pending:!0});var n,i=function(){r._findWorkByModel(t).done(function(e){t.set({orcid:r._getOrcidInfo({isCreatedByADS:!0,isCreatedByOthers:!1,isKnownToADS:!0,provenance:"ads"}),source_name:e.getSources().join("; ")}),r.trigger("orcidAction:"+o,t)})},u=s.adsToOrcid(t.attributes);if(u)n=u,a.addWork(n).done(i).fail(function(n,r,s){if("CONFLICT"===s)return i();var o="Failed to add entry, please try again";console.error.apply(console,[o].concat(arguments)),t.set("orcid",e.extend(c,{pending:!1,error:o}))});else{var l="There was a problem adding the record, try again";console.error.apply(console,[l].concat(arguments)),t.set("orcid",e.extend(c,{pending:!1,error:l}))}},"orcid-delete":function(t){t.set("orcid",{pending:!0});var n=function(){r.orcidWidget?r.removeModel(t):t.set("orcid",r._getOrcidInfo({})),r.trigger("orcidAction:"+o,t)},i=function(i){a.deleteWork(i.getPutCode()).done(n).fail(function(i,r,s){if("NOT FOUND"===s)return n();var o="Error deleting record, please try again";console.error.apply(console,[o].concat(arguments)),t.set("orcid",e.extend(c,{pending:!1,error:o}))})},s=t.get("_work");s?i(s):r._findWorkByModel(t).done(i)},"orcid-update":function(t){t.set("orcid",{pending:!0});var n=function(){var n="Error updating record, please try again";console.error.apply(console,[n].concat(arguments)),t.set("orcid",e.extend(c,{pending:!1,error:n}))};r.mergeADSAndOrcidData(t).done(function(t){var i=t.get("_work").getPutCode(),c=s.adsToOrcid(t.attributes,i);if(e.isNull(c))return n(c);a.updateWork(c).done(function(e){var n=new s(e,!0);a.getRecordInfo(n.toADSFormat()).done(function(e){t.set("orcid",r._getOrcidInfo(e)),r.trigger("orcidAction:"+o,t)})}).fail(n),t.set(t.attributes,{silent:!0})}).fail(function(){var n="Failed to merge ORCiD and ADS data";console.error.apply(console,[n].concat(arguments)),t.set("orcid",e.extend(c,{pending:!1,error:n}))})},"orcid-login":function(){a.signIn()},"orcid-logout":function(){a.signOut()},"orcid-view":function(t){var n=t.get("orcidWorkPath");e.isString(n)&&window.open(n,"_blank").focus()}};d[o]&&d[o](i.model)}return l.apply(this,arguments)},o}}),define("js/modules/orcid/item_view_extension",["backbone","underscore"],function(e,t){return{showOrcidActions:function(e){var t=this.$(".mini-orcid-icon");t.removeClass("green"),t.removeClass("gray");var n=this.$(".orcid-actions");n.removeClass("hidden"),n.removeClass("orcid-wait");var i=n.find(".orcid-action-update"),r=n.find(".orcid-action-insert"),s=n.find(".orcid-action-delete");i.addClass("hidden"),r.addClass("hidden"),s.addClass("hidden"),e(this.model.attributes)?(!0!==this.model.attributes.isFromAds&&i.removeClass("hidden"),s.removeClass("hidden"),t.addClass("green")):!1===this.model.attributes.isFromAds||(r.removeClass("hidden"),t.addClass("gray"))},hideOrcidActions:function(){this.$(".orcid-actions").addClass("hidden")},orcidAction:function(e){var t=$(e.currentTarget);this.$(".orcid-actions").addClass("orcid-wait");var n="";t.hasClass("orcid-action-insert")?n="insert":t.hasClass("orcid-action-update")?n="update":t.hasClass("orcid-action-delete")&&(n="delete");var i={actionType:n,model:this.model.attributes,modelType:"adsData"};return this.trigger("OrcidAction",i),!1}}}),define("js/modules/orcid/profile",["underscore","jsonpath","js/modules/orcid/work"],function(e,t,n){var i={workSummaries:"$"};return function(r){this._root=r||{},this.works=[],this.get=function(n){var i=t.query(this._root,n);return e.isEmpty(i)?null:e.isArray(i)&&i.length<=1?i[0]:i},this.getWorks=function(){return this.works},this.setWorks=function(e){return this.works=e,this},this.toADSFormat=function(){var t=e.sortBy(this.getWorks(),function(e){return e.getTitle()});return{responseHeader:{params:{}},response:{numFound:(t=e.map(t,function(e){return e.toADSFormat()})).length,start:0,docs:t}}},e.reduce(i,function(t,n,i){return e.isString(i)&&i.slice&&(t["get"+(i[0].toUpperCase()+i.slice(1))]=e.partial(t.get,n)),t},this),this.works=e.map(this.getWorkSummaries(),function(e){return new n(e)})}}),define("js/modules/orcid/orcid_api",["underscore","bootstrap","jquery","backbone","js/components/generic_module","js/mixins/dependon","js/components/pubsub_events","js/mixins/link_generator_mixin","js/components/api_query","js/components/api_request","js/mixins/hardened","js/components/api_targets","js/components/api_query_updater","js/components/api_feedback","js/modules/orcid/work","js/modules/orcid/profile","js/modules/orcid/bio"],function(e,t,n,i,r,s,o,a,c,u,l,d,h,p,f,g,m){var b=r.extend({initialize:function(){this.userData={},this.addCache=[],this.deleteCache=[],this.getUserProfileCache=[],this.authData=null,this.addWait=3e3,this.deleteWait=100,this.profileWait=100,this.maxAddChunkSize=100,this.maxDeleteChunkSize=10,this.db={},this.clearDBWait=3e4,this.dbUpdatePromise=null,this.maxQuerySize=100,this.queryUpdater=new h("orcid_api"),this.orcidApiTimeout=3e4,this.adsQueryTimeout=10,this.dirty=!0},activate:function(t){var n=t.getService("PersistentStorage"),i=t.getObject("DynamicConfig");if(this.setBeeHive(t),this.config={},e.extend(this.config,i.Orcid),n){var r=n.get("Orcid");r&&r.authData&&this.saveAccessData(r.authData)}this._addWork=e.debounce(this._addWork,this.addWait),this._getUserProfile=e.debounce(this._getUserProfile,this.profileWait),this._deleteWork=e.debounce(this._deleteWork,this.deleteWait)},checkAccessOrcidApiAccess:function(){return this.hasAccess()?this.getUserProfile():n.Deferred().reject().promise()},hasAccess:function(){return!(!this.authData||!this.authData.expires)&&this.authData.expires>(new Date).getTime()},signIn:function(e){this.getPubSub().publish(this.getPubSub().APP_EXIT,{type:"orcid",url:this.config.loginUrl+"&redirect_uri="+encodeURIComponent(this.config.redirectUrlBase+(e||"/user/orcid"))}),this.getPubSub().publish(this.getPubSub().ORCID_ANNOUNCEMENT,"login")},setADSUserData:function(e){var t=this.getBeeHive().getService("Api").url+d.ORCID_PREFERENCES+"/"+this.authData.orcid,n=this.createRequest(t,{method:"POST"},e);return n.fail(function(){console.error.apply(console,["ADS ORCiD preferences could not be set"].concat(arguments))}),n},getADSUserData:function(){var e=this,t=this.getBeeHive().getService("Api").url+d.ORCID_PREFERENCES+"/"+this.authData.orcid,n=this.createRequest(t);return n.fail(function(){e.signOut(),e.getBeeHive().getObject("User").setOrcidMode(0);var t=e.getPubSub();t.publish(t.ALERT,new p({title:"Expired ORCID login",msg:["Your ORCID login has expired.","Please reload the page and sign in again to access the page.","",'<button onclick="location.reload()" class="btn btn-primary" role="button">Reload</button>'].join("<br/>"),modal:!0,type:"warning"}))}),n},getUserBio:function(){var e=new n.Deferred,t=this.getBeeHive().getService("Api").url+d.ORCID_NAME+"/"+this.authData.orcid,i=this.createRequest(t);return i.fail(function(){console.error.apply(console,["ADS name could not be retrieved"].concat(arguments)),e.reject()}),i.done(function(t){var n=new m(t);e.resolve(n)}),e.promise()},signOut:function(){this.saveAccessData(null),this.getPubSub().publish(this.getPubSub().ORCID_ANNOUNCEMENT,"logout")},hasExchangeCode:function(e){return!!this.getExchangeCode(e)},getExchangeCode:function(e){return this.getUrlParameter("code",e||window.location.search)},getUrlParameter:function(e,t){for(var n=t.substring(1).split("&"),i=0;i<n.length;i++){var r=n[i].split("=");if(r[0]===e)return decodeURIComponent(r[1])}},getAccessData:function(t){var i=this.getBeeHive().getService("Api"),r=n.Deferred(),s={url:this.config.exchangeTokenUrl,done:e.bind(r.resolve,r),fail:e.bind(r.reject,r),always:e.bind(r.always,r),headers:{Accept:"application/json",Authorization:i.access_token}};return i.request(new u({target:this.config.exchangeTokenUrl,query:new c({code:t})}),s),r.promise()},saveAccessData:function(e){var t=this.getBeeHive();e&&!e.expires&&e.expires_in&&(e.expires=(new Date).getTime()+(1e3*e.expires_in-1e3)),this.authData=e;var n=t.getService("PersistentStorage");if(n){var i=n.get("Orcid")||{};i.authData=e,n.set("Orcid",i)}},getUrl:function(t,n){var i=this.config.apiEndpoint+"/"+this.authData.orcid+{profile_bib:"/orcid-profile/simple",profile_full:"/orcid-profile/full?update=True",works:"/orcid-works",work:"/orcid-work"}[t],r=e.isArray(n)?n.join(","):n;return r&&(i+="/"+r),i},createRequest:function(t,i,r){if(e.isUndefined(t))throw new Error("Url must be defined");var s=n.Deferred(),o=this.sendData(t,r,i||{});return o.done(e.bind(s.resolve,s)),o.fail(e.bind(s.reject,s)),o.always(e.bind(s.always,s)),s.promise()},_getUserProfile:function(){var t=this.createRequest(this.getUrl("profile_full")),n=this.getUserProfileCache.splice(0);t.done(function(t){e.forEach(n,function(n){orcidProfile=new g(t),n.resolve(orcidProfile.setWorks(e.map(t,function(e,t){return new f(e)})))})}),t.fail(function(){var t=arguments;e.forEach(n,function(e){e.reject.apply(e,t)})})},getUserProfile:function(){var e=n.Deferred();return this.getUserProfileCache.push(e),this._getUserProfile.call(this),e.promise()},getWork:function(t){var i=n.Deferred();return this.createRequest(this.getUrl("works",t)).done(function(e){i.resolve(new f(e))}).fail(e.bind(i.reject,i)),i.promise()},getWorks:function(t){if(!e.isArray(t))throw new TypeError("putcodes must be an Array");for(var i=n.Deferred(),r=[],s=0,o=t.length;s<o;s+=50){var a=t.slice(s,s+50),c=this.getUrl("works")+"/"+a.join(",");r.push(e.partial(this.createRequest,c))}var u=n.when.apply(n,r);return u.done(e.bind(i.resolve,i)),u.fail(function(){i.reject(arguments)}),i.promise()},updateWork:function(t){if(!e.isPlainObject(t))throw new TypeError("Work should be a simple object");var i=t["put-code"];if(!i)return n.Deferred().reject().promise();var r=this.getUrl("works",i);return this.createRequest(r,{method:"PUT"},t)},deleteWork:function(t){if(!e.isNumber(t))throw new TypeError("putcode should be a number");var i=n.Deferred();return this.deleteCache.push({id:e.uniqueId(),putCode:t,promise:i}),this._deleteWork.call(this),i.promise()},_deleteWork:function(){for(var t,i=this,r=this.deleteCache.slice(0),s=[],o=[],a=0;a<r.length;a+=this.maxDeleteChunkSize)t=r.slice(a,a+this.maxDeleteChunkSize),o.push(t);e.forEach(o,function(t,n){e.forEach(t,function(t){s.push(t.promise.promise()),e.delay(function(){i.createRequest(i.getUrl("works",t.putCode),{beforeSend:function(e){e._id=t.id},method:"DELETE"}).done(e.bind(t.promise.resolve,t.promise)).fail(e.bind(t.promise.reject,t.promise)).always(e.bind(t.promise.always,t.promise));var n=i.deleteCache.indexOf(t);i.deleteCache.splice(n,n+1)},i.deleteWait*n)})});n.when.apply(n,s).always(function(){i.deleteCache=e.reduce(i.deleteCache,function(e,t){return"pending"===t.promise.state()?t.promise.reject():e.push(t),e},[])})},addWork:function(t){if(!e.isPlainObject(t))throw new TypeError("Should be plain object");var i=n.Deferred();return this.addCache.push({id:e.uniqueId(),work:t,promise:i}),this._addWork.call(this),i.promise()},_addWork:function(){var t=this,n=e.map(t.addCache,"work"),i=e.map(t.addCache,"id"),r=t._addWorks(n,i);r.done(function(n){e.forEach(n,function(n,i){var r=e.find(t.addCache,function(e){return e.id===i});if(!r)return console.error("No Cache entry found"),!0;var s=r.promise,o=r.work;n?n.error?409===n.error["response-code"]?s.resolve(o):s.reject():s.resolve(new f(n.work)):s.reject();var a=t.addCache.indexOf(r);t.addCache.splice(a,a+1)})}),r.fail(function(n){var i=arguments;e.forEach(n,function(n){var r=e.findIndex(t.addCache,{id:n});if(r>=0){var s=t.addCache[r].promise;t.addCache.splice(r,r+1),"pending"===s.state()&&s.reject.apply(s,i)}})})},_addWorks:function(t,i){var r=this;if(!e.isArray(t)||!e.isArray(i))throw new TypeError("works and ids must be arrays");for(var s,o,a=n.Deferred(),c=[],u=0;u<t.length;u+=this.maxAddChunkSize){s=t.slice(u,u+this.maxAddChunkSize),o=i.slice(u,u+this.maxAddChunkSize);var l={bulk:[]};e.each(s,function(e){l.bulk.push({work:e})});var d=this.getUrl("works");c.push(this.createRequest(d,{beforeSend:function(e){e.cacheIds=o},method:"POST"},l))}return n.when.apply(n,c).then(function(){var t=e.isArray(arguments[0])?arguments:[arguments],n=e.reduce(t,function(t,n){var i=n&&n[0]&&n[0].bulk,r=n&&n[2]&&n[2].cacheIds;return e.forEach(r,function(e,n){t[e]=i[n]}),t},{});a.resolve(n)},function(e){r.setDirty(),a.reject.apply(a,[e.cacheIds].concat(arguments))}),a.promise()},sendData:function(t,i,r){var s=n.Deferred();r=r||{};var o={type:"GET",url:t,contentType:"application/json",cache:!!this.dbUpdatePromise,timeout:this.orcidApiTimeout,done:e.bind(s.resolve,s),fail:e.bind(s.reject,s),always:e.bind(s.always,s)};i?(o.dataType="json",o.data=JSON.stringify(i),o.converters={"* text":window.String,"text html":!0,"text json":function(e){return e=e||"{}",n.parseJSON(e)},"text xml":n.parseXML}):o.data=null,e.extend(o,r);var a=this.getBeeHive().getService("Api");return o.headers||(o.headers={}),o.headers.Authorization=a.access_token,!o.headers["Orcid-Authorization"]&&this.authData&&(o.headers["Orcid-Authorization"]="Bearer "+this.authData.access_token),o.headers["Content-Type"]||(o.headers["Content-Type"]="application/json"),o.headers.Accept||(o.headers.Accept="application/json"),a.request(new u({target:t,query:new c,options:o})),s.promise()},_checkIdsInADS:function(t){var i=this.getBeeHive().getService("Api"),r=n.Deferred();t.set("fl","bibcode, doi, alternate_bibcode"),t.set("rows","5000");var s=function(){r.resolve({})};return i.request(new u({target:d.SEARCH,query:t,options:{done:function(t){if(!t||!t.response||!t.response.docs)return r.resolve({});var n=e.reduce(t.response.docs,function(t,n){var i=n.bibcode.toLowerCase();return t["identifier:"+i]=i,e.each(n.doi,function(e){var n="identifier:"+e.toLowerCase().replace("doi:","");t[n]=i}),e.each(n.alternate_bibcode,function(e){var n="identifier:"+e.toLowerCase();t[n]=i}),t},{});r.resolve(n)},fail:s}})).fail(s),function t(n){if("pending"===r.state()&&n<=0)return r.reject("Request Timeout");"resolved"!==r.state()&&e.delay(t,1e3,--n)}(this.adsQueryTimeout),r.promise()},isSourcedByADS:function(e){return e.getSourceName().indexOf("NASA Astrophysics Data System")>-1},_buildQuery:function(t){if(e.isEmpty(t)||!t.identifier)return null;var n=e.filter(t.identifier,function(t){return!e.isEmpty(t.trim())||"NONE"===t}).join(" OR ");return e.isEmpty(n)?null:new c({q:"identifier:("+n+")"})},updateDatabase:function(t){var i=this;if(this.dbUpdatePromise&&"pending"===this.dbUpdatePromise.state())return this.dbUpdatePromise.promise();this.dbUpdatePromise=n.Deferred();var r=function(e){var t=i.dbUpdatePromise;i.setClean(),i.db=e,t&&t.resolve(),setTimeout(function(){t&&"pending"!==t.state()&&(t=null,i.setDirty())},i.clearDBWait)},s=function(t){var s=t.getWorks(),o=[],a={};if(e.forEach(s,function(e,t){var n="identifier:";(n+=e.getIdentifier())&&(o.push(n),a[n.toLowerCase()]={sourcedByADS:i.isSourcedByADS(e),putcode:e.getPutCode(),idx:t})}),o.length&&i.maxQuerySize>0){var c=[];o=o.sort();for(var u=e.range(0,o.length,i.maxQuerySize),l=0;l<u.length;l++){for(var d={},h=u[l];h<u[l]+i.maxQuerySize&&!(h>=o.length);h++){var p=o[h].split(":");d[p[0]]||(d[p[0]]=[]),d[p[0]].push(i.queryUpdater.quoteIfNecessary(p[1]))}var f=i._buildQuery(d);f&&c.push(i._checkIdsInADS(f))}}else r(a);n.when.apply(n,c).then(function(t){e.each(a,function(e,n){var i=t[n];i?a[n].bibcode=i:a[n].idx=-1}),r(a)},function(){console.error.apply(console,["Error processing response from ADS"].concat(arguments)),r(a)})};return t?s(t):this.getUserProfile().done(s).fail(function(){i.dbUpdatePromise.reject.apply(i.dbUpdatePromise,arguments)}),i.dbUpdatePromise.promise()},getRecordInfo:function(t){var i=this,r=n.Deferred(),s=function(t){var n={isCreatedByADS:!1,isCreatedByOthers:!1,isKnownToADS:!1,provenance:null},r=function(t,r){var s=("identifier:"+t).toLowerCase(),o=i.db[s];o&&(o.sourcedByADS?n.isCreatedByADS=!0:n.isCreatedByOthers=!0,o.idx>-1&&(n.isKnownToADS=!0),n=e.extend({},n,o))},s=e.pick(t,"identifier","bibcode","doi","alternate_bibcode");return e.each(s,function(t,n){e.isArray(t)?e.each(t,r):r(t,0)}),n};return this.needsUpdate()?this.updateDatabase().done(function(){r.resolve(s(t))}).fail(e.bind(r.reject,r)):r.resolve(s(t)),r.promise()},needsUpdate:function(){return this.dirty},setDirty:function(){this.dirty=!0},setClean:function(){this.dirty=!1},hardenedInterface:{hasAccess:"boolean indicating access to ORCID Api",getUserProfile:"get user profile",getUserBio:"get user bio",signIn:"login",signOut:"logout",getADSUserData:"",setADSUserData:"",getRecordInfo:"provides info about a document",addWork:"add a new orcid work",deleteWork:"remove an entry from orcid",updateWork:"update an orcid work",getWork:"get an orcid work",getWorks:"get an array of orcid works"}});return e.extend(b.prototype,s.BeeHive),e.extend(b.prototype,l),b}),define("js/modules/orcid/module",["backbone","underscore","js/components/generic_module","./orcid_api"],function(e,t,n,i){var r=n.extend({activate:function(e){var n=e.getObject("DynamicConfig");if(!n)throw new Error("DynamicConfig is not available to Orcid module");var i=n.orcidRedirectUrlBase||location.protocol+"//"+location.host,r=n.orcidClientId,s=n.orcidApiEndpoint,o=n.orcidLoginEndpoint;if(!r||!s)throw new Error("Missing configuration for ORCID module: orcidApiEndpoint, orcidClientId");var a={redirectUrlBase:i,apiEndpoint:s,clientId:r,worksUrl:s+"/{0}/orcid-works",loginUrl:o+"?scope=/orcid-profile/read-limited%20/orcid-works/create%20/orcid-works/update&response_type=code&access_type=offline&show_login=true&client_id="+r,exchangeTokenUrl:s+"/exchangeOAuthCode"};t.extend(n,{Orcid:a}),this.activateDependencies(e)},activateDependencies:function(e){var t=e.getService("OrcidApi");t||((t=new i).activate(e),e.addService("OrcidApi",t))}});return function(){return{activate:function(e){(new r).activate(e)}}}}),define("js/widgets/base/base_widget",["backbone","marionette","js/components/api_query","js/components/api_request","js/mixins/widget_mixin_method","js/components/api_targets","js/mixins/dependon","js/mixins/widget_state_manager"],function(e,t,n,i,r,s,o,a){var c=t.Controller.extend({initialize:function(e){e=e||{},_.bindAll(this,"dispatchRequest","processResponse"),this._currentQuery=new n,this.defaultQueryArguments=this.defaultQueryArguments||{},e.defaultQueryArguments&&(this.defaultQueryArguments=_.extend(this.defaultQueryArguments,e.defaultQueryArguments)),e.view&&(this.view=e.view,this.collection=e.view.collection),this.view&&t.bindEntityEvents(this,this.view,t.getOption(this,"viewEvents")),this.model&&t.bindEntityEvents(this,this.model,t.getOption(this,"modelEvents"))},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");t.subscribe(t.INVITING_REQUEST,_.bind(this.dispatchRequest,this)),t.subscribe(t.DELIVERING_RESPONSE,_.bind(this.processResponse,this))},dispatchNewQuery:function(e){_.each(this.defaultQueryArguments,function(t,n){e.unset(n)});var t=this.getPubSub();t.publish(t.NAVIGATE,"search-page",{q:e})},dispatchRequest:function(e){this._dispatchRequest(e)},_dispatchRequest:function(e){var t=this.customizeQuery(e);if(t){var n=this.composeRequest(t);if(n){var i=this.getPubSub();i.publish(i.DELIVERING_REQUEST,n)}}},customizeQuery:function(e){var t=e.clone();return t.unlock(),this.defaultQueryArguments&&(t=this.composeQuery(this.defaultQueryArguments,t)),t},processResponse:function(e){var t=e.getApiQuery();throw this.setCurrentQuery(t),new Error("you need to customize this function")},composeRequest:function(e){return new i({target:s.SEARCH,query:e})},setCurrentQuery:function(e){this._currentQuery=e},getCurrentQuery:function(){var e,t=new n({});try{if(this._currentQuery instanceof n)t=this._currentQuery;else if(_.isFunction(this.getBeeHive)&&(e=this.getBeeHive()).hasObject("AppStorage")){var i=e.getObject("AppStorage").getCurrentQuery();i instanceof n&&(t=i)}}catch(e){console.error(e.message)}finally{return t}},composeQuery:function(e,t){var n;return n=t||(n=this.getCurrentQuery()).clone(),e&&_.each(e,function(e,t){n.has(t)||n.set(t,e)}),n},onDestroy:function(){this.view.destroy()},getEl:function(){return this.view.el&&this.view.$el.children().length?this.view.el:this.view.render().el},render:function(){return this.view.render()},parseIdentifierFromQuery:function(e){if(!e.hasVal("q"))throw"no query";var t=e.get("q")[0];try{if(/^(?:identifier|bibcode):(.*)$/.test(t))return t.split(":")[1]}catch(e){throw"unable to parse bibcode"}throw"query must be in the format of identifer:foo or bibcode:foo"}},{mixin:r});return _.extend(c.prototype,o.BeeHive,a),c}),define("hbs!js/widgets/list_of_things/templates/item-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return" chosen "},3:function(e,t,n,i){var r,s;return'            <label class="custom-checkbox">\n                <input type="checkbox" value='+this.escapeExpression("function"==typeof(s=null!=(s=t.identifier||(null!=e?e.identifier:e))?s:t.helperMissing)?s.call(e,{name:"identifier",hash:{},data:i}):s)+' name="identifier" '+(null!=(r=t.if.call(e,null!=e?e.chosen:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+' aria-label="select item '+this.escapeExpression("function"==typeof(s=null!=(s=t.indexToShow||(null!=e?e.indexToShow:e))?s:t.helperMissing)?s.call(e,{name:"indexToShow",hash:{},data:i}):s)+'">\n            </label>\n'},4:function(e,t,n,i){return" checked "},6:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=e?e.normCiteSort:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.program(9,i,0),data:i}))?r:""},7:function(e,t,n,i){var r;return'              <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/citations" title="citation count" class="citations-redirect-link" aria-label="'+this.escapeExpression("function"==typeof(r=null!=(r=t.citationCountNorm||(null!=e?e.citationCountNorm:e))?r:t.helperMissing)?r.call(e,{name:"citationCountNorm",hash:{},data:i}):r)+' normalized citations">cited (n): '+this.escapeExpression("function"==typeof(r=null!=(r=t.citationCountNorm||(null!=e?e.citationCountNorm:e))?r:t.helperMissing)?r.call(e,{name:"citationCountNorm",hash:{},data:i}):r)+"</a>\n"},9:function(e,t,n,i){var r;return'              <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/citations" title="citation count" class="citations-redirect-link" aria-label="'+this.escapeExpression("function"==typeof(r=null!=(r=t.citation_count||(null!=e?e.citation_count:e))?r:t.helperMissing)?r.call(e,{name:"citation_count",hash:{},data:i}):r)+' citations">cited: '+this.escapeExpression("function"==typeof(r=null!=(r=t.citation_count||(null!=e?e.citation_count:e))?r:t.helperMissing)?r.call(e,{name:"citation_count",hash:{},data:i}):r)+"</a>\n"},11:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=e?e.normCiteSort:e,{name:"if",hash:{},fn:this.program(12,i,0),inverse:this.program(14,i,0),data:i}))?r:""},12:function(e,t,n,i){var r;return'              <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/citations" title="citation count" class="citations-redirect-link" aria-label="'+this.escapeExpression("function"==typeof(r=null!=(r=t.citationCountNorm||(null!=e?e.citationCountNorm:e))?r:t.helperMissing)?r.call(e,{name:"citationCountNorm",hash:{},data:i}):r)+' normalized citations">'+this.escapeExpression("function"==typeof(r=null!=(r=t.citationCountNorm||(null!=e?e.citationCountNorm:e))?r:t.helperMissing)?r.call(e,{name:"citationCountNorm",hash:{},data:i}):r)+"</a>\n"},14:function(e,t,n,i){var r;return'              <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/citations" title="citation count" class="citations-redirect-link" aria-label="'+this.escapeExpression("function"==typeof(r=null!=(r=t.citation_count||(null!=e?e.citation_count:e))?r:t.helperMissing)?r.call(e,{name:"citation_count",hash:{},data:i}):r)+' citations">'+this.escapeExpression("function"==typeof(r=null!=(r=t.citation_count||(null!=e?e.citation_count:e))?r:t.helperMissing)?r.call(e,{name:"citation_count",hash:{},data:i}):r)+"</a>\n"},16:function(e,t,n,i){var r;return'\n                <div class="letter-icon s-letter-icon">\n\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.text:r,{name:"if",hash:{},fn:this.program(17,i,0),inverse:this.program(21,i,0),data:i}))?r:"")+'\n            </div>\n\n            <div class="letter-icon s-letter-icon">\n\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.list:r,{name:"if",hash:{},fn:this.program(23,i,0),inverse:this.program(26,i,0),data:i}))?r:"")+'\n            </div>\n            <div class="letter-icon s-letter-icon">\n\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.data:r,{name:"if",hash:{},fn:this.program(28,i,0),inverse:this.program(31,i,0),data:i}))?r:"")+"\n            </div>\n"},17:function(e,t,n,i){var r;return'\n                        <a class="btn-link active-link s-active-link" aria-disabled="false">\n                            <i class="s-text-icon" aria-hidden="true"></i>\n                            <span class="sr-only">quick access to full text links</span>\n                        </a>\n                        <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.links:e)?r.text:r,{name:"each",hash:{},fn:this.program(18,i,0),inverse:this.noop,data:i}))?r:"")+"                        </ul>\n\n"},18:function(e,t,n,i){var r;return"                            <li><a "+(null!=(r=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(19,i,0),inverse:this.noop,data:i}))?r:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'"\n                                target="_blank" rel="noreferrer noopener" aria-label="open access link">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},19:function(e,t,n,i){return' class="s-open-access"'},21:function(e,t,n,i){return'\n                    <div title="full text links (none)">\n                        <a href="javascript:void(0)" class="btn-link disabled" aria-disabled="true" aria-label="full text links">\n                            <i class="s-text-icon" aria-hidden="true"></i>\n                        </a>\n                    </div>\n\n'},23:function(e,t,n,i){var r;return'\n                <a class="btn-link active-link s-active-link" aria-disabled="false">\n                    <i class="s-list-icon" aria-hidden="true"></i>\n                    <span class="sr-only">quick links to lists of references, citations and more</span>\n                </a>\n\n                <ul class="hidden list-unstyled list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.links:e)?r.list:r,{name:"each",hash:{},fn:this.program(24,i,0),inverse:this.noop,data:i}))?r:"")+"                </ul>\n\n"},24:function(e,t,n,i){return'                    <li><a href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},26:function(e,t,n,i){return'                <div title="references, citations (none)">\n                    <a href="javascript:void(0)" class="btn-link disabled" aria-disabled="true">\n                        <i class="s-list-icon" aria-hidden="true"></i>\n                        <span class="sr-only">quick links to lists of references, citations etc</span>\n                    </a>\n                </div>\n\n\n'},28:function(e,t,n,i){var r;return'\n                <a class="btn-link active-link s-active-link" aria-disabled="false">\n                    <i class="s-data-icon" aria-hidden="true"></i>\n                    <span class="sr-only">quick links to data associated with this article</span>\n                </a>\n\n                <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.links:e)?r.data:r,{name:"each",hash:{},fn:this.program(29,i,0),inverse:this.noop,data:i}))?r:"")+"                </ul>\n\n"},29:function(e,t,n,i){var r;return"                    <li><a "+(null!=(r=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(19,i,0),inverse:this.noop,data:i}))?r:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'" target="_blank" rel="noreferrer noopener"\n                        >'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},31:function(e,t,n,i){return'                    <div title="data products (none)">\n                        <a href="javascript:void(0)" class="btn-link disabled" aria-disabled="true">\n                            <i class="s-data-icon" aria-hidden="true"></i>\n                            <span class="sr-only">quick links to data associated with this article</span>\n                        </a>\n                    </div>\n\n'},33:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=e?e.encodedIdentifier:e,{name:"if",hash:{},fn:this.program(34,i,0),inverse:this.program(36,i,0),data:i}))?r:""},34:function(e,t,n,i){var r,s;return'                <a href="#abs/'+this.escapeExpression("function"==typeof(s=null!=(s=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?s:t.helperMissing)?s.call(e,{name:"encodedIdentifier",hash:{},data:i}):s)+'/abstract" class="abs-redirect-link">\n                    <h3 class="s-results-title">'+(null!=(r="function"==typeof(s=null!=(s=t.title||(null!=e?e.title:e))?s:t.helperMissing)?s.call(e,{name:"title",hash:{},data:i}):s)?r:"")+"</h3>\n                </a>\n"},36:function(e,t,n,i){var r,s;return'                <h3 class="s-results-title">'+(null!=(r="function"==typeof(s=null!=(s=t.title||(null!=e?e.title:e))?s:t.helperMissing)?s.call(e,{name:"title",hash:{},data:i}):s)?r:"")+"</h3>\n"},38:function(e,t,n,i){var r,s;return'            <a href="#abs/'+this.escapeExpression("function"==typeof(s=null!=(s=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?s:t.helperMissing)?s.call(e,{name:"encodedIdentifier",hash:{},data:i}):s)+'/abstract" class="abs-redirect-link">\n                <h3 class="s-results-title">'+(null!=(r="function"==typeof(s=null!=(s=t.title||(null!=e?e.title:e))?s:t.helperMissing)?s.call(e,{name:"title",hash:{},data:i}):s)?r:"")+"</h3>\n            </a>\n"},40:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=e?e.authorFormatted:e,{name:"if",hash:{},fn:this.program(41,i,0),inverse:this.program(46,i,0),data:i}))?r:""},41:function(e,t,n,i){var r;return'            <ul class="list-inline just-authors s-results-authors less-authors" aria-label="authors">\n'+(null!=(r=t.each.call(e,null!=e?e.authorFormatted:e,{name:"each",hash:{},fn:this.program(42,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=t.if.call(e,null!=e?e.extraAuthors:e,{name:"if",hash:{},fn:this.program(44,i,0),inverse:this.noop,data:i}))?r:"")+'            </ul>\n\n            <ul class="list-inline just-authors s-results-authors all-authors hidden" aria-label="authors">\n'+(null!=(r=t.each.call(e,null!=e?e.allAuthorFormatted:e,{name:"each",hash:{},fn:this.program(42,i,0),inverse:this.noop,data:i}))?r:"")+'                <li>\n                    <a href="javascript:void(0)" class="show-less-authors">\n                        <em>show less</em>\n                    </a>\n                </li>\n            </ul>\n'},42:function(e,t,n,i){return'                    <li class="article-author">'+this.escapeExpression(this.lambda(e,e))+"</li>\n"},44:function(e,t,n,i){var r;return'                <li>\n                    <a href="javascript:void(0)" class="show-all-authors">\n                        <em>and '+this.escapeExpression("function"==typeof(r=null!=(r=t.extraAuthors||(null!=e?e.extraAuthors:e))?r:t.helperMissing)?r.call(e,{name:"extraAuthors",hash:{},data:i}):r)+" more</em>\n                    </a>\n                </li>\n"},46:function(e,t,n,i){return'                <span class="text-faded">no author information available</span>\n'},48:function(e,t,n,i){var r;return'<div class="row">\n    <div class="col-sm-10 col-sm-offset-1">\n        <div class="s-results-orcid-container">\n\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.pending:r,{name:"if",hash:{},fn:this.program(49,i,0),inverse:this.program(51,i,0),data:i}))?r:"")+" \x3c!--orcid.pending--\x3e\n    </div>\n\n</div>\n"},49:function(e,t,n,i){return'            <button class="btn btn-default btn-sm s-orcid-loading" aria-disabled="true">\n                <i class="fa fa-lg fa-spinner fa-pulse" aria-hidden="true"></i> Working...\n            </button>\n'},51:function(e,t,n,i){var r;return"            \x3c!-- if provenance, it has been added by us or someone else--\x3e\n"+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.provenance:r,{name:"if",hash:{},fn:this.program(52,i,0),inverse:this.program(66,i,0),data:i}))?r:"")+"\x3c!--orcid.provenance --\x3e\n            "},52:function(e,t,n,i){var r;return'\n            <div class="'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.error:r,{name:"if",hash:{},fn:this.program(53,i,0),inverse:this.program(55,i,0),data:i}))?r:"")+" s-orcid-alert s-orcid-provenance-"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.orcid:e)?r.provenance:r,e))+'" role="alert">\n                <div class="btn-group">\n                    <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown"\n                            aria-expanded="false" '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.error:r,{name:"if",hash:{},fn:this.program(57,i,0),inverse:this.noop,data:i}))?r:"")+'>\n                        <img src="../../styles/img/orcid-active.svg" alt="orcid logo active" class="s-orcid-img"/> Actions <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.orcid:e)?r.actions:r,{name:"each",hash:{},fn:this.program(59,i,0),inverse:this.noop,data:i}))?r:"")+"                        </li>\n                    </ul>\n                </div>\n\n                "+(null!=(r=t.if.call(e,null!=e?e.source_name:e,{name:"if",hash:{},fn:this.program(64,i,0),inverse:this.noop,data:i}))?r:"")+'\n                <span class="text-success s-orcid-success pull-right"> <i class="icon-success" aria-hidden="true"></i>&nbsp;In ORCID&nbsp;</span>\n\n            </div>\n\n\n\n            '},53:function(e,t,n,i){return"alert-danger"},55:function(e,t,n,i){return"alert-success"},57:function(e,t,n,i){var r;return'title="'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.orcid:e)?r.error:r,e))+'"'},59:function(e,t,n,i){var r;return'                        <li>\n\n                            <a class="orcid-action '+this.escapeExpression(this.lambda(null!=e?e.action:e,e))+'" data-action="'+this.escapeExpression(this.lambda(null!=e?e.action:e,e))+'"\n                               title="'+this.escapeExpression(this.lambda(null!=e?e.caption:e,e))+'">\n                                <i class="\n'+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.action:e,"orcid-update",{name:"compare",hash:{},fn:this.program(60,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.action:e,"orcid-delete",{name:"compare",hash:{},fn:this.program(62,i,0),inverse:this.noop,data:i}))?r:"")+'                            " aria-hidden="true"></i>\n                                '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</a>\n"},60:function(e,t,n,i){return"                            icon-reload-c\n"},62:function(e,t,n,i){return"                            icon-clear-c\n"},64:function(e,t,n,i){var r;return'<span class="s-orcid-source">('+this.escapeExpression("function"==typeof(r=null!=(r=t.source_name||(null!=e?e.source_name:e))?r:t.helperMissing)?r.call(e,{name:"source_name",hash:{},data:i}):r)+")</span>"},66:function(e,t,n,i){var r;return"\x3c!-- add this paper to ORCID--\x3e\n\n"+(null!=(r=t.if.call(e,null!=e?e.bibcode:e,{name:"if",hash:{},fn:this.program(67,i,0),inverse:this.program(72,i,0),data:i}))?r:"")+"\n\n            "},67:function(e,t,n,i){var r;return'            <button class="btn '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.error:r,{name:"if",hash:{},fn:this.program(68,i,0),inverse:this.program(70,i,0),data:i}))?r:"")+" btn-sm orcid-action "+this.escapeExpression(this.lambda(null!=(r=null!=(r=null!=(r=null!=e?e.orcid:e)?r.actions:r)?r.add:r)?r.action:r,e))+'"  data-action="'+this.escapeExpression(this.lambda(null!=(r=null!=(r=null!=(r=null!=e?e.orcid:e)?r.actions:r)?r.add:r)?r.action:r,e))+'" '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.error:r,{name:"if",hash:{},fn:this.program(57,i,0),inverse:this.noop,data:i}))?r:"")+'>\n               <img src="../../styles/img/orcid-inactive.svg" alt="orcid logo inactive" class="s-orcid-img" title="'+this.escapeExpression(this.lambda(null!=(r=null!=(r=null!=(r=null!=e?e.orcid:e)?r.actions:r)?r.add:r)?r.caption:r,e))+'"/>\n                Claim in ORCID\n            </button>\n'},68:function(e,t,n,i){return"btn-danger"},70:function(e,t,n,i){return"btn-default"},72:function(e,t,n,i){return'            <div class="panel panel-default" style="box-shadow: none">\n                <div class="panel-body">\n                    <img src="../../styles/img/orcid-inactive.svg" alt="orcid logo inactive" class="s-orcid-img" title=""/>\n                    Record not known to ADS\n                </div>\n            </div>\n'},74:function(e,t,n,i){var r;return'\n        <div class="col-xs-10 col-xs-offset-1 s-more-info">\n'+(null!=(r=t.if.call(e,(t.isdefined||e&&e.isdefined||t.helperMissing).call(e,null!=e?e.highlights:e,{name:"isdefined",hash:{},data:i}),{name:"if",hash:{},fn:this.program(75,i,0),inverse:this.program(81,i,0),data:i}))?r:"")+"        </div>\n"},75:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=(r=null!=e?e.highlights:e)?r.length:r,{name:"if",hash:{},fn:this.program(76,i,0),inverse:this.program(79,i,0),data:i}))?r:""},76:function(e,t,n,i){var r;return'            <h4 class="sr-only">Search Highlights</h4>\n            <ul aria-label="search snippets" class="s-search-snippets">\n'+(null!=(r=t.each.call(e,null!=e?e.highlights:e,{name:"each",hash:{},fn:this.program(77,i,0),inverse:this.noop,data:i}))?r:"")+"            </ul>\n\n"},77:function(e,t,n,i){var r;return"                <li>"+(null!=(r=this.lambda(e,e))?r:"")+"</li>\n"},79:function(e,t,n,i){return'                <span class="text-muted">No highlights</span>\n'},81:function(e,t,n,i){return'            <span class="text-muted"><i class="fa fa-spinner fa-pulse" aria-hidden="true"></i> Loading Highlights...</span>\n'},83:function(e,t,n,i){var r;return'        <div class="col-xs-9 col-xs-offset-1 s-more-info">\n'+(null!=(r=t.if.call(e,null!=e?e.abstract:e,{name:"if",hash:{},fn:this.program(84,i,0),inverse:this.noop,data:i}))?r:"")+"        </div>\n"},84:function(e,t,n,i){var r,s;return'                    <h4 aria-label="read full abstract below"><a href="#abs/'+this.escapeExpression("function"==typeof(s=null!=(s=t.identifier||(null!=e?e.identifier:e))?s:t.helperMissing)?s.call(e,{name:"identifier",hash:{},data:i}):s)+'">Abstract</a></h4>\n'+(null!=(r=t.if.call(e,null!=e?e.shortAbstract:e,{name:"if",hash:{},fn:this.program(85,i,0),inverse:this.program(87,i,0),data:i}))?r:"")},85:function(e,t,n,i){var r,s;return'\n                    <div class="short-abstract" aria-label="a truncated version of the abstract">\n                        '+(null!=(r="function"==typeof(s=null!=(s=t.shortAbstract||(null!=e?e.shortAbstract:e))?s:t.helperMissing)?s.call(e,{name:"shortAbstract",hash:{},data:i}):s)?r:"")+'\n                        &nbsp; <button class="btn btn-xs btn-default show-full-abstract">more</button>\n                    </div>\n                    <div class="full-abstract hidden">\n                        '+(null!=(r="function"==typeof(s=null!=(s=t.abstract||(null!=e?e.abstract:e))?s:t.helperMissing)?s.call(e,{name:"abstract",hash:{},data:i}):s)?r:"")+'\n                        &nbsp; <button class="btn btn-xs btn-default hide-full-abstract">less</button>\n                    </div>\n'},87:function(e,t,n,i){var r,s;return"                        \x3c!--the abstract is short enough to be shown all at once--\x3e\n                        "+(null!=(r="function"==typeof(s=null!=(s=t.abstract||(null!=e?e.abstract:e))?s:t.helperMissing)?s.call(e,{name:"abstract",hash:{},data:i}):s)?r:"")+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,s;return'<div tabindex="-1" class="col-sm-12 '+(null!=(r=t.if.call(e,null!=e?e.chosen:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'">\n<div class="row s-top-row">\n    <div class="col-xs-1 s-checkbox-col s-top-row-col">\n        <label>\n            <span class="hidden-xs">'+this.escapeExpression("function"==typeof(s=null!=(s=t.indexToShow||(null!=e?e.indexToShow:e))?s:t.helperMissing)?s.call(e,{name:"indexToShow",hash:{},data:i}):s)+"</span>\n"+(null!=(r=t.if.call(e,null!=e?e.showCheckbox:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+'        </label>\n    </div>\n\n    <div class="col-xs-4 col-sm-3 s-top-row-col identifier s-identifier">\n        <a href="#abs/'+this.escapeExpression("function"==typeof(s=null!=(s=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?s:t.helperMissing)?s.call(e,{name:"encodedIdentifier",hash:{},data:i}):s)+'/abstract" aria-label="bibcode" class="abs-redirect-link">\n            '+this.escapeExpression("function"==typeof(s=null!=(s=t.identifier||(null!=e?e.identifier:e))?s:t.helperMissing)?s.call(e,{name:"identifier",hash:{},data:i}):s)+'\n        </a>\n    </div>\n    <div class="hidden-xs col-xs-1 col-md-1 col-md-offset-0 s-top-row-col print-visible-inline-1" aria-label="date published">\n        '+this.escapeExpression("function"==typeof(s=null!=(s=t.formattedDate||(null!=e?e.formattedDate:e))?s:t.helperMissing)?s.call(e,{name:"formattedDate",hash:{},data:i}):s)+'\n    </div>\n\n    <div class="hidden-xs print-visible-block-1">\n      <div class="col-xs-3 col-sm-5 col-md-3 s-top-row-col">\n'+(null!=(r=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?r:"")+'      </div>\n    </div>\n\n    <div class="hidden-sm hidden-md hidden-lg print-hidden">\n      <div class="col-xs-2 col-sm-5 col-md-3 s-top-row-col text-right">\n'+(null!=(r=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'      </div>\n    </div>\n\n\n\n    <div class="col-xs-5 col-sm-4 pull-right">\n        <div class="s-results-links">\n\n'+(null!=(r=t.if.call(e,null!=e?e.links:e,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.noop,data:i}))?r:"")+'      </div>\n    </div>\n\n</div>\n<div class="row">\n\n    <div class="col-xs-10 col-xs-offset-1">\n'+(null!=(r=t.if.call(e,null!=e?e.isOrcidWidget:e,{name:"if",hash:{},fn:this.program(33,i,0),inverse:this.program(38,i,0),data:i}))?r:"")+'    </div>\n</div>\n\n<div class="row">\n    <div class="col-xs-10 col-xs-offset-1">\n\n'+(null!=(r=t.unless.call(e,null!=e?e.isOrcidWidget:e,{name:"unless",hash:{},fn:this.program(40,i,0),inverse:this.noop,data:i}))?r:"")+"\n\n    </div>\n\n</div>\n\n"+(null!=(r=t.if.call(e,null!=e?e.orcid:e,{name:"if",hash:{},fn:this.program(48,i,0),inverse:this.noop,data:i}))?r:"")+'\n    <div class="row highlight-row">\n'+(null!=(r=t.if.call(e,null!=e?e.showHighlights:e,{name:"if",hash:{},fn:this.program(74,i,0),inverse:this.noop,data:i}))?r:"")+'    </div>\n\n    <div class="row abstract-row">\n'+(null!=(r=t.if.call(e,null!=e?e.showAbstract:e,{name:"if",hash:{},fn:this.program(83,i,0),inverse:this.noop,data:i}))?r:"")+"    </div>\n</div>\n"},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/item-template",t),t}),define("hbs!js/widgets/list_of_things/templates/pagination-partial",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'            <i class="icon-loading" aria-hidden="true"></i>&nbsp;Loading more papers...\n'},3:function(e,t,n,i){var r;return null!=(r=t.unless.call(e,null!=e?e.error:e,{name:"unless",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:""},4:function(e,t,n,i){var r;return'<div class="row" style="margin: 0; position: relative">\n'+(null!=(r=t.if.call(e,null!=e?e.pageData:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+'    <button class="btn btn-link" id="backToTopBtn">Top <i class="fa fa-caret-up" aria-hidden="true"></i></button>\n</div>\n'},5:function(e,t,n,i){var r;return'    <div class="col-sm-12 pagination-controls s-pagination-controls">\n        <div class="col-xs-5 per-page-container">\n'+(null!=(r=t.if.call(e,null!=e?e.pageData:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?r:"")+'        </div>\n        <div class="col-xs-7 pagination-container">\n            <nav aria-label="pagination controls">\n                <ul class="pager">\n                    <li class="'+(null!=(r=t.unless.call(e,null!=(r=null!=e?e.pageData:e)?r.previousPossible:r,{name:"unless",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+'"><a href="javascript:void(0)" class="page-control previous-page"><i class="fa fa-chevron-circle-left" aria-hidden="true"></i> prev</a></li>\n                    <li><input type="text" value="'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.pageData:e)?r.currentPage:r,e))+'" class="form-control page-control" style="display:inline-block;width:60px" aria-label="set the current page" aria-hidden="true"> of '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.pageData:e)?r.totalPages:r,e))+'</li>\n                    <li class="'+(null!=(r=t.unless.call(e,null!=(r=null!=e?e.pageData:e)?r.nextPossible:r,{name:"unless",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+'"><a href="javascript:void(0)" class="page-control next-page">next <i class="fa fa-chevron-circle-right" aria-hidden="true"></i></a></li>\n                </ul>\n            </nav>\n\n        </div>\n    </div>\n'},6:function(e,t,n,i){var r;return'            <div class="form-group">\n              <label for="per-page-select" class="col-xs-6 control-label" style="line-height: 32px; text-align: right;">Per Page</label>\n              <div class="col-xs-6 col-sm-5">\n                <select name="per-page-select" id="per-page-select" class="form-control">\n                  <option value="25" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(r=null!=e?e.pageData:e)?r.perPage:r,25,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+'>25</option>\n                  <option value="50" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(r=null!=e?e.pageData:e)?r.perPage:r,50,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+'>50</option>\n                  <option value="100" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(r=null!=e?e.pageData:e)?r.perPage:r,100,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+'>100</option>\n                  <option value="200" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(r=null!=e?e.pageData:e)?r.perPage:r,200,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+'>200</option>\n                  <option value="500" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(r=null!=e?e.pageData:e)?r.perPage:r,500,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+">500</option>\n                </select>\n              </div>\n            </div>\n"},7:function(e,t,n,i){return"selected"},9:function(e,t,n,i){return" disabled "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="row">\n    <div class="col-sm-12 page-loading" style="text-align:center">\n'+(null!=(r=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"    </div>\n</div>\n"+(null!=(r=t.unless.call(e,null!=e?e.query:e,{name:"unless",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/pagination-partial",t),e.registerPartial("js/widgets/list_of_things/templates/pagination-partial",t),t}),define("hbs!js/widgets/list_of_things/templates/results-container-template",["hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e){var t=e.template({1:function(e,t,n,i){var r;return'    <div>\n      <h4 class="s-list-description">'+this.escapeExpression("function"==typeof(r=null!=(r=t.description||(null!=e?e.description:e))?r:t.helperMissing)?r.call(e,{name:"description",hash:{},data:i}):r)+"</h4>\n    </div>\n    "},3:function(e,t,n,i){var r,s;return'\n    <div>\n      <h2 class="s-article-title">'+(null!=(r="function"==typeof(s=null!=(s=t.title||(null!=e?e.title:e))?s:t.helperMissing)?s.call(e,{name:"title",hash:{},data:i}):s)?r:"")+"</h2>\n    </div>\n"},5:function(e,t,n,i){var r;return" "+(null!=(r=t.if.call(e,null!=e?e.citation_discrepancy:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?r:"")+" "},6:function(e,t,n,i){var r;return'\n    <div>\n      <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>\n      This list is missing <b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.citation_discrepancy||(null!=e?e.citation_discrepancy:e))?r:t.helperMissing)?r.call(e,{name:"citation_discrepancy",hash:{},data:i}):r)+"</b> records, which could\n      not be matched to papers in ADS.\n    </div>\n    <br />\n    "},8:function(e,t,n,i){var r;return'\n    <div class="s-operator print-hidden">\n      <a href="'+this.escapeExpression("function"==typeof(r=null!=(r=t.queryURL||(null!=e?e.queryURL:e))?r:t.helperMissing)?r.call(e,{name:"queryURL",hash:{},data:i}):r)+'" class="btn btn-sm btn-inverse btn-primary-faded"\n        ><i class="fa fa-search" aria-hidden="true"></i> view this list in a\n        search results page</a\n      >\n    </div>\n'},10:function(e,t,n,i){var r;return" "+(null!=(r=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,helpers:t,partials:n}))?r:"")+" "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="s-list-controls">\n  <div class="s-results-border-bottom">\n    <div class="col-sm-1"></div>\n\n    <div class="col-sm-6"></div>\n\n    <div class="col-sm-4 sort-container"></div>\n\n    <div class="col-sm-1"></div>\n  </div>\n\n  <div class="s-list-title">\n'+(null!=(r=t.if.call(e,null!=e?e.description:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+" "+(null!=(r=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+"\n    \x3c!--citation widget should show info if [citations] and citation_count don't match--\x3e\n    "+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.queryOperator:e,"citations",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+" "+(null!=(r=t.if.call(e,null!=e?e.queryOperator:e,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?r:"")+'  </div>\n\n  <ul\n    class="results-list  s-results-list list-unstyled s-display-block"\n    aria-label="list of results"\n  ></ul>\n\n  '+(null!=(r=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+"\n</div>\n"},usePartial:!0,useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/results-container-template",t),t}),define("js/widgets/list_of_things/model",["backbone","underscore","bowser","js/mixins/add_stable_index_to_collection"],function(e,t,n,i){var r=e.Model.extend({defaults:function(){return{abstract:void 0,title:void 0,authorAff:void 0,pub:void 0,pubdate:void 0,keywords:void 0,bibcode:void 0,pub_raw:void 0,doi:void 0,details:void 0,links_data:void 0,resultsIndex:void 0,visible:!1,actionsVisible:!0,showCheckbox:!0,isMobileOrTablet:!1}},idAttribute:"resultsIndex"}),s=e.Collection.extend({initialize:function(e,t){this.numVisible=0,this.currentStartIndex=0,this.currentEndIndex=0,this.lastIndex=-1,this.lastMissingTrigger=null,t&&t.paginationModel&&(this.paginationModel=t.paginationModel,this.listenTo(this.paginationModel,"change:page",this._onPaginationChange),this.listenTo(this.paginationModel,"change:perPage",this._onPaginationChange))},model:r,numFound:void 0,comparator:"resultsIndex",_updateStartAndEndIndex:function(){var e=this.paginationModel.get("page"),t=this.paginationModel.get("perPage"),n=this.paginationModel.get("numFound");this.currentStartIndex=this.getPageStart(e,t),this.currentEndIndex=this.getPageEnd(e,t,n)},_onPaginationChange:function(){this._updateStartAndEndIndex(),this.trigger("pagination:change")},reset:function(){this.lastMissingTrigger=null,this.lastIndex=-1,e.Collection.prototype.reset.apply(this,arguments)},getStartIndex:function(){return this.currentStartIndex},getEndIndex:function(){return this.paginationModel.get("perPage")},_incrementLastIndex:function(){return this.lastIndex+=1,this.lastIndex},_prepareModel:function(t,n){return void 0===t.resultsIndex&&(t.resultsIndex=this._incrementLastIndex()),(t.title||t.bibcode||t.identifier)&&(t.emptyPlaceholder=!1),e.Collection.prototype._prepareModel.call(this,t,n)},getVisibleModels:function(){return t.filter(this.models,function(e){return e.attributes.visible})},updateIndexes:function(e,i,r){r=r||{};e=t.isNumber(e)?e:this.currentStartIndex,i=t.isNumber(i)?i:this.currentEndIndex+1;var s,o=0,a=null,c=0,u=[],l=null,d=n.parse(window.navigator.userAgent).platform.type,h="mobile"===d||"tablet"===d;if(this.each(function(n){s=n.attributes.resultsIndex,null!==l&&s!=l+1&&t.each(t.range(l+1,s),function(e){u.push(e)}),l=s,s>=e&&s<=i?(n.set("visible",!0),null===a&&(a=s),o+=1,c=s):n.set("visible",!1),n.set("isMobileOrTablet",h)}),o!==i-e+1&&t.each(t.range((l||e+u.length)+1,i+1),function(e){this.get(e)||u.push(e)},this),u.length){for(var p=0,f=u.length,g=0;g<u.length;g++){if(u[g]>i){f=g;break}u[g]<e&&(p=g+1)}u=u.slice(p,f),u=this._compressGaps(u),JSON.stringify(u)!=this.lastMissingTrigger&&(this.lastMissingTrigger=JSON.stringify(u),r.silent||this.trigger("show:missing",u))}return this.numVisible=o,this.currentStartIndex=a||0,this.currentEndIndex=c,o},_compressGaps:function(e){for(var t=e[0],n=t,i=e.length,r=[],s=0;s<i;s++){for(var o=s+1;o<i&&e[o]==t+(o-s);)n=e[o],o+=1;r.push({start:t,end:n}),s=o-1,o<i&&(t=n=e[o])}return r},showRange:function(e,t,n){if(n=n||{},e<0)throw new Error("Start cannot be negative");if(t<e)throw new Error("End cannot be smaller than start");return this.updateIndexes(e,t,n)},getNumVisible:function(){return this.numVisible},showMore:function(e){if(null===e)return this.updateIndexes(0,this.model.length);var t=this.getNumVisible();return this.updateIndexes(this.currentStartIndex,0==this.currentEndIndex?e-1:this.currentEndIndex+e)-t}});return t.extend(s.prototype,i),s}),define("hbs!js/widgets/list_of_things/templates/empty-view-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'  <div>\n    Using the ADS classic query translator? view the\n    <a\n      href="/help/faq/#classic-search-translator"\n      rel="noreferrer noopener"\n      target="_blank"\n      >docs</a\n    >.\n  </div>\n'},3:function(e,t,n,i){var r;return"  <ul>\n"+(null!=(r=t.if.call(e,null!=e?e.suggestedQuery:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'    <li>Try broadening your search</li>\n    <li>Disable any filters that may be applied</li>\n    <li><a href="#">Check out some examples</a></li>\n    <li>\n      <a\n        href="/help/search/search-syntax"\n        target="_blank"\n        rel="noreferrer noopener"\n        >Read our help pages</a\n      >\n    </li>\n  </ul>\n  <span>\n    Not seeing something that should be here? Let us know!\n    <button\n      class="btn btn-primary-faded results-feedback-button"\n      data-toggle="modal"\n      data-target="#feedback-modal"\n      data-feedback-view="general"\n    >\n      <i class="fa fa-comment" aria-hidden="true"></i>\n      Leave Feedback\n    </button>\n  </span>\n'},4:function(e,t,n,i){var r;return'    <li>\n      Try an alternate query:\n      <a href="'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.suggestedQuery:e)?r.url:r,e))+'">'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.suggestedQuery:e)?r.query:r,e))+"</a>\n    </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,s;return'<div class="s-empty-view-msg">\n  <div class="h4">Sorry no results were found for <code>'+this.escapeExpression("function"==typeof(s=null!=(s=t.query||(null!=e?e.query:e))?s:t.helperMissing)?s.call(e,{name:"query",hash:{},data:i}):s)+"</code></div>\n"+(null!=(r=t.if.call(e,null!=e?e.showTugboatMessage:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+"</div>\n"},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/empty-view-template",t),t}),define("hbs!js/widgets/list_of_things/templates/error-view-template",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="container-fluid">\n  <div class="row text-center">\n    <span class="fa-stack fa-lg text-danger">\n      <i class="fa fa-stack-2x fa-circle-o" aria-hidden="true"></i>\n      <i class="fa fa-stack-1x fa-exclamation" aria-hidden="true"></i>\n    </span>\n  </div>\n  <div class="row text-center">\n    <div class="h4">\n      Something Went Wrong\n    </div>\n    <div class="h4">\n      Please Retry Your Search\n    </div>\n  </div>\n</div>\n'},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/error-view-template",t),t}),define("hbs!js/widgets/list_of_things/templates/initial-view-template",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return"Requesting data..."},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/initial-view-template",t),t}),define("js/widgets/list_of_things/item_view",["marionette","backbone","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","analytics","mathjax"],function(e,t,n,i,r,s,o,a){return e.ItemView.extend({tagName:"li",template:s,constructor:function(t){return t&&_.defaults(t,_.pick(this,["model","collectionEvents","modelEvents"])),_.bindAll(this,"resetToggle"),e.ItemView.prototype.constructor.apply(this,arguments)},render:function(){return this.model.get("visible")?e.ItemView.prototype.render.apply(this,arguments):(this.$el&&this.$el.empty(),this)},onRender:function(){var e=this;a&&a.Hub.Queue(["Typeset",a.Hub,this.el]),$(">",this.$el).on("keyup",function(t){13===t.which&&$("a.abs-redirect-link",e.$el).mousedown().mouseup().click()})},events:{"change input[name=identifier]":"toggleSelect","focus .letter-icon":"showLinks","mouseenter .letter-icon":"showLinks","mouseleave .letter-icon":"hideLinks","focusout .letter-icon":"hideLinks","click .letter-icon>ul":"hideLinks","click .show-all-authors":"showAllAuthors","click .show-less-authors":"showLessAuthors","click .show-full-abstract":"showFullAbstract","click .hide-full-abstract":"hideFullAbstract","click .orcid-action":"orcidAction","click .abs-redirect-link":"onAbsLinkClick","click .citations-redirect-link":"onCitationsLinkClick"},modelEvents:{"change:visible":"render","change:showAbstract":"render","change:showHighlights":"render","change:orcid":"render","change:chosen":"render"},collectionEvents:{add:"render","change:visible":"render"},emitAnalyticsEvent:function(e){o("send","event","interaction","letter-link-followed",$(e.target).text())},onAbsLinkClick:function(e){var t=this.model.get("bibcode");o("send","event","interaction","abstract-link-followed",{target:"abstract",bibcode:t})},onCitationsLinkClick:function(e){var t=this.model.get("bibcode");o("send","event","interaction","citations-link-followed",{target:"citations",bibcode:t})},showAllAuthors:function(e){return this.$(".s-results-authors.less-authors").addClass("hidden"),this.$(".s-results-authors.all-authors").removeClass("hidden"),!1},showLessAuthors:function(e){return this.$(".s-results-authors.less-authors").removeClass("hidden"),this.$(".s-results-authors.all-authors").addClass("hidden"),!1},showFullAbstract:function(){return this.$(".short-abstract").addClass("hidden"),this.$(".full-abstract").removeClass("hidden"),!1},hideFullAbstract:function(){return this.$(".short-abstract").removeClass("hidden"),this.$(".full-abstract").addClass("hidden"),!1},toggleSelect:function(){var e=!this.model.get("chosen");this.trigger("toggleSelect",{selected:e,data:this.model.attributes}),this.model.set("chosen",e)},resetToggle:function(){this.setToggleTo(!1)},setToggleTo:function(e){var t=$("input[name=identifier]");e?(this.$el.addClass("chosen"),this.model.set("chosen",!0),t.prop("checked",!0)):(this.$el.removeClass("chosen"),this.model.set("chosen",!1),t.prop("checked",!1))},removeActiveQuickLinkState:function(e){e.find("i").removeClass("s-icon-draw-attention"),e.find(".link-details").addClass("hidden"),e.find("ul").attr("aria-expanded",!1)},addActiveQuickLinkState:function(e){e.find("i").addClass("s-icon-draw-attention"),e.find(".link-details").removeClass("hidden"),e.find("ul").attr("aria-expanded",!0)},deactivateOtherQuickLinks:function(e){var t=this.$(".letter-icon").filter(function(){if($(this).find("i").hasClass("s-icon-draw-attention"))return!0}).eq(0);t.length&&t[0]!==e[0]&&this.removeActiveQuickLinkState(t)},showLinks:function(e){var t=$(e.currentTarget);t.find(".active-link").length&&(this.deactivateOtherQuickLinks(t),this.addActiveQuickLinkState(t))},hideLinks:function(e){var t=$(e.currentTarget);t.is("ul")?this.removeActiveQuickLinkState(t.parent()):this.removeActiveQuickLinkState(t)},orcidAction:function(e){if(!e)return!1;var t=$(e.currentTarget),n={action:t.data("action")?t.data("action"):t.text().trim(),model:this.model,view:this,target:t};return this.trigger("OrcidAction",n),!1}})}),define("hbs!js/wraps/widget/loading/template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'  <div class="close-widget close-circle">\n    <a href="javascript:void(0)"\n      ><i class="fa fa-times fa-lg" aria-hidden="true"></i\n    ></a>\n  </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,s;return'<div class="loading-container">\n'+(null!=(r=t.unless.call(e,null!=e?e.hideCloseButton:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'  <div class="loading">\n    <div\n      class="loading-icon-'+this.escapeExpression("function"==typeof(s=null!=(s=t.widgetLoadingSize||(null!=e?e.widgetLoadingSize:e))?s:t.helperMissing)?s.call(e,{name:"widgetLoadingSize",hash:{},data:i}):s)+' fa fa-spinner fa-spin"\n      aria-hidden="true"\n    ></div>\n    <div class="loading-text loading-text-'+this.escapeExpression("function"==typeof(s=null!=(s=t.widgetLoadingSize||(null!=e?e.widgetLoadingSize:e))?s:t.helperMissing)?s.call(e,{name:"widgetLoadingSize",hash:{},data:i}):s)+'">\n      Loading...\n    </div>\n  </div>\n</div>\n'},useData:!0});return e.registerPartial("js/wraps/widget/loading/template",t),t}),define("js/widgets/list_of_things/paginated_view",["underscore","marionette","backbone","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","hbs!js/widgets/list_of_things/templates/results-container-template","js/mixins/link_generator_mixin","js/mixins/add_stable_index_to_collection","hbs!js/widgets/list_of_things/templates/empty-view-template","hbs!js/widgets/list_of_things/templates/error-view-template","hbs!js/widgets/list_of_things/templates/initial-view-template","./item_view","analytics","mathjax","hbs!js/wraps/widget/loading/template"],function(e,t,n,i,r,s,o,a,c,u,l,d,h,p,f,g,m){var b=n.Model.extend({defaults:function(){return{mainResults:!1,title:void 0,showAbstract:"closed",showHighlights:!1,showSidebars:!0,pagination:!0,start:0,highlightsLoaded:!1}}}),v=function(e){var t=e.clone(),n=t.get("q");if(n[0]===n[0].toUpperCase())return t.set("q",n[0].toLowerCase()),t.unset("fl"),{url:"#search/"+t.url(),query:t.get("q")}},y=t.ItemView.extend({template:function(t){return t.query?l(t):t.error?d(t):m(e.extend(t,{widgetLoadingSize:"big",hideCloseButton:!0}))}});return t.CompositeView.extend({childView:p,emptyView:y,initialize:function(e){this.model=new b},serializeData:function(){var e=this.model.toJSON();return e.queryOperator&&(e.queryURL="#search/q="+e.queryOperator+"(",e.queryURL+=encodeURIComponent("bibcode:"+e.bibcode)+")",e.removeSelf&&(e.queryURL+=encodeURIComponent(" -bibcode:"+e.bibcode)),e.sortOrder&&(e.queryURL+="&sort="+encodeURIComponent(e.sortOrder))),e},onRender:function(){g&&g.Hub.Queue(["Typeset",g.Hub,this.el])},className:"list-of-things",alreadyRendered:!1,emptyViewOptions:function(t){var n=this.model.get("query"),i=this.model.get("isTugboat"),r=this.model.get("error");return this.model.unset("error",{silent:!0}),e.isArray(n)?t.set({query:n[0],showTugboatMessage:i,suggestedQuery:v(this.model.get("currentQuery"))}):e.has("query",n)?t.set({query:n.query[0],showTugboatMessage:i,suggestedQuery:v(this.model.get("currentQuery"))}):r&&t.set("error",r),{model:t}},childViewContainer:".results-list",events:{"click .show-highlights":"toggleHighlights","click .show-abstract":"toggleAbstract","click .toggle-sidebars":"toggleShowSidebars","click #go-to-bottom":"goToBottom","click #backToTopBtn":"goToTop","click a.page-control":"changePageWithButton","keyup input.page-control":"tabOrEnterChangePageWithInput","change #per-page-select":"changePerPage"},toggleHighlights:function(t){var n=this.model.get("showHighlights");n=e.isBoolean(n)&&n?"closed":"open"===n?"closed":"open",this.model.set("showHighlights",n),this.model.get("highlightsLoaded")||(this.model.set("highlightsLoaded",!0),this.trigger("toggle-highlights","open"===n))},toggleAbstract:function(){"open"==this.model.get("showAbstract")?this.model.set("showAbstract","closed"):"closed"==this.model.get("showAbstract")&&(this.model.set("showAbstract","open"),f("send","event","interaction","abstracts-toggled-on"))},toggleShowSidebars:function(){var e=!this.model.get("showSidebars");this.model.set("showSidebars",e),f("send","event","interaction","on")},goToBottom:function(){$(document.documentElement).animate({scrollTop:this.$el.outerHeight()},"fast")},goToTop:function(){$(document.documentElement).animate({scrollTop:0},"fast")},modelEvents:{change:"render","change:showHighlights":"toggleChildrenHighlights","change:showAbstract":"toggleChildrenAbstracts"},collectionEvents:{reset:"onResetCollection"},template:a,onResetCollection:function(){this.model.set("highlightsLoaded",!1),this.model.trigger("change:showAbstract")},toggleChildrenHighlights:function(){var e=this.model.get("showHighlights");this.collection.invoke("set","showHighlights","open"===e)},toggleChildrenAbstracts:function(){var e=this.model.get("showAbstract");this.collection.invoke("set","showAbstract","open"===e)},changePageWithButton:function(e){var t=$(e.currentTarget);if(!t.parent().hasClass("disabled")){var n=t.hasClass("next-page")?1:-1,i=this.model.get("page")+n;return this.trigger("pagination:select",i),this.resultsWidget&&f("send","event","interaction","results-list-pagination",i),!1}},tabOrEnterChangePageWithInput:function(e){var t=parseInt($(e.target).val()-1);13!=e.keyCode&&9!=e.keyCode||this.trigger("pagination:select",t),this.resultsWidget&&f("send","event","interaction","results-list-pagination",t)},changePerPage:function(e){var t=parseInt(e.currentTarget?e.currentTarget.value:25);return t!==this.model.get("perPage")&&this.trigger("pagination:changePerPage",t),!1}})}),define("js/widgets/list_of_things/widget",["marionette","backbone","utils","js/components/api_request","js/components/api_query","js/components/api_feedback","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","hbs!js/widgets/list_of_things/templates/results-container-template","js/mixins/add_stable_index_to_collection","./model","./paginated_view"],function(e,t,n,i,r,s,o,a,c,u,l,d){var h=o.extend({initialize:function(e){var t=this;e=e||{},_.defaults(e,_.pick(this,["view","collection","pagination","model","description","childView"])),this.pagination={pagination:!0,perPage:25,numFound:void 0,currentQuery:void 0,start:0,pageData:void 0,focusedIndex:-1},e.collection=e.collection||new l,e.view||(e.view=new d({collection:e.collection,model:e.model,childView:e.childView})),e.view.model.set(this.pagination,{silent:!0}),e.view.model.set({sortOrder:e.sortOrder,removeSelf:e.removeSelf,queryOperator:e.queryOperator,description:e.description},{silent:!0}),_.extend(this,{model:e.view.model,view:e.view}),this.hiddenCollection=new l,this.listenTo(this.hiddenCollection,"all",this.onAllInternalEvents),this.listenTo(this.view,"all",this.onAllInternalEvents),this.on("all",this.onAllInternalEvents),this.model.on("change:page",function(){t.model.set("focusedIndex",-1,{silent:!0})}),this.changePage=_.debounce(this.changePage.bind(this),500),o.prototype.initialize.call(this,e)},activate:function(e){var t=this;this.setBeeHive(e),_.bindAll(this,["updatePaginationPreferences"]);var n=this.getPubSub();if(this.getBeeHive().getObject("User")&&this.getBeeHive().getObject("User").getLocalStorage){var i=this.getBeeHive().getObject("User").getLocalStorage().perPage;i&&(this.pagination.perPage=i,this.model.set(this.pagination))}n.subscribe(n.INVITING_REQUEST,function(){t.updateState(t.STATES.LOADING)}),this.activateWidget(),this.attachGeneralHandler(this.onApiFeedback),n.subscribe(n.USER_ANNOUNCEMENT,this.updatePaginationPreferences),n.subscribe(n.CUSTOM_EVENT,function(e){"hotkey/next"===e?t.changePage(1):"hotkey/prev"===e?t.changePage(-1):"hotkey/item-next"===e?t.changeItemFocus(1):"hotkey/item-prev"===e?t.changeItemFocus(-1):"hotkey/item-select"===e&&t.selectItem()})},selectItem:function(){var e=this.model.get("focusedIndex");if(e>=0){var t=this.view.children.findByIndex(e);t&&t.toggleSelect&&t.toggleSelect()}},changeItemFocus:function(e){var t=this.view.children.length,n=this.model.get("focusedIndex");n<=0&&-1===e?n=t-1:n===t-1&&1===e?n=0:n+=e,this.model.set("focusedIndex",n,{silent:!0});var i=this.view.children.findByIndex(n);i&&i.el&&$(">",i.el).focus()},changePage:function(e){this.updatePagination({page:(this.model.get("page")||0)+e})},onApiFeedback:function(e){e.error&&(this.view.model.set("error",e.error),this.updateState(this.STATES.ERRORED))},updatePaginationPreferences:function(e,t){"user_info_change"==e&&t.perPage&&t.perPage!==this.pagination.perPage&&this.updatePagination({perPage:t.perPage})},_getCurrentQueryString:function(e){var t="",n=e||this.getBeeHive().getObject("AppStorage").getCurrentQuery();if(!_.isUndefined(n)&&(t=n.getApiQuery().get("q"),_.isEmpty(t)||t[0].indexOf("simbid")>-1))try{t=[n.get("responseHeader.params.__original_query")]}catch(e){t=""}return t},processResponse:function(e){var t=this.extractDocs(e),n=e.has("response.numFound")?e.get("response.numFound"):this.hiddenCollection.length,i=e.has("response.start")?e.get("response.start"):this.model.get("start"),r=this.getPaginationInfo(e,t),s=this;if((t=this.processDocs(e,t,r))&&t.length){var o=$("<textarea/>"),a=_.map(t,function(e){return e.highlights&&(e.highlights=e.highlights.map(function(e){return o.html(e).text()})),_.extend(e,{showHighlights:void 0!==e.highlights,showCheckbox:!!s.model.get("showCheckboxes")})});this.hiddenCollection.add(a,{merge:!0}),0===this.hiddenCollection.filter(function(e){return e.get("highlights")}).length&&this.view.model.set("showHighlights","closed"),r.showRange&&(this.model.set(r),this.hiddenCollection.showRange(r.showRange[0],r.showRange[1])),this.view.collection.reset(this.hiddenCollection.getVisibleModels()),this.view.model.set("query",!1)}else{var c=e.get("responseHeader.params");this.view.model.set({isTugboat:!!c.__tb,query:this._getCurrentQueryString(e),currentQuery:e.getApiQuery()})}this.trigger("page-manager-event","widget-ready",{numFound:n});var u=this.model.has("perPage")&&this.model.get("perPage")===this.collection.length,l=this.model.has("pageData")&&!1===this.model.get("pageData").nextPossible;0===this.view.collection.length||u||l&&n<=i+t.length?(this.model.set("loading",!1),this.updateState(this.STATES.IDLE)):this.model.set("loading",!0)},extractDocs:function(e){var t=e.get("response.docs");return t=_.map(t,function(e){return e.all_ids=e.identifier,e.bibcode&&(e.original_identifier=e.identifier,e.identifier=e.bibcode?e.bibcode:e.identifier),e})},getPaginationInfo:function(e,t){var n=e.getApiQuery(),i=e.get("response.numFound")||0,r=this.model.get("perPage")||(n.has("rows")?n.get("rows")[0]:10),s=this.model.get("start")||0,o=u.getPageVal(s,r),a=[o*r,(o+1)*r-1];return n.has("__fetch_missing")?{start:s,showRange:a}:{numFound:i,perPage:r,start:s,page:o,showRange:a,pageData:this._getPaginationData(o,r,i),currentQuery:n}},_getPaginationData:function(e,t,n){return{perPage:t,totalPages:Math.ceil(n/t),currentPage:e+1,previousPossible:e>0,nextPossible:(e+1)*t<n}},processDocs:function(e,t,n){if(!e.has("response"))return[];var i=e.get("response").start||n.start||0;return t=u.addPaginationToDocs(t,i)},defaultQueryArguments:{fl:"id",start:0},updateLocalStorage:function(e){e.hasOwnProperty("perPage")&&_.contains([25,50,100,200,500],e.perPage)&&(this.getBeeHive().getObject("User").setLocalStorage({perPage:e.perPage}),console.log("set user's page preferences in localStorage: "+e.perPage))},updatePagination:function(e){var i=_.defaults({},e,{silentIndexUpdate:!1,updateHash:!0}),s=this.model.get("pageData"),o=this.model.get("start"),a={},c=(this.model.get("currentQuery")||new r).get("p_");if(_.isNumber(i.numFound)&&(a.numFound=i.numFound),_.isNumber(i.perPage)&&(a.perPage=i.perPage,this.pagination.perPage=i.perPage),_.isArray(c)&&_.isUndefined(i.page))try{i.page=parseInt(c[0])}catch(e){}if(_.isNumber(i.page)){var l=s&&s.totalPages-1||1;i.page>l?a.page=l:i.page<0?a.page=0:a.page=i.page}else if(_.isEmpty(this.collection.models)&&_.isNumber(o)&&_.isNumber(i.perPage))a.page=u.getPageVal(o,i.perPage);else if(_.isNumber(o)&&_.isNumber(i.perPage)){var d=this.collection.models[0].get("resultsIndex");a.page=u.getPageVal(d,i.perPage)}var h=_.isNumber(a.page)?a.page:this.model.get("page"),p=_.isNumber(a.perPage)?a.perPage:this.model.get("perPage"),f=_.isNumber(a.numFound)?a.numFound:this.model.get("numFound"),g=t.history&&t.history.getFragment&&t.history.getFragment();""+h!==(_.isArray(c)&&c[0])&&i.updateHash&&/search/.test(g)&&n.qs("p_",g)!==""+h&&t.history&&t.history.navigate&&t.history.navigate(n.updateHash("p_",h,g)),a.start=this.getPageStart(h,p,f),a.pageData=this._getPaginationData(h,p,f),a.showRange=[h*p,h*p+p-1],this.model.set(a),this.view.render(),this.hiddenCollection.showRange(a.showRange[0],a.showRange[1],{silent:!!i.silentIndexUpdate}),this.collection.reset(this.hiddenCollection.getVisibleModels()),$(document.documentElement).scrollTop(0)},onAllInternalEvents:function(e,t,n){try{var i=this.getPubSub()}catch(e){}if("pagination:changePerPage"===e)this.updateLocalStorage({perPage:t}),this.updatePagination({page:0,perPage:t}),this.view.model.set("showHighlights","closed");else{if("pagination:select"===e)return this.view.model.set("showHighlights","closed"),this.updatePagination({page:t});"show:missing"===e?_.each(t,function(e){var t=this.model.get("numFound"),n=e.start,i=this.model.get("perPage"),r=this.model.get("start");if(!(!t||n>=t||n!==r&&r>0)){var s=this.model.get("currentQuery").clone();s.unset("hl"),s.unset("hl.fl"),s.unset("hl.maxAnalyzedChars"),s.unset("hl.requireFieldMatch"),s.unset("hl.usePhraseHighlighter"),s.set("__fetch_missing","true"),s.set("start",n),s.set("rows",i-n<=0?i:i-n);var o=this.composeRequest(s);this.executeRequest(o)}},this):"childview:toggleSelect"==e?i.publish(i.PAPER_SELECTION,n.data.identifier):"toggle-highlights"===e&&this.loadHighlights()}},fetchHighlights:function(e){var t=e.start,n=e.rows,i=this.model.get("currentQuery").clone();i.set({hl:"true","hl.fl":"title,abstract,body,ack,*","hl.maxAnalyzedChars":"150000","hl.requireFieldMatch":"true","hl.usePhraseHighlighter":"true",start:t,rows:n});var r=this.composeRequest(i);this.executeRequest(r)},loadHighlights:function(){var e=this.hiddenCollection,t=e.currentEndIndex,n=e.currentStartIndex,i=t-n+1;i>25?(this.fetchHighlights({start:n,rows:25}),this.fetchHighlights({start:n+25,rows:i-25})):this.fetchHighlights({start:n,rows:i})},executeRequest:function(e){this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,e)},reset:function(){this.collection.reset(),this.hiddenCollection.reset(),this.model.set(_.defaults({currentQuery:this.getCurrentQuery(),query:!1},this.pagination,this.model.defaults()))}});return _.extend(h.prototype,u),h}),define("hbs!js/modules/orcid/widget/templates/container-template",["hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e){var t=e.template({1:function(e,t,n,i){var r;return" (<b>"+this.escapeExpression("function"==typeof(r=null!=(r=t.totalPapers||(null!=e?e.totalPapers:e))?r:t.helperMissing)?r.call(e,{name:"totalPapers",hash:{},data:i}):r)+"</b>) "},3:function(e,t,n,i){return'            <p><i class="icon-loading" aria-hidden="true"></i> Loading ORCID data...</p>\n'},5:function(e,t,n,i){var r,s;return'        <div style="margin-bottom: 10px;">\n            <span style="width: 40%;">ORCID Username:&nbsp;<b>'+this.escapeExpression("function"==typeof(s=null!=(s=t.orcidUserName||(null!=e?e.orcidUserName:e))?s:t.helperMissing)?s.call(e,{name:"orcidUserName",hash:{},data:i}):s)+"</b></span>\n            &nbsp;&nbsp;&nbsp;\n            <span>ORCID ID:&nbsp;<b>"+this.escapeExpression("function"==typeof(s=null!=(s=t.orcidID||(null!=e?e.orcidID:e))?s:t.helperMissing)?s.call(e,{name:"orcidID",hash:{},data:i}):s)+'</b></span>\n        </div>\n\n         <p><i class="fa fa-info-circle" aria-hidden="true"></i> To share this list of your ORCID papers:\n                    <ul>\n                      <li>\n                          Search for your ORCID ID in ADS (orcid:'+this.escapeExpression("function"==typeof(s=null!=(s=t.orcidID||(null!=e?e.orcidID:e))?s:t.helperMissing)?s.call(e,{name:"orcidID",hash:{},data:i}):s)+')\n                      </li>\n                    <li>\n                        You can then share the url of your results:<br>  <a href="https://ui.adsabs.harvard.edu/search/q=orcid%3A'+this.escapeExpression("function"==typeof(s=null!=(s=t.orcidID||(null!=e?e.orcidID:e))?s:t.helperMissing)?s.call(e,{name:"orcidID",hash:{},data:i}):s)+'&sort=date+desc">https://ui.adsabs.harvard.edu/search/q=orcid%3A'+this.escapeExpression("function"==typeof(s=null!=(s=t.orcidID||(null!=e?e.orcidID:e))?s:t.helperMissing)?s.call(e,{name:"orcidID",hash:{},data:i}):s)+'&sort=date+desc</a>\n                    </li>\n                    <li>\n                        Please note that claims take up to 24 hours to be indexed in ADS.\n                    </li>\n\n                    </ul>\n          </p>\n          <p> <i class="fa fa-info-circle" aria-hidden="true"></i>\n               To claim papers in ORCID and add to this list <br>\n              <div style="padding-left:5%;">\n'+(null!=(r=t.if.call(e,null!=e?e.orcidUserName:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?r:"")+'            </div>\n\n           </p>\n        <br>\n        <p> <a href="#orcid-instructions"> <i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i> Learn more about using ORCID with ADS</a></p>\n        <br>\n\n'},6:function(e,t,n,i){return'                <button class="btn btn-sm btn-default search-author-name"><i class="fa fa-search" aria-hidden="true"></i> click here to search your name in ADS</button>\n'},8:function(e,t,n,i){return"                search your name in ADS</button>\n"},10:function(e,t,n,i){var r;return null!=(r=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,indent:"            ",helpers:t,partials:n}))?r:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'\n<div class="s-results-control-row-container">\n\n\n    <div class="col-sm-10 col-sm-offset-1" style="padding:0 9%" >\n        <h2>\n            My ORCID Papers '+(null!=(r=t.if.call(e,null!=e?e.totalPapers:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"\n        </h2>\n        \x3c!--loading user data--\x3e\n"+(null!=(r=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.program(5,i,0),data:i}))?r:"")+'\n    </div>\n</div>\n<div class="row s-darker-background" style="margin-right:0;">\n    <div class="col-sm-10 s-main-content-container" style="margin-top:20px;padding-top: 20px; float:none">\n        <div class="row">\n            <ul class="col-sm-12 results-list  s-results-list list-unstyled s-display-block" aria-label="list of results">\n            </ul>\n        </div>\n'+(null!=(r=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+"\n\n    </div>\n</div>\n"},usePartial:!0,useData:!0});return e.registerPartial("js/modules/orcid/widget/templates/container-template",t),t}),define("hbs!js/modules/orcid/widget/templates/empty-template",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="col-sm-10 col-sm-offset-1">\n    No papers retrieved from ORCID\n</div>'},useData:!0});return e.registerPartial("js/modules/orcid/widget/templates/empty-template",t),t}),define("js/modules/orcid/widget/widget",["underscore","js/widgets/list_of_things/widget","js/widgets/base/base_widget","js/mixins/add_stable_index_to_collection","js/mixins/link_generator_mixin","js/mixins/formatter","hbs!js/modules/orcid/widget/templates/container-template","js/mixins/papers_utils","js/components/api_query","js/components/api_feedback","js/components/json_response","hbs!js/modules/orcid/widget/templates/empty-template","js/modules/orcid/extension","js/modules/orcid/bio"],function(e,t,n,i,r,s,o,a,c,u,l,d,h,p){return h(t.extend({initialize:function(n){t.prototype.initialize.apply(this,arguments);var i=this;this.view.getEmptyView=function(){return Marionette.ItemView.extend({template:d})},e.extend(this.view.events,{"click .search-author-name":function(){var e=this,t=this.model.get("orcidLastName")+", "+this.model.get("orcidFirstName"),n=i.getBeeHive().getService("OrcidApi"),r='author:"'+t+'"';n.getADSUserData().done(function(e){e&&e.nameVariations&&(e.nameVariations.push(t),r='author:("'+e.nameVariations.join('" OR "')+'")')}).always(function(){e.trigger("search-author-name",r)})}}),this.view.delegateEvents(),this.view.template=o,this.view.model.set({mainResults:!0},{silent:!0}),this.listenTo(this.collection,"reset",this.checkDetails),this.listenTo(this.view,"search-author-name",function(e){var t=this.getPubSub(),n=new c({q:e,sort:"date desc"});t.publish(t.NAVIGATE,"search-page",{q:n})})},orcidWidget:!0,activate:function(n){t.prototype.activate.apply(this,[].slice.apply(arguments)),e.bindAll(this,"processResponse"),this.on("orcidAction:delete",function(e){this.collection.remove(e)})},mergeDuplicateRecords:function(t){var n,i,r={},s=0;if(t?e.each(t,function(e){e._dupIdx=s++,(n=e.identifier)&&(n=n.toLowerCase(),r[n]?(r[n].push(e),i=!0):r[n]=[e])}):this.hiddenCollection.each(function(e){n=e.get("identifier"),e.attributes._dupIdx=s++,n&&(n=n.toLowerCase(),r[n]?(r[n].push(e.attributes),i=!0):r[n]=[e.attributes])}),i){var o={},a=[];e.each(r,function(t,n){if(t.length>1){var i=0;e.each(t,function(e,t){e.source_name&&"nasa ads"==e.source_name.toLowerCase()&&(i=t)});var r=t[i];t.splice(i,1),a.push(r._dupIdx),r.source_name=r.source_name||"",e.each(t,function(e){e.source_name&&(r.source_name+="; "+e.source_name),o[e._dupIdx]=!0})}});var c=function(t){var n=0;e.each(t,function(e){e.resultsIndex=n++,e.indexToShow=n})};if(t)(o=e.keys(o)).sort(function(e,t){return t-e}),e.each(o,function(e){t.splice(e,1)}),c(t);else{e.each(a,function(e){var t=this.hiddenCollection.models[e];t.set("source_name",t.attributes.source_name,{silent:!0})});var u=[];this.hiddenCollection.each(function(e){o[e.attributes._dupIdx]||u.push(e.attributes)}),c(u),this.hiddenCollection.reset(u),this.updatePagination({numFound:u.length})}}},processDocs:function(t,n){n=i.addPaginationToDocs(n,0);return e.each(n,function(e,t){e.isOrcidWidget=!0,n[t]=a.prepareDocForViewing(e)}),n},getPaginationInfo:function(e,t){var n=t.length,r=this.model.get("perPage")||10,s=e.getApiQuery()||new c({orcid:"author X"}),o=i.getPageVal(0,r);return{numFound:n,perPage:r,start:0,page:o,showRange:[o*r,(o+1)*r-1],pageData:this._getPaginationData(o,r,n),currentQuery:s}},onShow:function(){var e=this.getBeeHive().getService("OrcidApi"),t=this;if(e){if(!e.hasAccess())return;t.model.set("loading",!0);var n=e.getUserBio(),i=e.getUserProfile();$.when(n,i).done(function(e,n){var i=new l(n.toADSFormat()),r=new l(e.toADSFormat()).get("responseHeader.params"),s=e.getFirstName(),o=e.getLastName();t.model.set({orcidID:e.getOrcid(),orcidUserName:s+" "+o,orcidFirstName:s,orcidLastName:o,totalPapers:i.get("response.numFound")||0,loading:!1}),i.setApiQuery(new c(r)),t.processResponse(i)}),i.fail(function(){t.model.set({loading:!1});var e=t.getPubSub();e.publish(e.ALERT,new u({title:"Something Went Wrong",msg:["We were unable to retrieve your profile from ORCiD","Please reload the page to try again","",'<button onclick="location.reload()" class="btn btn-primary" role="button">Reload</button>'].join("<br/>"),modal:!0,type:"warning"}))})}},update:function(t){if(t=t||{},this.hiddenCollection&&this.view.collection){this._originalCollection||(this._originalCollection=new this.hiddenCollection.constructor(this.hiddenCollection.models));var n=this._originalCollection,i=["ads","both","others",null];if(e.has(t,"filterBy")){var r=t.filterBy;for(var s in e.isArray(r)||(r=[r]),r)if(!e.contains(i,r[s]))throw Error("Unknown value for the filter: "+r[s]);n=new this.hiddenCollection.constructor(n.filter(function(t){if(t.attributes.orcid&&e.contains(r,t.attributes.orcid.provenance))return!0}))}if(e.has(t,"sortBy")&&t.sortBy){var o=0;n=new this.hiddenCollection.constructor(e.map(n.sortBy(t.sortBy),function(e){return e.attributes.resultsIndex=o++,e}))}this.hiddenCollection.reset(n.models),this.updatePagination({})}}}))}),define("hbs!js/page_managers/templates/results-page-layout",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="results-page-layout" class="s-results-page-layout">\n  <div class="row s-stable-search-bar-height">\n    <div class="s-search-bar-full-width-container" role="search">\n      <div class="col-xs-0 col-sm-12 col-md-2 s-back-button-container">\n        <a href="/" class="back-button btn btn-sm btn-default">\n          <i class="fa fa-arrow-left" aria-hidden="true"></i> Start New\n          Search</a\n        >\n      </div>\n      <div\n        class="col-xs-12 col-sm-9 col-md-7 s-search-bar-row"\n        id="search-bar-row"\n        data-widget="SearchWidget"\n      ></div>\n    </div>\n  </div>\n  <div class="row s-message-control-row" id="message-control-row">\n    <span data-widget="AlertsWidgetx"></span>\n  </div>\n  <div class="row s-results-control-row" id="results-control-row"></div>\n  <div class="row">\n    <div class="col-xs-12 s-dynamic-page-body" id="dynamic-page-body" style="overflow: hidden">\n      <div class="max-width-wrapper">\n        <div>\n          <div\n            class="hidden-xs col-sm-3 col-md-2 s-left-column s-results-column"\n            id="results-left-column"\n          >\n            <h2 class="sr-only">Filters for the Current Search</h2>\n            <div class="left-col-container s-left-col-container">\n              <div data-widget="AuthorFacet" />\n              <div data-widget="DatabaseFacet" />\n              <div data-widget="RefereedFacet" />\n              <div data-widget="AffiliationFacet" />\n              <div data-widget="KeywordFacet" />\n              <div data-widget="BibstemFacet" />\n              <div data-widget="BibgroupFacet" />\n              <div data-widget="ObjectFacet" />\n              <div data-widget="NedObjectFacet" />\n              <div data-widget="DataFacet" />\n              <div data-widget="VizierFacet" />\n              <div data-widget="PubtypeFacet" />\n            </div>\n          </div>\n\n          <div\n            class="col-sm-9 col-md-7  s-results-middle-column s-results-column"\n            id="results-middle-column"\n          >\n            <div\n              class="main-content-container s-main-content-container"\n              id="main-content"\n              tabindex="-1"\n              role="main"\n              aria-label="container for search results and other main content"\n            >\n              <div data-widget="Results" />\n              <div data-widget="AuthorAffiliationTool" />\n              <div data-widget="ExportWidget" data-origin="results-page" />\n              <div data-widget="AuthorNetwork" />\n              <div data-widget="PaperNetwork" />\n              <div data-widget="Metrics" data-allow-redirect="true" />\n              <div data-widget="BubbleChart" />\n              <div data-widget="ConceptCloud" />\n              <div data-widget="CitationHelper" />\n            </div>\n          </div>\n          \n          <div id="results-right-column">\n            <div data-widget="QueryInfo" class="s-right-column col-sm-3" id="query-info-container"/>\n            <div\n              class="hidden-xs col-sm-3 col-md-3 results-right-column s-right-column s-results-column"\n            >\n              <h2 class="sr-only">\n                Additional Functionality (Information about your query, and more\n                search filters)\n              </h2>\n\n              <div data-widget="MyAdsFreeform" />\n              <div data-widget="OrcidSelector" />\n              <div data-widget="GraphTabs" />\n              <div data-widget="QueryDebugInfo" data-debug="true" />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},useData:!0});return e.registerPartial("js/page_managers/templates/results-page-layout",t),t}),define("hbs!js/page_managers/templates/results-control-row",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-results-control-row-container">\n    <div class="col-sm-6">\n        <div data-widget="BreadcrumbsWidget" class="s-display-inline-block"/>\n    </div>\n\n\n    <div class="col-xs-12 col-sm-6" style="padding-right:0; padding-left:0;">\n        <div class="s-results-action-buttons">\n            <div id="search-results-sort" class="col-xs-12 col-md-5 clearfix" style="margin-bottom:10px;">\n                <div data-widget="Sort" class="s-display-inline-block pull-right"/>\n            </div>\n            <div id="search-results-actions" class="col-xs-12 col-md-7">\n                <div><button id="results-actions-toggle" class="btn btn-primary-faded s-display-inline-block pull-right">\n                    <i class="fa fa-book" alt="open actions"></i> Actions\n                </button></div>\n                <div data-widget="VisualizationDropdown" class="s-display-inline-block pull-right"/>\n                <div data-widget="ExportDropdown" class="s-display-inline-block pull-right"/>\n            </div>\n        </div>\n    </div>\n\n</div>\n'},useData:!0});return e.registerPartial("js/page_managers/templates/results-control-row",t),t}),define("js/page_managers/three_column_view",["underscore","marionette","hbs!js/page_managers/templates/results-page-layout","hbs!js/page_managers/templates/results-control-row","js/widgets/base/base_widget"],function(e,t,n,i){var r=Backbone.Model.extend({defaults:function(){return{left:"open",right:"open",user_left:null,user_right:null}}});return t.ItemView.extend({initialize:function(e){e=e||{};this.widgets=e.widgets,this.model=new r},destroy:function(){t.ItemView.prototype.destroy.call(this,arguments)},template:n,modelEvents:{"change:left":"_updateColumnView","change:right":"_updateColumnView"},events:{"click .btn-expand":"onClickToggleColumns"},onRender:function(){this.$("#results-control-row").append(i()),this.displaySearchBar(this.options.displaySearchBar),this.displayControlRow(this.options.displayControlRow),this.displayLeftColumn(this.options.displayLeftColumn),this.displayRightColumn(this.options.displayRightColumn),this.displayMiddleColumn(this.options.displayMiddleColumn)},onShow:function(){this.displaySearchBar(!0)},displaySearchBar:function(e){$("#search-bar-row").toggle(void 0===e||e)},displayLeftColumn:function(e){this.$(".s-left-col-container").toggle(void 0===e||e)},displayControlRow:function(e){this.$("#results-control-row").toggle(void 0===e||e)},displayRightColumn:function(e){this.$(".s-left-col-container").toggle(void 0===e||e)},displayMiddleColumn:function(e){this.$(".s-left-col-container").toggle(void 0===e||e)},_returnBootstrapClasses:function(){var t=this.classList,n=[];return e.each(t,function(e){-1!==e.indexOf("col-")&&n.push(e)}),n.join(" ")},showCols:function(e){e=e||{left:!0,right:!0,force:!1};for(var t=["left","right"],n=0;n<t.length;n++){var i=t[n];if(i in e)null===this.model.get("user_"+i)?this.model.set(i,e[i]?"open":"closed"):e.force&&(this.model.set(i,e[i]?"open":"closed"),this.model.set("user_"+i,null))}},_updateColumnView:function(){var t,n,i,r,s;t=this.model.get("left"),n=this.model.get("right"),i=this.$("#results-left-column"),r=this.$("#results-right-column"),s=this.$("#results-middle-column"),e.each([["left",t,i],["right",n,r]],function(e){if("open"==e[1]){e[2].removeClass("hidden");var t=e[2];setTimeout(function(){t.children().show(0)},200)}else e[2].addClass("hidden")}),"open"===t&&"open"===n?s.removeClass(this._returnBootstrapClasses).addClass("col-sm-9 col-md-7"):"closed"===t&&"closed"===n&&s.removeClass(this._returnBootstrapClasses).addClass("col-md-12 col-sm-12")}})}),define("js/page_managers/view_mixin",["underscore","jquery"],function(e,t){return{getWidgetsFromTemplate:function(n,i){var r={},s=t(n).find("[data-widget]");return s.length>0&&e.each(s,function(e){var t=e.getAttribute("data-widget"),n=e.getAttribute("data-debug");n&&"true"==n&&!n||(r[t]=e)}),r}}}),define("js/page_managers/controller",["jquery","underscore","marionette","hbs!js/page_managers/templates/results-page-layout","hbs!js/page_managers/templates/results-control-row","js/widgets/base/base_widget","./three_column_view","./view_mixin","js/mixins/dependon"],function(e,t,n,i,r,s,o,a,c){var u=["ShowAbstract"],l=s.extend({initialize:function(e){this.widgets={},this.widgetDoms={},this.initialized=!1,this.widgetId=null,this.assembled=!1,t.extend(this,t.pick(e,["debug","widgetId"]))},activate:function(e){this.setBeeHive(e),this.debug=e.getDebug(),this.view=this.createView({debug:this.debug,widgets:this.widgets})},setWidgetId:function(e){this.widgetId=e},createView:function(e){return new o(e)},assemble:function(n){var i=e.Deferred();if(this.assembled)return i.resolve(this.view.el),i.promise();this.assembled=!0,this.view.render();var r,s=this;t.extend(s.widgetDoms,s.getWidgetsFromTemplate(s.view.$el));var o=[],a={};return t.each(s.widgetDoms,function(i,c){if(!n.hasWidget(c))return delete s.widgetDoms[c],void delete s.widgets[c];var l=n._getWidget(c).done(function(o){if(s.persistentWidgets&&s.persistentWidgets.indexOf(c)>-1&&n.incrRefCount("widget",c),o){var l=function(){t.assign(o,{componentParams:e(i).data()});var n=e('*[data-widget="'+c+'"]'),s=n.length>0?n.html().trim():"";window.__PRERENDERED&&o.view&&u.indexOf(c)>-1&&n.length>0&&s.length>0?("function"==typeof o.view.handlePrerenderedContent&&o.view.handlePrerenderedContent(s,n),window.__PRERENDERED=!1):(r=o.getEl?o.getEl():o.render().el,a[c]=r)};o.assemble?o.assemble(n).done(l):l(),s.widgets[c]=o}});o.push(l)},this),e.when.apply(e,o).then(function(){t.forEach(a,function(t,n){e(s.widgetDoms[n]).html(t)}),i.resolve()}).fail(function(){console.error("Generic error - we were not successul in assembling page"),arguments.length&&console.error(arguments),i.reject()}),i.promise()},disAssemble:function(n){t.each(t.keys(this.widgets),function(t){var i=this.widgets[t];i.disAssemble&&i.disAssemble(),n.returnWidget(t),n._isBarbarianAlive("widget:"+t)?e(this.widgetDoms[t]).detach():e(this.widgetDoms[t]).empty(),delete this.widgets[t],delete this.widgetDoms[t]},this),this.assembled=!1},show:function(e){var n=this;if(e){this.hideAll();var i=[].slice.apply(arguments);t.each(i,function(e){if(n.widgets[e]){var i=n.widgets[e],r=n.view.$el.find('[data-widget="'+e+'"]');if(r.length){var s=r.data("debug");if(void 0!==s&&s&&!n.debug)return;r.append(i.el?i.el:i.view.el),t.assign(i,{componentParams:r.data()});try{n.widgets[e].triggerMethod("show")}catch(t){console.error("Error when displaying widget: "+e,t.message,t.stack)}}else console.warn("Cannot insert widget: "+e+' (no selector [data-widget="'+e+'"])')}else n.debug&&console.error("Cannot show widget: "+e+"(because, frankly... there is no such widget there!)")})}else this.showAll();return this.triggerMethod("show"),this.view},hideAll:function(){return t.each(this.widgets,function(e){e.noDetach||("detach"in e&&t.isFunction(e.detach)?e.detach():e.view&&e.view.$el?e.view.$el.detach():e.$el&&e.$el.detach())}),this.view},showAll:function(){var e=this;return t.each(t.keys(e.widgets),function(n){var i=e.widgets[n],r=e.view.$el.find('[data-widget="'+n+'"]');r.append(i.el?i.el:i.view.el),t.assign(i,{componentParams:r.data()}),e.widgets[n].triggerMethod("show")}),this.view},broadcast:function(){var e=arguments;t.each(this.widgets,function(t,n){t.trigger.apply(t,e)},this)}});return t.extend(l.prototype,a,c.BeeHive,{getPubSub:function(){return this._ps&&this.hasPubSub()?this._ps:(this._ps=this.getBeeHive().getHardenedInstance().getService("PubSub"),this._ps)}}),l}),define("hbs!js/page_managers/templates/aria-announcement",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'<a\n  href="#main-content"\n  id="skip-to-main-content"\n  class="sr-only sr-only-focusable"\n  data-dont-handle="true"\n  >Skip to main content</a\n>\n'},3:function(e,t,n,i){return'\n<a\n  href="#main-content"\n  id="skip-to-main-content"\n  class="sr-only sr-only-focusable"\n  data-dont-handle="true"\n  >Skip to main content</a\n>\n'},5:function(e,t,n,i){return" home page "},7:function(e,t,n,i){return" search results page "},9:function(e,t,n,i){return" article abstract page "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"SearchPage",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+" "+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"DetailsPage",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+'\n<div id="aria-announcement-container" role="status">\n  Now on '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"LandingPage",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+" "+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"SearchPage",{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+" "+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"DetailsPage",{name:"compare",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+"\n</div>\n"},useData:!0});return e.registerPartial("js/page_managers/templates/aria-announcement",t),t}),define("hbs!js/page_managers/templates/master-page-manager",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="navbar-container">\n  <div data-widget="NavbarWidget"/>\n</div>\n\n<div id="alerts-container">\n  <div data-widget="AlertsWidget"/>\n</div>\n\n<div id="content-container">\n  <div class="dynamic-container s-dynamic-container"></div>\n</div>\n\n<div id="footer-container">\n  <div data-widget="FooterWidget"/>\n</div>\n'},useData:!0});return e.registerPartial("js/page_managers/templates/master-page-manager",t),t}),define("js/page_managers/master",["js/widgets/base/base_widget","js/components/generic_module","js/page_managers/controller","hbs!js/page_managers/templates/aria-announcement","hbs!js/page_managers/templates/master-page-manager","marionette","js/mixins/dependon"],function(e,t,n,i,r,s,o){var a=Backbone.Model.extend({defaults:function(){return{id:void 0,isSelected:!1,object:void 0,options:void 0}}}),c=Backbone.Collection.extend({model:a,selectOne:function(e){var t=null;this.each(function(n){n.id==e?t=n:n.set("isSelected",!1,{silent:!0})}),t.set("isSelected",!0)}}),u=Backbone.Model.extend({defaults:function(){return{name:void 0,numCalled:0,numAttached:0,ariaAnnouncement:void 0}}}),l=s.ItemView.extend({className:"s-master-page-manager",constructor:function(e){(e=e||{}).collection||(e.collection=new c),e.model||(e.model=new u),e.template=r,s.ItemView.prototype.constructor.call(this,e)},changeManager:function(){var e=this.collection.findWhere({isSelected:!0}),t=e.attributes.object.show.apply(e.attributes.object,e.attributes.options);this.$(".dynamic-container").children().detach(),this.$(".dynamic-container").append(t.$el),e.attributes.numAttach+=1,$(document.documentElement).scrollTop(0),$(".s-search-bar-full-width-container").removeClass("s-search-bar-motion"),$(".s-quick-add").removeClass("hidden")},changeWithinManager:function(){var e=this.collection.findWhere({isSelected:!0});e.attributes.object.show.apply(e.attributes.object,e.attributes.options),e.attributes.numAttach+=1}}),d=n.extend({initialize:function(e){e=e||{},this.view=new l(e),this.collection=this.view.collection,this.model=this.view.model,n.prototype.initialize.apply(this,arguments)},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.ARIA_ANNOUNCEMENT,this.handleAriaAnnouncement)},assemble:function(e){return this.setApp(e),n.prototype.assemble.call(this,e)},show:function(e,t,n){var i=$.Deferred(),r=this.getApp();this.collection.find({id:e})||this.collection.add({id:e});var s=this.collection.find({id:e}),o=this,a=function(r){s.get("isSelected")?(s.set({options:t,object:r}),o.view.changeWithinManager()):(s.set({options:t,object:r}),o.collection.selectOne(e),o.view.changeManager()),n&&r.provideContext&&r.provideContext.call(r,n);var a=o.currentChild;if(o.currentChild=e,a&&a!=e){var c=o.collection.find({id:a});c&&c.get("object")&&c.set("numDetach",c.get("numDetach")+1)}o.getPubSub().publish(o.getPubSub().ARIA_ANNOUNCEMENT,e),i.resolve()};return s.get("object")?(a(s.get("object")),i.promise()):(r._getWidget(e).then(function(t){s.set("object",t),t||console.error("unable to find page manager: "+e),t.assemble?t.assemble(r).then(function(){a(t)}):(console.error("eeeek, "+e+" has no assemble() method!"),i.reject())}),i.promise())},getCurrentActiveChild:function(){return this.collection.get(this.currentChild).get("object")},disAssemble:function(){_.each(this.collection.models,function(e){if(e.attributes.isSelected){var t=e.get("object");if(t.disAssemble)t.disAssemble(this.getApp());else{if(!t.destroy)throw new Error("Contract breach, no way to get ridd of the widget/page manager");t.destroy()}}e.set({isSelected:!1,object:null}),this.assembled=!1},this)},handleAriaAnnouncement:function(e){$("a#skip-to-main-content").remove(),$("div#aria-announcement-container").remove(),$("#app-container").before(i({page:e}))}});return _.extend(d.prototype,o.App),d}),define("js/page_managers/one_column_view",["marionette","js/widgets/base/base_widget"],function(e){return e.ItemView.extend({initialize:function(e){e=e||{};this.widgets=e.widgets},onRender:function(){}})}),define("js/page_managers/toc_widget",["backbone","marionette"],function(e,t){var n=e.Model.extend({defaults:function(){var e;return _defineProperty(e={id:void 0,path:void 0,title:void 0,showCount:!1,category:void 0,isActive:!1,isSelected:!1,numFound:0},"showCount",!0),_defineProperty(e,"alwaysThere",!1),e}}),i=e.Collection.extend({model:n,initialize:function(){this.on("change:isSelected",function(e){e.get("isSelected")&&this.trigger("widget-selected",e)})},selectOne:function(e){var t=null;this.each(function(n){n.id==e?t=n:n.set("isSelected",!1,{silent:!0})}),(t=t||this.first()).set("isSelected",!0)},comparator:function(e){return e.get("order")}}),r=e.Model.extend({defaults:function(){return{bibcode:void 0,query:void 0,path:void 0,idAttribute:void 0}}});return t.ItemView.extend({initialize:function(e){e=e||{},this.collection=e.collection||new i,this.model=e.model||new r,this.on("page-manager-message",this.onPageManagerMessage),this.listenTo(this.collection,"widget-selected",function(e){var t=e.get("id").split("__");this.model.set({path:e.get("path"),idAttribute:t[0],subView:t.length>1?t[1]:void 0}),this.triggerSelection()}),e.template||(this.template=function(){return""})},noDetach:!0,serializeData:function(){var e,t=this.model.toJSON(),n=this.collection.toJSON();return _.find(n,function(e){return void 0!==e.category})?(e=_.groupBy(this.collection.toJSON(),function(e){return e.category}),t=_.extend(t,e)):t=_.extend(t,{tabs:n}),t},events:{"click a":"navigateToPage"},navigateToPage:function(e){var t=$(e.currentTarget),n=t.attr("data-widget-id"),i={idAttribute:n};return!t.find("div").hasClass("s-nav-inactive")&&(n!==this.$(".s-nav-selected").attr("data-widget-id")&&(i.href=t.attr("href"),this.collection.selectOne(n),this.$el.parent(".nav-container").removeClass("show"),$("button.toggle-menu").html(' <i class="fa fa-bars" aria-hidden="true"></i> Show Menu')),!1)},modelEvents:{"change:bibcode":"resetActiveStates",change:"render"},collectionEvents:{add:"render","change:isActive":"render","change:isSelected":"render","change:numFound":"render"},resetActiveStates:function(){var e=this.model.get("path");this.collection.each(function(t){t.set({isSelected:e===t.get("path"),isActive:!0,numFound:0})}),this.triggerSelection()},triggerSelection:function(){if(0===this.collection.where({isSelected:!0}).length)return this.collection.selectOne("ShowAbstract");var e=this.model.get("path")||"abstract",t=encodeURIComponent(this.model.get("bibcode")),n={idAttribute:this.model.get("idAttribute")||"showAbstract",subView:this.model.get("subView")||"",href:"abs/"+(t||"")+"/"+e,bibcode:this.model.get("bibcode")};this.trigger("page-manager-event","widget-selected",n)},selectDefaultNavItem:function(){var e=t.getOption(this,"navConfig"),n=e[0];_.each(e,function(e,t){if(e.isSelected)return n=t,!1}),this.collection.selectOne(n)},onPageManagerMessage:function(e,n){if("new-widget"==e){var i=arguments[1],r=t.getOption(this,"navConfig"),s=r[i];if(s){var o=_.extend(_.clone(s),{id:i});this.collection.add(o)}else{var a=_.pick(r,function(e,t){return t.split("__")&&t.split("__")[0]==i});_.each(a,function(e,t){var n=_.extend(_.clone(e),{id:t});this.collection.add(n)},this)}}else if("widget-ready"==e){if(n.noDocs)return this.selectDefaultNavItem();var c=this.collection.get(n.widgetId);_.defaults(n,{isActive:!!n.numFound}),c&&c.set(_.pick(n,c.keys())),n.shouldReset&&(c&&c.get("isSelected")&&this.selectDefaultNavItem(),c&&c.set("isActive",!1))}else"broadcast-payload"===e&&this.model.set("bibcode",n.bibcode)}})}),define("js/page_managers/toc_controller",["underscore","marionette","./controller","./toc_widget","analytics"],function(e,t,n,i,r){return n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments),window.__BUMBLEBEE_TESTING_MODE__||(this.onWidgetSelected=e.debounce(e.bind(this.onWidgetSelected,this),100))},createView:function(t){return this.pageConfig?new this.pageConfig.view(e.extend(t,{template:this.pageConfig.template})):n.prototype.createView.call(this,t)},assemble:function(r){var s=$.Deferred();if(!this.navConfig)return s.reject(new Error("TOC widget is being assembled without navigation configuration (navConfig)")),s.promise();if(this.assembled)return s.resolve(),s.promise();var o=this;return n.prototype.assemble.apply(this,arguments).done(function(){var n=t.getOption(o,"TOCTemplate");o.TOCEvents?o.widgets.tocWidget=new i({template:n,events:t.getOption(o,"TOCEvents"),navConfig:t.getOption(o,"navConfig")}):o.widgets.tocWidget=new i({template:n,navConfig:t.getOption(o,"navConfig")}),o.view.$(".nav-container").append(o.widgets.tocWidget.render().el),e.each(e.keys(o.widgets),function(t){o.listenTo(this.widgets[t],"page-manager-event",e.bind(this.onPageManagerEvent,this,this.widgets[t])),o.broadcast("page-manager-message","new-widget",t)},o),s.resolve()}),s.promise()},onPageManagerEvent:function(t,n,i){i=i||{};var r=null,s=null;t&&e.each(e.pairs(this.widgets),function(e){e[1]===t&&(s=e[0],r=e[1])}),"widget-ready"==n&&null!==r?(i.widgetId=s,this.broadcast("page-manager-message",n,i)):"widget-selected"==n?this.onWidgetSelected.apply(this,arguments):"broadcast-payload"==n?this.broadcast("page-manager-message",n,i):"navigate"==n?this.getPubSub().publish(this.getPubSub().NAVIGATE,i.navCommand,i.sub):"apply-function"==n&&i.func.apply(this)},onWidgetSelected:function(e,t,n){var i=e.model.get("bibcode"),s=n.idAttribute.toLowerCase().replace("show","");r("send","event","interaction","toc-link-followed",{target:s,bibcode:i}),this.broadcast("page-manager-message","widget-selected",n),this.getPubSub().publish(this.getPubSub().NAVIGATE,n.idAttribute,n)},onPageManagerMessage:e.noop,setActive:function(e,t){t&&this.widgets[e].setSubView instanceof Function&&this.widgets[e].setSubView(t),t&&(e=e+"__"+t),this.widgets.tocWidget.collection.selectOne(e)},onDestroy:function(){this.stopListening(),this.widgets={},this.view.destroy()}})}),define("js/services/api",["underscore","jquery","js/components/generic_module","js/components/api_request","js/mixins/dependon","js/components/api_response","js/components/api_query","js/components/api_feedback","js/mixins/hardened","js/mixins/api_access","moment"],function(e,t,n,i,r,s,o,a,c,u,l){var d=n.extend({url:"/api/1/",clientVersion:null,outstandingRequests:0,access_token:null,refresh_token:null,expire_in:null,defaultTimeoutInMs:6e4,activate:function(e){this.setBeeHive(e)},done:function(e,t,n){var i=new s(e);i.setApiQuery(this.request.get("query")),this.api.trigger("api-response",i)},fail:function(e,t,n){console.error("API call failed:",JSON.stringify(this.request.url()),e.status,n);var i=this.api.hasBeeHive()?this.api.getPubSub():null;if(i){var r=new a({code:a.CODES.API_REQUEST_ERROR,msg:t,request:this.request,error:e,psk:this.key||this.api.getPubSub().getCurrentPubSubKey(),errorThrown:n,text:t,beVerbose:!0});i.publish(i.FEEDBACK,r)}else this.api&&this.api.trigger("api-error",this,e,t,n)},initialize:function(){this.always=e.bind(function(){this.outstandingRequests--},this)},getNumOutstandingRequests:function(){return this.outstandingRequests},setVals:function(t){e.each(t,function(e,t){this[t]=e},this)},modifyRequestOptions:function(e){},hardenedInterface:{request:"make a request to the API",setVals:"set a value on API (such as new access token)"}});return d.prototype._request=function(n,i){var r;i=e.extend({},i,n.get("options"));var s=this,a=n.get("query");if(a&&!(a instanceof o))throw Error("Api.query must be instance of ApiQuery");a&&(r="application/json"===i.contentType?JSON.stringify(a.toJSON()):a.url());var c,u=n.get("target")||"";if(!(c=(c=u.indexOf("http")>-1?u:this.url+(u.length>0&&0==u.indexOf("/")?u:u?"/"+u:u)).substring(0,this.url.length-2)+c.substring(this.url.length-2,c.length).replace("//","/")))throw Error("Sorry, you can't use api without url");var l={type:"GET",url:c,dataType:"json",data:r,contentType:"application/x-www-form-urlencoded",context:{request:n,api:s},timeout:this.defaultTimeoutInMs,headers:{},cache:!0};if(i.timeout&&(l.timeout=i.timeout),this.clientVersion&&(l.headers["X-BB-Api-Client-Version"]=this.clientVersion),this.access_token&&(l.headers.Authorization=this.access_token,/accounts\/bootstrap/i.test(u)&&(l.headers.Authorization="")),e.extend(l.headers,i.headers),e.extend(l,e.omit(i,"headers")),this.outstandingRequests++,this.modifyRequestOptions(l,n),i.useFetch&&i.fetchOptions){var d=e.assign({credentials:"include",mode:"cors",timeout:this.defaultTimeoutInMs},i.fetchOptions);d.headers=e.assign({"Content-Type":l.contentType},l.headers,i.fetchOptions.headers);var h=window.fetch(l.url,d).then(function(t){if(s.always.call(l.context,t),e.isFunction(l.always)&&l.always.call(l.context,t),!t.ok)throw(l.fail||s.fail).call(l.context,t),Error(t.statusText);(l.done||s.done).call(l.context,t)}).catch(function(e){throw(l.fail||s.fail).call(l.context,e),Error(e)});return e.extend(h,{done:h.then,fail:h.catch})}var p=t.ajax(l).always(l.always?[this.always,l.always]:this.always).done(l.done||this.done).fail(l.fail||this.fail);return p=p.promise(p)},d.prototype.getCurrentUTCMoment=function(){return l().utc()},d.prototype.request=function(n,i){var r=this,s=3,o=function o(){var a=t.Deferred(),c=r.getApiAccess({tokenRefresh:!0,reconnect:!0});return c.done(function(){a.resolve(r._request(n,i))}),c.fail(function(){--s>0?e.delay(o,1e3):a.reject.apply(a,arguments)}),a.promise()};if(!this.expire_in)return o();var a=l.utc(this.expire_in);return this.getCurrentUTCMoment().diff(a,"minutes")>-2?o():r._request(n,i)},e.extend(d.prototype,r.BeeHive,c,u),d}),define("js/services/default_pubsub",["backbone","underscore","js/components/generic_module","js/components/pubsub_key"],function(e,t,n,i){var r=/\s+/;return n.extend({className:"PubSub",initialize:function(e){this._issuedKeys={},this.strict=!0,this.handleErrors=!0,this._errors={},this.errWarningCount=10,t.extend(this,t.pick(e,["strict","handleErrors","errWarningCount"])),this.pubSubKey=i.newInstance({creator:{}}),this._issuedKeys[this.pubSubKey.getId()]=this.pubSubKey.getCreator(),this.running=!0,this.debug=!1},start:function(){this.publish(this.pubSubKey,this.OPENING_GATES),this.publish(this.pubSubKey,this.OPEN_FOR_BUSINESS),this.running=!0},destroy:function(){this.publish(this.pubSubKey,this.CLOSING_GATES),this.off(),this.publish(this.pubSubKey,this.CLOSED_FOR_BUSINESS),this.running=!1,this._issuedKeys={}},subscribe:function(e,n,i){if(!this.isRunning())throw new Error("PubSub has been closed, ignoring futher requests");if(this._checkKey(e,n,i),t.isUndefined(n))throw new Error("You tried to subscribe to undefined event. Error between chair and keyboard?");this.on(n,i,e),-1==n.indexOf(e.getId())&&this.on(n+e.getId(),i,e)},subscribeOnce:function(e,n,i){if(this._checkKey(e,n,i),t.isUndefined(n))throw new Error("You tried to subscribe to undefined event. Error between chair and keyboard?");this.once(n,i,e),-1==n.indexOf(e.getId())&&this.once(n+e.getId(),i,e)},unsubscribe:function(e,n,i){this._checkKey(e,n,i);var r=e;if(n&&i)this.off(n,i,r),this.off(n+e.getId(),i,r);else if(n||i)this.off(n,i,r),this.off(n+e.getId(),i,r);else{var s,o,a,c,u,l,d=t.keys(this._events),h=[];for(a=0,c=d.length;a<c;a++)if(n=d[a],s=this._events[n])for(l=0,u=s.length;l<u;l++)(o=s[l]).context===r&&h.push({name:n,event:o});t.each(h,function(e){this.off(e.name,e.event.callback,e.event.context)},this)}},publish:function(){if(this.isRunning()){this._checkKey(arguments[0]);var e=Array.prototype.slice.call(arguments,1);if(0==e.length||t.isUndefined(e[0]))throw new Error("You tried to trigger undefined event. Error between chair and keyboard?");return e.push(arguments[0]),this.handleErrors?this.triggerHandleErrors.apply(this,e):this.trigger.apply(this,e)}console.error("PubSub has been closed, ignoring futher requests")},getCurrentPubSubKey:function(){return this.pubSubKey},getPubSubKey:function(){var e=i.newInstance({creator:this.pubSubKey});if(this.strict){if(this._issuedKeys[e.getId()])throw Error("The key with id",e.getId(),"has been already registered!");this._issuedKeys[e.getId()]=e.getCreator()}return e},isStrict:function(){return this.strict},_checkKey:function(e,n,r){if(this.strict){if(t.isUndefined(e))throw new Error("Every request must be accompanied by PubSubKey");if(!(e instanceof i))throw new Error("Key must be instance of PubSubKey. (If you are trying to pass context, you can't do that. Instead, wrap your callback into: _.bind(callback, context))\nPerhaps the PubSub you are using is the non-protected version?");if(!this._issuedKeys.hasOwnProperty(e.getId()))throw new Error("Your key is not known to us, sorry, you can't use this queue.");if(this._issuedKeys[e.getId()]!==e.getCreator())throw new Error("Your key has wrong identity, sorry, you can't use this queue.")}},triggerHandleErrors:function(e){if(!this._events)return this;var t=Array.prototype.slice.call(arguments,1);if(!function(e,t,n,i){if(!n)return!0;if("object"===_typeof(n)){for(var s in n)e[t].apply(e,[s,n[s]].concat(i));return!1}if(r.test(n)){for(var o=n.split(r),a=0,c=o.length;a<c;a++)e[t].apply(e,[o[a]].concat(i));return!1}return!0}(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&this.triggerEvents(n,t),i&&this.triggerEvents(i,arguments),this},triggerEvents:function(e,t){var n,i=-1,r=e.length,s=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++i<r;)try{(n=e[i]).callback.call(n.ctx)}catch(e){this.handleCallbackError(e,n,t)}return;case 1:for(;++i<r;)try{(n=e[i]).callback.call(n.ctx,s)}catch(e){this.handleCallbackError(e,n,t)}return;case 2:for(;++i<r;)try{(n=e[i]).callback.call(n.ctx,s,o)}catch(e){this.handleCallbackError(e,n,t)}return;case 3:for(;++i<r;)try{(n=e[i]).callback.call(n.ctx,s,o,a)}catch(e){this.handleCallbackError(e,n,t)}return;default:for(;++i<r;)try{(n=e[i]).callback.apply(n.ctx,t)}catch(e){this.handleCallbackError(e,n,t)}}},handleCallbackError:function(e,t,n){if(console.warn("[PubSub] Error: ",t,n,e.message,e.stack),this.debug)throw e;console.warn(e.stack);var i=t.ctx.getId(),r=this._errors[i]=(this._errors[i]||0)+1;r%this.errWarningCount==0&&this.publish(this.pubSubKey,this.BIG_FIRE,r,e,t,n)},isRunning:function(){return this.running}})}),define("js/services/pubsub",["backbone","underscore","js/mixins/hardened","pubsub_service_impl","js/components/pubsub_events"],function(e,t,n,i,r){var s=i.extend({hardenedInterface:{subscribe:"register callback",unsubscribe:"deregister callback",publish:"send data to the queue",getPubSubKey:"get secret key"}});return t.extend(s.prototype,n,{getHardenedInstance:function(e){e=t.clone(e||this.hardenedInterface);var n={key:this.getPubSubKey()},i=this;e.publish=function(){i.publish.apply(i,[n.key].concat(t.toArray(arguments)))},e.subscribe=function(){i.subscribe.apply(i,[n.key].concat(t.toArray(arguments)))},e.unsubscribe=function(){i.unsubscribe.apply(i,[n.key].concat(t.toArray(arguments)))},e.subscribeOnce=function(){i.subscribeOnce.apply(i,[n.key].concat(t.toArray(arguments)))},e.getCurrentPubSubKey=function(){return n.key};var s=this._getHardenedInstance(e,this);return t.extend(s,r),s}}),t.extend(s.prototype,r),s}),define("js/services/storage",["underscore","js/components/persistent_storage"],function(e,t){var n=t.extend({activate:function(e){},onAppBootstrapped:function(){var e=this.getBeeHive().getObject("DynamicConfig");if(!e)throw new Error("DynamicConfig is missing");var t=e.namespace;t||(console.warn("Application namespace not set; persistent storage will be created without it"),t=""),this._store=this._createStore(t)}});return function(){return new n({name:"storage-service"})}}),define("router",["underscore","jquery","backbone","js/components/api_query","js/mixins/dependon","js/components/api_feedback","js/components/api_request","js/components/api_targets","js/mixins/api_access","js/components/api_query_updater"],function(e,t,n,i,r,s,o,a,c,u){var l=n.Router.extend({initialize:function(e){e=e||{},this.queryUpdater=new u("Router")},execute:function(t,n){var i=n.filter(function(e){return void 0!==e});e.isFunction(t)&&t.apply(this,i)},activate:function(e){if(this.setBeeHive(e),!this.hasPubSub())throw new Error("Ooops! Who configured this #@$%! There is no PubSub service!")},routerNavigate:function(e,t){t=t||{};this.getPubSub().publish(this.getPubSub().NAVIGATE,e,t)},routes:{"/":"index","":"index","classic-form(/)":"classicForm","paper-form(/)":"paperForm","index/(:query)":"index","search/(:query)(/)(:widgetName)":"search","search(/)(?:query)":"search","execute-query/(:query)":"executeQuery","feedback/(:subview)":"feedbackPage","abs/*path":"view","user/orcid*(:subView)":"orcidPage","user/account(/)(:subView)":"authenticationPage","user/account/verify/(:subView)/(:token)":"routeToVerifyPage","user/settings(/)(:subView)(/)":"settingsPage","user/libraries(/)(:id)(/)(:subView)(/)(:subData)(/)":"librariesPage","user/home(/)":"homePage","orcid-instructions(/)":"orcidInstructions","public-libraries/(:id)(/)":"publicLibraryPage","*invalidRoute":"noPageFound"},index:function(e){this.routerNavigate("index-page")},classicForm:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.routerNavigate("ClassicSearchForm",{query:(new i).load(e)})},paperForm:function(){this.routerNavigate("PaperSearchForm")},feedbackPage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="";try{t=t.replace("&",encodeURIComponent("&")),n=new URLSearchParams(t).get("bibcode")}catch(e){n=""}this.routerNavigate("ShowFeedback",{subview:e,href:"#feedback/".concat(e),bibcode:n})},search:function(e,t){if(e)try{var n=(new i).load(e);this.routerNavigate("search-page",{q:n,page:t&&"show-"+t,replace:!0})}catch(t){return console.error("Error parsing query from a string: ",e,t),this.getPubSub().publish(this.getPubSub().NAVIGATE,"index-page"),this.getPubSub().publish(this.getPubSub().BIG_FIRE,new s({code:s.CODES.CANNOT_ROUTE,reason:"Cannot parse query",query:e})),this.getPubSub().publish(this.getPubSub().ALERT,new s({code:s.CODES.ALERT,msg:"unable parse query",type:"danger",modal:!0}))}else this.getPubSub().publish(this.getPubSub().NAVIGATE,"index-page",{replace:!0})},executeQuery:function(e){this.getPubSub().publish(this.getPubSub().NAVIGATE,"execute-query",e)},view:function(e){if(!e)return this.routerNavigate("404");var t,n=e.split("/");n[n.length-1].match(/^(abstract|citations|references|coreads|similar|toc|graphics|metrics|exportcitation)$/)&&(t=n.pop());var i,r,s=n.join("/");t?(i="Show"+t[0].toUpperCase()+t.slice(1),r="#abs/"+encodeURIComponent(s)+"/"+t):(i="ShowAbstract",r="#abs/"+encodeURIComponent(s)+"/abstract"),this.routerNavigate(i,{href:r,bibcode:s})},routeToVerifyPage:function(e,t){this.getPubSub().publish(this.getPubSub().NAVIGATE,"user-action",{subView:e,token:t})},orcidPage:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"orcid-page")},orcidInstructions:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"orcid-instructions")},authenticationPage:function(t){if(t&&!e.contains(["login","register","reset-password-1","reset-password-2"],t))throw new Error("that isn't a subview that the authentication page knows about");this.routerNavigate("authentication-page",{subView:t})},settingsPage:function(t){e.contains(["token","password","email","delete"],t)?this.routerNavigate("UserSettings",{subView:t}):e.contains(["librarylink","orcid","application","export"],t)?this.routerNavigate("UserPreferences",{subView:t}):e.contains(["libraryimport"],t)?this.routerNavigate("LibraryImport"):e.contains(["myads"],t)?this.routerNavigate("MyAdsDashboard"):this.routerNavigate("UserPreferences",{subView:void 0})},librariesPage:function(t,n,i){if(t){if("actions"===t)return this.routerNavigate("LibraryActionsWidget","libraries");n=n||"library";if(e.contains(["library","admin"],n))this.routerNavigate("IndividualLibraryWidget",{subView:n,id:t});else{if(!e.contains(["export","metrics","visualization"],n))throw new Error("did not recognize subview for library view");"library-export"==(n="library-"+n)?this.routerNavigate(n,{subView:i||"bibtex",id:t}):"library-metrics"==n&&this.routerNavigate(n,{id:t})}}else this.routerNavigate("AllLibrariesWidget","libraries")},publicLibraryPage:function(e){this.getPubSub().publish(this.getPubSub().NAVIGATE,"IndividualLibraryWidget",{id:e,publicView:!0,subView:"library"})},homePage:function(e){this.routerNavigate("home-page",{subView:e})},noPageFound:function(){this.routerNavigate("404")},_extractParameters:function(t,n){return e.map(t.exec(n).slice(1),function(e){return/q\=/.test(e)?e:e?decodeURIComponent(e):e})}});return e.extend(l.prototype,r.BeeHive,c),l}),define("recaptcha",[],function(){var e=["//google.com/recaptcha/api.js?&render=explicit&onload=onRecaptchaLoad","//recaptcha.net/recaptcha/api.js?&render=explicit&onload=onRecaptchaLoad"];return{load:function(t,n,i){window.__grecaptcha__=$.Deferred(),window.onRecaptchaLoad=function(){window.__grecaptcha__.resolve(window.grecaptcha)},e.forEach(function(e){return n([e])}),n([t],function(e){return i(e)})}}}),define("reactify",[],function(){return{load:function(e,t,n){var i=e.split("?"),r=i[0],s=i[1];t([r,"js/react/".concat(s,"/index")],function(e,t){n(e.extend({initialize:function(n){this.view=new t,e.prototype.initialize.call(this,_objectSpread({componentId:s},n))}}))})}}}),define("js/bugutils/diagnostics",["jquery","underscore","js/components/api_query","js/components/api_request","js/components/api_response","js/mixins/dependon","js/components/generic_module","sprintf","js/components/api_targets"],function(e,t,n,i,r,s,o,a,c){var u=o.extend({activate:function(e,t){this.setApp(t),this.setBeeHive(e)},getFirstDoc:function(n,i){var r={query:{q:n,fl:"title,abstract,bibcode,id,author"},target:c.SEARCH};i&&t.extend(r,i);var s=e.Deferred();return this.apiRequest(r).done(function(e){s.resolve(e.response.docs[0])}),s.promise()},apiRequest:function(e,t){var r=this.getApp().getService("Api");if(!(e=e||{}).query)throw Error('You must pass in "query"');e.query instanceof n||(e.query=new n(e.query));var s=new i({target:e.target||c.SEARCH,query:e.query});return r.request(s,t)},ajax:function(t){var n=this.getApp().getService("Api");return t.headers=t.header||{},t.headers.Authorization=n.access_token,e.ajax(t)},jsonp:function(e,n){return e.dataType="jsonp",e.beforeSend=function(e,i){var r=i.url.split("&");t.each(r,function(e){e.startsWith("callback=")&&(i.url+="&"+(n||"json.wrf")+"="+e.replace("callback=",""))})},this.ajax(e)},printComparison:function(e){var t=[],n="%40s %40s %40s %10s";for(var i in t.push(a.sprintf(n,"field",e.first,e.second,"diff")),t.push("------------------------------------------------------------------------------------------------------------------------------------"),e.fields){var r=e.fields[i];t.push(a.sprintf(n,i,r.first,r.second,r.diff))}return console.log(t.join("\n")),t},compareTwoSearchInstances:function(n,i,r,s){var o=this,a=e.Deferred();if(r&&s){var c=this.countDocsInFields(n,r),u=this.countDocsInFields(i,s);e.when(c,u).done(function(e,r){var s=t.keys(e.fields),o=t.keys(r.fields),c=t.unique(s.concat(o)).sort(),u={};for(var l in c){l=c[l];var d=e.fields[l],h=r.fields[l];u[l]={first:d?d.numFound:"--",second:h?h.numFound:"--",diff:d&&h?h.numFound-d.numFound:"--"}}a.resolve({first:n,second:i,fields:u})})}else{var l=this.getListOfFields(n),d=this.getListOfFields(i);e.when(l,d).done(function(e,t){o.compareTwoSearchInstances(n,i,e,t).done(function(e){a.resolve(e)})})}return a},getListOfFields:function(t){var n=e.Deferred();return this.jsonp({url:t+"/admin/luke?numTerms=0&wt=json&indent=true",timeout:6e4}).done(function(e){var t=[];for(var i in e.fields)i.startsWith("_")||t.push(i);n.resolve(t)}),n},countDocsInFields:function(t,n){var i=e.Deferred(),r=[],s={},o={fields:{}};for(var a in n){var c=n[a],u=(e.Deferred(),"{!lucene}"+c+":*");console.log("Getting num docs for: "+u);var l=this.jsonp({url:t+"/query?q="+u+"&fl=id&wt=json&indent=true",context:{field:c,finalResult:o,cycleR:s},timeout:3e5}).done(function(e){this.finalResult.fields[this.field]={numFound:e.response.numFound};var n=0,r=[];for(var s in this.cycleR)"pending"==this.cycleR[s].state()&&(n+=1,r.push(s));console.log(t+" Got response for: "+this.field+" numFound: "+e.response.numFound+" requests to go: "+n+" "+(r.length<5?r.join(", "):"")),0==n&&i.resolve(this.finalResult)});s[c]=l,r.push(l)}return i},request:function(t){return e.ajax(t)},testOrcidLogin:function(){var e=this.getApp().getService("OrcidApi");e.signOut(),window.location=e.config.loginUrl},testOrcidSendingData:function(){var e=this.getApp();this.getFirstDoc("bibcode:1978yCat.1072....0C").done(function(t){e.getService("OrcidApi").addWorks([t]).done(function(e){console.log("result:",e,"expected: {}")})})},printPubSubSubscribers:function(e){var n=this.getApp().getService("PubSub"),i={};this.getApp().triggerMethodOnAll(function(e,t){if(this===n)i[n.pubSubKey.getId()]=e;else if(this.hasPubSub&&this.hasPubSub()){var r=this.getPubSub();r.getCurrentPubSubKey&&(i[r.getCurrentPubSubKey().getId()]&&console.warn("Redefining key that already exists: "+r.getCurrentPubSubKey().getId()+" "+i[r.getCurrentPubSubKey().getId()]),i[r.getCurrentPubSubKey().getId()]=e)}else console.warn("Instance without active PubSub: "+e,this)}),e&&(console.log("Printing list of all issued keys to PubSub"),t.each(t.keys(n._issuedKeys),function(e){var t;n._issuedKeys[e].getId&&i[n._issuedKeys[e].getId()]&&(t=i[n._issuedKeys[e].getId()]),t?console.log(e+"(parent:"+t+") -> "+i[e]):console.log(e+" -> "+i[e])}));var r={};console.log("Printing active subscribers to PubSub"),t.each(n._events,function(e,n,s){console.log(n+" ("+e.length+")"),t.each(e,function(e){var t=e.ctx.getId?i[e.ctx.getId()]:"unknown object";console.log("\t"+t),r[t]=r[t]?r[t]+1:1,void 0==t&&(r["undefined keys"]||(r["undefined keys"]=[]),r["undefined keys"].push(n+(e.ctx.getId?e.ctx.getId():"X")))})}),console.log(JSON.stringify(r,null," "))}});return t.extend(u.prototype,s.App,s.BeeHive),u});var _excluded=["type"];function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _objectWithoutProperties(e,t){if(null==e)return{};var n,i,r=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}define("js/react/BumblebeeWidget",["underscore","js/widgets/base/base_widget","js/components/api_request","js/components/api_query","analytics"],function(e,t,n,i,r){var s=function(){return window.bbb.getBeeHive()},o=function(){return s().getService("PubSub")},a=function(){for(var e=o(),t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.subscribe.apply(e,[e.pubSubKey].concat(n))},c=function(){for(var e=o(),t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.publish.apply(e,[e.pubSubKey].concat(n))};return t.extend({getBeeHive:function(){return s()},hasBeeHive:function(){return!0},initialize:function(t){var n=this,i=t.componentId;this.view.on({sendRequest:e.bind(this.onSendRequest,this),subscribeToPubSub:e.bind(this.subscribeToPubSub,this),publishToPubSub:e.bind(this.publishToPubSub,this),doSearch:e.bind(this.doSearch,this),getCurrentQuery:e.bind(this.onGetCurrentQuery,this),isLoggedIn:e.bind(this.isLoggedIn,this),analyticsEvent:e.bind(this.analyticsEvent,this)}),this.listenTo(this,"page-manager-message",function(e,t){"widget-selected"===e&&t.idAttribute===i&&n.view.destroy().render()}),this.activate(),this.onSendRequest=e.debounce(this.onSendRequest,1e3,{leading:!0,trailing:!1}),this.view._store&&(this._store=this.view._store)},dispatch:function(e){var t=e.type,n=_objectWithoutProperties(e,_excluded);this._store&&"function"==typeof this._store.dispatch&&this._store.dispatch(_objectSpread({type:t},n))},getState:function(){return this._store.getState()},activate:function(){var e=o();a(e.USER_ANNOUNCEMENT,this.handleUserAnnouncement.bind(this)),a(e.NAVIGATE,this.handleNavigation.bind(this));var t=this.getBeeHive().getObject("User");t&&"function"==typeof t.getUserName&&this.dispatch({type:"USER_ANNOUNCEMENT/user_signed_in",payload:t.getUserName()})},handleNavigation:function(e,t){var n="NAVIGATE/".concat(e);this.dispatch({type:n,payload:t})},handleUserAnnouncement:function(e,t){var n="USER_ANNOUNCEMENT/".concat(e);this.dispatch({type:n,payload:t})},isLoggedIn:function(e){var t=this.getBeeHive().getObject("User");"function"==typeof e&&e(t.isLoggedIn())},onGetCurrentQuery:function(e){e(this.getCurrentQuery())},subscribeToPubSub:function(e,t){var n=o();a(n[e],t)},publishToPubSub:function(e){for(var t=o(),n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];c.apply(void 0,[t[e]].concat(i))},doSearch:function(t){var n=new i;e.isString(t)?n.load(t):n.set(_objectSpread({},t)),this.publishToPubSub("NAVIGATE","search-page",{q:n})},onSendRequest:function(e){var t=e.options,r=e.target,s=e.query,a=o(),u=new n({target:r,query:new i(s)});u.set("options",_objectSpread(_objectSpread({},t),{},{contentType:"search/query"===r?"application/x-www-form-urlencoded":t.contentType,data:"search/query"===r?u.get("query").url():t.data})),c(a.EXECUTE_REQUEST,u)},analyticsEvent:function(){r.apply(void 0,arguments)}})}),define("js/dark-mode-switch",["analytics"],function(e){var t,n=function(e){document.body.setAttribute("data-theme","dark"),t.classList.add("darkModeOn"),t.setAttribute("title","Turn off dark mode"),e&&localStorage.setItem("darkSwitch","on")},i=function(e){document.body.removeAttribute("data-theme"),t.classList.remove("darkModeOn"),t.setAttribute("title","Turn on dark mode"),e&&localStorage.setItem("darkSwitch","off")},r=function(t,n){e("send","event","uitheme",t,n)};(t=document.getElementById("darkSwitch")).classList.remove("hidden"),null!==localStorage.getItem("darkSwitch")?"on"===localStorage.getItem("darkSwitch")?n(!1):i(!1):window.matchMedia("(prefers-color-scheme: dark)").matches?n(!1):i(!1),t.addEventListener("click",function(){t.classList.contains("darkModeOn")?(i(!0),r("appSetting","light")):(n(!0),r("appSetting","dark"))})}),define("async",[],function(){var e="callback",t=0;return{load:function(n,i,r,s){if(s.isBuild)r(null);else{var o="__async_req_"+(t+=1)+"__";window[o]=r,a=function(t,n){var i=/!(.+)/,r=t.replace(i,""),s=i.test(t)?t.replace(/.+!/,""):e;return(r+=r.indexOf("?")<0?"?":"&")+s+"="+n}(i.toUrl(n),o),(c=document.createElement("script")).type="text/javascript",c.async=!0,c.src=a,(u=document.getElementsByTagName("script")[0]).parentNode.insertBefore(c,u)}var a,c,u}}}),function(e){"function"==typeof define&&define.amd?define("array-flat-polyfill",e):e()}(function(){Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0})}),define("main.bundle",function(){});