function _typeof2(e){"@babel/helpers - typeof";return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _wrapRegExp(){_wrapRegExp=function(e,t){return new n(e,void 0,t)};var e=RegExp.prototype,t=new WeakMap;function n(e,i,a){var r=new RegExp(e,i);return t.set(r,a||t.get(e)),_setPrototypeOf(r,n.prototype)}function i(e,n){var i=t.get(n);return Object.keys(i).reduce(function(t,n){var a=i[n];if("number"==typeof a)t[n]=e[a];else{for(var r=0;void 0===e[a[r]]&&r+1<a.length;)r++;t[n]=e[a[r]]}return t},Object.create(null))}return _inherits(n,RegExp),n.prototype.exec=function(t){var n=e.exec.call(this,t);if(n){n.groups=i(n,this);var a=n.indices;a&&(a.groups=i(a,this))}return n},n.prototype[Symbol.replace]=function(n,a){if("string"==typeof a){var r=t.get(this);return e[Symbol.replace].call(this,n,a.replace(/\$<([^>]+)>/g,function(e,t){var n=r[t];return"$"+(Array.isArray(n)?n.join("$"):n)}))}if("function"==typeof a){var s=this;return e[Symbol.replace].call(this,n,function(){var e=arguments;return"object"!=_typeof(e[e.length-1])&&(e=[].slice.call(e)).push(i(e,s)),a.apply(this,e)})}return e[Symbol.replace].call(this,n,a)},_wrapRegExp.apply(this,arguments)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r,s,o=[],l=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(o.push(i.value),o.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw a}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}define("config/common.config",[],function(){window.skipMain&&requirejs.config({baseUrl:"../../"}),requirejs.config({shim:{mathjax:{exports:"MathJax",init:function(){return MathJax.Hub.Config({messageStyle:"none",HTML:["input/TeX","output/HTML-CSS"],TeX:{extensions:["AMSmath.js","AMSsymbols.js"],equationNumbers:{autoNumber:"AMS"}},extensions:["tex2jax.js"],jax:["input/TeX","output/HTML-CSS"],tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0},"HTML-CSS":{availableFonts:["TeX"],linebreaks:{automatic:!0}}}),MathJax.Hub.Startup.onload(),MathJax}}}}),require(["config/discovery.vars","regenerator-runtime","array-flat-polyfill","polyfill","js/dark-mode-switch"],function(e){setTimeout(function(){require(["google-analytics","analytics"],function(t,n){n("create",e.googleTrackingCode||"",e.googleTrackingOptions),e.googleOptimizeCode&&(n("require",e.googleOptimizeCode),e.debugExportBBB||console.warn("AB testing will be loaded, but bbb object is not exposed. Change debugExportBBB if needed."))})},0)}),require(["hbs/handlebars"],function(e){e.registerHelper("compare",function(e,t,n){var i,a;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");if(!(i={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},typeof:function(e,t){return _typeof2(e)===t}})[a=void 0!==n&&n.hash&&n.hash.operator?n.hash.operator:"==="])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+a);return i[a](e,t)?n.fn(this):n.inverse(this)}),e.registerHelper("toJSON",function(e){return JSON.stringify(e)}),e.registerHelper("isdefined",function(e){return void 0!==e}),e.registerHelper("ifInSet",function(e,t,n){return e.has(t)?n.fn(this):n.inverse(this)}),e.registerHelper("ifSetEmpty",function(e,t){return 0===e.size?t.fn(this):t.inverse(this)})}),require(["backbone-validation"],function(){_.extend(Backbone.Validation.callbacks,{valid:function(e,t,n){e.$("input[name="+t+"]").closest(".form-group").removeClass("has-error").find(".help-block").html("").addClass("no-show")},invalid:function(e,t,n,i){var a=e.$("[name="+t+"]");$group=a.closest(".form-group"),!0===e.submit&&($group.addClass("has-error"),$group.find(".help-block").html(n).removeClass("no-show"))}})}),require(["d3","d3-cloud"],function(e,t){var n=window;n.d3||(n.d3=e),n.d3&&n.d3.layout&&!n.d3.layout.cloud&&(n.d3.layout.cloud=t),e.legend=function(t){return t.each(function(){var t=e.select(this),n={},i=e.select(t.property("nearestViewportElement")),a=t.attr("data-style-padding")||5,r=t.selectAll(".legend-box").data([!0]),s=t.selectAll(".legend-items").data([!0]);r.enter().append("rect").classed("legend-box",!0),s.enter().append("g").classed("legend-items",!0);try{i.selectAll("[data-legend]").each(function(){var t=e.select(this);n[t.attr("data-legend")]={pos:t.attr("data-legend-pos")||this.getBBox().y,color:void 0!=t.attr("data-legend-color")?t.attr("data-legend-color"):"none"!=t.style("fill")?t.style("fill"):t.style("stroke")}})}catch(e){}n=e.entries(n).sort(function(e,t){return e.value.pos-t.value.pos});var o=0;s.selectAll("text").data(n,function(e){return e.key}).call(function(e){e.enter().append("text")}).call(function(e){e.exit().remove()}).attr("y",function(e,t){return 0===t?"0em":t+(o+=.2)+"em"}).attr("x","1em").text(function(e){return e.key}),s.selectAll("circle").data(n,function(e){return e.key}).call(function(e){e.enter().append("circle")}).call(function(e){e.exit().remove()}).attr("cy",function(e,t){return t-.25+"em"}).attr("cx",0).attr("r","0.4em").style("fill",function(e){return e.value.color});var l=s[0][0].getBBox();r.attr("x",l.x-a).attr("y",l.y-a).attr("height",l.height+2*a).attr("width",l.width+2*a)}),t}}),require(["jquery"],function(e){e.fn.getCursorPosition=function(){var e=this.get(0);if(e){if("selectionStart"in e)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),n=document.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-n}}},e.fn.selectRange=function(e,t){return t||(t=e),this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}})}})}),require.config({deps:"undefined"!=typeof window&&window.skipMain?["common.config"]:["config/common.config","js/apps/discovery/main"],waitSeconds:7,config:{es6:{modules:void 0},"js/components/persistent_storage":{namespace:"bumblebee"},"js/apps/discovery/main":{core:{controllers:{FeedbackMediator:"js/wraps/discovery_mediator",QueryMediator:"js/components/query_mediator",Diagnostics:"js/bugutils/diagnostics",AlertsController:"js/wraps/alerts_mediator",Orcid:"js/modules/orcid/module",SecondOrderController:"js/components/second_order_controller",HotkeysController:"js/components/hotkeys_controller",Experiments:"js/components/experiments"},services:{Api:"js/services/api",PubSub:"js/services/pubsub",Navigator:"js/apps/discovery/navigator",PersistentStorage:"js/services/storage",HistoryManager:"js/components/history_manager"},objects:{User:"js/components/user",Session:"js/components/session",DynamicConfig:"config/discovery.vars",MasterPageManager:"js/page_managers/master",AppStorage:"js/components/app_storage",RecaptchaManager:"recaptcha!js/components/recaptcha_manager",CSRFManager:"js/components/csrf_manager",LibraryController:"js/components/library_controller",DocStashController:"js/components/doc_stash_controller",Utils:"utils"},modules:{FacetFactory:"js/widgets/facet/factory"}},widgets:{LandingPage:"js/wraps/landing_page_manager/landing_page_manager",SearchPage:"js/wraps/results_page_manager",DetailsPage:"js/wraps/abstract_page_manager/abstract_page_manager",AuthenticationPage:"js/wraps/authentication_page_manager",SettingsPage:"js/wraps/user_settings_page_manager/user_page_manager",OrcidPage:"js/wraps/orcid_page_manager/orcid_page_manager",OrcidInstructionsPage:"js/wraps/orcid-instructions-page-manager/manager",ReactPageManager:"js/react/PageManager",LibrariesPage:"js/wraps/libraries_page_manager/libraries_page_manager",HomePage:"js/wraps/home_page_manager/home_page_manager",PublicLibrariesPage:"js/wraps/public_libraries_page_manager/public_libraries_manager",ErrorPage:"js/wraps/error_page_manager/error_page_manager",Authentication:"js/widgets/authentication/widget",UserSettings:"js/widgets/user_settings/widget",UserPreferences:"js/widgets/preferences/widget",LibraryImport:"js/widgets/library_import/widget",BreadcrumbsWidget:"js/widgets/filter_visualizer/widget",NavbarWidget:"js/widgets/navbar/widget",UserNavbarWidget:"js/widgets/user_navbar/widget",AlertsWidget:"js/widgets/alerts/widget",ClassicSearchForm:"js/widgets/classic_form/widget",SearchWidget:"js/widgets/search_bar/search_bar_widget",PaperSearchForm:"js/widgets/paper_search_form/widget",Results:"js/widgets/results/widget",QueryInfo:"js/widgets/query_info/query_info_widget",QueryDebugInfo:"js/widgets/api_query/widget",ExportWidget:"js/widgets/export/widget.jsx",Sort:"js/widgets/sort/widget.jsx",ExportDropdown:"js/wraps/export_dropdown",VisualizationDropdown:"js/wraps/visualization_dropdown",AuthorNetwork:"js/wraps/author_network",PaperNetwork:"js/wraps/paper_network",ConceptCloud:"js/widgets/wordcloud/widget",BubbleChart:"js/widgets/bubble_chart/widget",AuthorAffiliationTool:"js/widgets/author_affiliation_tool/widget.jsx",Metrics:"js/widgets/metrics/widget",CitationHelper:"js/widgets/citation_helper/widget",OrcidBigWidget:"js/modules/orcid/widget/widget",OrcidSelector:"js/widgets/orcid-selector/widget.jsx",AffiliationFacet:"js/wraps/affiliation_facet",AuthorFacet:"js/wraps/author_facet",BibgroupFacet:"js/wraps/bibgroup_facet",BibstemFacet:"js/wraps/bibstem_facet",DataFacet:"js/wraps/data_facet",DatabaseFacet:"js/wraps/database_facet",GrantsFacet:"js/wraps/grants_facet",KeywordFacet:"js/wraps/keyword_facet",ObjectFacet:"js/wraps/simbad_object_facet",NedObjectFacet:"js/wraps/ned_object_facet",RefereedFacet:"js/wraps/refereed_facet",VizierFacet:"js/wraps/vizier_facet",GraphTabs:"js/wraps/graph_tabs",FooterWidget:"js/widgets/footer/widget",PubtypeFacet:"js/wraps/pubtype_facet",ShowAbstract:"js/widgets/abstract/widget",ShowGraphics:"js/widgets/graphics/widget",ShowGraphicsSidebar:"js/wraps/sidebar-graphics-widget",ShowReferences:"js/wraps/references",ShowCitations:"js/wraps/citations",ShowCoreads:"js/wraps/coreads",ShowSimilar:"js/wraps/similar",MetaTagsWidget:"js/widgets/meta_tags/widget",ShowToc:"js/wraps/table_of_contents",ShowResources:"js/widgets/resources/widget.jsx",ShowAssociated:"js/widgets/associated/widget.jsx",ShowRecommender:"js/widgets/recommender/widget",ShowMetrics:"js/wraps/paper_metrics",ShowExportcitation:"js/wraps/paper_export",ShowFeedback:"reactify!js/react/BumblebeeWidget?FeedbackForms",ShowLibraryAdd:"js/wraps/abstract_page_library_add/widget",IndividualLibraryWidget:"js/widgets/library_individual/widget",LibraryActionsWidget:"js/widgets/library_actions/widget.jsx",AllLibrariesWidget:"js/widgets/libraries_all/widget",LibraryListWidget:"js/widgets/library_list/widget",MyAdsFreeform:"reactify!js/react/BumblebeeWidget?MyAdsFreeform",MyAdsDashboard:"reactify!js/react/BumblebeeWidget?MyAdsDashboard",RecommenderWidget:"reactify!js/react/BumblebeeWidget?Recommender"},plugins:{}}},map:{"*":{pubsub_service_impl:"js/services/default_pubsub"}},paths:{router:"js/apps/discovery/router",analytics:"js/components/analytics",utils:"js/utils",recaptcha:"js/plugins/recaptcha",reactify:"js/plugins/reactify",es6:"js/plugins/es6",suit:"shared/dist/index.umd.production.min",babel:"libs/babel",async:"libs/requirejs-plugins/async",hbs:"libs/requirejs-plugins/hbs",sprintf:"libs/sprintf",sinon:"libs/sinon",enzyme:"libs/enzyme",mocha:"libs/mocha/mocha",chai:"libs/chai",underscore:["https://cdn.jsdelivr.net/npm/lodash@2.4.2/dist/lodash.compat.min","https://unpkg.com/lodash@2.4.2/dist/lodash.compat.min","libs/lodash"],backbone:["https://cdn.jsdelivr.net/npm/backbone@1.1.2/backbone-min","https://unpkg.com/backbone@1.1.2/backbone-min","libs/backbone"],"backbone-validation":["https://cdn.jsdelivr.net/npm/backbone-validation@0.11.3/dist/backbone-validation-amd-min","https://unpkg.com/backbone-validation@0.11.3/dist/backbone-validation-amd-min","libs/backbone-validation"],"backbone.stickit":["https://cdn.jsdelivr.net/npm/backbone.stickit@0.9.2/backbone.stickit","https://unpkg.com/backbone.stickit@0.9.2/backbone.stickit","libs/backbone.stickit"],"backbone.wreqr":["https://cdn.jsdelivr.net/npm/backbone.wreqr@1.4.0/lib/backbone.wreqr.min","https://unpkg.com/backbone.wreqr@1.4.0/lib/backbone.wreqr.min","libs/backbone.wreqr"],bootstrap:["https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min","https://unpkg.com/bootstrap@3.3.7/dist/js/bootstrap.min","libs/bootstrap/bootstrap"],bowser:["https://cdn.jsdelivr.net/npm/bowser@2.11.0/es5","https://unpkg.com/bowser@2.11.0/es5","libs/bowser"],clipboard:["https://cdn.jsdelivr.net/npm/clipboard@1.7.1/dist/clipboard.min","https://unpkg.com/clipboard@1.7.1/dist/clipboard.min","libs/clipboard"],d3:["https://cdn.jsdelivr.net/npm/d3@3.5.17/d3.min","https://unpkg.com/d3@3.5.17/d3.min","libs/d3"],"d3-cloud":["https://cdn.jsdelivr.net/npm/d3-cloud@1.2.5/build/d3.layout.cloud","https://unpkg.com/d3-cloud@1.2.5/build/d3.layout.cloud","libs/d3-cloud"],filesaver:["https://cdn.jsdelivr.net/npm/file-saver@1.3.8/FileSaver.min","https://unpkg.com/file-saver@1.3.8/FileSaver.min","libs/file-saver"],hotkeys:["https://cdn.jsdelivr.net/npm/hotkeys-js@3.8.7/dist/hotkeys.min","https://unpkg.com/hotkeys-js@3.8.7/dist/hotkeys.min","libs/hotkeys"],jquery:["https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min","https://unpkg.com/jquery@2.2.4/dist/jquery.min","libs/jquery"],"jquery-ui":["https://code.jquery.com/ui/1.12.1/jquery-ui.min","https://code.jquery.com/ui/1.12.1/jquery-ui.min","libs/jquery-ui"],jsonpath:["https://cdn.jsdelivr.net/npm/jsonpath@0.2.12/jsonpath.min","https://unpkg.com/jsonpath@0.2.12/jsonpath.min","libs/jsonpath"],marionette:["https://cdn.jsdelivr.net/npm/backbone.marionette@2.4.5/lib/backbone.marionette.min","https://unpkg.com/backbone.marionette@2.4.5/lib/backbone.marionette.min","libs/backbone.marionette"],mathjax:["https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS_HTML&amp;delayStartupUntil=configured","https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML&amp;delayStartupUntil=configured","libs/mathjax/mathjax"],moment:["https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment.min","https://unpkg.com/moment@2.22.2/min/moment.min","libs/moment"],"persist-js":["https://cdn.jsdelivr.net/npm/persist-js@0.3.1/persist-min","https://unpkg.com/persist-js@0.3.1/persist-min","libs/persist-js"],react:["https://cdn.jsdelivr.net/npm/react@16/umd/react.production.min","https://unpkg.com/react@16/umd/react.production.min","libs/react"],"react-bootstrap":["https://cdn.jsdelivr.net/npm/react-bootstrap@0.33.0/dist/react-bootstrap.min","https://unpkg.com/react-bootstrap@0.33.0/dist/react-bootstrap.min","libs/react-bootstrap"],"react-dom":["https://cdn.jsdelivr.net/npm/react-dom@17.0.2/umd/react-dom.production.min","https://unpkg.com/react-dom@17.0.2/umd/react-dom.production.min","libs/react-dom"],"prop-types":["https://cdn.jsdelivr.net/npm/prop-types@15.6/prop-types.min","https://unpkg.com/prop-types@15.6/prop-types.min","libs/prop-types"],"react-redux":["https://cdn.jsdelivr.net/npm/react-redux@7.2.4/dist/react-redux.min","https://unpkg.com/react-redux@7.2.4/dist/react-redux.min","libs/react-redux"],"react-transition-group":["https://cdn.jsdelivr.net/npm/react-transition-group@2.4.0/dist/react-transition-group.min","https://unpkg.com/react-transition-group@2.4.0/dist/react-transition-group.min","libs/react-transition-group"],redux:["https://cdn.jsdelivr.net/npm/redux@4.0.5/dist/redux.min","https://unpkg.com/redux@4.0.5/dist/redux.min","libs/redux"],"redux-thunk":["https://cdn.jsdelivr.net/npm/redux-thunk@2.3.0/dist/redux-thunk.min","https://unpkg.com/redux-thunk@2.3.0/dist/redux-thunk.min","libs/redux-thunk"],select2:["https://cdn.jsdelivr.net/npm/select2@4.0.3/dist/js/select2.min","https://unpkg.com/select2@4.0.3/dist/js/select2.min","libs/select2/select2"],"react-aria-menubutton":["https://cdn.jsdelivr.net/npm/react-aria-menubutton@7.0.3/umd/ReactAriaMenuButton","https://unpkg.com/react-aria-menubutton@7.0.3/umd/ReactAriaMenuButton","libs/react-aria-menubutton"],"react-hook-form":["https://cdn.jsdelivr.net/npm/react-hook-form@6.11.0/dist/index.umd.production.min","https://unpkg.com/react-hook-form@6.11.0/dist/index.umd.production.min","libs/react-hook-form"],"react-is":["https://cdn.jsdelivr.net/npm/react-is@17.0.2/umd/react-is.production.min","https://unpkg.com/react-is@17.0.2/umd/react-is.production.min","libs/react-is"],"react-data-table-component":["https://cdn.jsdelivr.net/npm/react-data-table-component@6.11.7/dist/react-data-table-component.umd","https://unpkg.com/react-data-table-component@6.11.7/dist/react-data-table-component.umd","libs/react-data-table-component"],"react-window":["https://cdn.jsdelivr.net/npm/react-window@1.8.6/dist/index-prod.umd","https://unpkg.com/react-window@1.8.6/dist/index-prod.umd","libs/react-window"],"react-async":["https://cdn.jsdelivr.net/npm/react-async@10.0.1/dist-umd/index","https://unpkg.com/react-async@10.0.1/dist-umd/index","libs/react-async"],"regenerator-runtime":["https://cdn.jsdelivr.net/npm/regenerator-runtime@0.13.9/runtime","https://unpkg.com/regenerator-runtime@0.13.9/runtime","libs/regenerator-runtime"],diff:["https://cdn.jsdelivr.net/npm/diff@4.0.2/dist/diff.min","https://unpkg.com/diff@4.0.2/dist/diff.min","libs/diff"],"styled-components":["https://cdn.jsdelivr.net/npm/styled-components@5.1.0/dist/styled-components.min","https://unpkg.com/styled-components@5.1.0/dist/styled-components.min","libs/styled-components"],"@hookform/resolvers":["https://cdn.jsdelivr.net/npm/@hookform/resolvers@0.1.0/dist/index.umd.production.min","https://unpkg.com/@hookform/resolvers@0.1.0/dist/index.umd.production.min","libs/hookform"],"google-analytics":["libs/g","data:application/javascript,"],yup:"libs/yup",cache:"libs/cache",polyfill:"libs/polyfill","react-flexview":"libs/react-flexview","array-flat-polyfill":"libs/array-flat-polyfill"},hbs:{templateExtension:"html",helpers:!1},babel:{presets:["env","react"]},shim:{Backbone:{deps:["backbone"],exports:"Backbone"},"backbone.stickit":{deps:["backbone"]},"backbone-validation":{deps:["backbone"]},bootstrap:{deps:["jquery","jquery-ui"]},backbone:{deps:["jquery","underscore"],exports:"Backbone"},marionette:{deps:["jquery","underscore","backbone"],exports:"Marionette"},cache:{exports:"Cache"},mocha:{exports:"mocha"},sinon:{exports:"sinon"},filesaver:{exports:"saveAs"},d3:{exports:"d3"},"d3-cloud":{deps:["d3"]},"google-analytics":{exports:"__ga__"},"jquery-ui":{deps:["jquery"]},"jquery-querybuilder":{deps:["jquery"]},sprintf:{exports:"sprintf"},"persist-js":{exports:"Persist"}}}),define("config/discovery.config",function(){}),define("js/apps/discovery/main",["config/discovery.config","module"],function(e,t){require(["router","js/components/application","js/mixins/discovery_bootstrap","js/mixins/api_access","js/components/api_feedback","analytics"],function(e,n,i,a,r,s){var o="function"==typeof window.__setAppLoadingProgress?window.__setAppLoadingProgress:function(){};n.prototype.shim();var l=window.location.href.indexOf("debug=true")>-1,c=new(n.extend(i))({debug:l,timeout:6e4}),u=c.loadModules(t.config());o(30,"Loading Modules");u.done(function(){o(80,"App Loaded"),c.activate();var t=c.getService("PubSub");t.publish(t.getCurrentPubSubKey(),t.APP_LOADED),c.configure(),o(95,"Finishing Up..."),c.bootstrap().done(function(n){o(100),c.onBootstrap(n);var i=c.getObject("DynamicConfig");i&&i.debugExportBBB&&(window.bbb=c),t.publish(t.getCurrentPubSubKey(),t.APP_BOOTSTRAPPED),t.publish(t.getCurrentPubSubKey(),t.APP_STARTING),c.start(e).done(function(){t.publish(t.getCurrentPubSubKey(),t.APP_STARTED);var e=_.debounce(function(){var e,t=function(){try{var e=_.isFunction(this.getBeeHive)&&this.getBeeHive(),t=_.isFunction(e.getObject)&&e.getObject("User");if(t)return t.getUserData("USER_DATA")}catch(e){}return{}}.call(c);"OPEN IN CURRENT TAB"===(t.externalLinkAction&&t.externalLinkAction.toUpperCase()||"AUTO")&&function t(n){clearTimeout(e),n<10&&($('a[target="_blank"]').attr("target",""),e=setTimeout(t,1e3,n+1))}(0)},3e3,{leading:!0,trailing:!1},!1);t.subscribe(t.getCurrentPubSubKey(),t.NAVIGATE,e),e();var n=function(e,t,n){e.toggleClass("show");var i='<i class="fa fa-close" aria-hidden="true"></i> Close Menu';e.hasClass("show")?t.removeClass("full-width"):(i='<i class="fa fa-bars" aria-hidden="true"></i> Show Menu',t.addClass("full-width")),n.html(i)};if($("body").on("click","button.toggle-menu",function(e){var t=$(e.target),i=t.parents().eq(1).find(".nav-container"),a=t.parents().eq(1).find(".user-pages__main-content");n(i,a,t),$("a",i).on("click",function(){n(i,a,t)})}),$("body").on("click","#abs-full-txt-toggle",function(){$("#resources-container").toggleClass("show"),$("#resources-container").hasClass("show")?$("#abs-full-txt-toggle").text("Hide Sources"):$("#abs-full-txt-toggle").text("Full Text Sources")}),$("body").on("click","#results-actions-toggle",function(){$("#query-info-container").toggleClass("show"),$("#query-info-container").hasClass("show")?$("#results-actions-toggle").html('<i class="fa fa-times" title="close actions" aria-hidden="true"></i> Actions'):$("#results-actions-toggle").html('<i class="fa fa-book" title="open actions" aria-hidden="true"></i> Actions')}),$("body").on("click","#skip-to-main-content",function(){return $("#main-content").trigger("focus"),!1}),$("body").hasClass("is-proxied")){var i=window.getCanonicalUrl(),a='\n              <p>\n                You are using a proxied version of ADS, we recommend you switch to the regular non-proxied URL: \n                <a href="'.concat(i).concat(location.pathname,'" rel="noopener noreferrer">').concat(i,'</a></p>\n              <p>\n                Configure authenticated access to publisher content via the Library Link Server in your account  \n                <a href="').concat(i,'/user/settings/librarylink" rel="noopener noreferrer">preferences</a>.\n              </p>\n            ');t.publish(t.getCurrentPubSubKey(),t.ALERT,new r({type:"danger",msg:a}))}if(window.__PAGE_LOAD_TIMESTAMP){var o=new Date-window.__PAGE_LOAD_TIMESTAMP;s("send",{hitType:"timing",timingCategory:"Application",timingVar:"Loaded",timingValue:o});var u=localStorage.getItem("darkSwitch"),d="systemSetting",h="light";null!==u?"on"===u?(d="appSetting",h="dark"):(d="appSetting",h="light"):window.matchMedia("(prefers-color-scheme: dark)").matches&&(d="systemSetting",h="dark"),s("send","event","uitheme",d,h),l&&console.log("Application Started: "+o+"ms")}window.clearTimeout(window.APP_LOADING_TIMER)})})}).fail(function(){s("send","event","introspection","failed-load",arguments),l||c.redirect("500.html")}).fail(function(){s("send","event","introspection","failed-reloading",arguments),l||c.reload("404.html")})})}),define("js/components/multi_params",["backbone","underscore","jquery"],function(e,t,n){return e.Model.extend({locked:!1,_checkLock:function(){if(!0===this.locked)throw Error("Object locked for modifications")},isLocked:function(){return this.locked},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},clone:function(){if(this.isLocked()){var e=new this.constructor(this.attributes);return e.lock(),e}return new this.constructor(this.attributes)},hasVal:function(e){return!t.isEmpty(this.get(e))},_validate:function(e,n){for(var i in e){if(!t.isString(i))throw new Error("Keys must be strings, not: "+i);var a=e[i];if(a=t.without(t.flatten(a),"",!1,null,void 0,NaN),!t.isArray(a))throw new Error("Values were not converted to an Array");if(t.isEmpty(a)&&!0!==n.unset)throw new Error("Empty values not allowed");if(!t.every(a,function(e){return t.isString(e)||t.isNumber(e)&&!t.isNaN(e)}))throw new Error("Invalid value (not a string or number): "+a);e[i]=a}return!0},set:function(n,i,a){var r;if(this._checkLock(),null==n)return this;for(var s in"object"===_typeof(n)?(r=n,a=i):(r={})[n]=i,r){var o=r[s];t.isArray(o)||(r[s]=t.flatten([o]))}e.Model.prototype.set.call(this,r,a)},unset:function(){this._checkLock(),e.Model.prototype.unset.apply(this,arguments)},add:function(n,i,a){var r;if(this._checkLock(),null==n)return this;for(var s in"object"===_typeof(n)?(r=n,a=i):(r={})[n]=i,r){var o=r[s];t.isArray(o)||(o=t.flatten([o])),this.has(s)&&(o=t.clone(this.get(s)).concat(o)),r[s]=o}e.Model.prototype.set.call(this,r,a)},sync:function(){throw Error("MultiParams cannot be saved to server")},url:function(e){e||(e=this.attributes);var i=t.pairs(e).sort(function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}),a=n.param(t.object(i),!0);return a=(a=a.replace(/\+/g,"%20")).replace(/%E2%80%9[ECD]/g,"%22")},parse:function(e,n){if(t.isString(e)){var i={};return(e=decodeURI(e)).indexOf("?")>-1&&(i["#path"]=[e.slice(0,e.indexOf("?"))],e=e.slice(e.indexOf("?")+1)),e.indexOf("#")>-1&&(i["#hash"]=this._parse(e.slice(e.indexOf("#")+1)),e=e.slice(0,e.indexOf("#"))),i["#query"]=this._parse(e),this._checkParsed(i)}return this._checkParsed(e)},_parse:function(e){var t,n={};if(!e.trim())return n;for(var i,a,r=e.slice(e.indexOf("?")+1).split("&"),s=0;s<r.length;s++){t=r[s].split("="),i=decodeURIComponent(t[0].split("+").join(" "));var o=t[1];t.length>2&&(t.shift(),o=t.join("=")),a=decodeURIComponent(o.replace(/%(?!\d|[ABCDEF]+)/gi,"%25").split("+").join(" ")),void 0!==n[i]?n[i].push(a):n[i]=[a]}return n},_checkParsed:function(e){return t.isObject(e)&&"#query"in e?e["#query"]:e},load:function(e){this._checkLock();var t=this.parse(e);return this.clear(),this.set(t),this}})}),define("js/components/solr_params",["js/components/multi_params","backbone","underscore","jquery"],function(e,t,n,i){return e.extend({fieldsToConcatenate:[],defaultOperator:" ",fieldProcessors:{"*":function(e,t){return[e.join(t.defaultOperator)]}},initialize:function(e,t){t&&n.extend(this,n.pick(t,["fieldsToConcatenate","defaultOperator","fieldProcessors"]))},url:function(t,i){for(var a=n.clone(this.attributes),r=this.fieldsToConcatenate.length,s="",o=0;o<r;o++)s=this.fieldsToConcatenate[o],this.has(s)&&(this.fieldProcessors[s]?a[s]=this.fieldProcessors[s](this.get(s),this):a[s]=this.fieldProcessors["*"](this.get(s),this));return e.prototype.url.call(this,a)}})}),define("js/components/facade",["underscore","js/components/facade"],function(e,t){return(t=function(e,t){var n;return n={},this.mixIn(e,t,n),n.mixIn=this.mixIn,n}).prototype.mixIn=function(t,n,i){var a,r;for(a in i=i||this,t)if(r=t[a],a in n){var s=n[a];if("function"==typeof r)i[a]=e.bind(r,n);else if("function"==typeof s)i[a]=e.bind(s,n);else if(e.isUndefined(s));else if(e.isString(s)||e.isNumber(s)||e.isBoolean(s)||e.isDate(s)||e.isNull(s)||e.isRegExp(s))i["get"+a.substring(0,1).toUpperCase()+a.substring(1)]=e.bind(function(){return this.ctx[this.name]},{ctx:n,name:a}),i[a]=s;else if(s.hasOwnProperty("__facade__")&&s.__facade__)i[a]=s;else{if(!(e.isObject(s)&&"getHardenedInstance"in s))throw new Error("Sorry, you can't wrap '"+a+"': "+s);i[a]=s.getHardenedInstance()}}else{if("function"!=typeof r)throw new Error("Unknown key: "+a+"("+r+")");i[a]=e.bind(r,n)}return i.__facade__=!n||Boolean(!n.constructor||(!n.constructor.name||n.constructor.name)),i},t}),define("js/components/api_query",["backbone","underscore","js/components/solr_params","js/components/facade"],function(e,t,n,i){var a={add:"add values",set:"set (replace existing)",get:"get values",has:"has a key",hasVal:"more specific `has` using _.isEmpty",url:"url string of the params",load:"loads query as a string",clear:"clears all values",unset:"removes a key",toJSON:"values back as JSON object",clone:"make a copy",isLocked:!0,lock:!0,unlock:!0,pairs:"get all values as pairs",keys:"as keys",values:"only values",hasChanged:"whether this object has modification (since its creation)",previousAttributes:"get all changed attributes",previous:"previous values for a given attribute"},r=function(e,t){this.innerQuery=new i(a,e instanceof n?e:new n(e,t))},s={};return t.each(t.keys(a),function(e,t,n){s[e]=function(){return this.innerQuery[e].apply(this.innerQuery,arguments)}}),t.extend(r.prototype,s,{clone:function(){var e=this.innerQuery.clone.apply(this.innerQuery,arguments);return new r(e)},load:function(){var e=this.innerQuery.load.apply(this.innerQuery,arguments);return new r(e)}}),r}),define("js/components/default_request",["underscore","backbone","js/components/api_query","js/components/multi_params"],function(e,t,n,i){var a=function(t){if(e.isString(t))return!0;if(e.isArray(t))for(var n=t.length,i=0;i<n;i++){var a=t[i];if(!e.isString(a)&&!e.isNumber(a))return!1}return!0},r={query:function(t){return!!e.isUndefined(t)||t instanceof n},target:a,sender:a,options:a};return i.extend({_validate:function(t,n){return e.forOwn(t,function(e,n){var i=t[n];if(!(n in r))throw new Error("Invalid attr: "+n);if(!r[n].call(r,i))throw new Error("Invalid value:key "+n+i)}),!0},set:function(e,n,i){var a;if(this._checkLock(),null==e)return this;"object"===_typeof(e)?(a=e,i=n):(a={})[e]=n,t.Model.prototype.set.call(this,a,i)},_checkParsed:function(t){if(e.isObject(t)){var i={};return"#query"in t&&!e.isEmpty(t["#query"])&&(i.query=new n(t["#query"])),"#path"in t&&(i.target=t["#path"][0]),"#hash"in t&&e.extend(i,e.each(t["#hash"],function(e,t,n){1==e.length&&(n[t]=e[0])})),i}return t},url:function(t){t||(t=this.attributes);var n=t.target,a=n?e.isArray(n)?n.join("/"):n:"";return"query"in t&&(a+="?"+t.query.url()),"sender"in t&&(a+="#"+i.prototype.url.call(this,{sender:t.sender})),a},load:function(e){return i.prototype.load.call(this,e.indexOf("?")>-1?e:e+"?")}})}),define("js/components/api_request",["underscore","backbone","js/components/facade","js/components/default_request"],function(e,t,n,i){var a={get:"get a key",set:"set (replace existing)",url:"url string defining this request",has:"has a key",load:"loads request as a string",clear:"clears all values",unset:"removes a key",toJSON:"values back as JSON object",clone:"make a copy",isLocked:!0,lock:!0,unlock:!0,pairs:"get all values as pairs",keys:"as keys",values:"only values",hasChanged:"whether this object has modification (since its creation)",previousAttributes:"get all changed attributes",previous:"previous values for a given attribute"},r=function(e,t){this.innerRequest=new n(a,e instanceof i?e:new i(e,t))},s={};return e.each(e.keys(a),function(e,t,n){s[e]=function(){return this.innerRequest[e].apply(this.innerRequest,arguments)}}),e.extend(r.prototype,s,{clone:function(){var e=this.innerRequest.clone.apply(this.innerRequest,arguments);return new r(e)},load:function(){var e=this.innerRequest.load.apply(this.innerRequest,arguments);return new r(e)}}),r}),define("js/mixins/widget_utility",[],function(){var e={extendMethod:function(e,t,n){if(!_.isUndefined(t[n])){var i=e[n];e[n]=function(){var e=i.apply(this,arguments);return t[n].apply(this,arguments),e}}}};return e}),define("js/mixins/widget_mixin_method",["js/mixins/widget_utility"],function(e){return function(t,n){var i=this.prototype;_.extend(t,i),_.extend(t.events,i.events),_.each(Array.prototype.slice.call(arguments,1),function(n){e.extendMethod(i,t,n)})}}),define("js/components/api_targets",[],function(){var e={BOOTSTRAP:"/accounts/bootstrap",SEARCH:"search/query",QTREE:"search/qtree",BIGQUERY:"search/bigquery",EXPORT:"export/",SERVICE_AUTHOR_NETWORK:"vis/author-network",SERVICE_PAPER_NETWORK:"vis/paper-network",SERVICE_WORDCLOUD:"vis/word-cloud",SERVICE_METRICS:"metrics",SERVICE_OBJECTS:"objects",SERVICE_OBJECTS_QUERY:"objects/query",SERVICE_CITATION_HELPER:"citation_helper",SERVICE_AUTHOR_AFFILIATION_EXPORT:"authoraff",MYADS_STORAGE:"vault",MYADS_NOTIFICATIONS:"vault/_notifications",AUTHOR_AFFILIATION_SEARCH:"author-affiliation/search",AUTHOR_AFFILIATION_EXPORT:"author-affiliation/export",RESOLVER:"resolver",CSRF:"accounts/csrf",USER:"accounts/user",USER_DATA:"vault/user-data",SITE_CONFIGURATION:"vault/configuration",TOKEN:"accounts/token",LOGOUT:"accounts/logout",REGISTER:"accounts/register",VERIFY:"accounts/verify",DELETE:"accounts/user/delete",RESET_PASSWORD:"accounts/reset-password",CHANGE_PASSWORD:"accounts/change-password",CHANGE_EMAIL:"accounts/change-email",RECOMMENDER:"recommender",GRAPHICS:"graphics",FEEDBACK:"feedback/userfeedback",LIBRARY_IMPORT_CLASSIC_AUTH:"harbour/auth/classic",LIBRARY_IMPORT_CLASSIC_MIRRORS:"harbour/mirrors",LIBRARY_IMPORT_CLASSIC_TO_BBB:"biblib/classic",LIBRARY_IMPORT_ADS2_AUTH:"harbour/auth/twopointoh",LIBRARY_IMPORT_ADS2_TO_BBB:"biblib/twopointoh",LIBRARY_IMPORT_ZOTERO:"harbour/export/twopointoh/zotero",LIBRARY_IMPORT_MENDELEY:"harbour/export/twopointoh/mendeley",LIBRARY_IMPORT_CREDENTIALS:"harbour/user",ORCID_PREFERENCES:"orcid/preferences",ORCID_NAME:"orcid/orcid-name",LIBRARIES:"biblib/libraries",LIBRARY_TRANSFER:"biblib/transfer",DOCUMENTS:"biblib/documents",PERMISSIONS:"biblib/permissions",REFERENCE:"reference/text",_limits:{ExportWidget:{default:500,limit:3e3},Metrics:{default:7e3,limit:7e3},AuthorNetwork:{default:400,limit:1e3},PaperNetwork:{default:400,limit:1e3},ConceptCloud:{default:150,limit:150},BubbleChart:{default:1500}}};return e._doesntNeedCredentials=[e.SEARCH,e.QTREE,e.BIGQUERY,e.EXPORT,e.SERVICE_AUTHOR_NETWORK,e.SERVICE_PAPER_NETWORK,e.SERVICE_WORDCLOUD,e.SERVICE_METRICS,e.RECOMMENDER,e.GRAPHICS,e.FEEDBACK],e}),define("js/components/pubsub_events",[],function(){return{START_SEARCH:"[PubSub]-New-Query",INVITING_REQUEST:"[PubSub]-Inviting-Request",DELIVERING_REQUEST:"[PubSub]-New-Request",EXECUTE_REQUEST:"[PubSub]-Execute-Request",EXECUTE_STORED_QUERY:"[PubSub]-Execute-Stored-Query",DELIVERING_RESPONSE:"[PubSub]-New-Response",CLOSING_GATES:"[PubSub]-Closing",CLOSED_FOR_BUSINESS:"[PubSub]-Closed",OPENING_GATES:"[PubSub]-Opening",OPEN_FOR_BUSINESS:"[PubSub]-Ready",SMALL_FIRE:"[PubSub]-Problem",BIG_FIRE:"[PubSub]-Big-Problem",CITY_BURNING:"[PubSub]-Disaster",FEEDBACK:"[FC]-FeedBack",DISPLAY_DOCUMENTS:"[Router]-Display-Documents",DISPLAY_DOCUMENTS_DETAILS:"[Router]-Display-Documents-Details",GET_QTREE:"[FC]-GetQTree",NAVIGATE:"[Router]-Navigate-With-Trigger",PAGE_CHANGE:"[Navigator]Page-Changed",CUSTOM_EVENT:"[PubSub]-Custom-Event",ARIA_ANNOUNCEMENT:"[PubSub]-Aria-Announcement",USER_ANNOUNCEMENT:"[PubSub]-User-Announcement",ALERT:"[Alert]-Message",ORCID_ANNOUNCEMENT:"[PubSub]-Orcid-Announcement",APP_LOADED:"[App]-Application-Loaded",APP_BOOTSTRAPPED:"[App]-Application-Bootstrapped",APP_STARTING:"[App]-Application-Starting",APP_STARTED:"[App]-Application-Started",APP_EXIT:"[App]-Exit",PAPER_SELECTION:"[User]-Paper-Selection",BULK_PAPER_SELECTION:"[User]-Bulk-Paper-Selection",STORAGE_PAPER_UPDATE:"[User]-Paper-Update",LIBRARY_CHANGE:"[PubSub]-Library-Change"}}),define("js/components/pubsub_key",["underscore"],function(e){var t=function(t){e.extend(this,t)};return e.extend(t,{newInstance:function(n){var i={id:e.has(n,"id")?n.id:e.uniqueId(":psk"),creator:e.has(n,"creator")?n.creator:null};return new t({getId:function(){return i.id},getCreator:function(){return i.creator}})}}),t}),define("js/mixins/dependon",["underscore","js/components/pubsub_events","js/components/pubsub_key"],function(e,t,n){return{BeeHive:{setBeeHive:function(t){if(e.isEmpty(t))throw new Error("Huh? Empty Beehive? Trying to be funny?");this.__beehive=t},getBeeHive:function(){if(!this.hasBeeHive())throw new Error("The BeeHive is inactivate (or dead :<})");return this.__beehive},hasBeeHive:function(){return!(!this.__beehive||!(this.__beehive.active||this.__beehive.__facade__&&this.__beehive.getActive()))},getPubSub:function(){if(!this.hasBeeHive())throw new Error("The BeeHive is inactive (or dead >:})");if(this.__ctx||(this.__ctx={}),this.__ctx.pubsub)return this.__ctx.pubsub;var i=this.__beehive.getService("PubSub");return i&&i.__facade__?i:(this.__ctx.pubsub={_key:i.getPubSubKey(),_exec:function(t,a){if((a=e.toArray(a))[0]instanceof n)throw Error("You have given us a PubSub key, this.publish() method does not need it.");a.unshift(this._key),i[t].apply(i,a)},publish:function(){this._exec("publish",arguments)},subscribe:function(){this._exec("subscribe",arguments)},subscribeOnce:function(){this._exec("subscribeOnce",arguments)},unsubscribe:function(){this._exec("unsubscribe",arguments)},getCurrentPubSubKey:function(){return this._key}},e.extend(this.__ctx.pubsub,t),this.__ctx.pubsub)},hasPubSub:function(){return!!this.hasBeeHive()&&e.isObject(this.__beehive.getService("PubSub"))}},App:{setApp:function(t){if(e.isUndefined(t))throw new Error("App object cannot be empty");this.__app=t},getApp:function(){return this.__app},hasApp:function(){return!e.isEmpty(this.__app)}}}}),define("js/mixins/hardened",["underscore","js/components/facade"],function(e,t){return{_getHardenedInstance:function(e,n){if(!("hardenedInterface"in this||e))throw Error("Error: this.hardenedInterface is not defined");return new t(e||("hardenedInterface"in this?this.hardenedInterface:{}),n)},getHardenedInstance:function(e){return this._getHardenedInstance(e,this)}}}),define("js/components/api_feedback",["underscore","backbone","js/mixins/hardened"],function(e,t,n){var i=function(t){e.extend(this,e.defaults(t||{},{code:200,msg:void 0})),this.setCode(this.code)};i.CODES={INVALID_PASSWORD:498,ACCOUNT_NOT_FOUND:495,ALREADY_LOGGED_IN:493,REQUIRES_LOGIN:491,TOO_MANY_CHARACTERS:486,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,INTERNAL_SERVER_ERROR:500,BAD_GATEWAY:502,SERVER_ERROR:503,TOO_MANY_FAILURES:580,ALL_FINE:200,KEEP_WAITING:190,TESTING:0,MAKE_SPACE:-1,UNMAKE_SPACE:-1.1,SEARCH_CYCLE_STARTED:-2,SEARCH_CYCLE_FAILED_TO_START:-3,SEARCH_CYCLE_PROGRESS:-4,SEARCH_CYCLE_STOP_MONITORING:-5,SEARCH_CYCLE_FINISHED:-6,QUERY_ASSISTANT:-7,ALERT:-8,CANNOT_ROUTE:-9,API_REQUEST_ERROR:-10,BIBCODE_DATA_REQUESTED:-11};var a={};return e.each(e.pairs(i.CODES),function(e){a[e[1]]=e[0]}),e.extend(i.prototype,{hardenedInterface:{code:"integer value of the code",msg:"string message",toJSON:"for cloning",getApiRequest:"to get the original request",getSenderKey:"retrieve the senders key"},initialize:function(){},toJSON:function(){return{code:this.code,msg:this.msg}},setCode:function(e){if(!a[e])throw new Error("This code is not in the list ApiCodes - please extend js/components/api_feedback first:",this.code);this.code=e},setApiRequest:function(e){this.req=e},getApiRequest:function(){return this.req},setMsg:function(e){this.msg=e},getSenderKey:function(){return this.senderKey},setSenderKey:function(e){this.senderKey=e}},n),i.extend=t.Model.extend,i}),define("js/mixins/widget_state_manager",["underscore","js/components/api_feedback"],function(e,t){return{STATES:{LOADING:"loading",ERRORED:"errored",IDLE:"idle",READY:"ready"},activateWidget:function(){this.__widgetHandlerManager=new function(){this.handlers={},this.on=function(e,t){this.handlers[e].push(t)},this.off=function(t){e.forEach(this.handlers,function(e,n){var i=e.indexOf(t);i>-1&&e.splice(i,1)})},this.fire=function(t,n,i){e.forEach(this.handlers[t],function(e){e.apply(i,n)})},e.reduce(t.CODES,function(e,t){return e[t]=[],e},this.handlers)};var n=this.getPubSub();n.subscribe(n.FEEDBACK,e.bind(this.__handleFeedback,this)),this.updateState("ready")},__handleFeedback:function(e,t){this.getPubSub().getCurrentPubSubKey().getId()===t.getId()&&this.__widgetHandlerManager.fire(e.code,arguments,this)},attachHandler:function(e,t){try{this.__widgetHandlerManager.on(e,t)}catch(e){console.error(e)}},attachGeneralHandler:function(n){e.forEach(t.CODES,e.bind(function(e){(e>0||e===t.CODES.API_REQUEST_ERROR)&&this.attachHandler(e,n)},this))},detachHandler:function(e){this.__widgetHandlerManager.off(e)},onReady:e.noop,onLoading:e.noop,onIdle:e.noop,onErrored:e.noop,onStateChange:e.noop,updateState:function(t){if(t&&e.isString(t)&&t!==this.__state){var n=this.__state;this.__state=t,this.__fireStateHandler(),this.onStateChange.call(this,t,n)}},getState:function(){return this.__state},__fireStateHandler:function(){var e={};e.ready=this.onReady,e.loading=this.onLoading,e.idle=this.onIdle,e.errored=this.onErrored,e[this.__state]&&e[this.__state].call(this,this)}}}),define("js/widgets/base/base_widget",["backbone","marionette","js/components/api_query","js/components/api_request","js/mixins/widget_mixin_method","js/components/api_targets","js/mixins/dependon","js/mixins/widget_state_manager"],function(e,t,n,i,a,r,s,o){var l=t.Controller.extend({initialize:function(e){e=e||{},_.bindAll(this,"dispatchRequest","processResponse"),this._currentQuery=new n,this.defaultQueryArguments=this.defaultQueryArguments||{},e.defaultQueryArguments&&(this.defaultQueryArguments=_.extend(this.defaultQueryArguments,e.defaultQueryArguments)),e.view&&(this.view=e.view,this.collection=e.view.collection),this.view&&t.bindEntityEvents(this,this.view,t.getOption(this,"viewEvents")),this.model&&t.bindEntityEvents(this,this.model,t.getOption(this,"modelEvents"))},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");t.subscribe(t.INVITING_REQUEST,_.bind(this.dispatchRequest,this)),t.subscribe(t.DELIVERING_RESPONSE,_.bind(this.processResponse,this))},dispatchNewQuery:function(e){_.each(this.defaultQueryArguments,function(t,n){e.unset(n)});var t=this.getPubSub();t.publish(t.NAVIGATE,"search-page",{q:e})},dispatchRequest:function(e){this._dispatchRequest(e)},_dispatchRequest:function(e){var t=this.customizeQuery(e);if(t){var n=this.composeRequest(t);if(n){var i=this.getPubSub();i.publish(i.DELIVERING_REQUEST,n)}}},customizeQuery:function(e){var t=e.clone();return t.unlock(),this.defaultQueryArguments&&(t=this.composeQuery(this.defaultQueryArguments,t)),t},processResponse:function(e){var t=e.getApiQuery();throw this.setCurrentQuery(t),new Error("you need to customize this function")},composeRequest:function(e){return new i({target:r.SEARCH,query:e})},setCurrentQuery:function(e){this._currentQuery=e},getCurrentQuery:function(){var e,t=new n({});try{if(this._currentQuery instanceof n)t=this._currentQuery;else if(_.isFunction(this.getBeeHive)&&(e=this.getBeeHive()).hasObject("AppStorage")){var i=e.getObject("AppStorage").getCurrentQuery();i instanceof n&&(t=i)}}catch(e){console.error(e.message)}finally{return t}},composeQuery:function(e,t){var n;return n=t||(n=this.getCurrentQuery()).clone(),e&&_.each(e,function(e,t){n.has(t)||n.set(t,e)}),n},onDestroy:function(){this.view.destroy()},getEl:function(){return this.view.el&&this.view.$el.children().length?this.view.el:this.view.render().el},render:function(){return this.view.render()},parseIdentifierFromQuery:function(e){if(!e.hasVal("q"))throw"no query";var t=e.get("q")[0];try{if(/^(?:identifier|bibcode):(.*)$/.test(t))return t.split(":")[1]}catch(e){throw"unable to parse bibcode"}throw"query must be in the format of identifer:foo or bibcode:foo"}},{mixin:a});return _.extend(l.prototype,s.BeeHive,o),l}),define("js/components/api_query_updater",["underscore","js/components/api_query"],function(e,t){var n=function(t,n){if(!t||!e.isString(t))throw new Error("You must initialize the ApiQueryUpdater with a context (which is a string)");this.context=t,this.defaultOperator=" ",this.operators=[" ","AND","OR","NOT","NEAR"],this.defaultMode="limit",this.operationModes=["limit","exclude","expand","replace","remove"],this.impossibleString="￼￼￼",e.extend(this,n)};return e.extend(n.prototype,{updateQuery:function(t,n,i,a,r){if(r=e.defaults({},r,{prefix:"__"}),!n||!e.isString(n))throw new Error("You must tell us what parameter to update in the ApiQuery");var s,o,l,c,u,d=this._n(n,r.prefix),h=e.clone(t.get(n));if(c=this._getExistingVals(t,d),a=this._sanitizeConditionAsArray(a),"limit"==(i=this._sanitizeMode(i)))u="AND";else if("exclude"==i)u="NOT";else if("expand"==i)u="OR";else{if("replace"==i)return this._closeExistingVals(t,this._n(n,r.prefix)),t.set(this._n(n,r.prefix),["AND",a[0]]),t.set(n,a[0]);if("remove"!=i)throw new Error("Unsupported mode/operator:",i);u=c[0]}if(!t.has(n)){var p=[u].concat(a);return t.set(n,this._buildQueryFromConditions(p)),void t.set(this._n(n,r.prefix),p)}if(c){if(c[0]!==u)return this._closeExistingVals(t,d),this.updateQuery(t,n,i,a);s=this._buildQueryFromConditions(c)}else if(c=[u],1==h.length)if(-1==h[0].indexOf(" "))s=h[0],c.push(h[0]);else{s=h[0];var f=h[0].toLowerCase();f.indexOf(" and ")>-1||f.indexOf(" or ")>-1||f.indexOf(" not ")>-1||f.indexOf(" near")>-1||f.indexOf("(")>2?c.push("("+h[0]+")"):c.push(h[0])}else s=this.impossibleString;if("limit"==i||"expand"==i){l=e.union(c,a),o=this._buildQueryFromConditions(l);var m=e.clone(h);if(this._modifyArrayReplaceString(m,s,o))return t.set(n,m),void t.set(d,l)}if("exclude"==i){var g=e.clone(c);g[0]="OR",s=" NOT "+this._buildQueryFromConditions(g),l=e.union(c,a);var b=e.clone(l);b[0]="OR",o=" NOT "+this._buildQueryFromConditions(b);m=e.clone(h);if(this._modifyArrayReplaceString(m,s,o))return t.set(n,m),void t.set(d,l)}else if("remove"==i){l=e.difference(c,a),o=this._buildQueryFromConditions(l);m=e.clone(h);if(this._modifyArrayReplaceString(m,s,o))return t.set(n,m),void t.set(d,l)}"limit"==i?l=this._modifyArrayAddString(h,a,"AND"):"exclude"==i?l=this._modifyArrayAddString(h,a,"NOT"):"expand"==i&&(l=this._modifyArrayAddString(h,a,"OR")),t.set(d,l),t.set(n,h)},needsEscape:function(e){for(var t,n=0;n<e.length;n++)if("\\"==(t=e[n])||"+"==t||"-"==t||"!"==t||"("==t||")"==t||":"==t||"^"==t||"["==t||"]"==t||'"'==t||"{"==t||"}"==t||"~"==t||"*"==t||"?"==t||"|"==t||"&"==t||"/"==t)return!0;return!1},escape:function(e){for(var t,n=[],i=0;i<e.length;i++)"\\"!=(t=e[i])&&"+"!=t&&"-"!=t&&"!"!=t&&"("!=t&&")"!=t&&":"!=t&&"^"!=t&&"["!=t&&"]"!=t&&'"'!=t&&"{"!=t&&"}"!=t&&"~"!=t&&"*"!=t&&"?"!=t&&"|"!=t&&"&"!=t&&"/"!=t||n.push("\\"),n.push(t);return n.join("")},escapeInclWhitespace:function(e){for(var t,n=[],i=0;i<e.length;i++)"\\"!=(t=e[i])&&"+"!=t&&"-"!=t&&"!"!=t&&"("!=t&&")"!=t&&":"!=t&&"^"!=t&&"["!=t&&"]"!=t&&'"'!=t&&"{"!=t&&"}"!=t&&"~"!=t&&"*"!=t&&"?"!=t&&"|"!=t&&"&"!=t&&"/"!=t&&" "!=t&&"\t"!=t||n.push("\\"),n.push(t);return n.join("")},quoteIfNecessary:function(e,t,n){return this.quote(e,t,n,!0)},quote:function(t,n,i,a){n||(n='"'),i||(i=n),e.isUndefined(a)&&(a=!1);for(var r,s=[],o=!1,l=0;l<t.length;l++)"\\"!=(r=t[l])&&"+"!=r&&"-"!=r&&"!"!=r&&"("!=r&&")"!=r&&":"!=r&&"^"!=r&&"["!=r&&"]"!=r&&'"'!=r&&"{"!=r&&"}"!=r&&"~"!=r&&"|"!=r&&"&"!=r&&"/"!=r&&" "!=r&&"\t"!=r||(o=!0),r!=n&&r!=i||!(0==l||l>0&&"\\"!==t[l-1])||s.push("\\"),s.push(r);return 1==a&&"\\"==s[0]&&'"'==s[1]&&"\\"==s[s.length-2]&&'"'==s[s.length-1]?(s[0]="",s[s.length-2]="",s.join("")):o||0==a?n+s.join("")+i:s.join("")},saveTmpEntry:function(e,t,n){var i,a=this._getTmpStorage(e,!0);return t in a&&(i=a[t]),a[t]=n,i},removeTmpEntry:function(e,t){var n=this._getTmpStorage(e,!0),i=n[t];return delete n[t],i},getTmpEntry:function(e,t,n){var i;return t in(i=n?this._getTmpStorage(e,!0):this._getTmpStorage(e,!1))?i[t]:(i[t]=n,n)},hasTmpEntry:function(e,t){return t in this._getTmpStorage(e)},_getTmpStorage:function(e,t){var n=this._n("__tmpStorage");if(!e.hasOwnProperty(n)){if(!t)return{};e[n]={}}return e[n]},_n:function(t,n){return(e.isString(n)?n:"__")+this.context+"_"+t},_buildQueryFromConditions:function(e){if(e.length<=1)throw new Error("Violation of contract: first condition is always an operator");var t=e[0];return" "!=t&&(t=" "+t+" "),"("+e.slice(1).join(t)+")"},_modifyArrayReplaceString:function(t,n,i,a){var r=0;if(a||(a=-1),!n)throw new Error("Your search is empty, you fool");return e.each(t,function(e,s){a>0&&r>a||e.indexOf(n)>-1&&(t[s]=e.replace(n,i),r+=1)}),r},_modifyArrayAddString:function(e,t,n){if(!(0!=e.length&&""!=e[e.length-1].trim()||"NOT"!=n&&"NEAR"!=n))throw new Error("Invalid operation; cannot apply NOT/NEAR on single clause");var i=[n,e[e.length-1]].concat(t);return e[e.length-1]=this._buildQueryFromConditions(i),i},_getExistingVals:function(e,t,n){return e.has(t)?e.get(t):n},_closeExistingVals:function(e,t){e.unset(t)},_sanitizeMode:function(t){if(!t)return this.defaultMode;var n=e.indexOf(this.operationModes,t);if(-1==n)throw new Error("Unkwnown mode: "+t);return this.operationModes[n]},_sanitizeOperator:function(t){if(!t)return this.defaultOperator;if(!e.isString(t))throw new Error("Operator must be a string");if(""==t.trim())return this.defaultOperator;t=t.toUpperCase();var n=e.indexOf(this.operators,t);if(-1==n)throw new Error("Unknown operator: ",t);return this.operators[n]},_sanitizeConditionAsArray:function(t){if(!t)throw new Error("The condition must be set (string/array of strings)");if(e.isString(t))return[t];if(0==(t=e.without(e.flatten(t),"",!1,null,void 0,NaN)).length)throw new Error("After removing empty values, no condition was left");return t},clean:function(n){var i={};return n&&n.keys&&e.each(n.keys(),function(e){"__"!=e.substring(0,2)&&(i[e]=n.get(e))}),new t(i)}}),n}),define("analytics",["underscore","jquery"],function(e,t){var n={resolver:{hooks:["toc-link-followed","abstract-link-followed","citations-link-followed","associated-link-followed"],types:["abstract","citations","references","metrics","coreads","similar","graphics","associated","toc"],url:e.template("link_gateway/<%= bibcode %>/<%= target %>")}},i=function(i,a){e.isString(i)&&e.isPlainObject(a)&&e.has(a,"target")&&e.forEach(n,function(n){var r,s=null;if(e.forEach(n.types,function(t){e.isArray(t)?t[0]===a.target&&e.has(t[1],"redirectTo")&&(s=t[1].redirectTo):t===a.target&&(s=t)}),e.contains(n.hooks,i)&&s){var o=e.assign({},a,{target:s});r=a.url?a.url:n.url(o),t.ajax({url:r,type:"GET"})}})},a=[],r=window.GoogleAnalyticsObject||"ga",s=function(){if(window[r]){for(var e=0;e<a.length;e++)window[r].apply(this,a[e]);a=[]}};return function(){return i.apply(null,e.rest(arguments,3)),window[r]?(a.length>0&&s(),window[r].apply(this,arguments),!0):(console.log("Buffering GA signal",arguments),a.push(arguments),setTimeout(s,1e3),!1)}}),define("babel",{}),define("es6",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("js/widgets/facet/toggle_list.jsx",["react","d3","prop-types","react-redux"],function(e,t,n,i){var a=this,r=i.useSelector,s=function(n){var i=n.reduxState,a=n.toggleFacet,s=n.unselectFacet,l=n.value,c=n.currentLevel,u=n.showMoreFacets,d=n.resetVisibleFacets,h=n.selectFacet,p=n.hierarchical,f=n.isChecked,m=n.name,g=n.count,b=n.id,v=n.index,y=r(function(e){return e.config}),w="facet-label__title_".concat(y.facetField,"_").concat(p?"":"child","_").concat(v),_=e.createElement("label",{className:"facet-label custom-checkbox",htmlFor:"".concat(w,"__checkbox")},e.createElement("input",{type:"checkbox",id:"".concat(w,"__checkbox"),onChange:function(e){e.target.checked?(h(b),2===y.hierMaxLevels&&"function"==typeof a&&a(b,!0)):s(b)},checked:f,"aria-describedby":w})," ",e.createElement("span",null,e.createElement("span",{className:"facet-label__title",id:w},m),e.createElement("span",{className:"facet-label__amount",title:g},function(e){return t.format("s")(e).replace(/\.\d{2,}/,function(e){return e.slice(0,2)}).replace(".0","")}(g))));return p?e.createElement(o,{id:l,reduxState:i,currentLevel:c+1,showMoreFacets:u,resetVisibleFacets:d,toggleFacet:a,selectFacet:h,unselectFacet:s},_):_};s.propTypes={isChecked:n.bool.isRequired,name:n.string.isRequired,count:n.number.isRequired,reduxState:n.shape({config:n.object,state:n.object,pagination:n.object,children:n.array,facets:n.object}).isRequired,currentLevel:n.number,showMoreFacets:n.func,resetVisibleFacets:n.func,toggleFacet:n.func,selectFacet:n.func,unselectFacet:n.func,id:n.string,index:n.number};var o=function(t){var n=t.reduxState,i=t.currentLevel,r=t.children,o=t.selectFacet,l=t.unselectFacet,c=t.showMoreFacets,u=t.resetVisibleFacets,d=t.toggleFacet,h=t.id,p=1===i?n:n.facets[h],f=p.state.open,m=p.state.visible,g=p.pagination.finished||!1,b=_.values(_.pick(n.facets,p.children)),v="";"loading"===p.pagination.state?v=e.createElement("span",null,"loading..."):"failure"===p.pagination.state?v=e.createElement("span",null,e.createElement("i",{className:"icon-danger","aria-hidden":"true"}),"request failed"):"success"!==p.pagination.state||b.length||(v=e.createElement("span",null,"no data retrieved"));var y=null;y=b.length?b.slice(0,m).map(function(t,a){var r={isChecked:n.state.selected.indexOf(t.value)>-1,name:t.name,count:t.count,hierarchical:n.config.hierMaxLevels>i,value:t.value,id:t.value,selectFacet:o,unselectFacet:l,label:a};return r.hierarchical&&(r=_objectSpread(_objectSpread({},r),{},{showMoreFacets:c,resetVisibleFacets:u,reduxState:n,currentLevel:i,toggleFacet:d})),e.createElement("li",{key:t.value},e.createElement(s,_extends({},r,{index:a})))},a):e.createElement("li",null);var w,x=!g||b.length>m?"btn btn-default btn-xs facet__pagination-button":" hidden",S=m>5?"btn btn-default btn-xs facet__pagination-button":"hidden",E=i>1?"facet__list-container facet__list-container--child":"facet__list-container";return f&&(w=e.createElement("div",{className:E},e.createElement("ul",{className:"facet__list"},y),e.createElement("div",{className:"facet__state-message"},v),e.createElement("div",{className:"facet__pagination-container"},e.createElement("button",{type:"button",className:S,onClick:function(){return u(h)}},"less"),e.createElement("button",{type:"button",className:x,onClick:function(){return c(h)}},"more")))),e.createElement("div",null,e.createElement("div",{className:"facet__toggle"},e.createElement("i",{role:"button","aria-label":"facet toggle","aria-hidden":"true",tabIndex:"0",className:f?"facet__icon facet__icon--open":"facet__icon facet__icon--closed",onClick:function(){return d(h,!f)},onKeyPress:function(e){13===e.which&&d(h,!f)}})," ",r),w)};return o.defaultProps={children:[]},o.propTypes={reduxState:n.shape({config:n.object,state:n.object,pagination:n.object,children:n.array,facets:n.object}).isRequired,children:n.children,currentLevel:n.number.isRequired,showMoreFacets:n.func.isRequired,resetVisibleFacets:n.func.isRequired,toggleFacet:n.func.isRequired,selectFacet:n.func.isRequired,unselectFacet:n.func.isRequired,id:n.string.isRequired},o}),define("js/widgets/facet/facet-dropdown.jsx",["react","prop-types","react-redux"],function(e,t,n){var i=n.useSelector,a=function(t){var n=t.activeFacets,a=t.onSubmitFilter,r=i(function(e){return{logicOptions:e.config.logicOptions,facetTitle:e.config.facetTitle}}),s=r.logicOptions,o=r.facetTitle;if(0===n.length)return e.createElement("div",{style:{display:"none"}});if(n.length>25)return e.createElement("div",{className:"facet__dropdown"},e.createElement("div",null,"select no more than 25 facets at a time"));var l=s[1===n.length?"single":"multiple"];return"invalid choice"===l[0]?e.createElement("div",{className:"facet__dropdown"},e.createElement("div",null,"invalid choice!")):e.createElement("div",{className:"facet__dropdown"},e.createElement("div",{className:"facet__dropdown__title",style:{display:"flex",flexDirection:"column"}},e.createElement("div",null,o),e.createElement("div",null,e.createElement("b",null,n.length)," selected")),e.createElement("div",{className:"btn-group-vertical",style:{display:"flex",justifyContent:"center",flexDirection:"column"}},l.map(function(t){return e.createElement("button",{key:t,className:"btn btn-default",type:"button",onClick:function(){return a(t)}},t)})))};return a.defaultProps={activeFacets:[],onSubmitFilter:function(){}},a.propTypes={activeFacets:t.arrayOf(t.string),onSubmitFilter:t.func},a}),define("js/widgets/facet/reducers",["underscore"],function(e){function t(e,n){switch(e||(e=t.getDefaultState()),n.type){case"DATA_REQUESTED":return t.dataRequested(e,n.id);case"DATA_RECEIVED":return t.dataReceived(e,n.data,n.id);case"INCREASE_VISIBLE":return t.increaseVisible(e,n.num,n.id);case"RESET_VISIBLE":return t.resetVisible(e,n.id);case"FACET_SELECTED":return t.facetSelected(e,n.id);case"FACET_UNSELECTED":return t.facetUnselected(e,n.id);case"FACET_TOGGLED":return t.facetToggled(e,n.open,n.id);case"SUBMIT_FILTER":return t.submitFilter(e,n.logicOption);case"RESET_STATE":return t.getDefaultState(e);default:return e}}function n(e){var t=e.split("/");if(t.length>2){var n=t[t.length-2];return n=parseInt(e[0])-1+"/"+n}}function i(t,n,i,a){if(a=a||"state",!n){var r=e.assign({},t);return r[a]=e.assign({},t[a],i),r}var s={};return s[n]=e.assign({},t.facets[n]),s[n][a]=e.assign({},t.facets[n][a],i),e.assign({},t,{facets:e.assign({},t.facets,s)})}return t.getActiveFacets=function(e,t){return t.map(function(e){return!(t.indexOf(n(e))>-1)&&e}).filter(function(e){if(e)return e})},t.facetSelected=function(t,n){var i=t.facets[n].state.visible,a=e.unique(t.state.selected.concat(t.facets[n].children.slice(0,i).concat([n]))),r=e.filter(e.pairs(t.facets),function(e){return e[1].children.indexOf(n)>-1});if(r.length){r=r[0][0];var s=t.facets[r],o=s.children.slice(0,s.state.visible);e.intersection(a,o).length===o.length&&(a=a.concat([r]))}return e.assign({},t,{state:e.assign({},t.state,{selected:a})})},t.facetUnselected=function(t,i){var a=e.without(t.state.selected,i),r=n(i);return r&&(a=e.without(a,r)),a=e.without.apply(void 0,[a].concat(t.facets[i].children)),e.assign({},t,{state:e.assign({},t.state,{selected:a})})},t.resetVisible=function(e,t){return i(e,t,{visible:5})},t.increaseVisible=function(e,t,n){return i(e,n,n?{visible:e.facets[n].state.visible+t}:{visible:e.state.visible+t})},t.facetToggled=function(e,t,n){return i(e,n,{open:t})},t.dataRequested=function(t,n){if(n)a=e.assign({},t.facets[n].pagination,{state:"loading"});else var a=e.assign({},t.pagination,{state:"loading"});return i(t,n,a,"pagination")},t.processData=function(n,i){i=i||[],e.isFunction(i)&&(i=[i]);n=n.map(function(i,a){if(a%2==0)return{name:i.split("/")[i.split("/").length-1],value:i,count:n[a+1],pagination:e.assign({},e.cloneDeep(t.defaultState.pagination)),children:[],state:e.assign({},e.cloneDeep(t.defaultState.state))}}).filter(function(e){if(e)return e});return e.compose.apply(e,i)(n)},t.dataReceived=function(n,i,a){var r=i.facet_counts.facet_fields[Object.keys(i.facet_counts.facet_fields)[0]],s=r.length/2!=parseInt(i.responseHeader.params["facet.limit"]),o=(r=t.processData(r,n.config.preprocessors)).map(function(e){return e.value});if(r=e.object(o,r),!a)return e.assign({},n,{pagination:e.assign({},n.pagination,{state:"success",finished:s}),facets:e.assign({},n.facets,r),children:n.children.concat(o)});var l=e.assign({},n.facets[a],{children:n.facets[a].children.concat(o),pagination:e.assign({},n.facets[a].pagination,{state:"success",finished:s})}),c=e.assign({},n.facets,r);if(c[a]=l,n.state.selected.indexOf(a)>-1)var u=e.uniq(n.state.selected.concat(o.slice(0,n.facets[a].state.visible)));else u=n.state.selected;return e.assign({},n,{facets:c,state:e.assign({},n.state,{selected:u})})},t.submitFilter=function(e){throw new Error("this should be overridden by the widget")},t.defaultState={config:{preprocessors:[],hierMaxLevels:1,facetField:void 0,openByDefault:!1},state:{open:!1,visible:5,selected:[]},pagination:{state:void 0,finished:!1},children:[],facets:{}},t.getDefaultState=function(t){return e.assign({},this.defaultState,{config:t.config})},t}),define("js/widgets/facet/facet-container.jsx",["react","react-redux","prop-types","./toggle_list.jsx","./facet-dropdown.jsx","./reducers"],function(e,t,n,i,a,r){var s=t.connect,o=r.getActiveFacets,l=function(t){var n=t.activeFacets,r=t.reduxState,s=t.resetVisibleFacets,o=t.selectFacet,l=t.showMoreFacets,c=t.submitFilter,u=t.toggleFacet,d=t.unselectFacet,h=e.createElement("div",{role:"button",tabIndex:"0",onClick:function(){return u(void 0)},onKeyPress:function(e){13===e.which&&u(void 0)},style:{display:"inline-block"}},e.createElement("h3",{className:"facet__header"},r.config.facetTitle));return e.createElement("div",{className:"facet__container"},e.createElement(i,{reduxState:r,currentLevel:1,showMoreFacets:l,resetVisibleFacets:s,toggleFacet:u,selectFacet:o,unselectFacet:d},h,e.createElement(a,{activeFacets:n,onSubmitFilter:c})))};l.defaultProps={},l.propTypes={activeFacets:n.arrayOf(n.object).isRequired,reduxState:n.shape({config:n.object,state:n.object,pagination:n.object,children:n.array,facets:n.object}).isRequired,showMoreFacets:n.func.isRequired,resetVisibleFacets:n.func.isRequired,toggleFacet:n.func.isRequired,selectFacet:n.func.isRequired,unselectFacet:n.func.isRequired,submitFilter:n.func.isRequired};return s(function(e){return{reduxState:e,activeFacets:o(e,e.state.selected)}},function(e,t){return{selectFacet:function(n){e(t.actions.select_facet(n))},unselectFacet:function(n){e(t.actions.unselect_facet(n))},toggleFacet:function(n,i){e(t.actions.toggle_facet(n,i))},showMoreFacets:function(n){e(t.actions.increase_visible(n))},resetVisibleFacets:function(n){e(t.actions.reset_visible(n))},submitFilter:function(n){e(t.actions.submit_filter(n))}}})(l)}),define("js/widgets/facet/actions",["underscore"],function(e){var t={data_requested:function(e){return{type:"DATA_REQUESTED",id:e}},reset_visible:function(e){return{type:"RESET_VISIBLE",id:e}},increase_visible:function(e){return function(n,i){(e?i().facets[e].children.length:i().children.length)-((e?i().facets[e].state.visible:i().state.visible)+5)<=5&&n(this.fetch_data(e)),n({type:"INCREASE_VISIBLE",id:e,num:5}),i().state.selected.indexOf(e)>-1&&n(t.select_facet(e))}.bind(this)},data_received:function(e,t){return{type:"DATA_RECEIVED",data:e,id:t}},toggle_facet:function(t,n){return function(i,a){var r=t?a().facets[t].state.open:a().state.open;n=e.isBoolean(n)?n:!r;var s=t?a().facets[t].children.length:a().children.length;n&&!s&&i(this.fetch_data(t)),i({type:"FACET_TOGGLED",open:n,id:t})}.bind(this)},fetch_data:function(e,t){throw new Error("this was supposed to be overridden!")},select_facet:function(e){return{type:"FACET_SELECTED",id:e}},unselect_facet:function(e){return{type:"FACET_UNSELECTED",id:e}},submit_filter:function(e){throw new Error("this was supposed to be overridden!")},reset_state:function(){return{type:"RESET_STATE"}}};return function(){return Object.create(t)}}),define("js/widgets/facet/create_store",["underscore","redux","redux-thunk","js/widgets/facet/reducers"],function(e,t,n,i){return function(a){a={config:e.assign({},i.defaultState.config,a)};var r=e.assign({},e.cloneDeep(i.defaultState),a);return t.createStore(i,r,t.applyMiddleware(n.default))}}),define("utils",["jquery","underscore","analytics","react","js/components/api_query","js/components/api_request"],function(e,t,n,i,a,r){return{qs:function(e,n,i){var a=e.replace(/[*+?^$.[\]{}()|\\\/]/g,"\\$&"),r="(^|[\\?&])"+a+"=[^&]*",s=(n||window.location.hash).match(new RegExp(r,"g"));if(!s)return null;for(var o=[],l=0;l<s.length;l+=1)o.push(s[l].replace(new RegExp("(^|[\\?&])"+a+"="),""));if(i){var c=o.join(i);return decodeURIComponent(c.replace(/\+/g," "))}return!1===i?t.map(o,function(e){return decodeURIComponent(e.replace(/\+/g," "))}):null},updateHash:function(e,n,i){var a=e.replace(/[*+?^$.[\]{}()|\\\/]/g,"\\$&"),r=t.isString(i)?i:window.location.hash,s=r.match(new RegExp("&?"+a+"=([^&]+)(&|$)"));if(s){var o=s[0].replace(s[1],n);return r.replace(s[0],o)}return i},difference:function e(n,i){return t.transform(n,function(n,a,r){t.isEqual(a,i[r])||(n[r]=t.isObject(a)&&t.isObject(i[r])?e(a,i[r]):a)})},getBrowserInfo:function(){var t=e.Deferred(),n=setTimeout(function(){t.reject()},3e3);return window.require(["bowser"],function(e){window.clearTimeout(n),t.resolve(e.parse(window.navigator.userAgent))},function(){t.reject()}),t.promise()},TimingEvent:function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Timers",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Generic Timer",i=arguments.length>2?arguments[2]:void 0;_classCallCheck(this,e),this.timingCategory=n,this.timingVar=t,this.timingLabel=i,this.time=null}return _createClass(e,[{key:"start",value:function(){this.time=+new Date,this._emitted=!1}},{key:"stop",value:function(){if(!this._emitted){var e=+new Date-this.time;n("send",{hitType:"timing",timingCategory:this.timingCategory,timingVar:this.timingVar,timingLabel:this.timingLabel,timingValue:e}),this._emitted=!0}}}]),e}(),waitForSelector:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var a=e.Deferred(),r=null;return function t(i){var s=e.apply(void 0,n);return s.length?a.resolve(s):i>=3100?a.reject("timeout"):(r=setTimeout(function(){window.requestAnimationFrame(function(){t(i+=1)})},100),null)}(0),a.promise.destroy=function(){window.clearTimeout(r),a.reject()},a.promise()},withPrerenderedContent:function(t){return t.handlePrerenderedContent=function(n,i){var a=t.tagName+"."+t.className;t.$el=e(a,i),e(">",t.$el).addClass("tex2jax_ignore"),t.el=t.$el.get(0),t.delegateEvents();var r=t._renderTemplate;t._renderTemplate=function(){},t.model.once("change",function(){t._renderTemplate=r})},t},escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},makeApiQuery:function(e){return new a(e)},makeApiRequest:function(e){return new r(e)},extractErrorMessageFromAjax:function(e,t){if(void 0!==e&&void 0!==e.responseJSON){if("string"==typeof e.responseJSON.error)return e.responseJSON.error;if("string"==typeof e.responseJSON.message)return e.responseJSON.message}return t}}}),define("js/widgets/facet/widget",["backbone","js/components/api_query","js/components/api_request","js/widgets/base/base_widget","js/components/api_query_updater","analytics","react","react-dom","react-redux","./facet-container.jsx","./actions","./reducers","./create_store","utils"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p){var f=e.View.extend({render:function(e,t){return o.render(s.createElement(l.Provider,{store:e},s.createElement(c,{actions:t})),this.el),this},destroy:function(){o.unmountComponentAtNode(this.el)}});return i.extend({initialize:function(e){e=e||{};var t=_.pick(e,["facetTitle","facetField","preprocessors","hierMaxLevels","logicOptions","openByDefault"]);this.defaultQueryArguments=_.extend({},this.defaultQueryArguments,e.defaultQueryArguments,{"facet.field":e.facetField}),this.store=h(t),this.actions=u(),this.queryUpdater=new a(t.facetField),this.actions.fetch_data=function(e){return this._dispatchRequest.bind(this,e)}.bind(this),this.actions.submit_filter=function(e){return this.submitFilter.bind(this,e)}.bind(this),this.view=new f,this.view.render=_.partial(this.view.render,this.store,this.actions),e.debug||(this._dispatchRequest=_.debounce(_.bind(this._dispatchRequest,this),300))},defaultQueryArguments:{facet:"true","facet.mincount":"1","facet.limit":20,fl:"id"},activate:function(e){this.setBeeHive(e),_.bindAll(this,"dispatchRequest","processResponse"),this.getPubSub().subscribe(this.getPubSub().INVITING_REQUEST,this.dispatchRequest),this.activateWidget(),this.attachGeneralHandler(this.onApiFeedback),window.store?window.store.push(this.store):window.store=[this.store]},onApiFeedback:function(){var e=this.store.dispatch;setTimeout(function(){e({type:"FACET_TOGGLED",open:!1})},300),this.updateState(this.STATES.ERRORED)},dispatchRequest:function(e){this._sortChanged(e)||(this.setCurrentQuery(e),this.store.dispatch(this.actions.reset_state()),this.store.getState().config.openByDefault&&this.store.dispatch(this.actions.toggle_facet(void 0,!0)))},_sortChanged:function(e){try{var t=p.difference(e.toJSON(),this.getCurrentQuery().toJSON())}catch(e){}return t&&t.sort&&1===_.keys(t).length},_dispatchRequest:function(e){var t=this.getPubSub(),n=this,i=this.getCurrentQuery();this.store.dispatch(this.actions.data_requested(e)),t.subscribeOnce(t.DELIVERING_RESPONSE,function(t){n.store.dispatch(n.actions.data_received(t.toJSON(),e)),n.updateState(n.STATES.IDLE)});var a=this.customizeQuery(i),r=(e?this.store.getState().facets[e].children:this.store.getState().children).length||0;if(a.set("facet.offset",r),a.set("rows",1),e){var s=e.replace("0/","1/")+"/";a.set("facet.prefix",s)}var o=this.composeRequest(a);t.publish(t.DELIVERING_REQUEST,o),this.updateState(this.STATES.LOADING)},submitFilter:function(e){if(-1===["and","or","limit to","expand","exclude"].indexOf(e))throw new Error("we don't recognize this operator you're trying to filter on");var t=this.getCurrentQuery().clone();t.unlock();var n=this.store.getState().config.facetField,i="fq_"+n.replace("_facet_hier",""),a=d.getActiveFacets(this.store.getState(),this.store.getState().state.selected).map(function(e){return n+':"'+e+'"'});"and"==e||"limit to"==e?this.queryUpdater.updateQuery(t,i,"limit",a,{prefix:"filter_"}):"or"==e?this.queryUpdater.updateQuery(t,i,"expand",a,{prefix:"filter_"}):"exclude"!=e&&"not"!=e||(t.get(i)?this.queryUpdater.updateQuery(t,i,"exclude",a,{prefix:"filter_"}):(a.unshift("*:*"),this.queryUpdater.updateQuery(t,i,"exclude",a,{prefix:"filter_"}))),_.forEach(t.toJSON(),function(e,n){/^filter_/.test(n)&&e.length>3&&(t.unset(n),t.set("__"+n,e))});var s="{!type=aqp v=$"+i+"}",o=t.get("fq")||[];o.push(s),t.set("fq",_.unique(o)),t.unset("facet.prefix"),t.unset("facet"),t.unset("start"),t.unset("rows"),this.dispatchNewQuery(t),r("send","event","interaction","facet-applied",JSON.stringify({name:n,logic:e,conditions:a}))}})}),define("js/widgets/facet/graph-facet/widget",["underscore","utils","js/widgets/base/base_widget","js/components/api_query_updater"],function(e,t,n,i){return n.extend({initialize:function(t){t=t||{},this.processResponse=t.processResponse,this.model=new Backbone.Model,this.view=new t.graphView(e.extend(t.graphViewOptions,{model:this.model})),this.isActive=!1,this.isDone=!1,this.listenTo(this.view,"all",this.onAllInternalEvents),this.facetField=t.facetField,this.queryUpdater=new i(this.facetField),n.prototype.initialize.apply(this,arguments),this.listenTo(this.view,"facet-applied",this.handleConditionApplied),this.on("active",this.onActive),this.on("hidden",this.onHidden),this.dispatchRequest=e.debounce(e.bind(this.dispatchRequest,this),300)},activate:function(t){this.setBeeHive(t),e.bindAll(this,"dispatchRequest","processResponse","onInvitingRequest");var n=this.getPubSub();n.subscribe(n.INVITING_REQUEST,this.onInvitingRequest),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse),this.activateWidget(),this.attachGeneralHandler(this.onFeedback)},onInvitingRequest:function(e){this._sortChanged.call(this,e)||(this.isDone=!1,this.setCurrentQuery(e),this.dispatchRequest(e),this.updateState(this.STATES.LOADING))},_sortChanged:function(n){try{var i=t.difference(n.toJSON(),this.getCurrentQuery().toJSON())}catch(e){}return i&&i.sort&&1===e.keys(i).length},dispatchRequest:function(e){if(this.isActive&&!this.isDone&&e.has("q")){this.model.unset("graphData"),this.model.unset("statsCount");var t=this.customizeQuery(e),n=this.composeRequest(t),i=this.getPubSub();i.publish(i.DELIVERING_REQUEST,n),this.isDone=!0}},removeAnyOldConditions:function(t,n){var i=t.clone(),a=i.get("__"+this.facetField+"_"+n);if(a&&a.length>0){var r=e.last(a);i.get(n)[0].indexOf(r)>-1&&this.queryUpdater.updateQuery(i,n,"remove",r)}return i},handleConditionApplied:function(e){var t=this.getCurrentQuery();t.set("q",/^\(.*\)/.test(t.get("q")[0])?t.get("q")[0]:"("+t.get("q")[0]+")"),e=this.facetField+":"+e,t=t.clone(),t=this.removeAnyOldConditions(t,"q"),this.queryUpdater.updateQuery(t,"q","limit",e),this.dispatchNewQuery(t)},onActive:function(){!this.isActive&&this.isDone&&this.model.get("error")&&(this.isDone=!1,this.model.set("error",!1)),this.isActive=!0,this.dispatchRequest(this.getCurrentQuery())},onHidden:function(){this.isActive=!1},onFeedback:function(){this.model.set("error",!0),this.updateState(this.STATES.ERRORED)}})}),define("js/widgets/facet/factory",["js/widgets/facet/widget","js/widgets/facet/graph-facet/widget"],function(e,t){return{makeBasicCheckboxFacet:function(t){var n={facetTitle:t.facetTitle,displayNum:5,maxDisplayNum:100,facetField:t.facetField,openByDefault:!1,showOptions:!0,hierMaxLevels:1};return new e(_.extend(n,t))},makeHierarchicalCheckboxFacet:function(e){return e.hierMaxLevels=2,e.defaultQueryArguments=e.defaultQueryArguments||{},e.defaultQueryArguments["facet.prefix"]="0/",this.makeBasicCheckboxFacet.apply(this,arguments)},makeGraphFacet:function(e){return e=_.extend({openByDefault:!0},e),new t(e)}}}),define("js/wraps/affiliation_facet",["underscore","js/widgets/facet/factory"],function(e,t){return function(n){return t.makeHierarchicalCheckboxFacet(e.extend({facetField:"aff_facet_hier",facetTitle:"Institutions",openByDefault:!1,logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}},n))}}),define("js/wraps/author_facet",["underscore","js/widgets/facet/factory"],function(e,t){return function(n){return t.makeHierarchicalCheckboxFacet(e.extend({facetField:"author_facet_hier",facetTitle:"Authors",openByDefault:!0,logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}},n))}}),define("js/wraps/bibgroup_facet",["underscore","js/widgets/facet/factory"],function(e,t){return function(){return t.makeBasicCheckboxFacet({facetField:"bibgroup_facet",facetTitle:"Bib Groups",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]},preprocessors:[function(t){return e.map(t,function(t){return t.value.indexOf("/")>-1?e.assign(t,{name:t.value}):t})}]})}}),define("js/wraps/bibstem_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"bibstem_facet",facetTitle:"Publications",logicOptions:{single:["limit to","exclude"],multiple:["or","exclude"]}})}}),define("js/wraps/data_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"data_facet",facetTitle:"Data",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/wraps/database_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"database",facetTitle:"Collections",openByDefault:!0,logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/wraps/grants_facet",["js/widgets/facet/factory","analytics"],function(e,t){return function(){var n=e.makeHierarchicalCheckboxFacet({facetField:"grant_facet_hier",facetTitle:"Grants",logicOptions:{single:["limit to","exclude"],multiple:["or","exclude"]}});return n.handleLogicalSelection=function(e){var n=this.getCurrentQuery(),i=this.findPaginator(n).paginator,a=this.queryUpdater.removeTmpEntry(n,"SelectedItems");if(a&&_.keys(a).length>0){a=_.values(a),_.each(a,function(e,t,n){n[t]='grant:"'+e.title+'"'}),n=n.clone();"and"==e||"limit to"==e?this.queryUpdater.updateQuery(n,"fq_grant","limit",a):"or"==e?this.queryUpdater.updateQuery(n,"fq_grant","expand",a):"exclude"==e&&(n.get("fq_grant")?this.queryUpdater.updateQuery(n,"fq_grant","exclude",a):(a.unshift("*:*"),this.queryUpdater.updateQuery(n,"fq_grant","exclude",a)));var r="{!type=aqp cache=false cost=150 v=$fq_grant}",s=n.get("fq");if(s)-1==_.indexOf(s,r)&&s.push(r),n.set("fq",s);else n.set("fq",[r]);n.unset("facet.prefix"),n.unset("facet"),this.dispatchNewQuery(i.cleanQuery(n)),t("send","event","interaction","facet-applied",JSON.stringify({name:this.facetField,logic:e,conditions:a}))}},n}}),define("js/wraps/keyword_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"keyword_facet",facetTitle:"Keywords",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/components/json_response",["underscore","backbone","js/components/api_query"],function(e,t,n){var i=function(t,n){var i,a=t||{};n||(n={}),this.rid=e.uniqueId("r"),this.readOnly=!n.hasOwnProperty("readOnly")||n.readOnly,this._url=n.hasOwnProperty("url")?n.url:null,n.parse&&(a=this.parse(a,n)||{}),(i=e.result(this,"defaults"))&&(a=e.defaults({},a,i)),this.attributes=a,this.initialize.apply(this,arguments)};return e.extend(i.prototype,{initialize:function(){},getApiQuery:function(){return this.apiQuery},setApiQuery:function(e){if(e){if(!(e instanceof n))throw new Error("Only ApiQuery instances accepted");this.apiQuery=e}},toJSON:function(e){return this._clone(this.attributes)},url:function(){return this._url?this._url:this.rid},set:function(e,t,n){if(this.readOnly)throw Error("You can't change read-only response object");var i=this._split(e);if(1==i.length)this.attributes[i[0]]=t;else{this.get(e);t}},_split:function(e){for(var t=[],n=0,i=e.length,a=0,r=[];n<i;)e[n]==r[r.length-1]?r.pop():'"'==e[n]||"'"==e[n]?r.push(e[n]):"."==e[n]&&0==r.length?(t.push(e.substring(a,n)),a=n+1):"["==e[n]&&0==r.length&&(t.push(e.substring(a,n)),t.push(e.substring(n,e.indexOf("]",n+1)+1)),a=n=e.indexOf("]",n+1)+1),n+=1;return a<i&&t.push(e.substring(a)),t},has:function(e){return this.get(e,!0)},get:function(t,n,i){if(!t)return this._clone(this.attributes);for(var a=this._split(t),r=[],s=this.attributes;a.length>0;){var o=a.shift();if(s.hasOwnProperty(o))s=s[o],r.push(o);else{if(!(o.indexOf("[")>-1)){if(n)return!1;if(void 0!==i)return i;throw new Error("Can't find: "+t+(r.length>0?" (worked up to: "+r.join(".")+")":""))}var l=o.trim().substring(1,o.length-1);if((l.indexOf('"')>-1||l.indexOf("'")>-1)&&s.hasOwnProperty(l.substring(1,l.length-1)))s=s[l.substring(1,l.length-1)],r.push(l);else{if(!e.isArray(s)){if(n)return!1;if(void 0!==i)return i;throw new Error("Can't find: "+t+(r.length>0?" (worked up to: "+r.join(".")+")":""))}var c=null;try{if(c=parseInt(l),e.isNaN(c)||s.length<=c||c<0){if(n)return!1;if(void 0!==i)return i;throw new Error}s=s[c],r.push(l)}catch(e){if(n)return!1;if(void 0!==i)return i;throw new Error("Can't find: "+t+(r.length>0?" (worked up to: "+r.join(".")+")":""))}}}}return!!n||this._clone(s)},clone:function(){return new this.constructor(this.attributes)},_clone:function(t){return this.readOnly&&e.isObject(t)?e.cloneDeep?e.cloneDeep(t):JSON.parse(JSON.stringify(t)):t},isLocked:function(){return this.readOnly},lock:function(){return this.readOnly=!0},unlock:function(){return this.readOnly=!1}}),i.extend=t.Model.extend,i}),define("js/components/solr_response",["js/components/json_response","js/components/solr_params","backbone","underscore","jquery"],function(e,t,n,i,a){return e.extend({initialize:function(){if(!this.has("responseHeader.params"))throw new Error("SOLR data error - missing: responseHeader.params");if(i.isString(this._url)){var e=new t;this._url=new t(e.parse(this._url)).url()}else{var n=this.get("responseHeader.params");this._url=new t(n).url()}},url:function(e,t){return this._url}})}),define("js/components/api_response",["underscore","backbone","js/components/solr_response","js/components/facade"],function(e,t,n,i){var a={set:"set (replace existing)",get:"get values",has:"has a key",toJSON:"values back as JSON object",clone:"make a copy",url:"url string of the params",isLocked:!0,lock:!0,unlock:!0,setApiQuery:"sets the ApiQuery",getApiQuery:"gets the query"},r=function(e,t){this.innerResponse=new i(a,e instanceof n?e:new n(e,t))},s={};return e.each(e.keys(a),function(e,t,n){s[e]=function(){return this.innerResponse[e].apply(this.innerResponse,arguments)}}),e.extend(r.prototype,s,{clone:function(){var e=this.innerResponse.clone.apply(this.innerResponse,arguments);return new r(e)}}),r}),function(e){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("cache",[],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).dsjslib=e()}}(function(){return function(){return function e(t,n,i){function a(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){return a(t[s][1][e]||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}}()({1:[function(e,t,n){var i,a,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{a="function"==typeof clearTimeout?clearTimeout:o}catch(e){a=o}}();var c,u=[],d=!1,h=-1;function p(){d&&c&&(d=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!d){var e=l(p);d=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===o||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||d||l(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],2:[function(e,t,n){(function(e){!function(){"use strict";function n(e){var t=this;!function(e){var n=e.maximumWeight,i=e.weigherFunction,a=e.maximumSize,r="number"==typeof n&&n>-1,s="function"==typeof i;if(!r&&s||r&&!s)throw new Error("Maximum weight or weight function has illegal values");if(r&&s&&"number"==typeof a&&a>-1)throw new Error("Both max weight and size can't be configured");t._spec={loaderFn:"function"==typeof e.loaderFunction&&e.loaderFunction,expiresAfterWrite:"number"==typeof e.expiresAfterWrite?1e3*e.expiresAfterWrite:null,recordStats:e.recordStats,maxSize:a,maxWeight:n,weighFn:i,onRemove:"function"==typeof e.onRemove&&e.onRemove}}(e),i.apply(this)}n.prototype._REMOVAL_CAUSE_I="explicit",n.prototype._REMOVAL_CAUSE_C="capacity",n.prototype._REMOVAL_CAUSE_E="expired";var i=function(){this._accessQueue=new a("A"),this._writeQueue=this._spec.expiresAfterWrite?new a("W"):null;var e=n(this._REMOVAL_CAUSE_C,this._canReap,this._accessQueue,this),t=n(this._REMOVAL_CAUSE_E,this.isExpired,this._writeQueue,this);function n(e,t,n,i){return n?function(a){if(a)for(var r=n.tail.prev(n),s=null;r&&t.apply(i,[r]);)r&&(s=r.prev(n),i._rmEntry(r,e),r=s)}.bind(n):function(){}}this._cleanup=function(n){e(n),t(this._writeQueue)},this.size=0,this.weight=0,this._cache=Object.create(null),Object.defineProperty(this,"stats",{value:{hitCount:0,missCount:0,requestCount:0},configurable:!0})};function a(e){this.tail=this.head=Object.create(r.prototype),this.type=e}function r(e,t,n,i){this.key=e,this.loading=n,n||this.setValue(t),this.onLoad=i?[i]:[],this.writeTime=Date.now()}r.prototype.setValue=function(e){if(void 0===e||null===e)throw new Error("Illegal value for key "+e);this.value=e,this.writeTime=Date.now()},r.prototype.moveToHead=function(e){var t=this;e.forEach(function(e){if(e){var n=e.head;t.next(e,n),n.prev(e,t),e.head=t}})},r.prototype.next=function(e,t){var n="next"+e.type;return void 0!==t&&(this[n]=t),this[n]},r.prototype.prev=function(e,t){var n="prev"+e.type;return void 0!==t&&(this[n]=t),this[n]},r.prototype.remove=function(e){if(e){var t=this.prev(e),n=this.next(e);t?(t.next(e,n),n.prev(e,t)):(n.prev(e,null),e.head=n),n.next(e)||(e.tail=n),this.next(e,null),this.prev(e,null)}},r.prototype.promote=function(){var e=this;Array.prototype.slice.call(arguments).forEach(function(t){t&&e.prev(t)&&(e.remove(t),e.moveToHead([t]))})},r.prototype.forEach=function(e,t){for(var n=this;n;)e.call(this,n),n=n.next(t)},n.prototype.put=function(e,t){var n=this._cache[e];n?(n.setValue(t),n.writeTime=Date.now(),n.promote(this._accessQueue,this._writeQueue),this._cleanup(!1)):this._createEntry(e,t)},n.prototype._createEntry=function(e,t,n,i){var a=new r(e,t,n,i);return this._cleanup(!0),this._cache[e]=a,this._updateCacheSize(a,!0),a.moveToHead([this._accessQueue,this._writeQueue]),a},n.prototype.isExpired=function(e){var t=this._spec.expiresAfterWrite,n=Date.now();return!e.loading&&t&&t>0&&n-e.writeTime>t},n.prototype._updateCacheSize=function(e,t){var n;this._spec.maxWeight&&(n=this._spec.weighFn.apply(this,[e.key,e.value]),this.weight+=t?n:-n),this.size+=t?1:-1},n.prototype.get=function(t,n){n=n||function(){},this.stats.requestCount++;var i=this;e.nextTick(function(){(function(e,t){var n=this._cache[e];if(n){if(n.loading)return this.stats.missCount++,void n.onLoad.push(t);this.isExpired(n)?(this.stats.missCount++,this._notify(n,this._REMOVAL_CAUSE_E),n.loading=!0,n.onLoad.push(t),s(this,o.bind(n),e)):(n.promote(this._accessQueue),this.stats.hitCount++,t.apply(null,[null,n.value]))}else this.stats.missCount++,n=this._createEntry(e,null,!0,t),s(this,o.bind(n),e)}).call(i,t,n)})};var s=function(e,t,n){var i=e._spec.loaderFn;i&&i.apply(null,[n,function(n,i){t(e,n,i)}])},o=function(e,t,n){if(!t)try{this.setValue(n),this.promote(e._accessQueue,e._writeQueue),this.onLoad.forEach(function(e){e.apply(null,[t,n])}),this.onLoad=[],this.loading=!1}catch(e){t=e}t&&(this.onLoad.forEach(function(e){e.apply(null,[t,n])}),e._rmEntry(this))};function l(e,t,n){var i,a=null,r=e._spec.loaderFn;return r&&(r.apply(null,[n,function(e,t){i=e,a=t}]),t(i,a)),a}n.prototype.getSync=function(e){var t=arguments.length>2&&arguments[2];this.stats.requestCount++;var n,i=this._cache[e],a=this;return i?this.isExpired(i)?(this.stats.missCount++,t?this._rmEntry(i,this._REMOVAL_CAUSE_E):n=l(a,function(e,t){if(e)throw e;a._notify(i,a._REMOVAL_CAUSE_E),i.setValue(t),i.promote(a._accessQueue,a._writeQueue)},e)):(i.promote(this._accessQueue),n=i.value,this.stats.hitCount++):(this.stats.missCount++,t||(n=l(a,function(t,n){if(t)throw t;a._createEntry(e,n)},e))),n},n.prototype.getIfPresent=function(e){return this.getSync(e,null,!0)},n.prototype.invalidate=function(e){var t=this._cache[e];this._rmEntry(t,this._REMOVAL_CAUSE_I)},n.prototype._notify=function(e,t){this._spec.onRemove&&this._spec.onRemove.apply(null,[e.key,e.value,t])},n.prototype._rmEntry=function(e,t){e.remove(this._accessQueue),e.remove(this._writeQueue),this._updateCacheSize(e,!1),delete this._cache[e.key],t&&this._notify(e,t)},n.prototype.invalidateAll=function(){var e=this;Object.keys(this._cache).forEach(function(t){e.invalidate(t)})},n.prototype._canReap=function(){return this._spec.maxSize&&this.size>=this._spec.maxSize||this._spec.maxWeight&&this.weight>this._spec.maxWeight},t.exports=n}()}).call(this,e("_process"))},{_process:1}]},{},[2])(2)}),define("js/wraps/ned_object_facet",["js/components/api_response","js/components/api_request","js/components/api_query","js/components/solr_response","js/widgets/facet/factory","js/components/api_targets","analytics","cache","underscore","js/widgets/facet/reducers"],function(e,t,n,i,a,r,s,o,l,c){return function(){var e=a.makeHierarchicalCheckboxFacet({facetField:"ned_object_facet_hier",facetTitle:"NED Objects",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}});return e._dispatchRequest=function(e,t){var n=this.getPubSub(),i=this;this.store.dispatch(this.actions.data_requested(e)),e?n.subscribeOnce(n.DELIVERING_RESPONSE,function(t){i.translateNedid(t,e)}):n.subscribeOnce(n.DELIVERING_RESPONSE,function(t){i.store.dispatch(i.actions.data_received(t.toJSON(),e))});var a=this.getCurrentQuery();if(l.isUndefined(a)&&beehive.hasObject("AppStorage")){var r=beehive.getObject("AppStorage");l.isFunction(r.getCurrentQuery)&&(a=r.getCurrentQuery())}var s=this.customizeQuery(a);t=(e?this.store.getState().facets[e].children:this.store.getState().children).length||0;s.set("facet.offset",t),e&&s.set("facet.prefix",e.replace("0/","1/"));var o=this.composeRequest(s);n.publish(n.DELIVERING_REQUEST,o)},e._nedidCache={},e.translateNedid=function(n,i){var a=this,s=n.toJSON().facet_counts.facet_fields.ned_object_facet_hier.map(function(e,t){if(t%2==0)return e.split("/")[e.split("/").length-1]}).filter(function(e){if(e)return e});var o=new t({target:r.SERVICE_OBJECTS,options:{type:"POST",contentType:"application/json",data:JSON.stringify({source:"NED",identifiers:s}),done:function(t){var r=n.toJSON();r.facet_counts.facet_fields.ned_object_facet_hier=r.facet_counts.facet_fields.ned_object_facet_hier.map(function(n,i){if(i%2==0){var a=n.split("/"),r=a[a.length-1],s=a.slice(0,2).concat([t[r].canonical]).join("/");return e._nedidCache[s]=r,s}return n},this),a.store.dispatch(a.actions.data_received(r,i))}}}),l=this.getPubSub();l.publish(l.EXECUTE_REQUEST,o)},e.submitFilter=function(e){var t=this.getCurrentQuery().clone();t.unlock();var n=this.store.getState().config.facetField,i="fq_"+n,a=c.getActiveFacets(this.store.getState(),this.store.getState().state.selected),r=a.map(function(e){if(this._nedidCache[e])var t=e.split("/").slice(0,2).concat([this._nedidCache[e]]).join("/");else t=e;return n+':"'+t+'"'},this);"and"==e||"limit to"==e?this.queryUpdater.updateQuery(t,i,"limit",r):"or"==e?this.queryUpdater.updateQuery(t,i,"expand",r):"exclude"!=e&&"not"!=e||(t.get(i)?this.queryUpdater.updateQuery(t,i,"exclude",r):(r.unshift("*:*"),this.queryUpdater.updateQuery(t,i,"exclude",r)));var o="{!type=aqp v=$"+i+"}",u=t.get("fq")||[];if(u.push(o),t.set("fq",l.unique(u)),"ned_object_facet_hier"===n){var d=l.find(l.keys(t.toJSON()),function(e){return e.match(/fq_ned_object_facet_hier/i)});if(d){var h=t.get(d)[0];t.set("filter_ned_object_facet_hier_fq_ned_object_facet_hier",[h].concat(a)),t.unset("__ned_object_facet_hier_fq_ned_object_facet_hier")}}t.unset("facet.prefix"),t.unset("facet"),t.unset("start"),t.unset("rows"),this.dispatchNewQuery(t),s("send","event","interaction","facet-applied",JSON.stringify({name:n,logic:e,conditions:r}))},e}}),define("js/wraps/pubtype_facet",["js/widgets/facet/factory","analytics"],function(e,t){return function(){var n=e.makeHierarchicalCheckboxFacet({facetField:"doctype_facet_hier",facetTitle:"Publication Type",logicOptions:{single:["limit to","exclude"],multiple:["or","exclude"]}});return n.handleLogicalSelection=function(e){var n=this.getCurrentQuery(),i=this.findPaginator(n).paginator,a=this.queryUpdater.removeTmpEntry(n,"SelectedItems");if(a&&_.keys(a).length>0){a=_.values(a),_.each(a,function(e,t,n){n[t]='doctype:"'+e.title+'"'}),n=n.clone();"and"==e||"limit to"==e?this.queryUpdater.updateQuery(n,"fq_doctype","limit",a):"or"==e?this.queryUpdater.updateQuery(n,"fq_doctype","expand",a):"exclude"==e&&(n.get("fq_doctype")?this.queryUpdater.updateQuery(n,"fq_doctype","exclude",a):(a.unshift("*:*"),this.queryUpdater.updateQuery(n,"fq_doctype","exclude",a)));var r="{!type=aqp cache=false cost=150 v=$fq_doctype}",s=n.get("fq");if(s)-1==_.indexOf(s,r)&&s.push(r),n.set("fq",s);else n.set("fq",[r]);n.unset("facet.prefix"),n.unset("facet"),this.dispatchNewQuery(i.cleanQuery(n)),t("send","event","interaction","facet-applied",JSON.stringify({name:this.facetField,logic:e,conditions:a}))}},n}}),define("js/wraps/refereed_facet",["js/widgets/facet/factory","analytics"],function(e,t){return function(){var n=e.makeBasicCheckboxFacet({facetField:"property",facetTitle:"Refereed",openByDefault:!0,defaultQueryArguments:{"facet.query":"property:refereed"},preprocessors:function(e){return e.filter(function(e){return"notrefereed"===e.value||"refereed"===e.value}).map(function(e){return"notrefereed"===e.name&&(e.name="non-refereed"),e})},logicOptions:{single:["limit to","exclude"],multiple:["invalid choice"]}});return n.handleLogicalSelection=function(e){var n=this.getCurrentQuery(),i=this.findPaginator(n).paginator,a=this.queryUpdater.removeTmpEntry(n,"SelectedItems"),r=this;if(a&&_.keys(a).length>0){a=_.values(a),_.each(a,function(e,t,n){n[t]="property:"+r.queryUpdater.escapeInclWhitespace(e.value)}),n=n.clone();var s="fq_"+this.facetField;"and"==e||"limit to"==e?this.queryUpdater.updateQuery(n,s,"limit",a):"or"==e?this.queryUpdater.updateQuery(n,s,"expand",a):"exclude"!=e&&"not"!=e||this.queryUpdater.updateQuery(n,s,"exclude",a);var o="{!type=aqp v=$"+s+"}",l=n.get("fq");if(l)-1==_.indexOf(l,o)&&l.push(o),n.set("fq",l);else n.set("fq",[o]);this.dispatchNewQuery(i.cleanQuery(n)),t("send","event","interaction","facet-applied",JSON.stringify({name:this.facetField,logic:e,conditions:a}))}},n}}),define("js/wraps/simbad_object_facet",["js/components/api_response","js/components/api_request","js/components/api_query","js/components/solr_response","js/widgets/facet/factory","js/components/api_targets","analytics","cache","underscore","js/widgets/facet/reducers"],function(e,t,n,i,a,r,s,o,l,c){return function(){var e=a.makeHierarchicalCheckboxFacet({facetField:"simbad_object_facet_hier",facetTitle:"SIMBAD Objects",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}});return e._dispatchRequest=function(e,t){var n=this.getPubSub(),i=this,a=this.getBeeHive();this.store.dispatch(this.actions.data_requested(e)),e?n.subscribeOnce(n.DELIVERING_RESPONSE,function(t){i.translateSimbid(t,e)}):n.subscribeOnce(n.DELIVERING_RESPONSE,function(t){i.store.dispatch(i.actions.data_received(t.toJSON(),e))});var r=this.getCurrentQuery();if(l.isUndefined(r)&&a.hasObject("AppStorage")){var s=a.getObject("AppStorage");l.isFunction(s.getCurrentQuery)&&(r=s.getCurrentQuery())}var o=this.customizeQuery(r);t=(e?this.store.getState().facets[e].children:this.store.getState().children).length||0;o.set("facet.offset",t),e&&o.set("facet.prefix",e.replace("0/","1/"));var c=this.composeRequest(o);n.publish(n.DELIVERING_REQUEST,c)},e._simbidCache={},e.translateSimbid=function(n,i){var a=this,s=n.toJSON().facet_counts.facet_fields.simbad_object_facet_hier.map(function(e,t){if(t%2==0)return e.split("/")[e.split("/").length-1]}).filter(function(e){if(e)return e});var o=new t({target:r.SERVICE_OBJECTS,options:{type:"POST",contentType:"application/json",data:JSON.stringify({identifiers:s}),done:function(t){var r=n.toJSON();r.facet_counts.facet_fields.simbad_object_facet_hier=r.facet_counts.facet_fields.simbad_object_facet_hier.map(function(n,i){if(i%2==0){var a=n.split("/"),r=a[a.length-1],s=a.slice(0,2).concat([t[r].canonical]).join("/");return e._simbidCache[s]=r,s}return n},this),a.store.dispatch(a.actions.data_received(r,i))}}}),l=this.getPubSub();l.publish(l.EXECUTE_REQUEST,o)},e.submitFilter=function(e){var t=this.getCurrentQuery().clone();t.unlock();var n=this.store.getState().config.facetField,i="fq_"+n,a=c.getActiveFacets(this.store.getState(),this.store.getState().state.selected),r=a.map(function(e){if(this._simbidCache[e])var t=e.split("/").slice(0,2).concat([this._simbidCache[e]]).join("/");else t=e;return n+':"'+t+'"'},this);"and"==e||"limit to"==e?this.queryUpdater.updateQuery(t,i,"limit",r):"or"==e?this.queryUpdater.updateQuery(t,i,"expand",r):"exclude"!=e&&"not"!=e||(t.get(i)?this.queryUpdater.updateQuery(t,i,"exclude",r):(r.unshift("*:*"),this.queryUpdater.updateQuery(t,i,"exclude",r)));var o="{!type=aqp v=$"+i+"}",u=t.get("fq")||[];if(u.push(o),t.set("fq",l.unique(u)),"simbad_object_facet_hier"===n){var d=l.find(l.keys(t.toJSON()),function(e){return e.match(/fq_simbad_object_facet_hier/i)});if(d){var h=t.get(d)[0];t.set("filter_simbad_object_facet_hier_fq_simbad_object_facet_hier",[h].concat(a)),t.unset("__simbad_object_facet_hier_fq_simbad_object_facet_hier")}}t.unset("facet.prefix"),t.unset("facet"),t.unset("start"),t.unset("rows"),this.dispatchNewQuery(t),s("send","event","interaction","facet-applied",JSON.stringify({name:n,logic:e,conditions:r}))},e}}),define("js/wraps/vizier_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"vizier_facet",facetTitle:"Vizier Tables",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),function(e,t){"function"==typeof define&&define.amd?define("js/widgets/metrics/d3-tip",["d3"],t):t(e.d3)}(this,function(e){return e.tip=function(){var t=function(){return"n"},n=function(){return[0,0]},i=function(){return" "},a=function(){var t=e.select(document.createElement("div"));return t.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),t.node()}(),r=null,s=null,o=null;function l(e){var t;r="svg"===(t=(t=e).node()).tagName.toLowerCase()?t:t.ownerSVGElement,s=r.createSVGPoint(),document.body.appendChild(a)}l.show=function(){var r=Array.prototype.slice.call(arguments);r[r.length-1]instanceof SVGElement&&(o=r.pop());var s,d=i.apply(this,r),h=n.apply(this,r),p=t.apply(this,r),f=e.select(a),m=u.length,g=document.documentElement.scrollTop||document.body.scrollTop,b=document.documentElement.scrollLeft||document.body.scrollLeft;for(f.html(d).style({opacity:1,"pointer-events":"all"});m--;)f.classed(u[m],!1);return s=c.get(p).apply(this),f.classed(p,!0).style({top:s.top+h[0]+g+"px",left:s.left+h[1]+b+"px"}),l},l.hide=function(){return e.select(a).style({opacity:0,"pointer-events":"none"}),l},l.attr=function(t,n){if(arguments.length<2&&"string"==typeof t)return e.select(a).attr(t);var i=Array.prototype.slice.call(arguments);return e.selection.prototype.attr.apply(e.select(a),i),l},l.style=function(t,n){if(arguments.length<2&&"string"==typeof t)return e.select(a).style(t);var i=Array.prototype.slice.call(arguments);return e.selection.prototype.style.apply(e.select(a),i),l},l.direction=function(n){return arguments.length?(t=null==n?n:e.functor(n),l):t},l.offset=function(t){return arguments.length?(n=null==t?t:e.functor(t),l):n},l.html=function(t){return arguments.length?(i=null==t?t:e.functor(t),l):i};var c=e.map({n:function(){var e=d();return{top:e.n.y-a.offsetHeight,left:e.n.x-a.offsetWidth/2}},s:function(){var e=d();return{top:e.s.y,left:e.s.x-a.offsetWidth/2}},e:function(){var e=d();return{top:e.e.y-a.offsetHeight/2,left:e.e.x}},w:function(){var e=d();return{top:e.w.y-a.offsetHeight/2,left:e.w.x-a.offsetWidth}},nw:function(){var e=d();return{top:e.nw.y-a.offsetHeight,left:e.nw.x-a.offsetWidth}},ne:function(){var e=d();return{top:e.ne.y-a.offsetHeight,left:e.ne.x}},sw:function(){var e=d();return{top:e.sw.y,left:e.sw.x-a.offsetWidth}},se:function(){var e=d();return{top:e.se.y,left:e.e.x}}}),u=c.keys();function d(){var t=o||e.event.target,n={},i=t.getScreenCTM(),a=t.getBBox(),r=a.width,l=a.height,c=a.x,u=a.y;return s.x=c,s.y=u,n.nw=s.matrixTransform(i),s.x+=r,n.ne=s.matrixTransform(i),s.y+=l,n.se=s.matrixTransform(i),s.x-=r,n.sw=s.matrixTransform(i),s.y-=l/2,n.w=s.matrixTransform(i),s.x+=r,n.e=s.matrixTransform(i),s.x-=r/2,s.y-=l/2,n.n=s.matrixTransform(i),s.y+=l,n.s=s.matrixTransform(i),n}return l},e.tip}),define("js/widgets/metrics/extractor_functions",[],function(){function e(e){return e.filter(function(e){return e.y>0}).length>0}var t={};function n(e,t){var n={};return _.each(t,function(t,i){e[i]?n[i]=t-e[i]:n[i]=t}),n}return t.plot_paperhist=function(t){var i,a=[],r=t.paperhist_data;return i=t.norm?[r["refereed publications normalized"],n(r["refereed publications normalized"],r["all publications normalized"])]:[r["refereed publications"],n(r["refereed publications"],r["all publications"])],_.each(i,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),a.push(n)}),[{key:"Refereed",values:a[0]},{key:"Non-refereed",values:a[1]}].filter(function(t,n){return e(t.values)})},t.plot_readshist=function(t){var i,a=[];return i=t.norm?[t.readshist_data["refereed reads normalized"],n(t.readshist_data["refereed reads normalized"],t.readshist_data["all reads normalized"])]:[t.readshist_data["refereed reads"],n(t.readshist_data["refereed reads"],t.readshist_data["all reads"])],_.each(i,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),a.push(n)}),[{key:"Refereed",values:a[0]},{key:"Non-refereed",values:a[1]}].filter(function(t,n){return e(t.values)})},t.plot_citshist=function(t){var n,i=[],a=t.citshist_data;return n=t.norm?[a["refereed to refereed normalized"],a["refereed to nonrefereed normalized"],a["nonrefereed to refereed normalized"],a["nonrefereed to nonrefereed normalized"]]:[a["refereed to refereed"],a["refereed to nonrefereed"],a["nonrefereed to refereed"],a["nonrefereed to nonrefereed"]],_.each(n,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),i.push(n)}),["Ref. citations to ref. papers","Ref. citations to non ref. papers","Non ref. citations to ref. papers","Non ref. citations to non ref. papers"].map(function(e,t){return{key:e,values:i[t]}}).filter(function(t,n){return e(t.values)})},t.plot_series=function(e){var t=e.series_data,n=[t.h,t.g,t.i10,t.tori,t.i100,t.read10],i=[];return _.each(n,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),i.push(n)}),i[5]=_.map(i[5],function(e){return{x:e.x,y:e.y/10}}),[{key:"h Index",values:i[0]},{key:"g Index",values:i[1]},{key:"i10 Index",values:i[2]},{key:"tori Index",values:i[3]},{key:"i100 Index",values:i[4]},{key:"read10 Index",values:i[5]}]},t}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=t():"function"==typeof define&&define.amd?define("hbs/handlebars",t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?exports.Handlebars=t():e.Handlebars=t()}(this,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var a=i(n(1)),r=i(n(2)),s=n(3),o=n(4),l=i(n(5)),c=i(n(6)),u=i(n(7)),d=a.default.create;function h(){var e=d();return e.compile=function(t,n){return o.compile(t,n,e)},e.precompile=function(t,n){return o.precompile(t,n,e)},e.AST=r.default,e.Compiler=o.Compiler,e.JavaScriptCompiler=l.default,e.Parser=s.parser,e.parse=s.parse,e}var p=h();p.create=h,u.default(p),p.Visitor=c.default,p.default=p,t.default=p,e.exports=t.default},function(e,t,n){"use strict";var i=n(9).default,a=n(8).default;t.__esModule=!0;var r=i(n(10)),s=a(n(11)),o=a(n(12)),l=i(n(13)),c=i(n(14)),u=a(n(7));function d(){var e=new r.HandlebarsEnvironment;return l.extend(e,r),e.SafeString=s.default,e.Exception=o.default,e.Utils=l,e.escapeExpression=l.escapeExpression,e.VM=c,e.template=function(t){return c.template(t,e)},e}var h=d();h.create=d,u.default(h),h.default=h,t.default=h,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i={Program:function(e,t,n,i){this.loc=i,this.type="Program",this.body=e,this.blockParams=t,this.strip=n},MustacheStatement:function(e,t,n,i,a,r){this.loc=r,this.type="MustacheStatement",this.path=e,this.params=t||[],this.hash=n,this.escaped=i,this.strip=a},BlockStatement:function(e,t,n,i,a,r,s,o,l){this.loc=l,this.type="BlockStatement",this.path=e,this.params=t||[],this.hash=n,this.program=i,this.inverse=a,this.openStrip=r,this.inverseStrip=s,this.closeStrip=o},PartialStatement:function(e,t,n,i,a){this.loc=a,this.type="PartialStatement",this.name=e,this.params=t||[],this.hash=n,this.indent="",this.strip=i},ContentStatement:function(e,t){this.loc=t,this.type="ContentStatement",this.original=this.value=e},CommentStatement:function(e,t,n){this.loc=n,this.type="CommentStatement",this.value=e,this.strip=t},SubExpression:function(e,t,n,i){this.loc=i,this.type="SubExpression",this.path=e,this.params=t||[],this.hash=n},PathExpression:function(e,t,n,i,a){this.loc=a,this.type="PathExpression",this.data=e,this.original=i,this.parts=n,this.depth=t},StringLiteral:function(e,t){this.loc=t,this.type="StringLiteral",this.original=this.value=e},NumberLiteral:function(e,t){this.loc=t,this.type="NumberLiteral",this.original=this.value=Number(e)},BooleanLiteral:function(e,t){this.loc=t,this.type="BooleanLiteral",this.original=this.value="true"===e},UndefinedLiteral:function(e){this.loc=e,this.type="UndefinedLiteral",this.original=this.value=void 0},NullLiteral:function(e){this.loc=e,this.type="NullLiteral",this.original=this.value=null},Hash:function(e,t){this.loc=t,this.type="Hash",this.pairs=e},HashPair:function(e,t,n){this.loc=n,this.type="HashPair",this.key=e,this.value=t},helpers:{helperExpression:function(e){return!("SubExpression"!==e.type&&!e.params.length&&!e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return 1===e.parts.length&&!i.helpers.scopedId(e)&&!e.depth}}};t.default=i,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default,a=n(9).default;t.__esModule=!0,t.parse=function(e,t){if("Program"===e.type)return e;return r.default.yy=u,u.locInfo=function(e){return new u.SourceLocation(t&&t.srcName,e)},(new o.default).accept(r.default.parse(e))};var r=i(n(15)),s=i(n(2)),o=i(n(16)),l=a(n(17)),c=n(13);t.parser=r.default;var u={};c.extend(u,l,s.default)},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0,t.Compiler=l,t.precompile=function(e,t,n){if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new a.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);"data"in(t=t||{})||(t.data=!0);t.compat&&(t.useDepths=!0);var i=n.parse(e,t),r=(new n.Compiler).compile(i,t);return(new n.JavaScriptCompiler).compile(r,t)},t.compile=function(e,t,n){var i=void 0===arguments[1]?{}:arguments[1];if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new a.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in i||(i.data=!0);i.compat&&(i.useDepths=!0);var r=void 0;function s(){var t=n.parse(e,i),a=(new n.Compiler).compile(t,i),r=(new n.JavaScriptCompiler).compile(a,i,void 0,!0);return n.template(r)}function o(e,t){return r||(r=s()),r.call(this,e,t)}return o._setup=function(e){return r||(r=s()),r._setup(e)},o._child=function(e,t,n,i){return r||(r=s()),r._child(e,t,n,i)},o};var a=i(n(12)),r=n(13),s=i(n(2)),o=[].slice;function l(){}function c(e,t){if(e===t)return!0;if(r.isArray(e)&&r.isArray(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!c(e[n],t[n]))return!1;return!0}}function u(e){if(!e.path.parts){var t=e.path;e.path=new s.default.PathExpression(!1,0,[t.original+""],t.original+"",t.loc)}}l.prototype={compiler:l,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var i=this.opcodes[n],a=e.opcodes[n];if(i.opcode!==a.opcode||!c(i.args,a.args))return!1}t=this.children.length;for(n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.sourceNode=[],this.opcodes=[],this.children=[],this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds,t.blockParams=t.blockParams||[];var n=t.knownHelpers;if(t.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},n)for(var i in n)i in n&&(t.knownHelpers[i]=n[i]);return this.accept(e)},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++;return this.usePartial=this.usePartial||t.usePartial,this.children[n]=t,this.useDepths=this.useDepths||t.useDepths,n},accept:function(e){this.sourceNode.unshift(e);var t=this[e.type](e);return this.sourceNode.shift(),t},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var t=e.body,n=t.length,i=0;i<n;i++)this.accept(t[i]);return this.options.blockParams.shift(),this.isSimple=1===n,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){u(e);var t=e.program,n=e.inverse;t=t&&this.compileProgram(t),n=n&&this.compileProgram(n);var i=this.classifySexpr(e);"helper"===i?this.helperSexpr(e,t,n):"simple"===i?(this.simpleSexpr(e),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,t,n),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},PartialStatement:function(e){this.usePartial=!0;var t=e.params;if(t.length>1)throw new a.default("Unsupported number of partial arguments: "+t.length,e);t.length||t.push({type:"PathExpression",parts:[],depth:0});var n=e.name.original,i="SubExpression"===e.name.type;i&&this.accept(e.name),this.setupFullMustacheParams(e,void 0,void 0,!0);var r=e.indent||"";this.options.preventIndent&&r&&(this.opcode("appendContent",r),r=""),this.opcode("invokePartial",i,n,r),this.opcode("append")},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){u(e);var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,t,n){var i=e.path,a=i.parts[0],r=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.accept(i),this.opcode("invokeAmbiguous",a,r)},simpleSexpr:function(e){this.accept(e.path),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),r=e.path,o=r.parts[0];if(this.options.knownHelpers[o])this.opcode("invokeKnownHelper",i.length,o);else{if(this.options.knownHelpersOnly)throw new a.default("You specified knownHelpersOnly, but used the unknown helper "+o,e);r.falsy=!0,this.accept(r),this.opcode("invokeHelper",i.length,r.original,s.default.helpers.simpleId(r))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0],n=s.default.helpers.scopedId(e),i=!e.depth&&!n&&this.blockParamIndex(t);i?this.opcode("lookupBlockParam",i,e.parts):t?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts)):this.opcode("lookupOnContext",e.parts,e.falsy,n):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var t=e.pairs,n=0,i=t.length;for(this.opcode("pushHash");n<i;n++)this.pushParam(t[n].value);for(;n--;)this.opcode("assignToHash",t[n].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:o.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var t=s.default.helpers.simpleId(e.path),n=t&&!!this.blockParamIndex(e.path.parts[0]),i=!n&&s.default.helpers.helperExpression(e),a=!n&&(i||t);if(a&&!i){var r=e.path.parts[0],o=this.options;o.knownHelpers[r]?i=!0:o.knownHelpersOnly&&(a=!1)}return i?"helper":a?"ambiguous":"simple"},pushParams:function(e){for(var t=0,n=e.length;t<n;t++)this.pushParam(e[t])},pushParam:function(e){var t=null!=e.value?e.value:e.original||"";if(this.stringParams)t.replace&&(t=t.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",t,e.type),"SubExpression"===e.type&&this.accept(e);else{if(this.trackIds){var n=void 0;if(!e.parts||s.default.helpers.scopedId(e)||e.depth||(n=this.blockParamIndex(e.parts[0])),n){var i=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",n,i)}else(t=e.original||t).replace&&(t=t.replace(/^\.\//g,"").replace(/^\.$/g,"")),this.opcode("pushId",e.type,t)}this.accept(e)}},setupFullMustacheParams:function(e,t,n,i){var a=e.params;return this.pushParams(a),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.accept(e.hash):this.opcode("emptyHash",i),a},blockParamIndex:function(e){for(var t=0,n=this.options.blockParams.length;t<n;t++){var i=this.options.blockParams[t],a=i&&r.indexOf(i,e);if(i&&a>=0)return[t,a]}}}},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var a=n(10),r=i(n(12)),s=n(13),o=i(n(18));function l(e){this.value=e}function c(){}c.prototype={nameLookup:function(e,t){return c.isValidJavaScriptVariableName(t)?[e,".",t]:[e,"['",t,"']"]},depthedLookup:function(e){return[this.aliasable("this.lookup"),'(depths, "',e,'")']},compilerInfo:function(){var e=a.COMPILER_REVISION;return[e,a.REVISION_CHANGES[e]]},appendToBuffer:function(e,t,n){return s.isArray(e)||(e=[e]),e=this.source.wrap(e,t),this.environment.isSimple?["return ",e,";"]:n?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},compile:function(e,t,n,i){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!i,this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.useDepths||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var a=e.opcodes,s=void 0,o=void 0,l=void 0,c=void 0;for(l=0,c=a.length;l<c;l++)s=a[l],this.source.currentLocation=s.loc,o=o||s.loc,this[s.opcode].apply(this,s.args);if(this.source.currentLocation=o,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new r.default("Compile completed with content left on stack");var u=this.createFunctionContext(i);if(this.isChild)return u;var d={compiler:this.compilerInfo(),main:u},h=this.context.programs;for(l=0,c=h.length;l<c;l++)h[l]&&(d[l]=h[l]);return this.environment.usePartial&&(d.usePartial=!0),this.options.data&&(d.useData=!0),this.useDepths&&(d.useDepths=!0),this.useBlockParams&&(d.useBlockParams=!0),this.options.compat&&(d.compat=!0),i?d.compilerOptions=this.options:(d.compiler=JSON.stringify(d.compiler),this.source.currentLocation={start:{line:1,column:0}},d=this.objectLiteral(d),t.srcName?(d=d.toStringWithSourceMap({file:t.destName})).map=d.map&&d.map.toString():d=d.toString()),d},preamble:function(){this.lastContext=0,this.source=new o.default(this.options.srcName)},createFunctionContext:function(e){var t="",n=this.stackVars.concat(this.registers.list);n.length>0&&(t+=", "+n.join(", "));var i=0;for(var a in this.aliases){var r=this.aliases[a];this.aliases.hasOwnProperty(a)&&r.children&&r.referenceCount>1&&(t+=", alias"+ ++i+"="+a,r.children[0]="alias"+i)}var s=["depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&s.push("blockParams"),this.useDepths&&s.push("depths");var o=this.mergeSource(t);return e?(s.push(o),Function.apply(this,s)):this.source.wrap(["function(",s.join(","),") {\n  ",o,"}"])},mergeSource:function(e){var t=this.environment.isSimple,n=!this.forceBuffer,i=void 0,a=void 0,r=void 0,s=void 0;return this.source.each(function(e){e.appendToBuffer?(r?e.prepend("  + "):r=e,s=e):(r&&(a?r.prepend("buffer += "):i=!0,s.add(";"),r=s=void 0),a=!0,t||(n=!1))}),n?r?(r.prepend("return "),s.add(";")):a||this.source.push('return "";'):(e+=", buffer = "+(i?"":this.initializeBuffer()),r?(r.prepend("return buffer + "),s.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(i?"":";\n")),this.source.merge()},blockValue:function(e){var t=this.aliasable("helpers.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs(e,0,n);var i=this.popStack();n.splice(1,0,i),this.push(this.source.functionCall(t,"call",n))},ambiguousBlockValue:function(){var e=this.aliasable("helpers.blockHelperMissing"),t=[this.contextName(0)];this.setupHelperArgs("",0,t,!0),this.flushInline();var n=this.topStack();t.splice(1,0,n),this.pushSource(["if (!",this.lastHelper,") { ",n," = ",this.source.functionCall(e,"call",t),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack(function(e){return[" != null ? ",e,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("this.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,n){var i=0;n||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[i++])),this.resolvePath("context",e,i,t)},lookupBlockParam:function(e,t){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",t,1)},lookupData:function(e,t){e?this.pushStackLiteral("this.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",t,0,!0)},resolvePath:function(e,t,n,i){var a=this;if(this.options.strict||this.options.assumeObjects)this.push(function(e,t,n,i){var a=t.popStack(),r=0,s=n.length;e&&s--;for(;r<s;r++)a=t.nameLookup(a,n[r],i);return e?[t.aliasable("this.strict"),"(",a,", ",t.quotedString(n[r]),")"]:a}(this.options.strict,this,t,e));else for(var r=t.length;n<r;n++)this.replaceStack(function(r){var s=a.nameLookup(r,t[n],e);return i?[" && ",s]:[" != null ? ",s," : ",r]})},resolvePossibleLambda:function(){this.push([this.aliasable("this.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"SubExpression"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t,n){var i=this.popStack(),a=this.setupHelper(e,t),r=n?[a.name," || "]:"",s=["("].concat(r,i);this.options.strict||s.push(" || ",this.aliasable("helpers.helperMissing")),s.push(")"),this.push(this.source.functionCall(s,"call",a.callParams))},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(this.source.functionCall(n.name,"call",n.callParams))},invokeAmbiguous:function(e,t){this.useRegister("helper");var n=this.popStack();this.emptyHash();var i=this.setupHelper(0,e,t),a=["(","(helper = ",this.lastHelper=this.nameLookup("helpers",e,"helper")," || ",n,")"];this.options.strict||(a[0]="(helper = ",a.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))),this.push(["(",a,i.paramsInit?["),(",i.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",i.callParams)," : helper))"])},invokePartial:function(e,t,n){var i=[],a=this.setupParams(t,1,i,!1);e&&(t=this.popStack(),delete a.name),n&&(a.indent=JSON.stringify(n)),a.helpers="helpers",a.partials="partials",e?i.unshift(t):i.unshift(this.nameLookup("partials",t,"partial")),this.options.compat&&(a.depths="depths"),a=this.objectLiteral(a),i.push(a),this.push(this.source.functionCall("this.invokePartial","",i))},assignToHash:function(e){var t=this.popStack(),n=void 0,i=void 0,a=void 0;this.trackIds&&(a=this.popStack()),this.stringParams&&(i=this.popStack(),n=this.popStack());var r=this.hash;n&&(r.contexts[e]=n),i&&(r.types[e]=i),a&&(r.ids[e]=a),r.values[e]=t},pushId:function(e,t,n){"BlockParam"===e?this.pushStackLiteral("blockParams["+t[0]+"].path["+t[1]+"]"+(n?" + "+JSON.stringify("."+n):"")):"PathExpression"===e?this.pushString(t):"SubExpression"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:c,compileChildren:function(e,t){for(var n=e.children,i=void 0,a=void 0,r=0,s=n.length;r<s;r++){i=n[r],a=new this.compiler;var o=this.matchExistingProgram(i);null==o?(this.context.programs.push(""),o=this.context.programs.length,i.index=o,i.name="program"+o,this.context.programs[o]=a.compile(i,t,this.context,!this.precompile),this.context.environments[o]=i,this.useDepths=this.useDepths||a.useDepths,this.useBlockParams=this.useBlockParams||a.useBlockParams):(i.index=o,i.name="program"+o,this.useDepths=this.useDepths||i.useDepths,this.useBlockParams=this.useBlockParams||i.useBlockParams)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){var t=this.environment.children[e],n=[t.index,"data",t.blockParams];return(this.useBlockParams||this.useDepths)&&n.push("blockParams"),this.useDepths&&n.push("depths"),"this.program("+n.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof l||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new l(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var t=["("],n=void 0,i=void 0,a=void 0;if(!this.isInline())throw new r.default("replaceStack on non-inline");var s=this.popStack(!0);if(s instanceof l)t=["(",n=[s.value]],a=!0;else{i=!0;var o=this.incrStack();t=["((",this.push(o)," = ",s,")"],n=this.topStack()}var c=e.call(this,n);a||this.popStack(),i&&this.stackSlot--,this.push(t.concat(c,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];if(i instanceof l)this.compileStack.push(i);else{var a=this.incrStack();this.pushSource([a," = ",i,";"]),this.compileStack.push(a)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();if(!e&&n instanceof l)return n.value;if(!t){if(!this.stackSlot)throw new r.default("Invalid stack pop");this.stackSlot--}return n},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof l?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var t=this.aliases[e];return t?(t.referenceCount++,t):((t=this.aliases[e]=this.source.wrap(e)).aliasable=!0,t.referenceCount=1,t)},setupHelper:function(e,t,n){var i=[];return{params:i,paramsInit:this.setupHelperArgs(t,e,i,n),name:this.nameLookup("helpers",t,"helper"),callParams:[this.contextName(0)].concat(i)}},setupParams:function(e,t,n){var i={},a=[],r=[],s=[],o=void 0;i.name=this.quotedString(e),i.hash=this.popStack(),this.trackIds&&(i.hashIds=this.popStack()),this.stringParams&&(i.hashTypes=this.popStack(),i.hashContexts=this.popStack());var l=this.popStack(),c=this.popStack();(c||l)&&(i.fn=c||"this.noop",i.inverse=l||"this.noop");for(var u=t;u--;)o=this.popStack(),n[u]=o,this.trackIds&&(s[u]=this.popStack()),this.stringParams&&(r[u]=this.popStack(),a[u]=this.popStack());return this.trackIds&&(i.ids=this.source.generateArray(s)),this.stringParams&&(i.types=this.source.generateArray(r),i.contexts=this.source.generateArray(a)),this.options.data&&(i.data="data"),this.useBlockParams&&(i.blockParams="blockParams"),i},setupHelperArgs:function(e,t,n,i){var a=this.setupParams(e,t,n,!0);return a=this.objectLiteral(a),i?(this.useRegister("options"),n.push("options"),["options=",a]):(n.push(a),"")}},function(){for(var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),t=c.RESERVED_WORDS={},n=0,i=e.length;n<i;n++)t[e[n]]=!0}(),c.isValidJavaScriptVariableName=function(e){return!c.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},t.default=c,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var a=i(n(12)),r=i(n(2));function s(){this.parents=[]}s.prototype={constructor:s,mutating:!1,acceptKey:function(e,t){var n=this.accept(e[t]);if(this.mutating){if(n&&(!n.type||!r.default[n.type]))throw new a.default('Unexpected node type "'+n.type+'" found when accepting '+t+" on "+e.type);e[t]=n}},acceptRequired:function(e,t){if(this.acceptKey(e,t),!e[t])throw new a.default(e.type+" requires "+t)},acceptArray:function(e){for(var t=0,n=e.length;t<n;t++)this.acceptKey(e,t),e[t]||(e.splice(t,1),t--,n--)},accept:function(e){if(e){this.current&&this.parents.unshift(this.current),this.current=e;var t=this[e.type](e);return this.current=this.parents.shift(),!this.mutating||t?t:!1!==t?e:void 0}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")},BlockStatement:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash"),this.acceptKey(e,"program"),this.acceptKey(e,"inverse")},PartialStatement:function(e){this.acceptRequired(e,"name"),this.acceptArray(e.params),this.acceptKey(e,"hash")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")},PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}},t.default=s,e.exports=t.default},function(e,t,n){(function(n){"use strict";t.__esModule=!0,t.default=function(e){var t=void 0!==n?n:window,i=t.Handlebars;e.noConflict=function(){t.Handlebars===e&&(t.Handlebars=i)}},e.exports=t.default}).call(t,function(){return this}())},function(e,t,n){"use strict";t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,n){"use strict";t.default=function(e){if(e&&e.__esModule)return e;var t={};if("object"===_typeof(e)&&null!==e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},t.__esModule=!0},function(e,t,n){"use strict";var i=n(9).default,a=n(8).default;t.__esModule=!0,t.HandlebarsEnvironment=u,t.createFrame=p;var r=i(n(13)),s=a(n(12));t.VERSION="3.0.1";t.COMPILER_REVISION=6;t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};var o=r.isArray,l=r.isFunction,c=r.toString;function u(e,t){var n;this.helpers=e||{},this.partials=t||{},(n=this).registerHelper("helperMissing",function(){if(1!==arguments.length)throw new s.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}),n.registerHelper("blockHelperMissing",function(e,t){var i=t.inverse,a=t.fn;if(!0===e)return a(this);if(!1===e||null==e)return i(this);if(o(e))return e.length>0?(t.ids&&(t.ids=[t.name]),n.helpers.each(e,t)):i(this);if(t.data&&t.ids){var s=p(t.data);s.contextPath=r.appendContextPath(t.data.contextPath,t.name),t={data:s}}return a(e,t)}),n.registerHelper("each",function(e,t){if(!t)throw new s.default("Must pass iterator to #each");var n=t.fn,i=t.inverse,a=0,c="",u=void 0,d=void 0;function h(t,i,a){u&&(u.key=t,u.index=i,u.first=0===i,u.last=!!a,d&&(u.contextPath=d+t)),c+=n(e[t],{data:u,blockParams:r.blockParams([e[t],t],[d+t,null])})}if(t.data&&t.ids&&(d=r.appendContextPath(t.data.contextPath,t.ids[0])+"."),l(e)&&(e=e.call(this)),t.data&&(u=p(t.data)),e&&"object"===_typeof(e))if(o(e))for(var f=e.length;a<f;a++)h(a,a,a===e.length-1);else{var m=void 0;for(var g in e)e.hasOwnProperty(g)&&(m&&h(m,a-1),m=g,a++);m&&h(m,a-1,!0)}return 0===a&&(c=i(this)),c}),n.registerHelper("if",function(e,t){return l(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||r.isEmpty(e)?t.inverse(this):t.fn(this)}),n.registerHelper("unless",function(e,t){return n.helpers.if.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})}),n.registerHelper("with",function(e,t){l(e)&&(e=e.call(this));var n=t.fn;if(r.isEmpty(e))return t.inverse(this);if(t.data&&t.ids){var i=p(t.data);i.contextPath=r.appendContextPath(t.data.contextPath,t.ids[0]),t={data:i}}return n(e,t)}),n.registerHelper("log",function(e,t){var i=t.data&&null!=t.data.level?parseInt(t.data.level,10):1;n.log(i,e)}),n.registerHelper("lookup",function(e,t){return e&&e[t]})}u.prototype={constructor:u,logger:d,log:h,registerHelper:function(e,t){if("[object Object]"===c.call(e)){if(t)throw new s.default("Arg not supported with multiple helpers");r.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if("[object Object]"===c.call(e))r.extend(this.partials,e);else{if(void 0===t)throw new s.default("Attempting to register a partial as undefined");this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]}};var d={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:1,log:function(e,t){if("undefined"!=typeof console&&d.level<=e){var n=d.methodMap[e];(console[n]||console.log).call(console,t)}}};t.logger=d;var h=d.log;function p(e){var t=r.extend({},e);return t._parent=e,t}t.log=h},function(e,t,n){"use strict";function i(e){this.string=e}t.__esModule=!0,i.prototype.toString=i.prototype.toHTML=function(){return""+this.string},t.default=i,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i=["description","fileName","lineNumber","message","name","number","stack"];function a(e,t){var n=t&&t.loc,r=void 0,s=void 0;n&&(e+=" - "+(r=n.start.line)+":"+(s=n.start.column));for(var o=Error.prototype.constructor.call(this,e),l=0;l<i.length;l++)this[i[l]]=o[i[l]];Error.captureStackTrace&&Error.captureStackTrace(this,a),n&&(this.lineNumber=r,this.column=s)}a.prototype=new Error,t.default=a,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0,t.extend=function(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e},t.indexOf=function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}if(!r.test(e))return e;return e.replace(a,s)},t.isEmpty=function(e){return!e&&0!==e||!(!c(e)||0!==e.length)},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},a=/[&<>"'`]/g,r=/[&<>"'`]/;function s(e){return i[e]}var o,l=Object.prototype.toString;t.toString=l,(o=function(e){return"function"==typeof e})(/x/)&&(t.isFunction=o=function(e){return"function"==typeof e&&"[object Function]"===l.call(e)}),t.isFunction=o;var c=Array.isArray||function(e){return!(!e||"object"!==_typeof(e))&&"[object Array]"===l.call(e)};t.isArray=c},function(e,t,n){"use strict";var i=n(9).default,a=n(8).default;t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,n=o.COMPILER_REVISION;if(t!==n){if(t<n){var i=o.REVISION_CHANGES[n],a=o.REVISION_CHANGES[t];throw new s.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+a+").")}throw new s.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},t.template=function(e,t){if(!t)throw new s.default("No environment passed to template");if(!e||!e.main)throw new s.default("Unknown template object: "+_typeof(e));t.VM.checkRevision(e.compiler);var n={strict:function(e,t){if(!(t in e))throw new s.default('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:r.escapeExpression,invokePartial:function(n,i,a){a.hash&&(i=r.extend({},i,a.hash));n=t.VM.resolvePartial.call(this,n,i,a);var o=t.VM.invokePartial.call(this,n,i,a);null==o&&t.compile&&(a.partials[a.name]=t.compile(n,e.compilerOptions,t),o=a.partials[a.name](i,a));if(null!=o){if(a.indent){for(var l=o.split("\n"),c=0,u=l.length;c<u&&(l[c]||c+1!==u);c++)l[c]=a.indent+l[c];o=l.join("\n")}return o}throw new s.default("The partial "+a.name+" could not be compiled when running in runtime-only mode")},fn:function(t){return e[t]},programs:[],program:function(e,t,n,i,a){var r=this.programs[e],s=this.fn(e);return t||a||i||n?r=l(this,e,s,t,n,i,a):r||(r=this.programs[e]=l(this,e,s)),r},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=r.extend({},t,e)),n},noop:t.VM.noop,compilerInfo:e.compiler};function i(t){var a=void 0===arguments[1]?{}:arguments[1],r=a.data;i._setup(a),!a.partial&&e.useData&&(r=function(e,t){t&&"root"in t||((t=t?o.createFrame(t):{}).root=e);return t}(t,r));var s=void 0,l=e.useBlockParams?[]:void 0;return e.useDepths&&(s=a.depths?[t].concat(a.depths):[t]),e.main.call(n,t,n.helpers,n.partials,r,l,s)}return i.isTop=!0,i._setup=function(i){i.partial?(n.helpers=i.helpers,n.partials=i.partials):(n.helpers=n.merge(i.helpers,t.helpers),e.usePartial&&(n.partials=n.merge(i.partials,t.partials)))},i._child=function(t,i,a,r){if(e.useBlockParams&&!a)throw new s.default("must pass block params");if(e.useDepths&&!r)throw new s.default("must pass parent depths");return l(n,t,e[t],i,0,a,r)},i},t.wrapProgram=l,t.resolvePartial=function(e,t,n){e?e.call||n.name||(n.name=e,e=n.partials[e]):e=n.partials[n.name];return e},t.invokePartial=function(e,t,n){if(n.partial=!0,void 0===e)throw new s.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)},t.noop=function(){return""};var r=i(n(13)),s=a(n(12)),o=n(10);function l(e,t,n,i,a,r,s){function o(t){var a=void 0===arguments[1]?{}:arguments[1];return n.call(e,t,e.helpers,e.partials,a.data||i,r&&[a.blockParams].concat(r),s&&[t].concat(s))}return o.program=t,o.depth=s?s.length:0,o.blockParams=a||0,o}},function(e,t,n){"use strict";t.__esModule=!0;var i=function(){var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,content:12,COMMENT:13,CONTENT:14,openRawBlock:15,END_RAW_BLOCK:16,OPEN_RAW_BLOCK:17,helperName:18,openRawBlock_repetition0:19,openRawBlock_option0:20,CLOSE_RAW_BLOCK:21,openBlock:22,block_option0:23,closeBlock:24,openInverse:25,block_option1:26,OPEN_BLOCK:27,openBlock_repetition0:28,openBlock_option0:29,openBlock_option1:30,CLOSE:31,OPEN_INVERSE:32,openInverse_repetition0:33,openInverse_option0:34,openInverse_option1:35,openInverseChain:36,OPEN_INVERSE_CHAIN:37,openInverseChain_repetition0:38,openInverseChain_option0:39,openInverseChain_option1:40,inverseAndProgram:41,INVERSE:42,inverseChain:43,inverseChain_option0:44,OPEN_ENDBLOCK:45,OPEN:46,mustache_repetition0:47,mustache_option0:48,OPEN_UNESCAPED:49,mustache_repetition1:50,mustache_option1:51,CLOSE_UNESCAPED:52,OPEN_PARTIAL:53,partialName:54,partial_repetition0:55,partial_option0:56,param:57,sexpr:58,OPEN_SEXPR:59,sexpr_repetition0:60,sexpr_option0:61,CLOSE_SEXPR:62,hash:63,hash_repetition_plus0:64,hashSegment:65,ID:66,EQUALS:67,blockParams:68,OPEN_BLOCK_PARAMS:69,blockParams_repetition_plus0:70,CLOSE_BLOCK_PARAMS:71,path:72,dataName:73,STRING:74,NUMBER:75,BOOLEAN:76,UNDEFINED:77,NULL:78,DATA:79,pathSegments:80,SEP:81,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",13:"COMMENT",14:"CONTENT",16:"END_RAW_BLOCK",17:"OPEN_RAW_BLOCK",21:"CLOSE_RAW_BLOCK",27:"OPEN_BLOCK",31:"CLOSE",32:"OPEN_INVERSE",37:"OPEN_INVERSE_CHAIN",42:"INVERSE",45:"OPEN_ENDBLOCK",46:"OPEN",49:"OPEN_UNESCAPED",52:"CLOSE_UNESCAPED",53:"OPEN_PARTIAL",59:"OPEN_SEXPR",62:"CLOSE_SEXPR",66:"ID",67:"EQUALS",69:"OPEN_BLOCK_PARAMS",71:"CLOSE_BLOCK_PARAMS",74:"STRING",75:"NUMBER",76:"BOOLEAN",77:"UNDEFINED",78:"NULL",79:"DATA",81:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[12,1],[10,3],[15,5],[9,4],[9,4],[22,6],[25,6],[36,6],[41,2],[43,3],[43,1],[24,3],[8,5],[8,5],[11,5],[57,1],[57,1],[58,5],[63,1],[65,3],[68,3],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[54,1],[54,1],[73,2],[72,1],[80,3],[80,1],[6,0],[6,2],[19,0],[19,2],[20,0],[20,1],[23,0],[23,1],[26,0],[26,1],[28,0],[28,2],[29,0],[29,1],[30,0],[30,1],[33,0],[33,2],[34,0],[34,1],[35,0],[35,1],[38,0],[38,2],[39,0],[39,1],[40,0],[40,1],[44,0],[44,1],[47,0],[47,2],[48,0],[48,1],[50,0],[50,2],[51,0],[51,1],[55,0],[55,2],[56,0],[56,1],[60,0],[60,2],[61,0],[61,1],[64,1],[64,2],[70,1],[70,2]],performAction:function(e,t,n,i,a,r,s){var o=r.length-1;switch(a){case 1:return r[o-1];case 2:this.$=new i.Program(r[o],null,{},i.locInfo(this._$));break;case 3:case 4:case 5:case 6:case 7:this.$=r[o];break;case 8:this.$=new i.CommentStatement(i.stripComment(r[o]),i.stripFlags(r[o],r[o]),i.locInfo(this._$));break;case 9:this.$=new i.ContentStatement(r[o],i.locInfo(this._$));break;case 10:this.$=i.prepareRawBlock(r[o-2],r[o-1],r[o],this._$);break;case 11:this.$={path:r[o-3],params:r[o-2],hash:r[o-1]};break;case 12:this.$=i.prepareBlock(r[o-3],r[o-2],r[o-1],r[o],!1,this._$);break;case 13:this.$=i.prepareBlock(r[o-3],r[o-2],r[o-1],r[o],!0,this._$);break;case 14:case 15:case 16:this.$={path:r[o-4],params:r[o-3],hash:r[o-2],blockParams:r[o-1],strip:i.stripFlags(r[o-5],r[o])};break;case 17:this.$={strip:i.stripFlags(r[o-1],r[o-1]),program:r[o]};break;case 18:var l=i.prepareBlock(r[o-2],r[o-1],r[o],r[o],!1,this._$),c=new i.Program([l],null,{},i.locInfo(this._$));c.chained=!0,this.$={strip:r[o-2].strip,program:c,chain:!0};break;case 19:this.$=r[o];break;case 20:this.$={path:r[o-1],strip:i.stripFlags(r[o-2],r[o])};break;case 21:case 22:this.$=i.prepareMustache(r[o-3],r[o-2],r[o-1],r[o-4],i.stripFlags(r[o-4],r[o]),this._$);break;case 23:this.$=new i.PartialStatement(r[o-3],r[o-2],r[o-1],i.stripFlags(r[o-4],r[o]),i.locInfo(this._$));break;case 24:case 25:this.$=r[o];break;case 26:this.$=new i.SubExpression(r[o-3],r[o-2],r[o-1],i.locInfo(this._$));break;case 27:this.$=new i.Hash(r[o],i.locInfo(this._$));break;case 28:this.$=new i.HashPair(i.id(r[o-2]),r[o],i.locInfo(this._$));break;case 29:this.$=i.id(r[o-1]);break;case 30:case 31:this.$=r[o];break;case 32:this.$=new i.StringLiteral(r[o],i.locInfo(this._$));break;case 33:this.$=new i.NumberLiteral(r[o],i.locInfo(this._$));break;case 34:this.$=new i.BooleanLiteral(r[o],i.locInfo(this._$));break;case 35:this.$=new i.UndefinedLiteral(i.locInfo(this._$));break;case 36:this.$=new i.NullLiteral(i.locInfo(this._$));break;case 37:case 38:this.$=r[o];break;case 39:this.$=i.preparePath(!0,r[o],this._$);break;case 40:this.$=i.preparePath(!1,r[o],this._$);break;case 41:r[o-2].push({part:i.id(r[o]),original:r[o],separator:r[o-1]}),this.$=r[o-2];break;case 42:this.$=[{part:i.id(r[o]),original:r[o]}];break;case 43:this.$=[];break;case 44:r[o-1].push(r[o]);break;case 45:this.$=[];break;case 46:r[o-1].push(r[o]);break;case 53:this.$=[];break;case 54:r[o-1].push(r[o]);break;case 59:this.$=[];break;case 60:r[o-1].push(r[o]);break;case 65:this.$=[];break;case 66:r[o-1].push(r[o]);break;case 73:this.$=[];break;case 74:r[o-1].push(r[o]);break;case 77:this.$=[];break;case 78:r[o-1].push(r[o]);break;case 81:this.$=[];break;case 82:r[o-1].push(r[o]);break;case 85:this.$=[];break;case 86:r[o-1].push(r[o]);break;case 89:this.$=[r[o]];break;case 90:r[o-1].push(r[o]);break;case 91:this.$=[r[o]];break;case 92:r[o-1].push(r[o])}},table:[{3:1,4:2,5:[2,43],6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],46:[2,43],49:[2,43],53:[2,43]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:[1,11],14:[1,18],15:16,17:[1,21],22:14,25:15,27:[1,19],32:[1,20],37:[2,2],42:[2,2],45:[2,2],46:[1,12],49:[1,13],53:[1,17]},{1:[2,1]},{5:[2,44],13:[2,44],14:[2,44],17:[2,44],27:[2,44],32:[2,44],37:[2,44],42:[2,44],45:[2,44],46:[2,44],49:[2,44],53:[2,44]},{5:[2,3],13:[2,3],14:[2,3],17:[2,3],27:[2,3],32:[2,3],37:[2,3],42:[2,3],45:[2,3],46:[2,3],49:[2,3],53:[2,3]},{5:[2,4],13:[2,4],14:[2,4],17:[2,4],27:[2,4],32:[2,4],37:[2,4],42:[2,4],45:[2,4],46:[2,4],49:[2,4],53:[2,4]},{5:[2,5],13:[2,5],14:[2,5],17:[2,5],27:[2,5],32:[2,5],37:[2,5],42:[2,5],45:[2,5],46:[2,5],49:[2,5],53:[2,5]},{5:[2,6],13:[2,6],14:[2,6],17:[2,6],27:[2,6],32:[2,6],37:[2,6],42:[2,6],45:[2,6],46:[2,6],49:[2,6],53:[2,6]},{5:[2,7],13:[2,7],14:[2,7],17:[2,7],27:[2,7],32:[2,7],37:[2,7],42:[2,7],45:[2,7],46:[2,7],49:[2,7],53:[2,7]},{5:[2,8],13:[2,8],14:[2,8],17:[2,8],27:[2,8],32:[2,8],37:[2,8],42:[2,8],45:[2,8],46:[2,8],49:[2,8],53:[2,8]},{18:22,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:33,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{4:34,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],37:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{4:35,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{12:36,14:[1,18]},{18:38,54:37,58:39,59:[1,40],66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,9],13:[2,9],14:[2,9],16:[2,9],17:[2,9],27:[2,9],32:[2,9],37:[2,9],42:[2,9],45:[2,9],46:[2,9],49:[2,9],53:[2,9]},{18:41,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:42,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:43,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{31:[2,73],47:44,59:[2,73],66:[2,73],74:[2,73],75:[2,73],76:[2,73],77:[2,73],78:[2,73],79:[2,73]},{21:[2,30],31:[2,30],52:[2,30],59:[2,30],62:[2,30],66:[2,30],69:[2,30],74:[2,30],75:[2,30],76:[2,30],77:[2,30],78:[2,30],79:[2,30]},{21:[2,31],31:[2,31],52:[2,31],59:[2,31],62:[2,31],66:[2,31],69:[2,31],74:[2,31],75:[2,31],76:[2,31],77:[2,31],78:[2,31],79:[2,31]},{21:[2,32],31:[2,32],52:[2,32],59:[2,32],62:[2,32],66:[2,32],69:[2,32],74:[2,32],75:[2,32],76:[2,32],77:[2,32],78:[2,32],79:[2,32]},{21:[2,33],31:[2,33],52:[2,33],59:[2,33],62:[2,33],66:[2,33],69:[2,33],74:[2,33],75:[2,33],76:[2,33],77:[2,33],78:[2,33],79:[2,33]},{21:[2,34],31:[2,34],52:[2,34],59:[2,34],62:[2,34],66:[2,34],69:[2,34],74:[2,34],75:[2,34],76:[2,34],77:[2,34],78:[2,34],79:[2,34]},{21:[2,35],31:[2,35],52:[2,35],59:[2,35],62:[2,35],66:[2,35],69:[2,35],74:[2,35],75:[2,35],76:[2,35],77:[2,35],78:[2,35],79:[2,35]},{21:[2,36],31:[2,36],52:[2,36],59:[2,36],62:[2,36],66:[2,36],69:[2,36],74:[2,36],75:[2,36],76:[2,36],77:[2,36],78:[2,36],79:[2,36]},{21:[2,40],31:[2,40],52:[2,40],59:[2,40],62:[2,40],66:[2,40],69:[2,40],74:[2,40],75:[2,40],76:[2,40],77:[2,40],78:[2,40],79:[2,40],81:[1,45]},{66:[1,32],80:46},{21:[2,42],31:[2,42],52:[2,42],59:[2,42],62:[2,42],66:[2,42],69:[2,42],74:[2,42],75:[2,42],76:[2,42],77:[2,42],78:[2,42],79:[2,42],81:[2,42]},{50:47,52:[2,77],59:[2,77],66:[2,77],74:[2,77],75:[2,77],76:[2,77],77:[2,77],78:[2,77],79:[2,77]},{23:48,36:50,37:[1,52],41:51,42:[1,53],43:49,45:[2,49]},{26:54,41:55,42:[1,53],45:[2,51]},{16:[1,56]},{31:[2,81],55:57,59:[2,81],66:[2,81],74:[2,81],75:[2,81],76:[2,81],77:[2,81],78:[2,81],79:[2,81]},{31:[2,37],59:[2,37],66:[2,37],74:[2,37],75:[2,37],76:[2,37],77:[2,37],78:[2,37],79:[2,37]},{31:[2,38],59:[2,38],66:[2,38],74:[2,38],75:[2,38],76:[2,38],77:[2,38],78:[2,38],79:[2,38]},{18:58,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{28:59,31:[2,53],59:[2,53],66:[2,53],69:[2,53],74:[2,53],75:[2,53],76:[2,53],77:[2,53],78:[2,53],79:[2,53]},{31:[2,59],33:60,59:[2,59],66:[2,59],69:[2,59],74:[2,59],75:[2,59],76:[2,59],77:[2,59],78:[2,59],79:[2,59]},{19:61,21:[2,45],59:[2,45],66:[2,45],74:[2,45],75:[2,45],76:[2,45],77:[2,45],78:[2,45],79:[2,45]},{18:65,31:[2,75],48:62,57:63,58:66,59:[1,40],63:64,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{66:[1,70]},{21:[2,39],31:[2,39],52:[2,39],59:[2,39],62:[2,39],66:[2,39],69:[2,39],74:[2,39],75:[2,39],76:[2,39],77:[2,39],78:[2,39],79:[2,39],81:[1,45]},{18:65,51:71,52:[2,79],57:72,58:66,59:[1,40],63:73,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{24:74,45:[1,75]},{45:[2,50]},{4:76,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],37:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{45:[2,19]},{18:77,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{4:78,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{24:79,45:[1,75]},{45:[2,52]},{5:[2,10],13:[2,10],14:[2,10],17:[2,10],27:[2,10],32:[2,10],37:[2,10],42:[2,10],45:[2,10],46:[2,10],49:[2,10],53:[2,10]},{18:65,31:[2,83],56:80,57:81,58:66,59:[1,40],63:82,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{59:[2,85],60:83,62:[2,85],66:[2,85],74:[2,85],75:[2,85],76:[2,85],77:[2,85],78:[2,85],79:[2,85]},{18:65,29:84,31:[2,55],57:85,58:66,59:[1,40],63:86,64:67,65:68,66:[1,69],69:[2,55],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:65,31:[2,61],34:87,57:88,58:66,59:[1,40],63:89,64:67,65:68,66:[1,69],69:[2,61],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:65,20:90,21:[2,47],57:91,58:66,59:[1,40],63:92,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{31:[1,93]},{31:[2,74],59:[2,74],66:[2,74],74:[2,74],75:[2,74],76:[2,74],77:[2,74],78:[2,74],79:[2,74]},{31:[2,76]},{21:[2,24],31:[2,24],52:[2,24],59:[2,24],62:[2,24],66:[2,24],69:[2,24],74:[2,24],75:[2,24],76:[2,24],77:[2,24],78:[2,24],79:[2,24]},{21:[2,25],31:[2,25],52:[2,25],59:[2,25],62:[2,25],66:[2,25],69:[2,25],74:[2,25],75:[2,25],76:[2,25],77:[2,25],78:[2,25],79:[2,25]},{21:[2,27],31:[2,27],52:[2,27],62:[2,27],65:94,66:[1,95],69:[2,27]},{21:[2,89],31:[2,89],52:[2,89],62:[2,89],66:[2,89],69:[2,89]},{21:[2,42],31:[2,42],52:[2,42],59:[2,42],62:[2,42],66:[2,42],67:[1,96],69:[2,42],74:[2,42],75:[2,42],76:[2,42],77:[2,42],78:[2,42],79:[2,42],81:[2,42]},{21:[2,41],31:[2,41],52:[2,41],59:[2,41],62:[2,41],66:[2,41],69:[2,41],74:[2,41],75:[2,41],76:[2,41],77:[2,41],78:[2,41],79:[2,41],81:[2,41]},{52:[1,97]},{52:[2,78],59:[2,78],66:[2,78],74:[2,78],75:[2,78],76:[2,78],77:[2,78],78:[2,78],79:[2,78]},{52:[2,80]},{5:[2,12],13:[2,12],14:[2,12],17:[2,12],27:[2,12],32:[2,12],37:[2,12],42:[2,12],45:[2,12],46:[2,12],49:[2,12],53:[2,12]},{18:98,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{36:50,37:[1,52],41:51,42:[1,53],43:100,44:99,45:[2,71]},{31:[2,65],38:101,59:[2,65],66:[2,65],69:[2,65],74:[2,65],75:[2,65],76:[2,65],77:[2,65],78:[2,65],79:[2,65]},{45:[2,17]},{5:[2,13],13:[2,13],14:[2,13],17:[2,13],27:[2,13],32:[2,13],37:[2,13],42:[2,13],45:[2,13],46:[2,13],49:[2,13],53:[2,13]},{31:[1,102]},{31:[2,82],59:[2,82],66:[2,82],74:[2,82],75:[2,82],76:[2,82],77:[2,82],78:[2,82],79:[2,82]},{31:[2,84]},{18:65,57:104,58:66,59:[1,40],61:103,62:[2,87],63:105,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{30:106,31:[2,57],68:107,69:[1,108]},{31:[2,54],59:[2,54],66:[2,54],69:[2,54],74:[2,54],75:[2,54],76:[2,54],77:[2,54],78:[2,54],79:[2,54]},{31:[2,56],69:[2,56]},{31:[2,63],35:109,68:110,69:[1,108]},{31:[2,60],59:[2,60],66:[2,60],69:[2,60],74:[2,60],75:[2,60],76:[2,60],77:[2,60],78:[2,60],79:[2,60]},{31:[2,62],69:[2,62]},{21:[1,111]},{21:[2,46],59:[2,46],66:[2,46],74:[2,46],75:[2,46],76:[2,46],77:[2,46],78:[2,46],79:[2,46]},{21:[2,48]},{5:[2,21],13:[2,21],14:[2,21],17:[2,21],27:[2,21],32:[2,21],37:[2,21],42:[2,21],45:[2,21],46:[2,21],49:[2,21],53:[2,21]},{21:[2,90],31:[2,90],52:[2,90],62:[2,90],66:[2,90],69:[2,90]},{67:[1,96]},{18:65,57:112,58:66,59:[1,40],66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,22],13:[2,22],14:[2,22],17:[2,22],27:[2,22],32:[2,22],37:[2,22],42:[2,22],45:[2,22],46:[2,22],49:[2,22],53:[2,22]},{31:[1,113]},{45:[2,18]},{45:[2,72]},{18:65,31:[2,67],39:114,57:115,58:66,59:[1,40],63:116,64:67,65:68,66:[1,69],69:[2,67],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,23],13:[2,23],14:[2,23],17:[2,23],27:[2,23],32:[2,23],37:[2,23],42:[2,23],45:[2,23],46:[2,23],49:[2,23],53:[2,23]},{62:[1,117]},{59:[2,86],62:[2,86],66:[2,86],74:[2,86],75:[2,86],76:[2,86],77:[2,86],78:[2,86],79:[2,86]},{62:[2,88]},{31:[1,118]},{31:[2,58]},{66:[1,120],70:119},{31:[1,121]},{31:[2,64]},{14:[2,11]},{21:[2,28],31:[2,28],52:[2,28],62:[2,28],66:[2,28],69:[2,28]},{5:[2,20],13:[2,20],14:[2,20],17:[2,20],27:[2,20],32:[2,20],37:[2,20],42:[2,20],45:[2,20],46:[2,20],49:[2,20],53:[2,20]},{31:[2,69],40:122,68:123,69:[1,108]},{31:[2,66],59:[2,66],66:[2,66],69:[2,66],74:[2,66],75:[2,66],76:[2,66],77:[2,66],78:[2,66],79:[2,66]},{31:[2,68],69:[2,68]},{21:[2,26],31:[2,26],52:[2,26],59:[2,26],62:[2,26],66:[2,26],69:[2,26],74:[2,26],75:[2,26],76:[2,26],77:[2,26],78:[2,26],79:[2,26]},{13:[2,14],14:[2,14],17:[2,14],27:[2,14],32:[2,14],37:[2,14],42:[2,14],45:[2,14],46:[2,14],49:[2,14],53:[2,14]},{66:[1,125],71:[1,124]},{66:[2,91],71:[2,91]},{13:[2,15],14:[2,15],17:[2,15],27:[2,15],32:[2,15],42:[2,15],45:[2,15],46:[2,15],49:[2,15],53:[2,15]},{31:[1,126]},{31:[2,70]},{31:[2,29]},{66:[2,92],71:[2,92]},{13:[2,16],14:[2,16],17:[2,16],27:[2,16],32:[2,16],37:[2,16],42:[2,16],45:[2,16],46:[2,16],49:[2,16],53:[2,16]}],defaultActions:{4:[2,1],49:[2,50],51:[2,19],55:[2,52],64:[2,76],73:[2,80],78:[2,17],82:[2,84],92:[2,48],99:[2,18],100:[2,72],105:[2,88],107:[2,58],110:[2,64],111:[2,11],123:[2,70],124:[2,29]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],i=[null],a=[],r=this.table,s="",o=0,l=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;a.push(u);var d=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,p,f,m,g,b,v,y,w,_,x={};;){if(f=n[n.length-1],this.defaultActions[f]?m=this.defaultActions[f]:(null!==h&&void 0!==h||(_=void 0,"number"!=typeof(_=t.lexer.lex()||1)&&(_=t.symbols_[_]||_),h=_),m=r[f]&&r[f][h]),void 0===m||!m.length||!m[0]){var S="";if(!c){for(b in w=[],r[f])this.terminals_[b]&&b>2&&w.push("'"+this.terminals_[b]+"'");S=this.lexer.showPosition?"Parse error on line "+(o+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+w.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(o+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(S,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:u,expected:w})}}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+h);switch(m[0]){case 1:n.push(h),i.push(this.lexer.yytext),a.push(this.lexer.yylloc),n.push(m[1]),h=null,p?(h=p,p=null):(l=this.lexer.yyleng,s=this.lexer.yytext,o=this.lexer.yylineno,u=this.lexer.yylloc,c>0&&c--);break;case 2:if(v=this.productions_[m[1]][1],x.$=i[i.length-v],x._$={first_line:a[a.length-(v||1)].first_line,last_line:a[a.length-1].last_line,first_column:a[a.length-(v||1)].first_column,last_column:a[a.length-1].last_column},d&&(x._$.range=[a[a.length-(v||1)].range[0],a[a.length-1].range[1]]),void 0!==(g=this.performAction.call(x,s,l,o,this.yy,m[1],i,a)))return g;v&&(n=n.slice(0,-1*v*2),i=i.slice(0,-1*v),a=a.slice(0,-1*v)),n.push(this.productions_[m[1]][0]),i.push(x.$),a.push(x._$),y=r[n[n.length-2]][n[n.length-1]],n.push(y);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t,n,i,a;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),s=0;s<r.length&&(!(n=this._input.match(this.rules[r[s]]))||t&&!(n[0].length>t[0].length)||(t=n,i=s,this.options.flex));s++);return t?((a=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=a.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:a?a[a.length-1].length-a[a.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,r[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},options:{},performAction:function(e,t,n,i){function a(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(a(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(a(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return t.yytext=t.yytext.substr(5,t.yyleng-9),this.popState(),16;case 4:return 14;case 5:return this.popState(),13;case 6:return 59;case 7:return 62;case 8:return 17;case 9:return this.popState(),this.begin("raw"),21;case 10:return 53;case 11:return 27;case 12:return 45;case 13:case 14:return this.popState(),42;case 15:return 32;case 16:return 37;case 17:return 49;case 18:return 46;case 19:this.unput(t.yytext),this.popState(),this.begin("com");break;case 20:return this.popState(),13;case 21:return 46;case 22:return 67;case 23:case 24:return 66;case 25:return 81;case 26:break;case 27:return this.popState(),52;case 28:return this.popState(),31;case 29:return t.yytext=a(1,2).replace(/\\"/g,'"'),74;case 30:return t.yytext=a(1,2).replace(/\\'/g,"'"),74;case 31:return 79;case 32:case 33:return 76;case 34:return 77;case 35:return 78;case 36:return 75;case 37:return 69;case 38:return 71;case 39:case 40:return 66;case 41:return"INVALID";case 42:return 5}},rules:[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],conditions:{mu:{rules:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[5],inclusive:!1},raw:{rules:[3,4],inclusive:!1},INITIAL:{rules:[0,1,42],inclusive:!0}}};return e}();function n(){this.yy={}}return e.lexer=t,n.prototype=e,e.Parser=n,new n}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var a=i(n(6));function r(){}function s(e,t,n){void 0===t&&(t=e.length);var i=e[t-1],a=e[t-2];return i?"ContentStatement"===i.type?(a||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(i.original):void 0:n}function o(e,t,n){void 0===t&&(t=-1);var i=e[t+1],a=e[t+2];return i?"ContentStatement"===i.type?(a||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(i.original):void 0:n}function l(e,t,n){var i=e[null==t?0:t+1];if(i&&"ContentStatement"===i.type&&(n||!i.rightStripped)){var a=i.value;i.value=i.value.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),i.rightStripped=i.value!==a}}function c(e,t,n){var i=e[null==t?e.length-1:t-1];if(i&&"ContentStatement"===i.type&&(n||!i.leftStripped)){var a=i.value;return i.value=i.value.replace(n?/\s+$/:/[ \t]+$/,""),i.leftStripped=i.value!==a,i.leftStripped}}r.prototype=new a.default,r.prototype.Program=function(e){var t=!this.isRootSeen;this.isRootSeen=!0;for(var n=e.body,i=0,a=n.length;i<a;i++){var r=n[i],u=this.accept(r);if(u){var d=s(n,i,t),h=o(n,i,t),p=u.openStandalone&&d,f=u.closeStandalone&&h,m=u.inlineStandalone&&d&&h;u.close&&l(n,i,!0),u.open&&c(n,i,!0),m&&(l(n,i),c(n,i)&&"PartialStatement"===r.type&&(r.indent=/([ \t]+$)/.exec(n[i-1].original)[1])),p&&(l((r.program||r.inverse).body),c(n,i)),f&&(l(n,i),c((r.inverse||r.program).body))}}return e},r.prototype.BlockStatement=function(e){this.accept(e.program),this.accept(e.inverse);var t=e.program||e.inverse,n=e.program&&e.inverse,i=n,a=n;if(n&&n.chained)for(i=n.body[0].program;a.chained;)a=a.body[a.body.length-1].program;var r={open:e.openStrip.open,close:e.closeStrip.close,openStandalone:o(t.body),closeStandalone:s((i||t).body)};if(e.openStrip.close&&l(t.body,null,!0),n){var u=e.inverseStrip;u.open&&c(t.body,null,!0),u.close&&l(i.body,null,!0),e.closeStrip.open&&c(a.body,null,!0),s(t.body)&&o(i.body)&&(c(t.body),l(i.body))}else e.closeStrip.open&&c(t.body,null,!0);return r},r.prototype.MustacheStatement=function(e){return e.strip},r.prototype.PartialStatement=r.prototype.CommentStatement=function(e){var t=e.strip||{};return{inlineStandalone:!0,open:t.open,close:t.close}},t.default=r,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0,t.SourceLocation=function(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}},t.id=function(e){return/^\[.*\]$/.test(e)?e.substr(1,e.length-2):e},t.stripFlags=function(e,t){return{open:"~"===e.charAt(2),close:"~"===t.charAt(t.length-3)}},t.stripComment=function(e){return e.replace(/^\{\{~?\!-?-?/,"").replace(/-?-?~?\}\}$/,"")},t.preparePath=function(e,t,n){n=this.locInfo(n);for(var i=e?"@":"",r=[],s=0,o=0,l=t.length;o<l;o++){var c=t[o].part,u=t[o].original!==c;if(i+=(t[o].separator||"")+c,u||".."!==c&&"."!==c&&"this"!==c)r.push(c);else{if(r.length>0)throw new a.default("Invalid path: "+i,{loc:n});".."===c&&(s++,"../")}}return new this.PathExpression(e,s,r,i,n)},t.prepareMustache=function(e,t,n,i,a,r){var s=i.charAt(3)||i.charAt(2),o="{"!==s&&"&"!==s;return new this.MustacheStatement(e,t,n,o,a,this.locInfo(r))},t.prepareRawBlock=function(e,t,n,i){if(e.path.original!==n){var r={loc:e.path.loc};throw new a.default(e.path.original+" doesn't match "+n,r)}i=this.locInfo(i);var s=new this.Program([t],null,{},i);return new this.BlockStatement(e.path,e.params,e.hash,s,void 0,{},{},{},i)},t.prepareBlock=function(e,t,n,i,r,s){if(i&&i.path&&e.path.original!==i.path.original){var o={loc:e.path.loc};throw new a.default(e.path.original+" doesn't match "+i.path.original,o)}t.blockParams=e.blockParams;var l=void 0,c=void 0;n&&(n.chain&&(n.program.body[0].closeStrip=i.strip),c=n.strip,l=n.program);r&&(r=l,l=t,t=r);return new this.BlockStatement(e.path,e.params,e.hash,t,l,e.strip,c,i&&i.strip,this.locInfo(s))};var a=i(n(12))},function(e,t,n){"use strict";t.__esModule=!0;var i=n(13),a=void 0;try{}catch(e){}function r(e,t,n){if(i.isArray(e)){for(var a=[],r=0,s=e.length;r<s;r++)a.push(t.wrap(e[r],n));return a}return"boolean"==typeof e||"number"==typeof e?e+"":e}function s(e){this.srcFile=e,this.source=[]}a||((a=function(e,t,n,i){this.src="",i&&this.add(i)}).prototype={add:function(e){i.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){i.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),s.prototype={prepend:function(e,t){this.source.unshift(this.wrap(e,t))},push:function(e,t){this.source.push(this.wrap(e,t))},merge:function(){var e=this.empty();return this.each(function(t){e.add(["  ",t,"\n"])}),e},each:function(e){for(var t=0,n=this.source.length;t<n;t++)e(this.source[t])},empty:function(){var e=void 0===arguments[0]?this.currentLocation||{start:{}}:arguments[0];return new a(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var t=void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return e instanceof a?e:(e=r(e,this,t),new a(t.start.line,t.start.column,this.srcFile,e))},functionCall:function(e,t,n){return n=this.generateList(n),this.wrap([e,t?"."+t+"(":"(",n,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var i=r(e[n],this);"undefined"!==i&&t.push([this.quotedString(n),":",i])}var a=this.generateList(t);return a.prepend("{"),a.add("}"),a},generateList:function(e,t){for(var n=this.empty(t),i=0,a=e.length;i<a;i++)i&&n.add(","),n.add(r(e[i],this,t));return n},generateArray:function(e,t){var n=this.generateList(e,t);return n.prepend("["),n.add("]"),n}},t.default=s,e.exports=t.default}])}),define("hbs/underscore",[],function(){var e={},t=Array.prototype,n=Object.prototype,i=Function.prototype,a=t.slice,r=t.unshift,s=n.toString,o=n.hasOwnProperty,l=t.forEach,c=t.map,u=t.reduce,d=t.reduceRight,h=t.filter,p=t.every,f=t.some,m=t.indexOf,g=t.lastIndexOf,b=Array.isArray,v=Object.keys,y=i.bind,w=function(e){return new P(e)};w.VERSION="1.3.3";var _=w.each=w.forEach=function(t,n,i){if(null!=t)if(l&&t.forEach===l)t.forEach(n,i);else if(t.length===+t.length){for(var a=0,r=t.length;a<r;a++)if(a in t&&n.call(i,t[a],a,t)===e)return}else for(var s in t)if(w.has(t,s)&&n.call(i,t[s],s,t)===e)return};w.map=w.collect=function(e,t,n){var i=[];return null==e?i:c&&e.map===c?e.map(t,n):(_(e,function(e,a,r){i[i.length]=t.call(n,e,a,r)}),e.length===+e.length&&(i.length=e.length),i)},w.reduce=w.foldl=w.inject=function(e,t,n,i){var a=arguments.length>2;if(null==e&&(e=[]),u&&e.reduce===u)return i&&(t=w.bind(t,i)),a?e.reduce(t,n):e.reduce(t);if(_(e,function(e,r,s){a?n=t.call(i,n,e,r,s):(n=e,a=!0)}),!a)throw new TypeError("Reduce of empty array with no initial value");return n},w.reduceRight=w.foldr=function(e,t,n,i){var a=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return i&&(t=w.bind(t,i)),a?e.reduceRight(t,n):e.reduceRight(t);var r=w.toArray(e).reverse();return i&&!a&&(t=w.bind(t,i)),a?w.reduce(r,t,n,i):w.reduce(r,t)},w.find=w.detect=function(e,t,n){var i;return x(e,function(e,a,r){if(t.call(n,e,a,r))return i=e,!0}),i},w.filter=w.select=function(e,t,n){var i=[];return null==e?i:h&&e.filter===h?e.filter(t,n):(_(e,function(e,a,r){t.call(n,e,a,r)&&(i[i.length]=e)}),i)},w.reject=function(e,t,n){var i=[];return null==e?i:(_(e,function(e,a,r){t.call(n,e,a,r)||(i[i.length]=e)}),i)},w.every=w.all=function(t,n,i){var a=!0;return null==t?a:p&&t.every===p?t.every(n,i):(_(t,function(t,r,s){if(!(a=a&&n.call(i,t,r,s)))return e}),!!a)};var x=w.some=w.any=function(t,n,i){n||(n=w.identity);var a=!1;return null==t?a:f&&t.some===f?t.some(n,i):(_(t,function(t,r,s){if(a||(a=n.call(i,t,r,s)))return e}),!!a)};w.include=w.contains=function(e,t){var n=!1;return null==e?n:m&&e.indexOf===m?-1!=e.indexOf(t):n=x(e,function(e){return e===t})},w.invoke=function(e,t){var n=a.call(arguments,2);return w.map(e,function(e){return(w.isFunction(t)?t||e:e[t]).apply(e,n)})},w.pluck=function(e,t){return w.map(e,function(e){return e[t]})},w.max=function(e,t,n){if(!t&&w.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&w.isEmpty(e))return-1/0;var i={computed:-1/0};return _(e,function(e,a,r){var s=t?t.call(n,e,a,r):e;s>=i.computed&&(i={value:e,computed:s})}),i.value},w.min=function(e,t,n){if(!t&&w.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&w.isEmpty(e))return 1/0;var i={computed:1/0};return _(e,function(e,a,r){var s=t?t.call(n,e,a,r):e;s<i.computed&&(i={value:e,computed:s})}),i.value},w.shuffle=function(e){var t,n=[];return _(e,function(e,i,a){t=Math.floor(Math.random()*(i+1)),n[i]=n[t],n[t]=e}),n},w.sortBy=function(e,t,n){var i=w.isFunction(t)?t:function(e){return e[t]};return w.pluck(w.map(e,function(e,t,a){return{value:e,criteria:i.call(n,e,t,a)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;return void 0===n?1:void 0===i?-1:n<i?-1:n>i?1:0}),"value")},w.groupBy=function(e,t){var n={},i=w.isFunction(t)?t:function(e){return e[t]};return _(e,function(e,t){var a=i(e,t);(n[a]||(n[a]=[])).push(e)}),n},w.sortedIndex=function(e,t,n){n||(n=w.identity);for(var i=0,a=e.length;i<a;){var r=i+a>>1;n(e[r])<n(t)?i=r+1:a=r}return i},w.toArray=function(e){return e?w.isArray(e)?a.call(e):w.isArguments(e)?a.call(e):e.toArray&&w.isFunction(e.toArray)?e.toArray():w.values(e):[]},w.size=function(e){return w.isArray(e)?e.length:w.keys(e).length},w.first=w.head=w.take=function(e,t,n){return null==t||n?e[0]:a.call(e,0,t)},w.initial=function(e,t,n){return a.call(e,0,e.length-(null==t||n?1:t))},w.last=function(e,t,n){return null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},w.rest=w.tail=function(e,t,n){return a.call(e,null==t||n?1:t)},w.compact=function(e){return w.filter(e,function(e){return!!e})},w.flatten=function(e,t){return w.reduce(e,function(e,n){return w.isArray(n)?e.concat(t?n:w.flatten(n)):(e[e.length]=n,e)},[])},w.without=function(e){return w.difference(e,a.call(arguments,1))},w.uniq=w.unique=function(e,t,n){var i=n?w.map(e,n):e,a=[];return e.length<3&&(t=!0),w.reduce(i,function(n,i,r){return(t?w.last(n)===i&&n.length:w.include(n,i))||(n.push(i),a.push(e[r])),n},[]),a},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=w.intersect=function(e){var t=a.call(arguments,1);return w.filter(w.uniq(e),function(e){return w.every(t,function(t){return w.indexOf(t,e)>=0})})},w.difference=function(e){var t=w.flatten(a.call(arguments,1),!0);return w.filter(e,function(e){return!w.include(t,e)})},w.zip=function(){for(var e=a.call(arguments),t=w.max(w.pluck(e,"length")),n=new Array(t),i=0;i<t;i++)n[i]=w.pluck(e,""+i);return n},w.indexOf=function(e,t,n){if(null==e)return-1;var i,a;if(n)return e[i=w.sortedIndex(e,t)]===t?i:-1;if(m&&e.indexOf===m)return e.indexOf(t);for(i=0,a=e.length;i<a;i++)if(i in e&&e[i]===t)return i;return-1},w.lastIndexOf=function(e,t){if(null==e)return-1;if(g&&e.lastIndexOf===g)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},w.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),a=0,r=new Array(i);a<i;)r[a++]=e,e+=n;return r};var S=function(){};w.bind=function(e,t){var n,i;if(e.bind===y&&y)return y.apply(e,a.call(arguments,1));if(!w.isFunction(e))throw new TypeError;return i=a.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(a.call(arguments)));S.prototype=e.prototype;var r=new S,s=e.apply(r,i.concat(a.call(arguments)));return Object(s)===s?s:r}},w.bindAll=function(e){var t=a.call(arguments,1);return 0==t.length&&(t=w.functions(e)),_(t,function(t){e[t]=w.bind(e[t],e)}),e},w.memoize=function(e,t){var n={};return t||(t=w.identity),function(){var i=t.apply(this,arguments);return w.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},w.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},w.defer=function(e){return w.delay.apply(w,[e,1].concat(a.call(arguments,1)))},w.throttle=function(e,t){var n,i,a,r,s,o,l=w.debounce(function(){s=r=!1},t);return function(){n=this,i=arguments;return a||(a=setTimeout(function(){a=null,s&&e.apply(n,i),l()},t)),r?s=!0:o=e.apply(n,i),l(),r=!0,o}},w.debounce=function(e,t,n){var i;return function(){var a=this,r=arguments;n&&!i&&e.apply(a,r),clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(a,r)},t)}},w.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments))}},w.wrap=function(e,t){return function(){var n=[e].concat(a.call(arguments,0));return t.apply(this,n)}},w.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},w.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},w.keys=v||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)w.has(e,n)&&(t[t.length]=n);return t},w.values=function(e){return w.map(e,w.identity)},w.functions=w.methods=function(e){var t=[];for(var n in e)w.isFunction(e[n])&&t.push(n);return t.sort()},w.extend=function(e){return _(a.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},w.pick=function(e){var t={};return _(w.flatten(a.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},w.defaults=function(e){return _(a.call(arguments,1),function(t){for(var n in t)null==e[n]&&(e[n]=t[n])}),e},w.clone=function(e){return w.isObject(e)?w.isArray(e)?e.slice():w.extend({},e):e},w.tap=function(e,t){return t(e),e},w.isEqual=function(e,t){return function e(t,n,i){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;if(t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped),t.isEqual&&w.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&w.isFunction(n.isEqual))return n.isEqual(t);var a=s.call(t);if(a!=s.call(n))return!1;switch(a){case"[object String]":return t==String(n);case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=_typeof(t)||"object"!=_typeof(n))return!1;for(var r=i.length;r--;)if(i[r]==t)return!0;i.push(t);var o=0,l=!0;if("[object Array]"==a){if(l=(o=t.length)==n.length)for(;o--&&(l=o in t==o in n&&e(t[o],n[o],i)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var c in t)if(w.has(t,c)&&(o++,!(l=w.has(n,c)&&e(t[c],n[c],i))))break;if(l){for(c in n)if(w.has(n,c)&&!o--)break;l=!o}}return i.pop(),l}(e,t,[])},w.isEmpty=function(e){if(null==e)return!0;if(w.isArray(e)||w.isString(e))return 0===e.length;for(var t in e)if(w.has(e,t))return!1;return!0},w.isElement=function(e){return!(!e||1!=e.nodeType)},w.isArray=b||function(e){return"[object Array]"==s.call(e)},w.isObject=function(e){return e===Object(e)},w.isArguments=function(e){return"[object Arguments]"==s.call(e)},w.isArguments(arguments)||(w.isArguments=function(e){return!(!e||!w.has(e,"callee"))}),w.isFunction=function(e){return"[object Function]"==s.call(e)},w.isString=function(e){return"[object String]"==s.call(e)},w.isNumber=function(e){return"[object Number]"==s.call(e)},w.isFinite=function(e){return w.isNumber(e)&&isFinite(e)},w.isNaN=function(e){return e!=e},w.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==s.call(e)},w.isDate=function(e){return"[object Date]"==s.call(e)},w.isRegExp=function(e){return"[object RegExp]"==s.call(e)},w.isNull=function(e){return null===e},w.isUndefined=function(e){return void 0===e},w.has=function(e,t){return o.call(e,t)},w.noConflict=function(){return root._=previousUnderscore,this},w.identity=function(e){return e},w.times=function(e,t,n){for(var i=0;i<e;i++)t.call(n,i)},w.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},w.result=function(e,t){if(null==e)return null;var n=e[t];return w.isFunction(n)?n.call(e):n},w.mixin=function(e){_(w.functions(e),function(t){I(t,w[t]=e[t])})};var E=0;w.uniqueId=function(e){var t=E++;return e?e+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var k=/.^/,A={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var C in A)A[A[C]]=C;var T=/\\|'|\r|\n|\t|\u2028|\u2029/g,O=/\\(\\|'|r|n|t|u2028|u2029)/g,j=function(e){return e.replace(O,function(e,t){return A[t]})};w.template=function(e,t,n){n=w.defaults(n||{},w.templateSettings);var i="__p+='"+e.replace(T,function(e){return"\\"+A[e]}).replace(n.escape||k,function(e,t){return"'+\n_.escape("+j(t)+")+\n'"}).replace(n.interpolate||k,function(e,t){return"'+\n("+j(t)+")+\n'"}).replace(n.evaluate||k,function(e,t){return"';\n"+j(t)+"\n;__p+='"})+"';\n";n.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+i+"return __p;\n";var a=new Function(n.variable||"obj","_",i);if(t)return a(t,w);var r=function(e){return a.call(this,e,w)};return r.source="function("+(n.variable||"obj")+"){\n"+i+"}",r},w.chain=function(e){return w(e).chain()};var P=function(e){this._wrapped=e};w.prototype=P.prototype;var R=function(e,t){return t?w(e).chain():e},I=function(e,t){P.prototype[e]=function(){var e=a.call(arguments);return r.call(e,this._wrapped),R(t.apply(w,e),this._chain)}};return w.mixin(w),_(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var n=t[e];P.prototype[e]=function(){var t=this._wrapped;n.apply(t,arguments);var i=t.length;return"shift"!=e&&"splice"!=e||0!==i||delete t[0],R(t,this._chain)}}),_(["concat","join","slice"],function(e){var n=t[e];P.prototype[e]=function(){return R(n.apply(this._wrapped,arguments),this._chain)}}),P.prototype.chain=function(){return this._chain=!0,this},P.prototype.value=function(){return this._wrapped},w}),function(window){var JSON=window.JSON||{};!function(){"use strict";function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,a,r,s,o=gap,l=t[e];switch(l&&"object"===_typeof(l)&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),_typeof(l)){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(r=l.length,n=0;n<r;n+=1)s[n]=str(n,l)||"null";return a=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+o+"]":"["+s.join(",")+"]",gap=o,a}if(rep&&"object"===_typeof(rep))for(r=rep.length,n=0;n<r;n+=1)"string"==typeof rep[n]&&(a=str(i=rep[n],l))&&s.push(quote(i)+(gap?": ":":")+a);else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(a=str(i,l))&&s.push(quote(i)+(gap?": ":":")+a);return a=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+o+"}":"{"+s.join(",")+"}",gap=o,a}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!==_typeof(t)||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var n,i,a=e[t];if(a&&"object"===_typeof(a))for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(void 0!==(i=walk(a,n))?a[n]=i:delete a[n]);return reviver.call(e,t,a)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("hbs/json2",[],function(){return JSON})}.call(this,this),define("hbs",["hbs/handlebars","hbs/underscore","hbs/json2"],function(e,t,n){var i,a,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=function(){throw new Error("Environment unsupported.")},o=[],l="w+",c="hbs",u="/styles/",d="/demo-build/styles/",h="templates/helpers/",p="screen.build.css",f="onHbsRead";e.registerHelper("$",function(){}),"undefined"!=typeof window&&window.navigator&&window.document&&!window.navigator.userAgent.match(/Node.js/)?(a=function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return!0===arguments[0]?new XDomainRequest:new XMLHttpRequest;for(t=0;t<3;t++){n=r[t];try{e=new ActiveXObject(n)}catch(e){}if(e){r=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},getIEVersion=function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))}return e},s=function(e,t){var n=!1;if(0!=e.indexOf("http"))n=!1;else{var i="https"===e.substr(0,5)?8:7,r="https"===window.location.href.substr(0,5)?8:7,s=e.substr(i).split("/").shift(),o=getIEVersion();n=s!=window.location.href.substr(r).split("/").shift()&&o>=7}if(n){var l=a(!0);l.open("GET",e),l.onload=function(){t(l.responseText,e)},l.onprogress=function(){},l.ontimeout=function(){},l.onerror=function(){},setTimeout(function(){l.send()},0)}else{var c=a();c.open("GET",e,!0),c.onreadystatechange=function(n){4===c.readyState&&t(c.responseText,e)},c.send(null)}}):"undefined"!=typeof process&&process.versions&&process.versions.node?(i=require.nodeRequire("fs"),s=function(e,t){var n=i.readFileSync(e,"utf8")||"";t(n=n.replace(/^\uFEFF/,""),e)}):"undefined"!=typeof java&&void 0!==java.io&&(s=function(e,t){for(var n,i=new java.io.FileInputStream(e),a=new java.io.InputStreamReader(i,"UTF-8"),r=new java.io.BufferedReader(a),s="";null!==(n=r.readLine());)s+=new String(n)+"\n";r.close(),t(s,e)});var m,g=[],b={},v=[];return{get:function(){return e},write:function(e,t,n){if(t+"@hbs"in o){var i=o[t+"@hbs"];n.asModule(e+"!"+t,i)}},version:"3.0.3",load:function(i,a,r,y){var w=i+"@hbs";(m=m||y).hbs=m.hbs||{};var _=0==m.hbs.helpers,x="";m.hbs.partialsUrl&&((x=m.hbs.partialsUrl).match(/\/$/)||(x+="/")),m.hbs.fetchText&&(s=m.hbs.fetchText);var S;function E(e,n){var i=[];return e&&e.body&&(i=function e(n,i){return t(n).forEach(function(t){t&&t.type&&"PartialStatement"===t.type&&"SubExpression"!==t.name.type&&i.push(t.name.original),t&&t.program&&t.program.body&&e(t.program.body,i),t&&t.inverse&&t.inverse.body&&e(t.inverse.body,i)}),i}(e.body,[])),n&&n.partials&&n.partials.length&&t(n.partials).forEach(function(e){i.push(e)}),t.unique(i)}function k(e){return!!("SubExpression"===e.type||e.params&&e.params.length||e.hash)}function A(n,i){k(n)&&void 0!==n.path&&function(t,n){void 0===e.helpers[t]&&n.push(t)}(n.path.original,i),n&&n.params&&n.params.forEach(function(e){A(e,i)}),n&&n.hash&&n.hash.pairs&&t(n.hash.pairs).forEach(function(e){A(e.value,i)})}function C(e){var n=[],i=[];e&&e.body&&(n=function e(n,i,a,r){a=a?a+".":"";return t(n).forEach(function(t){var n;(k(t)||"MustacheStatement"===t.type)&&A(t,r),t&&t.mustache&&e([t.mustache],i,a+"",r),t&&t.program&&t.program.body&&(n=e([t.path],[],"",r)[0]||"",t.inverse&&t.inverse.body&&e(t.inverse.body,i,a+""+(n?a+""?"."+n:n:""),r),e(t.program.body,i,a+""+(n?a+""?"."+n:n:""),r))}),i}(e.body,[],void 0,i));var a=["helperMissing","blockHelperMissing","each","if","unless","with","log","lookup"];return{vars:t(n).chain().unique().map(function(e){return""===e?".":e.length&&"."===e[e.length-1]?e.substr(0,e.length-1)+"[]":e}).value(),helpers:t(i).chain().unique().map(function(e){if(!t(a).contains(e))return e}).compact().value()}}function T(e){for(var t=e.split("/"),n=0;n<t.length;n++)".."===t[n]?(delete t[n-1],delete t[n]):"."===t[n]&&delete t[n];return t.join("/").replace(/\/\/+/g,"/")}var O=m.hbs&&!1===m.hbs.templateExtension;S=O?a.toUrl(i):a.toUrl(i+"."+(m.hbs&&m.hbs.templateExtension?m.hbs.templateExtension:c)),s(S,function(s,y){var S,k,A,j,P,R=m.isBuild&&m[f]?m[f]:function(e,t,n){return n},I=e.parse(R(i,y,s)),D=function(e){var t,i;if(e&&e.body&&(t=e.body[0])&&"CommentStatement"===t.type)try{return i=t.value.replace(new RegExp("^[\\s]+|[\\s]+$","g"),""),n.parse(i),i}catch(e){return n.stringify({description:i})}return"{}"}(I),N=C(I),q=N.vars,M=N.helpers||[],L="",F=[],V=i.substr(0,i.lastIndexOf("/")+1);if("{}"!==D)try{A=n.parse(D)}catch(e){console.log("couldn't parse meta for %s",y)}var B,U,$=E(I,A);for(var H in m.hbs=m.hbs||{},m.hbs._partials=m.hbs._partials||{},$)if($.hasOwnProperty(H)&&"string"==typeof $[H]){var Q,G=$[H];if(Q=G.match(/^(\.|\/)+/)?T(V+G):T(x+G),O){if(y===a.toUrl(Q))continue}else if(y===a.toUrl(Q+"."+(m.hbs&&m.hbs.templateExtension?m.hbs.templateExtension:c)))continue;m.hbs._partials[Q]=m.hbs._partials[Q]||[],m.hbs._partials[Q].references=m.hbs._partials[Q].references||[],m.hbs._partials[Q].references.push(G),m.hbs._loadedDeps=m.hbs._loadedDeps||{},F[H]="hbs!"+Q}if(S=F.join("', '"),M=M.concat(A&&A.helpers?A.helpers:[]),(k=_?"":function(){var e,t=[],n=m.hbs&&m.hbs.helperPathCallback?m.hbs.helperPathCallback:function(e){return(m.hbs&&m.hbs.helperDirectory?m.hbs.helperDirectory:h)+e};for(e=0;e<M.length;e++)t[e]="'"+n(M[e],y)+"'";return t}().join(","))&&(k=","+k),A)try{A.styles&&(g=t.union(g,A.styles),require.isBrowser&&!m.isBuild?(j=document.head||document.getElementsByTagName("head")[0],t(A.styles).forEach(function(e){b[e]||((P=document.createElement("link")).href=m.baseUrl+u+e+".css",P.media="all",P.rel="stylesheet",P.type="text/css",j.appendChild(P),b[e]=P)})):m.isBuild&&(B=require.nodeRequire("fs"),U=t(A.styles).map(function(e){return b[e]?"":(b[e]=!0,"@import url("+e+".css);\n")}).join("\n"),B.open(__dirname+d+p,l,"0666",function(e,t){B.writeSync(t,U,null,encoding="utf8"),B.close(t)}),l="a"))}catch(e){console.log("error injecting styles")}m.isBuild||m.serverRender||(L="t.meta = "+D+";\nt.helpers = "+n.stringify(M)+";\nt.deps = "+n.stringify(F)+";\nt.vars = "+n.stringify(q)+";\n");var z=m.hbs||{},W=t.extend(z.compileOptions||{},{originalKeyFallback:z.originalKeyFallback}),Y=function(t,n,i){var a,r;return"data"in(i=i||{})||(i.data=!0),i.compat&&(i.useDepths=!0),a=e.parse(t),r=(new e.Compiler).compile(a,i),(new e.JavaScriptCompiler).compile(r,i)}(s,0,W),J="'hbs!"+i+"',";S&&(S=", '"+S+"'");var K=[];m.hbs._partials[i]&&(K=m.hbs._partials[i].references);var X=m.hbs&&m.hbs.handlebarsPath?m.hbs.handlebarsPath:"hbs/handlebars";for(s="/* START_TEMPLATE */\ndefine("+J+"['"+X+"'"+S+k+"], function( Handlebars ){ \nvar t = Handlebars.template("+Y+");\nHandlebars.registerPartial('"+i+"', t);\n",H=0;H<K.length;H++)s+="Handlebars.registerPartial('"+K[H]+"', t);\n";s+=L+"return t;\n});\n/* END_TEMPLATE */\n",m.isBuild&&(o[w]=s),m.isBuild||(s+="\r\n//# sourceURL="+y),m.isBuild?(r.fromText(i,s),a([i],function(e){r(e)})):a(F,function(){r.fromText(s),a([i],function(e){r(e)})}),m.removeCombined&&y&&v.push(y)})},onLayerEnd:function(){m.removeCombined&&i&&v.forEach(function(e){i.existsSync(e)&&i.unlinkSync(e)})}}}),define("hbs!js/widgets/metrics/templates/metrics_container",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'\n    <div class="s-metrics-metadata">\n      <i class="icon-loading" aria-hidden="true" /> Loading metrics...\n    </div>\n\n'},3:function(e,t,n,i){var a;return'\n    <div class="metrics-metadata s-metrics-metadata">\n      <p>Currently showing metrics for <b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.numFound||(null!=e?e.numFound:e))?a:t.helperMissing)?a.call(e,{name:"numFound",hash:{},data:i}):a)+"</b> records.</p>\n    </div>\n\n"},5:function(e,t,n,i){var a,r;return'  <div style="padding-left:4%">\n    <h4 class="s-list-description">Metrics for</h4>\n    <h2 class="s-article-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h2>\n  </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="metrics-container">\n  <div class="print-only">\n    <div style="font-weight: 300;text-align:center; font-size: medium;">\n      NASA/ADS Metrics Report\n    </div>\n  </div>\n  <div class="print-only" style="text-align:center">'+this.escapeExpression("function"==typeof(r=null!=(r=t.url||(null!=e?e.url:e))?r:t.helperMissing)?r.call(e,{name:"url",hash:{},data:i}):r)+'</div>\n\n  <div class="col-xs-12 s-explore-close-container">\n    <div class="s-large-close close-widget close">x</div>\n'+(null!=(a=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"  </div>\n\n  \x3c!--used by widget when it is on the abstract page--\x3e\n"+(null!=(a=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+'  <div class="s-metrics-section" id="papers">\n    <div class="s-metrics-title">\n      <h3>Papers</h3>\n      <button class="btn btn-link download s-download hidden">\n        <i\n          class="fa fa-download fa-2x"\n          aria-hidden="true"\n          title="download data in csv"\n        ></i>\n        <span class="sr-only">download data in csv</span>\n      </button>\n    </div>\n    <div class="metrics-table s-metrics-table"></div>\n    <div class="metrics-graph s-metrics-graph"></div>\n  </div>\n  <div class="s-metrics-section" id="citations">\n    <div class="s-metrics-title">\n      <h3>Citations</h3>\n      <button class="btn btn-link download s-download hidden">\n        <i\n          class="fa fa-download fa-2x"\n          aria-hidden="true"\n          title="download data in csv"\n        ></i>\n        <span class="sr-only">download data in csv</span>\n      </button>\n    </div>\n    <div class="metrics-table s-metrics-table"></div>\n    <div class="metrics-graph s-metrics-graph"></div>\n  </div>\n  <div class="s-metrics-section" id="reads">\n    <div class="s-metrics-title">\n      <h3>Reads</h3>\n      <button class="btn btn-link download s-download hidden">\n        <i\n          class="fa fa-download fa-2x"\n          aria-hidden="true"\n          title="download data in csv"\n        ></i>\n        <span class="sr-only">download data in csv</span>\n      </button>\n    </div>\n    <div class="metrics-table s-metrics-table"></div>\n    <div class="metrics-graph s-metrics-graph"></div>\n  </div>\n  <div class="s-metrics-section" id="indices">\n    <div class="s-metrics-title">\n      <h3>Indices</h3>\n      <button class="btn btn-link s-download download-indices hidden">\n        <i\n          class="fa fa-download fa-2x"\n          aria-hidden="true"\n          title="download data in csv"\n        ></i>\n        <span class="sr-only">download data in csv</span>\n      </button>\n    </div>\n    <div class="metrics-table s-metrics-table"></div>\n    <div class="metrics-graph s-metrics-graph"></div>\n  </div>\n  <a id="download-link" style="visibility: hidden"></a>\n</div>\n'},useData:!0});return e.registerPartial("js/widgets/metrics/templates/metrics_container",t),t}),define("hbs!js/widgets/metrics/templates/graph_template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'\n<div class="print-hidden">\n  <p>\n    <b>Currently showing a limited subset of data for this view. </b>\n  </p>\n  <p>\n    <button\n      class="btn btn-primary-faded btn-sm show-all"\n      style="max-width: 90%; white-space: normal;"\n    >\n      Click here to load the graph and RIQ and Tori indices.\n      <i>(This may take a few moments.)</i>\n    </button>\n  </p>\n</div>\n\n'},3:function(e,t,n,i){var a;return'<div class="graph-container s-graph-container">\n'+(null!=(a=t.if.call(e,null!=e?e.normalizedGraphData:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")+'  <div>\n    <form action="" class="stacked-form">\n      <label class="custom-radio">\n        stacked\n        <input type="radio" name="bar-arrangement" value="stacked" checked />\n      </label>\n      <label class="custom-radio">\n        grouped\n        <input type="radio" name="bar-arrangement" value="grouped" />\n      </label>\n    </form>\n    <div class="pull-right graph-key"></div>\n    <div class="s-metrics-svg-container" style="padding-bottom: 58%">\n      <svg\n        class="s-metrics-svg"\n        viewbox="0 0 480 250"\n        preserveAspectRatio="xMinYMin meet"\n      ></svg>\n    </div>\n  </div>\n</div>\n\n'},4:function(e,t,n,i){var a;return'  <div\n    class="graph-tab s-graph-tab '+(null!=(a=t.unless.call(e,null!=e?e.normalizedGraphData:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.unless.call(e,null!=e?e.normalized:e,{name:"unless",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+' "\n    data-tab="total"\n  >\n    Total\n  </div>\n  <div\n    class="graph-tab s-graph-tab '+(null!=(a=t.unless.call(e,null!=e?e.normalizedGraphData:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.normalized:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+' "\n    data-tab="normalized"\n  >\n    Normalized\n  </div>\n'},5:function(e,t,n,i){return" no-show "},7:function(e,t,n,i){return"active"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.showingSimple:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:""},useData:!0});return e.registerPartial("js/widgets/metrics/templates/graph_template",t),t}),define("hbs!js/widgets/metrics/templates/paper_table",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<thead>\n  <tr>\n    <th>\n      <span class="sr-only">no value</span>\n    </th>\n    <th>\n      <span class="sr-only">no value</span>\n    </th>\n    <th>\n      Totals\n    </th>\n    <th>\n      Refereed\n    </th>\n  </tr>\n</thead>\n\n<tr>\n  <td>Number of papers</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      aria-hidden="true"\n      data-container="body"\n      title="<b>Number of Papers</b>"\n      data-content="The total number of papers for which metrics were calculated. This may differ from total number of papers requested due to gaps in the metrics database. If you spot a discrepancy please let us know at adshelp@cfa.harvard.edu "\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfPapers:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfPapers:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr>\n  <td>Normalized paper count</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      aria-hidden="true"\n      data-container="body"\n      title="<b>Normalized Paper Count</b>"\n      data-content="For a list of N papers (i=1,...N), where N<sub>auth</sub><sup>i</sup> is the number of authors for publication i, the normalized paper count is the sum over 1/N<sub>auth</sub><sup>i</sup>."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNormalizedPaperCount:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNormalizedPaperCount:e)?a[1]:a,e))+"\n  </td>\n</tr>\n"},useData:!0});return e.registerPartial("js/widgets/metrics/templates/paper_table",t),t}),define("hbs!js/widgets/metrics/templates/citations_table",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<thead>\n  <tr>\n    <th>\n      <span class="sr-only">no value</span>\n    </th>\n    <th>\n      <span class="sr-only">no value</span>\n    </th>\n    <th class="hidden-abstract-page">\n      Totals\n    </th>\n    <th class="hidden-abstract-page">\n      Refereed\n    </th>\n  </tr>\n</thead>\n\n<tr class="hidden-abstract-page">\n  <td>\n    Number of citing papers\n  </td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Number of Citing Papers</b>"\n      data-content="Number of unique papers citing the papers in the submitted list."\n      aria-hidden="true"\n    ></i>\n    &nbsp;\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.numberOfCitingPapers:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.numberOfCitingPapers:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr>\n  <td>Total citations</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Total Citations</b>"\n      data-content="The total number of times all papers in the list were cited."\n      aria-hidden="true"\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalCitations:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalCitations:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr class="hidden-abstract-page">\n  <td>Number of self-citations</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Number of Self-Citations</b>"\n      data-content="The number of citations that were also in the list from which the metrics were computed."\n      aria-hidden="true"\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.numberOfSelfCitations:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.numberOfSelfCitations:e)?a[1]:a,e))+'\n  </td>\n</tr>\n\n<tr class="hidden-abstract-page">\n  <td>Average citations</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Average Citations</b>"\n      data-content="The total number of citations divided by the number of papers."\n      aria-hidden="true"\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageCitations:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageCitations:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr class="hidden-abstract-page">\n  <td>Median citations</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Median Citations</b>"\n      data-content="The median of the citation distribution."\n      aria-hidden="true"\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianCitations:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianCitations:e)?a[1]:a,e))+'\n  </td>\n</tr>\n\n<tr>\n  <td>Normalized citations</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Normalized Citations</b>"\n      aria-hidden="true"\n      data-content="For a list of N papers (i=1,...N), where N<sub>auth</sub><sup>i</sup> is the number of authors for publication i and C<sub>i</sub> the number of citations that this paper received, the normalized citation count for each article is C<sub>i</sub>/N<sub>auth</sub><sup>i</sup> ,and the \'normalized citations\' for this list of N papers is the sum of these N numbers."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.normalizedCitations:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.normalizedCitations:e)?a[1]:a,e))+'\n  </td>\n</tr>\n\n<tr>\n  <td>Refereed citations</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Refereed Citations</b>"\n      aria-hidden="true"\n      data-content="Number of refereed citing papers."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.refereedCitations:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.refereedCitations:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr class="hidden-abstract-page">\n  <td>Average refereed citations</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Average Refereed Citations</b>"\n      aria-hidden="true"\n      data-content="The average number of citations from refereed publications to all/refereed publications in the list."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageRefereedCitations:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageRefereedCitations:e)?a[1]:a,e))+'\n  </td>\n</tr>\n\n<tr class="hidden-abstract-page">\n  <td>Median refereed citations</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Median Refereed Citations</b>"\n      aria-hidden="true"\n      data-content="The average median of citations from refereed publications to all refereed publications in the list."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianRefereedCitations:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianRefereedCitations:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr>\n  <td>Normalized refereed citations</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Normalized Refereed Citations</b>"\n      aria-hidden="true"\n      data-content="The normalized number of citations from refereed publications to all refereed publications in the list."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.normalizedRefereedCitations:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.normalizedRefereedCitations:e)?a[1]:a,e))+"\n  </td>\n</tr>\n"},useData:!0});return e.registerPartial("js/widgets/metrics/templates/citations_table",t),t}),define("hbs!js/widgets/metrics/templates/indices_table",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<thead>\n  <tr>\n    <th>\n      <span class="sr-only">no value</span>\n    </th>\n    <th>\n      <span class="sr-only">no value</span>\n    </th>\n    <th>\n      Totals\n    </th>\n    <th>\n      Refereed\n    </th>\n  </tr>\n</thead>\n\n<tr>\n  <td>\n    h-index\n  </td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      aria-hidden="true"\n      title="<b>h-index</b>"\n      data-content="The H-index is the largest number H such that H publications have at least H citations."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.hIndex:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.hIndex:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr>\n  <td>m-index</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      aria-hidden="true"\n      title="<b>m-index</b>"\n      data-content="The m-index is defined as the h-index divided by number of years since the first published paper of the scientist (also called m-quotient)."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.mIndex:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.mIndex:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr>\n  <td>g-index</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      aria-hidden="true"\n      data-container="body"\n      title="<b>g-index</b>"\n      data-content="Given a set of articles ranked in decreasing order of the number of citations that they received, the g-index is the (unique) largest number such that the top g articles received (together) at least g<sup>2</sup> citations."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.gIndex:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.gIndex:e)?a[1]:a,e))+'\n  </td>\n</tr>\n\n<tr>\n  <td>i10-index</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      aria-hidden="true"\n      title="<b>i10-index</b>"\n      data-content="The i10-index is the number of publications with at least 10 citations."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.i10Index:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.i10Index:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr>\n  <td>i100-index</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      aria-hidden="true"\n      data-container="body"\n      title="<b>i100-index</b>"\n      data-content="The i100-index is the number of publications with at least 100 citations."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.i100Index:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.i100Index:e)?a[1]:a,e))+'\n  </td>\n</tr>\n\n<tr>\n  <td>tori index</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      aria-hidden="true"\n      data-container="body"\n      title="<b>tori index</b>"\n      data-content="The tori-index is calculated using the reference lists of the citing papers, where self-citations are removed. The contribution of each citing paper is then normalized by the number of remaining references in the citing papers and the number of authors in the cited paper."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.toriIndex:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.toriIndex:e)?a[1]:a,e))+'\n  </td>\n</tr>\n\n<tr>\n  <td>riq index</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>riq index</b>"\n      aria-hidden="true"\n      data-content="The riq-index equals the square root of the tori-index, divided by the time between the first and last publication. A multiplication with 1000 has been applied."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.riqIndex:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.riqIndex:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr>\n  <td>read10-index</td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      aria-hidden="true"\n      title="<b>Read10-index</b>"\n      data-content="Read10 is the current readership rate for all an individual\'s papers published in the most recent ten years, normalized for number of authors."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.read10Index:e)?a[0]:a,e))+"\n  </td>\n  <td>\n    "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.read10Index:e)?a[1]:a,e))+"\n  </td>\n</tr>\n"},useData:!0});return e.registerPartial("js/widgets/metrics/templates/indices_table",t),t}),define("hbs!js/widgets/metrics/templates/reads_table",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<thead>\n  <tr>\n    <th>\n      <span class="sr-only">no value</span>\n    </th>\n    <th>\n      <span class="sr-only">no value</span>\n    </th>\n    <th class="hidden-abstract-page">\n      Totals\n    </th>\n    <th class="hidden-abstract-page">\n      Refereed\n    </th>\n  </tr>\n</thead>\n\n<tr>\n  <td>\n    Total number of reads\n  </td>\n  <td>\n    <i\n      class="icon-help"\n      data-toggle="popover"\n      data-container="body"\n      aria-hidden="true"\n      title="<b>Total Number of Reads</b>"\n      data-content="The total number of times all papers were read. For each paper, a read is counted if an ADS user runs a search in our system and then requests to either view the paper\\\'s full bibliographic record or download the fulltext."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfReads:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfReads:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr class="hidden-abstract-page">\n  <td>Average number of reads</td>\n  <td>\n    <i\n      class="icon-help"\n      aria-hidden="true"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Average Number of Reads</b>"\n      data-content="The total number of reads divided by the number of papers."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageNumberOfReads:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageNumberOfReads:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr class="hidden-abstract-page">\n  <td>Median number of reads</td>\n  <td>\n    <i\n      class="icon-help"\n      aria-hidden="true"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Median Number of Reads</b>"\n      data-content="The median of the reads distribution."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianNumberOfReads:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianNumberOfReads:e)?a[1]:a,e))+'\n  </td>\n</tr>\n\n<tr>\n  <td>Total number of downloads</td>\n  <td>\n    <i\n      class="icon-help"\n      aria-hidden="true"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Total Number of Downloads</b>"\n      data-content="The total number of times full text (article or e-print) was accessed."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfDownloads:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfDownloads:e)?a[1]:a,e))+'\n  </td>\n</tr>\n<tr class="hidden-abstract-page">\n  <td>Average number of downloads</td>\n  <td>\n    <i\n      class="icon-help"\n      aria-hidden="true"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Average Number of Downloads</b>"\n      data-content="The total number of downloads divided by the number of papers."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageNumberOfDownloads:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageNumberOfDownloads:e)?a[1]:a,e))+'\n  </td>\n</tr>\n\n<tr class="hidden-abstract-page">\n  <td>Median number of downloads</td>\n  <td>\n    <i\n      class="icon-help"\n      aria-hidden="true"\n      data-toggle="popover"\n      data-container="body"\n      title="<b>Median Number of Downloads</b>"\n      data-content="The median of the downloads distribution."\n    ></i>\n  </td>\n  <td>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianNumberOfDownloads:e)?a[0]:a,e))+'\n  </td>\n  <td class="hidden-abstract-page">\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianNumberOfDownloads:e)?a[1]:a,e))+"\n  </td>\n</tr>\n"},useData:!0});return e.registerPartial("js/widgets/metrics/templates/reads_table",t),t}),define("js/widgets/metrics/widget",["underscore","marionette","d3","js/widgets/base/base_widget","./extractor_functions","js/components/api_response","js/components/json_response","js/components/api_request","js/components/api_query","js/mixins/dependon","hbs!js/widgets/metrics/templates/metrics_container","hbs!js/widgets/metrics/templates/graph_template","hbs!js/widgets/metrics/templates/paper_table","hbs!js/widgets/metrics/templates/citations_table","hbs!js/widgets/metrics/templates/indices_table","hbs!js/widgets/metrics/templates/reads_table","bootstrap","js/components/api_feedback","js/components/api_targets","./d3-tip"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,m,b,v,y,w){function _(e){if(!e)return e;var t=e.toString();return t.indexOf(".")>-1&&t.split(".")[1]?e.toFixed(1):e}var x=Backbone.Model.extend({defaults:function(){return{title:[],rows:[]}}}),S=t.ItemView.extend({className:"table table-hover s-metrics-table table-condensed",tagName:"table",onRender:function(){this.$('[data-toggle="popover"]').popover({html:!0,trigger:"hover"})}}),E=Backbone.Model.extend({defaults:function(){return{graphData:void 0,normalizedGraphData:void 0,normalized:!1,graphType:"histogram",barArrangement:"stacked",yAxisLabel:"Papers"}}}),k=t.ItemView.extend({className:"graph-view s-graph-view",initialize:function(){this.initial=!0},modelEvents:{"change:normalized":"render"},ui:{svg:"svg"},events:{"click .graph-tab":"updateTabValue"},updateTabValue:function(e){"normalized"===$(e.currentTarget).data("tab")?this.model.set("normalized",!0):this.model.set("normalized",!1)},colors:["#5683e0","#7ab889","#ffb639","#ed5e5b","#ce5cff","#1c459b"],drawHistogram:function(){var t=this.model.get("normalized")?this.model.get("normalizedGraphData"):this.model.get("graphData"),i=t.length,a=n.layout.stack()(t.map(function(e){return e.values})),r=(n.max(a,function(e){return n.max(e,function(e){return e.y})}),n.max(a,function(e){return n.max(e,function(e){return e.y0+e.y})})),s=n.select(this.$("svg")[0]),o=this,l=20,c=50,u=480-c-10,d=250-l-20,h=this.model.get("graphData")[0].values.map(function(e){return e.x}),p=n.scale.ordinal().domain(h).rangeRoundBands([0,u],.08),f=n.scale.linear().domain([0,r]).range([d,0]);this.$("svg").empty();var m=s.append("g").attr("transform","translate("+c+","+l+")").classed("graph-container-g",!0);s.selectAll("[data-legend]").data(e.map(t,"key")).enter().append("g").attr("data-legend",e.identity).attr("data-legend-color",function(e,t){return o.colors[t]}),setTimeout(function(){s.append("g").attr("class","legend").attr("transform","translate(70, 20)").attr("data-style-padding",7).style("font-size","12px").call(n.legend)},500),this.tip||(this.tip=n.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){var n=o.model.get("normalized")?"normalizedGraphData":"graphData",i=0,a=o.model.get(n).map(function(n){var a=n.key,r=e.findWhere(n.values,{x:t.x}).y;return i+=r,"<b>"+a+"</b>:&nbsp;"+r.toFixed(2)});return a.push("<b>Total</b>:&nbsp;".concat(i.toFixed(2))),a.join("<br/>")})),m.call(this.tip),m.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")"),m.append("g").attr("class","y axis").attr("transform","translate(0,0)"),m.append("text").attr("text-anchor","middle").attr("transform","translate(-40,"+d/2+")rotate(-90)").classed("graph-label",!0).text(this.model.get("yAxisLabel")),this.$("input[name=bar-arrangement]").on("change",function(e){"grouped"===this.value?b.transition().duration(500).delay(function(e,t){return 10*t}).attr("x",function(e,t,n){return p(e.x)+p.rangeBand()/i*n}).attr("width",p.rangeBand()/i).transition().attr("y",function(e){return f(e.y)}).attr("height",function(e){return d-f(e.y)}):(f.domain([0,r]),b.transition().duration(500).delay(function(e,t){return 10*t}).attr("y",function(e){return f(e.y0+e.y)}).attr("height",function(e){return f(e.y0)-f(e.y0+e.y)}).transition().attr("x",function(e){return p(e.x)}).attr("width",p.rangeBand()))});var g,b=m.selectAll(".layer").data(a).enter().append("g").attr("class","layer").style("fill",function(e,t){return o.colors[t]}).selectAll("rect").data(function(e){return e}).enter().append("rect").attr("width",p.rangeBand()).attr("x",function(e){return p(e.x)}).on("mouseover",this.tip.show).on("mouseout",this.tip.hide);if(h.length>20){var v=Math.floor(h.length/5);g=h.filter(function(e){return e%v==0})}else g=h.length>8?h.filter(function(e){return e%2==0}):h;var y=n.svg.axis().scale(p).tickSize(0).tickValues(g).tickPadding(6).orient("bottom"),w=r>1?5:0,_=n.svg.axis().scale(f).tickSize(0).ticks(w).tickFormat(function(e){return e>1?n.format("s")(e):n.format(".1n")(e)}).orient("left");m.select(".x.axis").call(y),m.select(".y.axis").transition().call(_),m.selectAll("rect").transition().delay(function(e,t){return 10*t}).attr("y",function(e){return f(e.y0+e.y)}).attr("height",function(e){return f(e.y0)-f(e.y0+e.y)})},drawLineGraph:function(){var t=this;this.$(".stacked-form").remove();var i=n.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return e.key}),a=this.model.get("graphData");if(a){a.forEach(function(e){e.values.forEach(function(e){e.x=parseInt(e.x)})});var r=a[0].values.map(function(e){return e.x}),s=n.select(this.$("svg")[0]),o=20,l=50,c=480-l-80,u=250-o-30;if(g=s.append("g").attr("transform","translate("+l+","+o+")").attr("pointer-events","all"),1!==r.length){var d=n.scale.linear().domain(n.extent(r)).range([0,c]),h=n.scale.linear().range([u,0]);h.domain([0,n.max(e.flatten(a.map(function(e){return e.values.map(function(e){return e.y})})))]);var p,f,m,b,v,y,w,_,x,S,E=n.svg.axis().scale(d).tickSize(0).ticks(5).tickFormat(n.format()).tickPadding(6).orient("bottom"),k=n.svg.axis().scale(h).tickSize(0).ticks(5).tickFormat(function(e){return e>1?n.format("s")(e):n.format(".1n")(e)}).orient("left"),A=n.svg.line().x(function(e){return d(e.x)}).y(function(e){return h(e.y)});g.call(i),g.append("g").attr("class","x axis").attr("transform","translate(0,"+u+")").call(E),g.append("g").attr("class","y axis").call(k),g.selectAll(".index").data(a).enter().append("g").attr("class","index").append("path").attr("class","line").attr("d",function(e){return A(e.values)}).style("stroke",function(e,n){return t.colors[n]}),p=e.reduce(a,function(e,t){return e[t.key]=t.values,e},{}),f=s.append("g").attr("pointer-events","all"),m=f.append("line").attr({"pointer-events":"none",x1:l,x2:l,y1:o,y2:u+o,stroke:"black","stroke-width":"1px"}),b=e.map(p,function(e,t){return{key:t,el:f.append("circle").attr({r:3,"stroke-width":"2px",fill:"none","pointer-events":"none"}),data:e}}),v=g.append("foreignObject").attr({class:"info-box",width:"200px",height:"100px",x:"100"}).style({opacity:.75,"font-size":"0.60em"}),y=e.memoize(function(e){if(e){var t="<table>";for(var n in t+="<tr><td><strong>Year:</strong></td><td>&nbsp;"+e.year+"</td></tr>",e.groups){var i=e.groups[n];t+="<tr>",t+='<td style="color:'+i.color+'"><strong>'+i.key+":</strong></td>",t+="<td>&nbsp;"+i.val.toFixed(5)+"</td>",t+="</tr>"}return t+="</table>"}},function(e){return e.year}),w=e.memoize(function(t){var i=n.bisector(function(e){return e.x}).left,a=[];return e.forEach(b,function(e){var n=e.data,r=i(n,t),s=n[r-1]||0,c=n[r]||n[n.length-1],u=t-s.x<c.x===t?s:c,p=d(u.x)+l,f=h(u.y)+o;a.push({dot:e,data:u,pos:{x:p,y:f}})},0),a}),_=e.memoize(function(t){return e.reduce(t,function(e,t){return e+t.pos.x},0)/t.length},function(e){return e[0].data.x}),x=function(e,n,i){var a=n.dot.el,r=n.data,s=n.pos;a.attr({visibility:null,transform:"translate("+s.x+","+s.y+")",stroke:t.colors[i]}),e.year=r.x,e.groups.push({key:n.dot.key,val:r.y,color:t.colors[i]})},S=e.debounce(function(){v.html(""),m.attr("visibility","hidden"),e.forEach(b,function(e){e.el.attr("visibility","hidden")})},300,{leading:!0}),g.append("rect").attr({x:-10,width:c+20,height:u,visibility:"hidden"}).on("mouseout",S).on("mousemove",function(){var t=n.mouse(this),i=w(d.invert(t[0]).toFixed(0)),a=_(i),r={year:0,groups:[]};e.forEach(i,e.partial(x,r)),v.html(y(r)),m.attr({x1:a,x2:a,visibility:null})}),s.selectAll("[data-legend]").data(e.map(a,"key")).enter().append("g").attr("data-legend",e.identity).attr("data-legend-color",function(e,n){return t.colors[n]}),setTimeout(function(){s.append("g").attr("class","legend").attr("transform","translate(70, 36)").attr("data-style-padding",7).style("font-size","12px").call(n.legend)},500)}else g.append("text").attr("x",10).attr("y",100).text("time period is less than a year, refer to table to the left for values")}},drawGraph:function(){var e=this.model.get("graphType");"histogram"===e?this.drawHistogram():"line"===e&&this.drawLineGraph()},template:d,onRender:function(){var e=this;this.drawGraph(),setTimeout(function(){$("svg",e.el).attr("aria-label",e.model.get("yAxisLabel")+" graph")},0)}}),A=Backbone.Model.extend({defaults:function(){return{widgetName:"Metrics"}}}),C=t.LayoutView.extend({template:u,events:{"click .close-widget":"signalCloseWidget","click .show-all":"signalShowAll","click #papers .download":"signaleDownloadPapers","click #citations .download":"signaleDownloadCitations","click #reads .download":"signaleDownloadReads","click .download-indices":"signaleDownloadIndices"},signaleDownloadPapers:function(){this.trigger("download-papers")},signaleDownloadCitations:function(){this.trigger("download-citations")},signaleDownloadReads:function(){this.trigger("download-reads")},signaleDownloadIndices:function(){this.trigger("download-indices")},signalCloseWidget:function(){$(".d3-tip").remove(),this.trigger("close-widget")},signalShowAll:function(){this.$(".show-all").html('<i class="icon-loading" aria-hidden="true"/>&nbsp;&nbsp;'+this.$(".show-all").html()),this.trigger("show-all")},showDownloadButtons:function(e){this.$(".download").removeClass("hidden"),e.indicesGraphView.model.get("showingSimple")||this.$(".download-indices").removeClass("hidden")},modelEvents:{change:"render"},regions:{papersGraph:"#papers .metrics-graph",papersTable:"#papers .metrics-table",citationsGraph:"#citations .metrics-graph",citationsTable:"#citations .metrics-table",indicesGraph:"#indices .metrics-graph",indicesTable:"#indices .metrics-table",readsGraph:"#reads .metrics-graph",readsTable:"#reads .metrics-table"}}),T=i.extend({viewEvents:{"close-widget":"closeWidget","show-all":"showAll","download-papers":"downloadPapers","download-citations":"downloadCitations","download-reads":"downloadReads","download-indices":"downloadIndices"},initialize:function(e){e=e||{},this.containerModel=new A,this.view=new C({model:this.containerModel}),this.childViews={},t.bindEntityEvents(this,this.view,t.getOption(this,"viewEvents")),this.dataExtractor=a,this.GraphModel=E,this.GraphView=k},defaultQueryArguments:{fl:["bibcode"]},components:{TableModel:x,TableView:S,GraphView:k,GraphModel:E,ContainerView:C},activate:function(t){this.setBeeHive(t),e.bindAll(this,"setCurrentQuery","processMetrics","checkIfSimpleRequired");var n=t.getService("PubSub");n.subscribe(n.INVITING_REQUEST,this.setCurrentQuery),this.activateWidget(),this.attachGeneralHandler(this.onApiFeedback)},onApiFeedback:function(){this.closeWidget();var e=this.getPubSub();e.publish(e.ALERT,new v({code:0,msg:"Sorry Metrics are unavailable at this time, try again later",type:"danger"}))},downloadPapers:function(){var e=this.prepareDownloadData(this.childViews.papersGraphView.model.get("graphData"));this.download(e,"metrics-papers.csv")},downloadCitations:function(){var e=this.prepareDownloadData(this.childViews.citationsGraphView.model.get("graphData"));this.download(e,"metrics-citations.csv")},downloadReads:function(){var e=this.prepareDownloadData(this.childViews.readsGraphView.model.get("graphData"));this.download(e,"metrics-reads.csv")},downloadIndices:function(){var e=this.prepareDownloadData(this.childViews.indicesGraphView.model.get("graphData"),!1);this.download(e,"metrics-indices.csv")},prepareDownloadData:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n="data:text/csv;charset=utf-8,",i=e.length,a=e[0].values.length;n+="Year",e.forEach(function(e){n+=", ".concat(e.key)}),n+=t?", Total\n":"\n";for(var r=0;r<a;r++){n+="".concat(e[0].values[r].x);for(var s=0,o=0;o<i;o++)n+=", ".concat(e[o].values[r].y),s+=e[o].values[r].y;n+=t?", ".concat(s,"\n"):"\n"}return n},download:function(e,t){var n=encodeURI(e),i=document.getElementById("download-link");i.setAttribute("download",t),i.setAttribute("href",n),i.click()},closeWidget:function(){this.reset(),this.componentParams&&this.componentParams.allowRedirect&&this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},showAll:function(){this.getIndicators()},reset:function(){this.childViews={},e.each(this.view.regions,function(e,t){this.view[t].currentView&&this.view[t].currentView.destroy()},this),this.containerModel.clear({silent:!0})},createTableViews:function(e,t){var n=1===t?this.createTableDataForOnePaper(e):this.createTableData(e);this.childViews.papersTableView=new S({template:h,model:new x(n.paperModelData)}),this.childViews.readsTableView=new S({template:m,model:new x(n.readsModelData)}),this.childViews.citationsTableView=new S({model:new x(n.citationsModelData),template:p}),this.childViews.indicesTableView=new S({model:new x(n.indicesModelData),template:f})},createTableData:function(t){var n={},i={refereed:t["basic stats refereed"],total:t["basic stats"]},a={refereed:t["citation stats refereed"],total:t["citation stats"]},r={refereed:t["indicators refereed"],total:t.indicators};return n.paperModelData={totalNumberOfPapers:[i.total["number of papers"],i.refereed["number of papers"]],totalNormalizedPaperCount:[i.total["normalized paper count"],i.refereed["normalized paper count"]]},n.readsModelData={totalNumberOfReads:[i.total["total number of reads"],i.refereed["total number of reads"]],averageNumberOfReads:[i.total["average number of reads"],i.refereed["average number of reads"]],medianNumberOfReads:[i.total["median number of reads"],i.refereed["median number of reads"]],totalNumberOfDownloads:[i.total["total number of downloads"],i.refereed["total number of downloads"]],averageNumberOfDownloads:[i.total["average number of downloads"],i.refereed["average number of downloads"]],medianNumberOfDownloads:[i.total["median number of downloads"],i.total["median number of downloads"]]},n.citationsModelData={numberOfCitingPapers:[a.total["number of citing papers"],a.refereed["number of citing papers"]],totalCitations:[a.total["total number of citations"],a.refereed["total number of citations"]],numberOfSelfCitations:[a.total["number of self-citations"],a.refereed["number of self-citations"]],averageCitations:[a.total["average number of citations"],a.refereed["average number of citations"]],medianCitations:[a.total["median number of citations"],a.refereed["median number of citations"]],normalizedCitations:[a.total["normalized number of citations"],a.refereed["normalized number of citations"]],refereedCitations:[a.total["total number of refereed citations"],a.refereed["total number of refereed citations"]],averageRefereedCitations:[a.total["average number of refereed citations"],a.refereed["average number of refereed citations"]],medianRefereedCitations:[a.total["median number of refereed citations"],a.refereed["median number of refereed citations"]],normalizedRefereedCitations:[a.total["normalized number of refereed citations"],a.refereed["normalized number of refereed citations"]]},n.indicesModelData={hIndex:[r.total.h,r.refereed.h],mIndex:[r.total.m,r.refereed.m],gIndex:[r.total.g,r.refereed.g],i10Index:[r.total.i10,r.refereed.i10],i100Index:[r.total.i100,r.refereed.i100],toriIndex:[r.total.tori,r.refereed.tori],riqIndex:[r.total.riq,r.refereed.riq],read10Index:[r.total.read10,r.refereed.read10]},e.each(n,function(t,n){e.each(t,function(e,n){t[n]=[_(e[0]),_(e[1])]})}),n},createGraphViews:function(e){var t=e.histograms,n=new E;this.childViews.papersGraphView=new k({model:n}),this.childViews.papersGraphView.model.set("graphData",this.dataExtractor.plot_paperhist({norm:!1,paperhist_data:t.publications})),this.childViews.papersGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_paperhist({norm:!0,paperhist_data:t.publications}));var i=new E({yAxisLabel:"Citations"});this.childViews.citationsGraphView=new k({model:i}),this.childViews.citationsGraphView.model.set("graphData",this.dataExtractor.plot_citshist({norm:!1,citshist_data:t.citations})),this.childViews.citationsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_citshist({norm:!0,citshist_data:t.citations}));var a=new E;this.childViews.readsGraphView=new k({model:a}),this.childViews.readsGraphView.model.set("graphData",this.dataExtractor.plot_readshist({norm:!1,readshist_data:t.reads})),this.childViews.readsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_readshist({norm:!0,readshist_data:t.reads}));var r=new E({graphType:"line"});this.childViews.indicesGraphView=new k({model:r}),e["time series"]?this.childViews.indicesGraphView.model.set("graphData",this.dataExtractor.plot_series({series_data:e["time series"]})):this.childViews.indicesGraphView.model.set({showingSimple:!0})},insertViews:function(){this.view.render(),["papers","citations","indices","reads"].forEach(function(e){this.view[e+"Table"].show(this.childViews[e+"TableView"]),this.view[e+"Graph"].show(this.childViews[e+"GraphView"])},this),this.view.showDownloadButtons(this.childViews)},insertViewsForOnePaper:function(e){this.view.render({title:this.containerModel.get("title")}),this.view.$("#indices").hide(),this.view.$("#papers").hide(),this.view.$(".metrics-metadata").hide(),this.hasReads(e)?(this.view.readsTable.show(this.childViews.readsTableView),this.view.readsGraph.show(this.childViews.readsGraphView)):this.view.$(this.view.readsTable.el).html("No reads found for this article."),this.hasCitations(e)?(this.view.citationsTable.show(this.childViews.citationsTableView),this.view.citationsGraph.show(this.childViews.citationsGraphView)):this.view.$(this.view.citationsTable.el).html("No citations found for this article."),this.view.$(".hidden-abstract-page").hide(),this.view.$(".download").removeClass("hidden")},createGraphViewsForOnePaper:function(e){var t=e.histograms,n=new this.GraphModel;this.childViews.citationsGraphView=new this.GraphView({model:n}),this.childViews.citationsGraphView.model.set("graphData",this.dataExtractor.plot_citshist({norm:!1,citshist_data:t.citations})),this.childViews.citationsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_citshist({norm:!0,citshist_data:t.citations}));var i=new this.GraphModel;this.childViews.readsGraphView=new this.GraphView({model:i}),this.childViews.readsGraphView.model.set("graphData",this.dataExtractor.plot_readshist({norm:!1,readshist_data:t.reads})),this.childViews.readsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_readshist({norm:!0,readshist_data:t.reads}))},createTableDataForOnePaper:function(t){var n={},i={refereed:t["basic stats refereed"],total:t["basic stats"]},a={refereed:t["citation stats refereed"],total:t["citation stats"]};return n.readsModelData={totalNumberOfReads:[i.total["total number of reads"],i.refereed["total number of reads"]],averageNumberOfReads:[i.total["average number of reads"],i.refereed["average number of reads"]],medianNumberOfReads:[i.total["median number of reads"],i.refereed["median number of reads"]],totalNumberOfDownloads:[i.total["total number of downloads"],i.refereed["total number of downloads"]],averageNumberOfDownloads:[i.total["average number of downloads"],i.refereed["average number of downloads"]],medianNumberOfDownloads:[i.total["median number of downloads"],i.total["median number of downloads"]]},n.citationsModelData={numberOfCitingPapers:[a.total["number of citing papers"],a.refereed["number of citing papers"]],totalCitations:[a.total["total number of citations"],a.refereed["total number of citations"]],numberOfSelfCitations:[a.total["number of self-citations"],a.refereed["number of self-citations"]],averageCitations:[a.total["average number of citations"],a.refereed["average number of citations"]],medianCitations:[a.total["median number of citations"],a.refereed["median number of citations"]],normalizedCitations:[a.total["normalized number of citations"],a.refereed["normalized number of citations"]],refereedCitations:[a.total["total number of refereed citations"],a.refereed["total number of refereed citations"]],averageRefereedCitations:[a.total["average number of refereed citations"],a.refereed["average number of refereed citations"]],medianRefereedCitations:[a.total["median number of refereed citations"],a.refereed["median number of refereed citations"]],normalizedRefereedCitations:[a.total["normalized number of refereed citations"],a.refereed["normalized number of refereed citations"]]},e.each(n,function(t,n){e.each(t,function(e,n){t[n]=[_(e[0]),_(e[1])]})}),n},hasCitations:function(e){return e["citation stats"]["total number of citations"]>0},hasReads:function(e){return e["basic stats"]["total number of reads"]>0},renderWidgetForCurrentQuery:function(e){e=e||{},this.reset(),this.containerModel.set({url:window.location.href,loading:!0});var t=this.getCurrentQuery()||e.currentQuery;t=this.customizeQuery(t);var n=this,i=[],a=void 0,r=y._limits.Metrics.default;t.set("rows",1e3);var s=function(o){t.set({start:o}),this._executeSearch(t).done(function(t){i=i.concat(t.get("response.docs").map(function(e){return e.bibcode})),a=a||t.get("response").numFound,(o+=1e3)>=a||o>=r?(a>r&&void 0===e.simple&&(e.simple=!0),n.containerModel.set({numFound:a>r?r:a,bibcodes:i}),n.getMetrics(i,e)):s(o)})}.bind(this);s(0)},checkIfSimpleRequired:function(){if(!this._currentQuery)return(new $.Deferred).resolve(!1);var e=this._currentQuery.clone();return e.unlock(),e.set({stats:"true","stats.field":"citation_count",fl:"id"}),this._executeSearch(e).then(function(e){return e.get("stats.stats_fields.citation_count.sum")>5e4})},getIndicators:function(){var t=this.getPubSub(),n=new l({bibcodes:this.containerModel.get("bibcodes"),types:["indicators","timeseries"]}),i=new o({target:y.SERVICE_METRICS,query:n,options:{type:"POST",contentType:"application/json"}});function a(t){var n=t.toJSON();this.childViews.indicesGraphView.model.set({graphData:this.dataExtractor.plot_series({series_data:n["time series"]}),showingSimple:!1});var i={refereed:n["indicators refereed"],total:n.indicators},a={hIndex:[i.total.h,i.refereed.h],mIndex:[i.total.m,i.refereed.m],gIndex:[i.total.g,i.refereed.g],i10Index:[i.total.i10,i.refereed.i10],i100Index:[i.total.i100,i.refereed.i100],toriIndex:[i.total.tori,i.refereed.tori],riqIndex:[i.total.riq,i.refereed.riq],read10Index:[i.total.read10,i.refereed.read10]};e.each(a,function(e,t){a[t]=[_(e[0]),_(e[1])]}),this.childViews.indicesTableView.model.set(a),this.childViews.indicesTableView.render(),this.childViews.indicesGraphView.render(),this.view.$(".download-indices").removeClass("hidden")}a=a.bind(this),t.subscribeOnce(t.DELIVERING_RESPONSE,a),t.publish(t.EXECUTE_REQUEST,i)},getMetrics:function(e,t){t=t||{};var n=$.Deferred();function i(t){var i=this.getPubSub(),a=new l({bibcodes:e});t&&a.set({types:["simple"]});var r=new o({target:y.SERVICE_METRICS,query:a,options:{type:"POST",contentType:"application/json"}});function s(){try{this.processMetrics.apply(this,arguments),n.resolve()}catch(e){n.reject()}}s=s.bind(this),i.subscribeOnce(i.DELIVERING_RESPONSE,s),i.publish(i.EXECUTE_REQUEST,r)}return i=i.bind(this),void 0!==t.simple?i(t.simple):this.checkIfSimpleRequired().done(i),n.promise()},processMetrics:function(e){if(this.containerModel.set("loading",!1),(e=e.attributes?e.attributes:e).Error||500===e.status)throw this.closeWidget(),new Error("Metrics Service Error");1===e["basic stats"]["number of papers"]?(this.createTableViews(e,1),this.createGraphViewsForOnePaper(e),this.insertViewsForOnePaper(e)):(this.createTableViews(e),this.createGraphViews(e),this.insertViews(e))},_executeSearch:function(t){var n=this.getPubSub(),i=new o({target:y.SEARCH,query:t}),a=$.Deferred();return n.subscribeOnce(n.DELIVERING_RESPONSE,e.bind(function(e){a.resolve(e)}),this),n.publish(n.EXECUTE_REQUEST,i),a},renderWidgetForListOfBibcodes:function(e){this.reset(),this.containerModel.set({numFound:e.length,loading:!0}),this.getMetrics(e,{simple:!1})}});return e.extend(T.prototype,c.BeeHive),T}),define("hbs!js/widgets/list_of_things/templates/item-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return" chosen "},3:function(e,t,n,i){var a,r;return'            <label class="custom-checkbox">\n                <input type="checkbox" value='+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+' name="identifier" '+(null!=(a=t.if.call(e,null!=e?e.chosen:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")+' aria-label="select item '+this.escapeExpression("function"==typeof(r=null!=(r=t.indexToShow||(null!=e?e.indexToShow:e))?r:t.helperMissing)?r.call(e,{name:"indexToShow",hash:{},data:i}):r)+'">\n            </label>\n'},4:function(e,t,n,i){return" checked "},6:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.normCiteSort:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.program(9,i,0),data:i}))?a:""},7:function(e,t,n,i){var a;return'              <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?a:t.helperMissing)?a.call(e,{name:"encodedIdentifier",hash:{},data:i}):a)+'/citations" title="citation count" class="citations-redirect-link" aria-label="'+this.escapeExpression("function"==typeof(a=null!=(a=t.citationCountNorm||(null!=e?e.citationCountNorm:e))?a:t.helperMissing)?a.call(e,{name:"citationCountNorm",hash:{},data:i}):a)+' normalized citations">cited (n): '+this.escapeExpression("function"==typeof(a=null!=(a=t.citationCountNorm||(null!=e?e.citationCountNorm:e))?a:t.helperMissing)?a.call(e,{name:"citationCountNorm",hash:{},data:i}):a)+"</a>\n"},9:function(e,t,n,i){var a;return'              <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?a:t.helperMissing)?a.call(e,{name:"encodedIdentifier",hash:{},data:i}):a)+'/citations" title="citation count" class="citations-redirect-link" aria-label="'+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+' citations">cited: '+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+"</a>\n"},11:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.normCiteSort:e,{name:"if",hash:{},fn:this.program(12,i,0),inverse:this.program(14,i,0),data:i}))?a:""},12:function(e,t,n,i){var a;return'              <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?a:t.helperMissing)?a.call(e,{name:"encodedIdentifier",hash:{},data:i}):a)+'/citations" title="citation count" class="citations-redirect-link" aria-label="'+this.escapeExpression("function"==typeof(a=null!=(a=t.citationCountNorm||(null!=e?e.citationCountNorm:e))?a:t.helperMissing)?a.call(e,{name:"citationCountNorm",hash:{},data:i}):a)+' normalized citations">'+this.escapeExpression("function"==typeof(a=null!=(a=t.citationCountNorm||(null!=e?e.citationCountNorm:e))?a:t.helperMissing)?a.call(e,{name:"citationCountNorm",hash:{},data:i}):a)+"</a>\n"},14:function(e,t,n,i){var a;return'              <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?a:t.helperMissing)?a.call(e,{name:"encodedIdentifier",hash:{},data:i}):a)+'/citations" title="citation count" class="citations-redirect-link" aria-label="'+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+' citations">'+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+"</a>\n"},16:function(e,t,n,i){var a;return'\n                <div class="letter-icon s-letter-icon">\n\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.text:a,{name:"if",hash:{},fn:this.program(17,i,0),inverse:this.program(21,i,0),data:i}))?a:"")+'\n            </div>\n\n            <div class="letter-icon s-letter-icon">\n\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.list:a,{name:"if",hash:{},fn:this.program(23,i,0),inverse:this.program(26,i,0),data:i}))?a:"")+'\n            </div>\n            <div class="letter-icon s-letter-icon">\n\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.data:a,{name:"if",hash:{},fn:this.program(28,i,0),inverse:this.program(31,i,0),data:i}))?a:"")+"\n            </div>\n"},17:function(e,t,n,i){var a;return'\n                        <a class="btn-link active-link s-active-link" aria-disabled="false">\n                            <i class="s-text-icon" aria-hidden="true"></i>\n                            <span class="sr-only">quick access to full text links</span>\n                        </a>\n                        <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.links:e)?a.text:a,{name:"each",hash:{},fn:this.program(18,i,0),inverse:this.noop,data:i}))?a:"")+"                        </ul>\n\n"},18:function(e,t,n,i){var a;return"                            <li><a "+(null!=(a=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(19,i,0),inverse:this.noop,data:i}))?a:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'"\n                                target="_blank" rel="noreferrer noopener" aria-label="open access link">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},19:function(e,t,n,i){return' class="s-open-access"'},21:function(e,t,n,i){return'\n                    <div title="full text links (none)">\n                        <a href="javascript:void(0)" class="btn-link disabled" aria-disabled="true" aria-label="full text links">\n                            <i class="s-text-icon" aria-hidden="true"></i>\n                        </a>\n                    </div>\n\n'},23:function(e,t,n,i){var a;return'\n                <a class="btn-link active-link s-active-link" aria-disabled="false">\n                    <i class="s-list-icon" aria-hidden="true"></i>\n                    <span class="sr-only">quick links to lists of references, citations and more</span>\n                </a>\n\n                <ul class="hidden list-unstyled list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.links:e)?a.list:a,{name:"each",hash:{},fn:this.program(24,i,0),inverse:this.noop,data:i}))?a:"")+"                </ul>\n\n"},24:function(e,t,n,i){return'                    <li><a href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},26:function(e,t,n,i){return'                <div title="references, citations (none)">\n                    <a href="javascript:void(0)" class="btn-link disabled" aria-disabled="true">\n                        <i class="s-list-icon" aria-hidden="true"></i>\n                        <span class="sr-only">quick links to lists of references, citations etc</span>\n                    </a>\n                </div>\n\n\n'},28:function(e,t,n,i){var a;return'\n                <a class="btn-link active-link s-active-link" aria-disabled="false">\n                    <i class="s-data-icon" aria-hidden="true"></i>\n                    <span class="sr-only">quick links to data associated with this article</span>\n                </a>\n\n                <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.links:e)?a.data:a,{name:"each",hash:{},fn:this.program(29,i,0),inverse:this.noop,data:i}))?a:"")+"                </ul>\n\n"},29:function(e,t,n,i){var a;return"                    <li><a "+(null!=(a=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(19,i,0),inverse:this.noop,data:i}))?a:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'" target="_blank" rel="noreferrer noopener"\n                        >'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},31:function(e,t,n,i){return'                    <div title="data products (none)">\n                        <a href="javascript:void(0)" class="btn-link disabled" aria-disabled="true">\n                            <i class="s-data-icon" aria-hidden="true"></i>\n                            <span class="sr-only">quick links to data associated with this article</span>\n                        </a>\n                    </div>\n\n'},33:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.encodedIdentifier:e,{name:"if",hash:{},fn:this.program(34,i,0),inverse:this.program(36,i,0),data:i}))?a:""},34:function(e,t,n,i){var a,r;return'                <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/abstract" class="abs-redirect-link">\n                    <h3 class="s-results-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h3>\n                </a>\n"},36:function(e,t,n,i){var a,r;return'                <h3 class="s-results-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h3>\n"},38:function(e,t,n,i){var a,r;return'            <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/abstract" class="abs-redirect-link">\n                <h3 class="s-results-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h3>\n            </a>\n"},40:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.authorFormatted:e,{name:"if",hash:{},fn:this.program(41,i,0),inverse:this.program(46,i,0),data:i}))?a:""},41:function(e,t,n,i){var a;return'            <ul class="list-inline just-authors s-results-authors less-authors" aria-label="authors">\n'+(null!=(a=t.each.call(e,null!=e?e.authorFormatted:e,{name:"each",hash:{},fn:this.program(42,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.extraAuthors:e,{name:"if",hash:{},fn:this.program(44,i,0),inverse:this.noop,data:i}))?a:"")+'            </ul>\n\n            <ul class="list-inline just-authors s-results-authors all-authors hidden" aria-label="authors">\n'+(null!=(a=t.each.call(e,null!=e?e.allAuthorFormatted:e,{name:"each",hash:{},fn:this.program(42,i,0),inverse:this.noop,data:i}))?a:"")+'                <li>\n                    <a href="javascript:void(0)" class="show-less-authors">\n                        <em>show less</em>\n                    </a>\n                </li>\n            </ul>\n'},42:function(e,t,n,i){return'                    <li class="article-author">'+this.escapeExpression(this.lambda(e,e))+"</li>\n"},44:function(e,t,n,i){var a;return'                <li>\n                    <a href="javascript:void(0)" class="show-all-authors">\n                        <em>and '+this.escapeExpression("function"==typeof(a=null!=(a=t.extraAuthors||(null!=e?e.extraAuthors:e))?a:t.helperMissing)?a.call(e,{name:"extraAuthors",hash:{},data:i}):a)+" more</em>\n                    </a>\n                </li>\n"},46:function(e,t,n,i){return'                <span class="text-faded">no author information available</span>\n'},48:function(e,t,n,i){var a;return'<div class="row">\n    <div class="col-sm-10 col-sm-offset-1">\n        <div class="s-results-orcid-container">\n\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.pending:a,{name:"if",hash:{},fn:this.program(49,i,0),inverse:this.program(51,i,0),data:i}))?a:"")+" \x3c!--orcid.pending--\x3e\n    </div>\n\n</div>\n"},49:function(e,t,n,i){return'            <button class="btn btn-default btn-sm s-orcid-loading" aria-disabled="true">\n                <i class="fa fa-lg fa-spinner fa-pulse" aria-hidden="true"></i> Working...\n            </button>\n'},51:function(e,t,n,i){var a;return"            \x3c!-- if provenance, it has been added by us or someone else--\x3e\n"+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.provenance:a,{name:"if",hash:{},fn:this.program(52,i,0),inverse:this.program(66,i,0),data:i}))?a:"")+"\x3c!--orcid.provenance --\x3e\n            "},52:function(e,t,n,i){var a;return'\n            <div class="'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.error:a,{name:"if",hash:{},fn:this.program(53,i,0),inverse:this.program(55,i,0),data:i}))?a:"")+" s-orcid-alert s-orcid-provenance-"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.orcid:e)?a.provenance:a,e))+'" role="alert">\n                <div class="btn-group">\n                    <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown"\n                            aria-expanded="false" '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.error:a,{name:"if",hash:{},fn:this.program(57,i,0),inverse:this.noop,data:i}))?a:"")+'>\n                        <img src="../../styles/img/orcid-active.svg" alt="orcid logo active" class="s-orcid-img"/> Actions <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.orcid:e)?a.actions:a,{name:"each",hash:{},fn:this.program(59,i,0),inverse:this.noop,data:i}))?a:"")+"                        </li>\n                    </ul>\n                </div>\n\n                "+(null!=(a=t.if.call(e,null!=e?e.source_name:e,{name:"if",hash:{},fn:this.program(64,i,0),inverse:this.noop,data:i}))?a:"")+'\n                <span class="text-success s-orcid-success pull-right"> <i class="icon-success" aria-hidden="true"></i>&nbsp;In ORCID&nbsp;</span>\n\n            </div>\n\n\n\n            '},53:function(e,t,n,i){return"alert-danger"},55:function(e,t,n,i){return"alert-success"},57:function(e,t,n,i){var a;return'title="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.orcid:e)?a.error:a,e))+'"'},59:function(e,t,n,i){var a;return'                        <li>\n\n                            <a class="orcid-action '+this.escapeExpression(this.lambda(null!=e?e.action:e,e))+'" data-action="'+this.escapeExpression(this.lambda(null!=e?e.action:e,e))+'"\n                               title="'+this.escapeExpression(this.lambda(null!=e?e.caption:e,e))+'">\n                                <i class="\n'+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.action:e,"orcid-update",{name:"compare",hash:{},fn:this.program(60,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.action:e,"orcid-delete",{name:"compare",hash:{},fn:this.program(62,i,0),inverse:this.noop,data:i}))?a:"")+'                            " aria-hidden="true"></i>\n                                '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</a>\n"},60:function(e,t,n,i){return"                            icon-reload-c\n"},62:function(e,t,n,i){return"                            icon-clear-c\n"},64:function(e,t,n,i){var a;return'<span class="s-orcid-source">('+this.escapeExpression("function"==typeof(a=null!=(a=t.source_name||(null!=e?e.source_name:e))?a:t.helperMissing)?a.call(e,{name:"source_name",hash:{},data:i}):a)+")</span>"},66:function(e,t,n,i){var a;return"\x3c!-- add this paper to ORCID--\x3e\n\n"+(null!=(a=t.if.call(e,null!=e?e.bibcode:e,{name:"if",hash:{},fn:this.program(67,i,0),inverse:this.program(72,i,0),data:i}))?a:"")+"\n\n            "},67:function(e,t,n,i){var a;return'            <button class="btn '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.error:a,{name:"if",hash:{},fn:this.program(68,i,0),inverse:this.program(70,i,0),data:i}))?a:"")+" btn-sm orcid-action "+this.escapeExpression(this.lambda(null!=(a=null!=(a=null!=(a=null!=e?e.orcid:e)?a.actions:a)?a.add:a)?a.action:a,e))+'"  data-action="'+this.escapeExpression(this.lambda(null!=(a=null!=(a=null!=(a=null!=e?e.orcid:e)?a.actions:a)?a.add:a)?a.action:a,e))+'" '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.error:a,{name:"if",hash:{},fn:this.program(57,i,0),inverse:this.noop,data:i}))?a:"")+'>\n               <img src="../../styles/img/orcid-inactive.svg" alt="orcid logo inactive" class="s-orcid-img" title="'+this.escapeExpression(this.lambda(null!=(a=null!=(a=null!=(a=null!=e?e.orcid:e)?a.actions:a)?a.add:a)?a.caption:a,e))+'"/>\n                Claim in ORCID\n            </button>\n'},68:function(e,t,n,i){return"btn-danger"},70:function(e,t,n,i){return"btn-default"},72:function(e,t,n,i){return'            <div class="panel panel-default" style="box-shadow: none">\n                <div class="panel-body">\n                    <img src="../../styles/img/orcid-inactive.svg" alt="orcid logo inactive" class="s-orcid-img" title=""/>\n                    Record not known to ADS\n                </div>\n            </div>\n'},74:function(e,t,n,i){var a;return'\n        <div class="col-xs-10 col-xs-offset-1 s-more-info">\n'+(null!=(a=t.if.call(e,(t.isdefined||e&&e.isdefined||t.helperMissing).call(e,null!=e?e.highlights:e,{name:"isdefined",hash:{},data:i}),{name:"if",hash:{},fn:this.program(75,i,0),inverse:this.program(81,i,0),data:i}))?a:"")+"        </div>\n"},75:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=(a=null!=e?e.highlights:e)?a.length:a,{name:"if",hash:{},fn:this.program(76,i,0),inverse:this.program(79,i,0),data:i}))?a:""},76:function(e,t,n,i){var a;return'            <h4 class="sr-only">Search Highlights</h4>\n            <ul aria-label="search snippets" class="s-search-snippets">\n'+(null!=(a=t.each.call(e,null!=e?e.highlights:e,{name:"each",hash:{},fn:this.program(77,i,0),inverse:this.noop,data:i}))?a:"")+"            </ul>\n\n"},77:function(e,t,n,i){var a;return"                <li>"+(null!=(a=this.lambda(e,e))?a:"")+"</li>\n"},79:function(e,t,n,i){return'                <span class="text-muted">No highlights</span>\n'},81:function(e,t,n,i){return'            <span class="text-muted"><i class="fa fa-spinner fa-pulse" aria-hidden="true"></i> Loading Highlights...</span>\n'},83:function(e,t,n,i){var a;return'        <div class="col-xs-9 col-xs-offset-1 s-more-info">\n'+(null!=(a=t.if.call(e,null!=e?e.abstract:e,{name:"if",hash:{},fn:this.program(84,i,0),inverse:this.noop,data:i}))?a:"")+"        </div>\n"},84:function(e,t,n,i){var a,r;return'                    <h4 aria-label="read full abstract below"><a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+'">Abstract</a></h4>\n'+(null!=(a=t.if.call(e,null!=e?e.shortAbstract:e,{name:"if",hash:{},fn:this.program(85,i,0),inverse:this.program(87,i,0),data:i}))?a:"")},85:function(e,t,n,i){var a,r;return'\n                    <div class="short-abstract" aria-label="a truncated version of the abstract">\n                        '+(null!=(a="function"==typeof(r=null!=(r=t.shortAbstract||(null!=e?e.shortAbstract:e))?r:t.helperMissing)?r.call(e,{name:"shortAbstract",hash:{},data:i}):r)?a:"")+'\n                        &nbsp; <button class="btn btn-xs btn-default show-full-abstract">more</button>\n                    </div>\n                    <div class="full-abstract hidden">\n                        '+(null!=(a="function"==typeof(r=null!=(r=t.abstract||(null!=e?e.abstract:e))?r:t.helperMissing)?r.call(e,{name:"abstract",hash:{},data:i}):r)?a:"")+'\n                        &nbsp; <button class="btn btn-xs btn-default hide-full-abstract">less</button>\n                    </div>\n'},87:function(e,t,n,i){var a,r;return"                        \x3c!--the abstract is short enough to be shown all at once--\x3e\n                        "+(null!=(a="function"==typeof(r=null!=(r=t.abstract||(null!=e?e.abstract:e))?r:t.helperMissing)?r.call(e,{name:"abstract",hash:{},data:i}):r)?a:"")+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div tabindex="-1" class="col-sm-12 '+(null!=(a=t.if.call(e,null!=e?e.chosen:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'">\n<div class="row s-top-row">\n    <div class="col-xs-1 s-checkbox-col s-top-row-col">\n        <label>\n            <span class="hidden-xs">'+this.escapeExpression("function"==typeof(r=null!=(r=t.indexToShow||(null!=e?e.indexToShow:e))?r:t.helperMissing)?r.call(e,{name:"indexToShow",hash:{},data:i}):r)+"</span>\n"+(null!=(a=t.if.call(e,null!=e?e.showCheckbox:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'        </label>\n    </div>\n\n    <div class="col-xs-4 col-sm-3 s-top-row-col identifier s-identifier">\n        <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/abstract" aria-label="bibcode" class="abs-redirect-link">\n            '+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+'\n        </a>\n    </div>\n    <div class="hidden-xs col-xs-1 col-md-1 col-md-offset-0 s-top-row-col print-visible-inline-1" aria-label="date published">\n        '+this.escapeExpression("function"==typeof(r=null!=(r=t.formattedDate||(null!=e?e.formattedDate:e))?r:t.helperMissing)?r.call(e,{name:"formattedDate",hash:{},data:i}):r)+'\n    </div>\n\n    <div class="hidden-xs print-visible-block-1">\n      <div class="col-xs-3 col-sm-5 col-md-3 s-top-row-col">\n'+(null!=(a=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:"")+'      </div>\n    </div>\n\n    <div class="hidden-sm hidden-md hidden-lg print-hidden">\n      <div class="col-xs-2 col-sm-5 col-md-3 s-top-row-col text-right">\n'+(null!=(a=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'      </div>\n    </div>\n\n\n\n    <div class="col-xs-5 col-sm-4 pull-right">\n        <div class="s-results-links">\n\n'+(null!=(a=t.if.call(e,null!=e?e.links:e,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.noop,data:i}))?a:"")+'      </div>\n    </div>\n\n</div>\n<div class="row">\n\n    <div class="col-xs-10 col-xs-offset-1">\n'+(null!=(a=t.if.call(e,null!=e?e.isOrcidWidget:e,{name:"if",hash:{},fn:this.program(33,i,0),inverse:this.program(38,i,0),data:i}))?a:"")+'    </div>\n</div>\n\n<div class="row">\n    <div class="col-xs-10 col-xs-offset-1">\n\n'+(null!=(a=t.unless.call(e,null!=e?e.isOrcidWidget:e,{name:"unless",hash:{},fn:this.program(40,i,0),inverse:this.noop,data:i}))?a:"")+"\n\n    </div>\n\n</div>\n\n"+(null!=(a=t.if.call(e,null!=e?e.orcid:e,{name:"if",hash:{},fn:this.program(48,i,0),inverse:this.noop,data:i}))?a:"")+'\n    <div class="row highlight-row">\n'+(null!=(a=t.if.call(e,null!=e?e.showHighlights:e,{name:"if",hash:{},fn:this.program(74,i,0),inverse:this.noop,data:i}))?a:"")+'    </div>\n\n    <div class="row abstract-row">\n'+(null!=(a=t.if.call(e,null!=e?e.showAbstract:e,{name:"if",hash:{},fn:this.program(83,i,0),inverse:this.noop,data:i}))?a:"")+"    </div>\n</div>\n"},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/item-template",t),t}),define("hbs!js/widgets/list_of_things/templates/pagination-partial",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'            <i class="icon-loading" aria-hidden="true"></i>&nbsp;Loading more papers...\n'},3:function(e,t,n,i){var a;return null!=(a=t.unless.call(e,null!=e?e.error:e,{name:"unless",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:""},4:function(e,t,n,i){var a;return'<div class="row" style="margin: 0; position: relative">\n'+(null!=(a=t.if.call(e,null!=e?e.pageData:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+'    <button class="btn btn-link" id="backToTopBtn">Top <i class="fa fa-caret-up" aria-hidden="true"></i></button>\n</div>\n'},5:function(e,t,n,i){var a;return'    <div class="col-sm-12 pagination-controls s-pagination-controls">\n        <div class="col-xs-5 per-page-container">\n'+(null!=(a=t.if.call(e,null!=e?e.pageData:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:"")+'        </div>\n        <div class="col-xs-7 pagination-container">\n            <nav aria-label="pagination controls">\n                <ul class="pager">\n                    <li class="'+(null!=(a=t.unless.call(e,null!=(a=null!=e?e.pageData:e)?a.previousPossible:a,{name:"unless",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+'"><a href="javascript:void(0)" class="page-control previous-page"><i class="fa fa-chevron-circle-left" aria-hidden="true"></i> prev</a></li>\n                    <li><input type="text" value="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.pageData:e)?a.currentPage:a,e))+'" class="form-control page-control" style="display:inline-block;width:60px" aria-label="set the current page" aria-hidden="true"> of '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.pageData:e)?a.totalPages:a,e))+'</li>\n                    <li class="'+(null!=(a=t.unless.call(e,null!=(a=null!=e?e.pageData:e)?a.nextPossible:a,{name:"unless",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+'"><a href="javascript:void(0)" class="page-control next-page">next <i class="fa fa-chevron-circle-right" aria-hidden="true"></i></a></li>\n                </ul>\n            </nav>\n\n        </div>\n    </div>\n'},6:function(e,t,n,i){var a;return'            <div class="form-group">\n              <label for="per-page-select" class="col-xs-6 control-label" style="line-height: 32px; text-align: right;">Per Page</label>\n              <div class="col-xs-6 col-sm-5">\n                <select name="per-page-select" id="per-page-select" class="form-control">\n                  <option value="25" '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.pageData:e)?a.perPage:a,25,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'>25</option>\n                  <option value="50" '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.pageData:e)?a.perPage:a,50,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'>50</option>\n                  <option value="100" '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.pageData:e)?a.perPage:a,100,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'>100</option>\n                  <option value="200" '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.pageData:e)?a.perPage:a,200,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'>200</option>\n                  <option value="500" '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.pageData:e)?a.perPage:a,500,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+">500</option>\n                </select>\n              </div>\n            </div>\n"},7:function(e,t,n,i){return"selected"},9:function(e,t,n,i){return" disabled "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="row">\n    <div class="col-sm-12 page-loading" style="text-align:center">\n'+(null!=(a=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"    </div>\n</div>\n"+(null!=(a=t.unless.call(e,null!=e?e.query:e,{name:"unless",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/pagination-partial",t),e.registerPartial("js/widgets/list_of_things/templates/pagination-partial",t),t}),define("hbs!js/widgets/list_of_things/templates/results-container-template",["hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e){var t=e.template({1:function(e,t,n,i){var a;return'    <div>\n      <h4 class="s-list-description">'+this.escapeExpression("function"==typeof(a=null!=(a=t.description||(null!=e?e.description:e))?a:t.helperMissing)?a.call(e,{name:"description",hash:{},data:i}):a)+"</h4>\n    </div>\n    "},3:function(e,t,n,i){var a,r;return'\n    <div>\n      <h2 class="s-article-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h2>\n    </div>\n"},5:function(e,t,n,i){var a;return" "+(null!=(a=t.if.call(e,null!=e?e.citation_discrepancy:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:"")+" "},6:function(e,t,n,i){var a;return'\n    <div>\n      <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>\n      This list is missing <b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_discrepancy||(null!=e?e.citation_discrepancy:e))?a:t.helperMissing)?a.call(e,{name:"citation_discrepancy",hash:{},data:i}):a)+"</b> records, which could\n      not be matched to papers in ADS.\n    </div>\n    <br />\n    "},8:function(e,t,n,i){var a;return'\n    <div class="s-operator print-hidden">\n      <a href="'+this.escapeExpression("function"==typeof(a=null!=(a=t.queryURL||(null!=e?e.queryURL:e))?a:t.helperMissing)?a.call(e,{name:"queryURL",hash:{},data:i}):a)+'" class="btn btn-sm btn-inverse btn-primary-faded"\n        ><i class="fa fa-search" aria-hidden="true"></i> view this list in a\n        search results page</a\n      >\n    </div>\n'},10:function(e,t,n,i){var a;return" "+(null!=(a=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,helpers:t,partials:n}))?a:"")+" "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="s-list-controls">\n  <div class="s-results-border-bottom">\n    <div class="col-sm-1"></div>\n\n    <div class="col-sm-6"></div>\n\n    <div class="col-sm-4 sort-container"></div>\n\n    <div class="col-sm-1"></div>\n  </div>\n\n  <div class="s-list-title">\n'+(null!=(a=t.if.call(e,null!=e?e.description:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"\n    \x3c!--citation widget should show info if [citations] and citation_count don't match--\x3e\n    "+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.queryOperator:e,"citations",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.queryOperator:e,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?a:"")+'  </div>\n\n  <ul\n    class="results-list  s-results-list list-unstyled s-display-block"\n    aria-label="list of results"\n  ></ul>\n\n  '+(null!=(a=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"\n</div>\n"},usePartial:!0,useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/results-container-template",t),t}),define("js/mixins/add_stable_index_to_collection",["underscore"],function(e){return{getPageStart:function(e,t,n){return n?Math.min(e*t,n):e*t},getPageEnd:function(e,t,n){var i=this.getPageStart(e,t)+t;return i>n?n:i},getPageVal:function(e,t){return Math.floor(e/t)},addPaginationToDocs:function(t,n){var i=e.isArray(n)?n[0]:parseInt(n);return e.each(t,function(e){e.resultsIndex=i,e.indexToShow=i+1,i+=1}),t}}}),define("js/widgets/list_of_things/model",["backbone","underscore","bowser","js/mixins/add_stable_index_to_collection"],function(e,t,n,i){var a=e.Model.extend({defaults:function(){return{abstract:void 0,title:void 0,authorAff:void 0,pub:void 0,pubdate:void 0,keywords:void 0,bibcode:void 0,pub_raw:void 0,doi:void 0,details:void 0,links_data:void 0,resultsIndex:void 0,visible:!1,actionsVisible:!0,showCheckbox:!0,isMobileOrTablet:!1}},idAttribute:"resultsIndex"}),r=e.Collection.extend({initialize:function(e,t){this.numVisible=0,this.currentStartIndex=0,this.currentEndIndex=0,this.lastIndex=-1,this.lastMissingTrigger=null,t&&t.paginationModel&&(this.paginationModel=t.paginationModel,this.listenTo(this.paginationModel,"change:page",this._onPaginationChange),this.listenTo(this.paginationModel,"change:perPage",this._onPaginationChange))},model:a,numFound:void 0,comparator:"resultsIndex",_updateStartAndEndIndex:function(){var e=this.paginationModel.get("page"),t=this.paginationModel.get("perPage"),n=this.paginationModel.get("numFound");this.currentStartIndex=this.getPageStart(e,t),this.currentEndIndex=this.getPageEnd(e,t,n)},_onPaginationChange:function(){this._updateStartAndEndIndex(),this.trigger("pagination:change")},reset:function(){this.lastMissingTrigger=null,this.lastIndex=-1,e.Collection.prototype.reset.apply(this,arguments)},getStartIndex:function(){return this.currentStartIndex},getEndIndex:function(){return this.paginationModel.get("perPage")},_incrementLastIndex:function(){return this.lastIndex+=1,this.lastIndex},_prepareModel:function(t,n){return void 0===t.resultsIndex&&(t.resultsIndex=this._incrementLastIndex()),(t.title||t.bibcode||t.identifier)&&(t.emptyPlaceholder=!1),e.Collection.prototype._prepareModel.call(this,t,n)},getVisibleModels:function(){return t.filter(this.models,function(e){return e.attributes.visible})},updateIndexes:function(e,i,a){a=a||{};e=t.isNumber(e)?e:this.currentStartIndex,i=t.isNumber(i)?i:this.currentEndIndex+1;var r,s=0,o=null,l=0,c=[],u=null,d=n.parse(window.navigator.userAgent).platform.type,h="mobile"===d||"tablet"===d;if(this.each(function(n){r=n.attributes.resultsIndex,null!==u&&r!=u+1&&t.each(t.range(u+1,r),function(e){c.push(e)}),u=r,r>=e&&r<=i?(n.set("visible",!0),null===o&&(o=r),s+=1,l=r):n.set("visible",!1),n.set("isMobileOrTablet",h)}),s!==i-e+1&&t.each(t.range((u||e+c.length)+1,i+1),function(e){this.get(e)||c.push(e)},this),c.length){for(var p=0,f=c.length,m=0;m<c.length;m++){if(c[m]>i){f=m;break}c[m]<e&&(p=m+1)}c=c.slice(p,f),c=this._compressGaps(c),JSON.stringify(c)!=this.lastMissingTrigger&&(this.lastMissingTrigger=JSON.stringify(c),a.silent||this.trigger("show:missing",c))}return this.numVisible=s,this.currentStartIndex=o||0,this.currentEndIndex=l,s},_compressGaps:function(e){for(var t=e[0],n=t,i=e.length,a=[],r=0;r<i;r++){for(var s=r+1;s<i&&e[s]==t+(s-r);)n=e[s],s+=1;a.push({start:t,end:n}),r=s-1,s<i&&(t=n=e[s])}return a},showRange:function(e,t,n){if(n=n||{},e<0)throw new Error("Start cannot be negative");if(t<e)throw new Error("End cannot be smaller than start");return this.updateIndexes(e,t,n)},getNumVisible:function(){return this.numVisible},showMore:function(e){if(null===e)return this.updateIndexes(0,this.model.length);var t=this.getNumVisible();return this.updateIndexes(this.currentStartIndex,0==this.currentEndIndex?e-1:this.currentEndIndex+e)-t}});return t.extend(r.prototype,i),r}),define("js/mixins/openurl_generator",["underscore"],function(e){var t=function(t){return e.isString(t)},n=function(t){return e.isArray(t)},i={url_ver:"Z39.88-2004",rft_val_fmt:"info:ofi/fmt:kev:mtx:",rfr_id:"info:sid/ADS",sid:"ADS"};return{getOpenUrl:function(e){var a=e||{},r=a.metadata,s=a.linkServer,o=void 0===s?"":s,l=r||{},c=l.page,u=l.doi,d=l.doctype,h=l.bibcode,p=l.author,f=l.issue,m=l.volume,g=l.pub,b=l.year,v=l.title,y=l.issn,w=l.isbn,_=t(h)&&(h.includes("PhDT")?"PhD":!!h.includes("MsT")&&"Masters"),x=t(d)&&t(h)&&h.includes("PhDT")?"dissertation":t(d)?d:"article",S=_objectSpread(_objectSpread({},i),{},{"rft.spage":!!n(c)&&c[0].split("-")[0],id:!!n(u)&&"doi:"+u[0],genre:x,rft_id:[!!n(u)&&"info:doi/"+u[0],!!t(h)&&"info:bibcode/"+h],"rft.degree":_,"rft.aulast":!!t(p)&&p.split(", ")[0],"rft.aufirst":!!t(p)&&p.split(", ")[1],"rft.issue":!!t(f)&&f,"rft.volume":!!t(m)&&m,"rft.jtitle":!!t(g)&&g,"rft.date":!!t(b)&&b,"rft.atitle":!!n(v)&&v[0],"rft.issn":!!n(y)&&y[0],"rft.isbn":!!n(w)&&w[0],"rft.genre":x,rft_val_fmt:i.rft_val_fmt+(t(d)?d:"article")}),E=_objectSpread(_objectSpread({},S),{},{spage:S["rft.spage"],volume:S["rft.volume"],title:S["rft.jtitle"],atitle:S["rft.atitle"],aulast:S["rft.aulast"],aufirst:S["rft.aufirst"],date:S["rft.date"],isbn:S["rft.isbn"],issn:S["rft.issn"]}),k=o.includes("?")?o+"&":o+"?",A=Object.keys(E).filter(function(e){return E[e]}).map(function(e){if(E[e])return n(E[e])?E[e].filter(function(e){return e}).map(function(t){return"".concat(e,"=").concat(t)}).join("&"):"".concat(e,"=").concat(E[e])});return encodeURI(k+A.join("&"))}}}),define("js/mixins/link_generator_mixin",["underscore","js/mixins/openurl_generator"],function(e,t){var n=t.getOpenUrl,i=["ADS_PDF","ADS_SCAN","INSTITUTION","PUB_PDF","PUB_HTML","EPRINT_PDF","EPRINT_HTML","AUTHOR_PDF","AUTHOR_HTML"],a={"4TU.ResearchData":{shortName:"4TU.ResearchData",description:"International data repository for science, engineering and design"},AcA:{shortName:"AcA",description:"Acta Astronomica Data Files"},ADS_PDF:{name:"ADS PDF",shortName:"ADS",description:"ADS PDF",type:"PDF"},ADS_SCAN:{name:"ADS Scanned Article",description:"ADS scanned article",shortName:"ADS",type:"SCAN"},AHED:{shortName:"AHED",description:"Astrobiology Habitable Environments Database"},ALMA:{shortName:"ALMA",description:"Atacama Large Millimeter/submillimeter Array"},ArcticData:{shortName:"ArcticData",description:"Arctic Data Center"},ARI:{shortName:"ARI",description:"Astronomisches Rechen-Institut"},ARTEMIS:{shortName:"ARTEMIS",description:"Acceleration Reconnection Turbulence & Electrodynamics of Moon Interaction with the Sun"},AstroGeo:{shortName:"AstroGeo",description:"USGS Astrogeology Science Center"},Astroverse:{shortName:"Astroverse",description:"CfA Dataverse"},ASU:{shortName:"ASU",description:"Arizona State University"},ATNF:{shortName:"ATNF",description:"Australia Telescope Online Archive"},Author:{shortName:"Author",description:"Author Hosted Dataset"},AUTHOR_HTML:{name:"Author Article",shortName:"Author",description:"Link to HTML page provided by author",type:"HTML"},AUTHOR_PDF:{name:"Author PDF",shortName:"Author",description:"Link to PDF page provided by author",type:"PDF"},BAS:{shortName:"BAS",description:"British Antarctic Survey"},BAVJ:{shortName:"BAVJ",description:"Data of the German Association for Variable Stars"},BICEP2:{shortName:"BICEP2",description:"BICEP/Keck Data"},CADC:{shortName:"CADC",description:"Canadian Astronomy Data Center"},Caltech:{shortName:"Caltech",description:"California Institute of Technology"},CDS:{shortName:"CDS",description:"Strasbourg Astronomical Data Center"},Chandra:{shortName:"Chandra",description:"Chandra X-Ray Observatory"},ClimateDataStore:{shortName:"ClimateDataStore",description:"Climate Data Store"},CMDN:{shortName:"CMDN",description:"China Meteorological Data Service Centre"},CXO:{shortName:"CXO",description:"Chandra Data Archive"},DARTS:{shortName:"DARTS",description:"Data ARchives and Transmission System"},Dataverse:{shortName:"Dataverse",description:"Dataverse Project"},Dryad:{shortName:"Dryad",description:"International Repository of Research Data"},EARTHCHEM:{shortName:"EARTHCHEM",description:"Open-access repository for geochemical datasets"},ECMWF:{shortName:"ECMWF",description:"European Centre for Medium-Range Weather Forecasts"},EMFISIS:{shortName:"EMFISIS",description:"An instrument suite on the Van Allen Probes"},EPRINT_HTML:{name:"arXiv Article",shortName:"arXiv",description:"Arxiv article",type:"HTML"},EPRINT_PDF:{name:"arXiv PDF",shortName:"arXiv",description:"ArXiv eprint",type:"PDF"},ERGSC:{shortName:"ERGSC",description:"ERG Science Center"},ESA:{shortName:"ESA",description:"ESAC Science Data Center"},ESGF:{shortName:"ESGF",description:"Earth System Grid Federation"},ESO:{shortName:"ESO",description:"European Southern Observatory"},ETHZ:{shortName:"ETHZ",description:"ETH Zurich Research Collection"},FDSN:{shortName:"FDSN",description:"International Federation of Digital Seismograph Networks"},Figshare:{shortName:"Figshare",description:"Online Open Access Repository"},figshare:{shortName:"figshare",description:"Online Open Access Repository"},GCPD:{shortName:"GCPD",description:"The General Catalogue of Photometric Data"},Gemini:{shortName:"Gemini",description:"Gemini Observatory Archive"},Github:{shortName:"Github",description:"Web-based version-control and collaboration platform for software developers."},GRAS:{shortName:"GRAS",description:"Lunar and Planet Exploration Program Ground Application System"},GTC:{shortName:"GTC",description:"Gran Telescopio CANARIAS Public Archive"},HEASARC:{shortName:"HEASARC",description:"NASA High Energy Astrophysics Science Archive Research Center"},Herschel:{shortName:"Herschel",description:"Herschel Science Center"},IBVS:{shortName:"IBVS",description:"Information Bulletin on Variable Stars"},INES:{shortName:"INES",description:"IUE Newly Extracted Spectra"},IRIS:{shortName:"IRIS",description:"Incorporated Research Institutions for Seismology"},IRSA:{shortName:"IRSA",description:"NASA/IPAC Infrared Science Archive"},ISO:{shortName:"ISO",description:"Infrared Space Observatory"},JOSS:{shortName:"JOSS",description:"Journal of Open Source Software"},JWST:{shortName:"JWST",description:"JWST Proposal Info"},KOA:{shortName:"KOA",description:"Keck Observatory Archive"},LAADS:{shortName:"LAADS",description:"Level-1 and Atmosphere Archive & Distribution System Distributed Active Archive Center"},label:{shortName:"label",description:"name"},LASP:{shortName:"LASP",description:"Laboratory for Atmospheric and Space Physics"},LPL:{shortName:"LPL",description:"Lunar and Planetary Laboratory"},MAST:{shortName:"MAST",description:"Mikulski Archive for Space Telescopes"},MetOffice:{shortName:"MetOffice",description:"Met Office"},MIT:{shortName:"MIT",description:"Massachusetts Institute of Technology"},NASA:{shortName:"NASA",description:"NASA Data Portal"},NCAR:{shortName:"NCAR",description:"National Center for Atmospheric Research"},NED:{shortName:"NED",description:"NASA/IPAC Extragalactic Database"},NExScI:{shortName:"NExScI",description:"NASA Exoplanet Archive"},NOAA:{shortName:"NOAA",description:"National Oceanic and Atmospheric Administration"},NOAO:{shortName:"NOAO",description:"National Optical Astronomy Observatory"},OSF:{shortName:"OSF",description:"Open Science Foundation"},PANGAEA:{shortName:"PANGAEA",description:"Digital Data Library and a Data Publisher for Earth System Science"},pangaea:{shortName:"pangaea",description:"Digital Data Library and a Data Publisher for Earth System Science"},PASA:{shortName:"PASA",description:"Publication of the Astronomical Society of Australia Datasets"},PDG:{shortName:"PDG",description:"Particle Data Group"},PDS:{shortName:"PDS",description:"The NASA Planetary Data System"},PDSS:{shortName:"PDSS",description:"The NASA Planetary Data System"},PIK:{shortName:"PIK",description:"Potsdam Institute for Climate Impact Research"},protocols:{shortName:"protocols",description:"Collaborative Platform and Preprint Server for Science Methods and Protocols"},PUB_HTML:{name:"Publisher Article",shortName:"Publisher",description:"Electronic on-line publisher article (HTML)",type:"HTML"},PUB_PDF:{name:"Publisher PDF",shortName:"Publisher",description:"Publisher PDF",type:"PDF"},ScienceBase:{shortName:"ScienceBase",description:"ScienceBase"},SIMBAD:{shortName:"SIMBAD",description:"SIMBAD Database at the CDS"},Spitzer:{shortName:"Spitzer",description:"Spitzer Space Telescope"},TDR:{shortName:"TDR",description:"Texas Data Respository"},THEMIS:{shortName:"THEMIS",description:"Time History of Events and Macroscopic Interactions During Substorms"},TNS:{shortName:"TNS",description:"Transient Name Server"},UNAVCO:{shortName:"UNAVCO",description:"UNAVCO"},Vizier:{shortName:"VizieR",description:"VizieR Catalog Service"},XMM:{shortName:"XMM",description:"XMM Newton Science Archive"},Zenodo:{shortName:"Zenodo",description:"Zenodo Archive"}},r=function(e){return encodeURIComponent(e)};return{LINK_TYPES:a,parseLinksData:function(t){var n=e.bind(this._parseLinksDataForModel,this),i=e.bind(this.parseResourcesData,this);return e.isArray(t)?e.map(t,function(e){try{var t=i(e);return n(e,t)}catch(t){return e}}):[]},parseResourcesData:function(t){var n=e.bind(this._processLinkData,this);if(e.isPlainObject(t)){if(e.isArray(t.property)&&e.isString(t.bibcode)){if(e.contains(t.property,"ESOURCE")&&!e.has(t,"esources"))throw new Error("if `property` property contains `ESOURCE`, then data must have `esources` field");if(e.contains(t.property,"DATA")&&!e.has(t,"data"))throw new Error("if `property` property contains `DATA`, then data must have `data` field");return n(e.extend({},t))}throw new Error("data must have `property` and `bibcode`")}throw new Error("data must be a plain object")},createUrlByType:function(t,n,i){var a=i;return e.isArray(a)&&(a=a[0]),e.isString(t)&&e.isString(n)&&e.isString(a)?"/link_gateway/"+t+"/"+n+":"+a:""},_createGatewayUrl:function(t,n){return e.isString(t)&&e.isString(n)?"/link_gateway/"+r(t)+"/"+n:""},_processLinkData:function(t){var r,s,o=this._createGatewayUrl,l=[],c=[],u=0,d=t.property;return e.forEach(t.esources,function(i){var r=i.split("_"),s=a[i],c=t.link_server;(t.doi||t.issn||t.isbn)&&c&&u<1&&(l.push({url:n({metadata:t,linkServer:c}),openUrl:!0,type:"INSTITUTION",shortName:"My Institution",name:"My Institution",description:"Find Article At My Institution",rawType:"INSTITUTION"}),u+=1),r.length>1?l.push({url:o(t.bibcode,i),open:e.contains(d,r[0]+"_OPENACCESS"),shortName:s&&s.shortName||i,name:s&&s.name||i,type:s&&s.type||"HTML",description:s&&s.description,rawType:i}):l.push({url:o(t.bibcode,i),open:!1,shortName:s&&s.shortName||i,name:s&&s.name||i,type:s&&s.type||"HTML",description:s&&s.description,rawType:i})}),!e.find(l,{name:a.EPRINT_PDF.name})&&e.isArray(t.links_data)&&e.forEach(t.links_data,function(e){var t=JSON.parse(e);if(/preprint/i.test(t.type)){var n=a.EPRINT_PDF;l.push({url:t.url,open:!0,shortName:n&&n.shortName||t.type,name:n&&n.name||t.type,type:n&&n.type||"HTML",description:n&&n.description,rawType:"EPRINT_PDF"})}}),e.forEach(t.data,function(e){var n=e.split(":"),i=a[n[0]];n.length>1?c.push({url:o(t.bibcode,n[0]),count:n[1],name:i?i.shortName:n[0],description:i?i.description:n[0]}):c.push({url:o(t.bibcode,e),count:"1",name:i?i.shortName:e,description:i?i.description:e})}),c=e.sortBy(c,"count").reverse(),{fullTextSources:(r=l,s=r.sort(function(e,t){var n=i.indexOf(e.rawType),a=i.indexOf(t.rawType);return-1!==n&&-1!==a?n-a:-1!==n?-1:-1!==a?1:0}),[].concat(_toConsumableArray(s.filter(function(e){return i.includes(e.rawType)})),_toConsumableArray(s.filter(function(e){return!i.includes(e.rawType)})))),dataProducts:c}},_parseLinksDataForModel:function(t,n){var i={list:[],data:[],text:[]},a=e.extend({},t,{links:i});if(e.isPlainObject(n)&&(i=e.assign(i,{data:i.data.concat(n.dataProducts||[]),text:i.text.concat(n.fullTextSources||[])})),!e.isPlainObject(a))throw new Error("data must be a plain object");if(e.isPlainObject(a["[citations]"])&&e.isString(a.bibcode)){var s=a["[citations]"];e.isNumber(s.num_citations)&&s.num_citations>0&&i.list.push({letter:"C",name:"Citations ("+s.num_citations+")",url:"#abs/"+r(a.bibcode)+"/citations"}),e.isNumber(s.num_references)&&s.num_references>0&&i.list.push({letter:"R",name:"References ("+s.num_references+")",url:"#abs/"+r(a.bibcode)+"/references"})}return e.isArray(a.property)&&e.isString(a.bibcode)&&e.contains(a.property,"TOC")&&i.list.push({letter:"T",name:"Table of Contents",url:"#abs/"+r(a.bibcode)+"/toc"}),a}}}),define("hbs!js/widgets/list_of_things/templates/empty-view-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'  <div>\n    Using the ADS classic query translator? view the\n    <a\n      href="/help/faq/#classic-search-translator"\n      rel="noreferrer noopener"\n      target="_blank"\n      >docs</a\n    >.\n  </div>\n'},3:function(e,t,n,i){var a;return"  <ul>\n"+(null!=(a=t.if.call(e,null!=e?e.suggestedQuery:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")+'    <li>Try broadening your search</li>\n    <li>Disable any filters that may be applied</li>\n    <li><a href="#">Check out some examples</a></li>\n    <li>\n      <a\n        href="/help/search/search-syntax"\n        target="_blank"\n        rel="noreferrer noopener"\n        >Read our help pages</a\n      >\n    </li>\n  </ul>\n  <span>\n    Not seeing something that should be here? Let us know!\n    <button\n      class="btn btn-primary-faded results-feedback-button"\n      data-toggle="modal"\n      data-target="#feedback-modal"\n      data-feedback-view="general"\n    >\n      <i class="fa fa-comment" aria-hidden="true"></i>\n      Leave Feedback\n    </button>\n  </span>\n'},4:function(e,t,n,i){var a;return'    <li>\n      Try an alternate query:\n      <a href="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.suggestedQuery:e)?a.url:a,e))+'">'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.suggestedQuery:e)?a.query:a,e))+"</a>\n    </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="s-empty-view-msg">\n  <div class="h4">Sorry no results were found for <code>'+this.escapeExpression("function"==typeof(r=null!=(r=t.query||(null!=e?e.query:e))?r:t.helperMissing)?r.call(e,{name:"query",hash:{},data:i}):r)+"</code></div>\n"+(null!=(a=t.if.call(e,null!=e?e.showTugboatMessage:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"</div>\n"},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/empty-view-template",t),t}),define("hbs!js/widgets/list_of_things/templates/error-view-template",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="container-fluid">\n  <div class="row text-center">\n    <span class="fa-stack fa-lg text-danger">\n      <i class="fa fa-stack-2x fa-circle-o" aria-hidden="true"></i>\n      <i class="fa fa-stack-1x fa-exclamation" aria-hidden="true"></i>\n    </span>\n  </div>\n  <div class="row text-center">\n    <div class="h4">\n      Something Went Wrong\n    </div>\n    <div class="h4">\n      Please Retry Your Search\n    </div>\n  </div>\n</div>\n'},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/error-view-template",t),t}),define("hbs!js/widgets/list_of_things/templates/initial-view-template",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return"Requesting data..."},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/initial-view-template",t),t}),define("js/widgets/list_of_things/item_view",["marionette","backbone","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","analytics","mathjax"],function(e,t,n,i,a,r,s,o){return e.ItemView.extend({tagName:"li",template:r,constructor:function(t){return t&&_.defaults(t,_.pick(this,["model","collectionEvents","modelEvents"])),_.bindAll(this,"resetToggle"),e.ItemView.prototype.constructor.apply(this,arguments)},render:function(){return this.model.get("visible")?e.ItemView.prototype.render.apply(this,arguments):(this.$el&&this.$el.empty(),this)},onRender:function(){var e=this;o&&o.Hub.Queue(["Typeset",o.Hub,this.el]),$(">",this.$el).on("keyup",function(t){13===t.which&&$("a.abs-redirect-link",e.$el).mousedown().mouseup().click()})},events:{"change input[name=identifier]":"toggleSelect","focus .letter-icon":"showLinks","mouseenter .letter-icon":"showLinks","mouseleave .letter-icon":"hideLinks","focusout .letter-icon":"hideLinks","click .letter-icon>ul":"hideLinks","click .show-all-authors":"showAllAuthors","click .show-less-authors":"showLessAuthors","click .show-full-abstract":"showFullAbstract","click .hide-full-abstract":"hideFullAbstract","click .orcid-action":"orcidAction","click .abs-redirect-link":"onAbsLinkClick","click .citations-redirect-link":"onCitationsLinkClick"},modelEvents:{"change:visible":"render","change:showAbstract":"render","change:showHighlights":"render","change:orcid":"render","change:chosen":"render"},collectionEvents:{add:"render","change:visible":"render"},emitAnalyticsEvent:function(e){s("send","event","interaction","letter-link-followed",$(e.target).text())},onAbsLinkClick:function(e){var t=this.model.get("bibcode");s("send","event","interaction","abstract-link-followed",{target:"abstract",bibcode:t})},onCitationsLinkClick:function(e){var t=this.model.get("bibcode");s("send","event","interaction","citations-link-followed",{target:"citations",bibcode:t})},showAllAuthors:function(e){return this.$(".s-results-authors.less-authors").addClass("hidden"),this.$(".s-results-authors.all-authors").removeClass("hidden"),!1},showLessAuthors:function(e){return this.$(".s-results-authors.less-authors").removeClass("hidden"),this.$(".s-results-authors.all-authors").addClass("hidden"),!1},showFullAbstract:function(){return this.$(".short-abstract").addClass("hidden"),this.$(".full-abstract").removeClass("hidden"),!1},hideFullAbstract:function(){return this.$(".short-abstract").removeClass("hidden"),this.$(".full-abstract").addClass("hidden"),!1},toggleSelect:function(){var e=!this.model.get("chosen");this.trigger("toggleSelect",{selected:e,data:this.model.attributes}),this.model.set("chosen",e)},resetToggle:function(){this.setToggleTo(!1)},setToggleTo:function(e){var t=$("input[name=identifier]");e?(this.$el.addClass("chosen"),this.model.set("chosen",!0),t.prop("checked",!0)):(this.$el.removeClass("chosen"),this.model.set("chosen",!1),t.prop("checked",!1))},removeActiveQuickLinkState:function(e){e.find("i").removeClass("s-icon-draw-attention"),e.find(".link-details").addClass("hidden"),e.find("ul").attr("aria-expanded",!1)},addActiveQuickLinkState:function(e){e.find("i").addClass("s-icon-draw-attention"),e.find(".link-details").removeClass("hidden"),e.find("ul").attr("aria-expanded",!0)},deactivateOtherQuickLinks:function(e){var t=this.$(".letter-icon").filter(function(){if($(this).find("i").hasClass("s-icon-draw-attention"))return!0}).eq(0);t.length&&t[0]!==e[0]&&this.removeActiveQuickLinkState(t)},showLinks:function(e){var t=$(e.currentTarget);t.find(".active-link").length&&(this.deactivateOtherQuickLinks(t),this.addActiveQuickLinkState(t))},hideLinks:function(e){var t=$(e.currentTarget);t.is("ul")?this.removeActiveQuickLinkState(t.parent()):this.removeActiveQuickLinkState(t)},orcidAction:function(e){if(!e)return!1;var t=$(e.currentTarget),n={action:t.data("action")?t.data("action"):t.text().trim(),model:this.model,view:this,target:t};return this.trigger("OrcidAction",n),!1}})}),define("hbs!js/wraps/widget/loading/template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'  <div class="close-widget close-circle">\n    <a href="javascript:void(0)"\n      ><i class="fa fa-times fa-lg" aria-hidden="true"></i\n    ></a>\n  </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="loading-container">\n'+(null!=(a=t.unless.call(e,null!=e?e.hideCloseButton:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'  <div class="loading">\n    <div\n      class="loading-icon-'+this.escapeExpression("function"==typeof(r=null!=(r=t.widgetLoadingSize||(null!=e?e.widgetLoadingSize:e))?r:t.helperMissing)?r.call(e,{name:"widgetLoadingSize",hash:{},data:i}):r)+' fa fa-spinner fa-spin"\n      aria-hidden="true"\n    ></div>\n    <div class="loading-text loading-text-'+this.escapeExpression("function"==typeof(r=null!=(r=t.widgetLoadingSize||(null!=e?e.widgetLoadingSize:e))?r:t.helperMissing)?r.call(e,{name:"widgetLoadingSize",hash:{},data:i}):r)+'">\n      Loading...\n    </div>\n  </div>\n</div>\n'},useData:!0});return e.registerPartial("js/wraps/widget/loading/template",t),t}),define("js/widgets/list_of_things/paginated_view",["underscore","marionette","backbone","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","hbs!js/widgets/list_of_things/templates/results-container-template","js/mixins/link_generator_mixin","js/mixins/add_stable_index_to_collection","hbs!js/widgets/list_of_things/templates/empty-view-template","hbs!js/widgets/list_of_things/templates/error-view-template","hbs!js/widgets/list_of_things/templates/initial-view-template","./item_view","analytics","mathjax","hbs!js/wraps/widget/loading/template"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,m,g){var b=n.Model.extend({defaults:function(){return{mainResults:!1,title:void 0,showAbstract:"closed",showHighlights:!1,showSidebars:!0,pagination:!0,start:0,highlightsLoaded:!1}}}),v=function(e){var t=e.clone(),n=t.get("q");if(n[0]===n[0].toUpperCase())return t.set("q",n[0].toLowerCase()),t.unset("fl"),{url:"#search/"+t.url(),query:t.get("q")}},y=t.ItemView.extend({template:function(t){return t.query?u(t):t.error?d(t):g(e.extend(t,{widgetLoadingSize:"big",hideCloseButton:!0}))}});return t.CompositeView.extend({childView:p,emptyView:y,initialize:function(e){this.model=new b},serializeData:function(){var e=this.model.toJSON();return e.queryOperator&&(e.queryURL="#search/q="+e.queryOperator+"(",e.queryURL+=encodeURIComponent("bibcode:"+e.bibcode)+")",e.removeSelf&&(e.queryURL+=encodeURIComponent(" -bibcode:"+e.bibcode)),e.sortOrder&&(e.queryURL+="&sort="+encodeURIComponent(e.sortOrder))),e},onRender:function(){m&&m.Hub.Queue(["Typeset",m.Hub,this.el])},className:"list-of-things",alreadyRendered:!1,emptyViewOptions:function(t){var n=this.model.get("query"),i=this.model.get("isTugboat"),a=this.model.get("error");return this.model.unset("error",{silent:!0}),e.isArray(n)?t.set({query:n[0],showTugboatMessage:i,suggestedQuery:v(this.model.get("currentQuery"))}):e.has("query",n)?t.set({query:n.query[0],showTugboatMessage:i,suggestedQuery:v(this.model.get("currentQuery"))}):a&&t.set("error",a),{model:t}},childViewContainer:".results-list",events:{"click .show-highlights":"toggleHighlights","click .show-abstract":"toggleAbstract","click .toggle-sidebars":"toggleShowSidebars","click #go-to-bottom":"goToBottom","click #backToTopBtn":"goToTop","click a.page-control":"changePageWithButton","keyup input.page-control":"tabOrEnterChangePageWithInput","change #per-page-select":"changePerPage"},toggleHighlights:function(t){var n=this.model.get("showHighlights");n=e.isBoolean(n)&&n?"closed":"open"===n?"closed":"open",this.model.set("showHighlights",n),this.model.get("highlightsLoaded")||(this.model.set("highlightsLoaded",!0),this.trigger("toggle-highlights","open"===n))},toggleAbstract:function(){"open"==this.model.get("showAbstract")?this.model.set("showAbstract","closed"):"closed"==this.model.get("showAbstract")&&(this.model.set("showAbstract","open"),f("send","event","interaction","abstracts-toggled-on"))},toggleShowSidebars:function(){var e=!this.model.get("showSidebars");this.model.set("showSidebars",e),f("send","event","interaction","on")},goToBottom:function(){$(document.documentElement).animate({scrollTop:this.$el.outerHeight()},"fast")},goToTop:function(){$(document.documentElement).animate({scrollTop:0},"fast")},modelEvents:{change:"render","change:showHighlights":"toggleChildrenHighlights","change:showAbstract":"toggleChildrenAbstracts"},collectionEvents:{reset:"onResetCollection"},template:o,onResetCollection:function(){this.model.set("highlightsLoaded",!1),this.model.trigger("change:showAbstract")},toggleChildrenHighlights:function(){var e=this.model.get("showHighlights");this.collection.invoke("set","showHighlights","open"===e)},toggleChildrenAbstracts:function(){var e=this.model.get("showAbstract");this.collection.invoke("set","showAbstract","open"===e)},changePageWithButton:function(e){var t=$(e.currentTarget);if(!t.parent().hasClass("disabled")){var n=t.hasClass("next-page")?1:-1,i=this.model.get("page")+n;return this.trigger("pagination:select",i),this.resultsWidget&&f("send","event","interaction","results-list-pagination",i),!1}},tabOrEnterChangePageWithInput:function(e){var t=parseInt($(e.target).val()-1);13!=e.keyCode&&9!=e.keyCode||this.trigger("pagination:select",t),this.resultsWidget&&f("send","event","interaction","results-list-pagination",t)},changePerPage:function(e){var t=parseInt(e.currentTarget?e.currentTarget.value:25);return t!==this.model.get("perPage")&&this.trigger("pagination:changePerPage",t),!1}})}),define("js/widgets/list_of_things/widget",["marionette","backbone","utils","js/components/api_request","js/components/api_query","js/components/api_feedback","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","hbs!js/widgets/list_of_things/templates/results-container-template","js/mixins/add_stable_index_to_collection","./model","./paginated_view"],function(e,t,n,i,a,r,s,o,l,c,u,d){var h=s.extend({initialize:function(e){var t=this;e=e||{},_.defaults(e,_.pick(this,["view","collection","pagination","model","description","childView"])),this.pagination={pagination:!0,perPage:25,numFound:void 0,currentQuery:void 0,start:0,pageData:void 0,focusedIndex:-1},e.collection=e.collection||new u,e.view||(e.view=new d({collection:e.collection,model:e.model,childView:e.childView})),e.view.model.set(this.pagination,{silent:!0}),e.view.model.set({sortOrder:e.sortOrder,removeSelf:e.removeSelf,queryOperator:e.queryOperator,description:e.description},{silent:!0}),_.extend(this,{model:e.view.model,view:e.view}),this.hiddenCollection=new u,this.listenTo(this.hiddenCollection,"all",this.onAllInternalEvents),this.listenTo(this.view,"all",this.onAllInternalEvents),this.on("all",this.onAllInternalEvents),this.model.on("change:page",function(){t.model.set("focusedIndex",-1,{silent:!0})}),this.changePage=_.debounce(this.changePage.bind(this),500),s.prototype.initialize.call(this,e)},activate:function(e){var t=this;this.setBeeHive(e),_.bindAll(this,["updatePaginationPreferences"]);var n=this.getPubSub();if(this.getBeeHive().getObject("User")&&this.getBeeHive().getObject("User").getLocalStorage){var i=this.getBeeHive().getObject("User").getLocalStorage().perPage;i&&(this.pagination.perPage=i,this.model.set(this.pagination))}n.subscribe(n.INVITING_REQUEST,function(){t.updateState(t.STATES.LOADING)}),this.activateWidget(),this.attachGeneralHandler(this.onApiFeedback),n.subscribe(n.USER_ANNOUNCEMENT,this.updatePaginationPreferences),n.subscribe(n.CUSTOM_EVENT,function(e){"hotkey/next"===e?t.changePage(1):"hotkey/prev"===e?t.changePage(-1):"hotkey/item-next"===e?t.changeItemFocus(1):"hotkey/item-prev"===e?t.changeItemFocus(-1):"hotkey/item-select"===e&&t.selectItem()})},selectItem:function(){var e=this.model.get("focusedIndex");if(e>=0){var t=this.view.children.findByIndex(e);t&&t.toggleSelect&&t.toggleSelect()}},changeItemFocus:function(e){var t=this.view.children.length,n=this.model.get("focusedIndex");n<=0&&-1===e?n=t-1:n===t-1&&1===e?n=0:n+=e,this.model.set("focusedIndex",n,{silent:!0});var i=this.view.children.findByIndex(n);i&&i.el&&$(">",i.el).focus()},changePage:function(e){this.updatePagination({page:(this.model.get("page")||0)+e})},onApiFeedback:function(e){e.error&&(this.view.model.set("error",e.error),this.updateState(this.STATES.ERRORED))},updatePaginationPreferences:function(e,t){"user_info_change"==e&&t.perPage&&t.perPage!==this.pagination.perPage&&this.updatePagination({perPage:t.perPage})},_getCurrentQueryString:function(e){var t="",n=e||this.getBeeHive().getObject("AppStorage").getCurrentQuery();if(!_.isUndefined(n)&&(t=n.getApiQuery().get("q"),_.isEmpty(t)||t[0].indexOf("simbid")>-1))try{t=[n.get("responseHeader.params.__original_query")]}catch(e){t=""}return t},processResponse:function(e){var t=this.extractDocs(e),n=e.has("response.numFound")?e.get("response.numFound"):this.hiddenCollection.length,i=e.has("response.start")?e.get("response.start"):this.model.get("start"),a=this.getPaginationInfo(e,t),r=this;if((t=this.processDocs(e,t,a))&&t.length){var s=$("<textarea/>"),o=_.map(t,function(e){return e.highlights&&(e.highlights=e.highlights.map(function(e){return s.html(e).text()})),_.extend(e,{showHighlights:void 0!==e.highlights,showCheckbox:!!r.model.get("showCheckboxes")})});this.hiddenCollection.add(o,{merge:!0}),0===this.hiddenCollection.filter(function(e){return e.get("highlights")}).length&&this.view.model.set("showHighlights","closed"),a.showRange&&(this.model.set(a),this.hiddenCollection.showRange(a.showRange[0],a.showRange[1])),this.view.collection.reset(this.hiddenCollection.getVisibleModels()),this.view.model.set("query",!1)}else{var l=e.get("responseHeader.params");this.view.model.set({isTugboat:!!l.__tb,query:this._getCurrentQueryString(e),currentQuery:e.getApiQuery()})}this.trigger("page-manager-event","widget-ready",{numFound:n});var c=this.model.has("perPage")&&this.model.get("perPage")===this.collection.length,u=this.model.has("pageData")&&!1===this.model.get("pageData").nextPossible;0===this.view.collection.length||c||u&&n<=i+t.length?(this.model.set("loading",!1),this.updateState(this.STATES.IDLE)):this.model.set("loading",!0)},extractDocs:function(e){var t=e.get("response.docs");return t=_.map(t,function(e){return e.all_ids=e.identifier,e.bibcode&&(e.original_identifier=e.identifier,e.identifier=e.bibcode?e.bibcode:e.identifier),e})},getPaginationInfo:function(e,t){var n=e.getApiQuery(),i=e.get("response.numFound")||0,a=this.model.get("perPage")||(n.has("rows")?n.get("rows")[0]:10),r=this.model.get("start")||0,s=c.getPageVal(r,a),o=[s*a,(s+1)*a-1];return n.has("__fetch_missing")?{start:r,showRange:o}:{numFound:i,perPage:a,start:r,page:s,showRange:o,pageData:this._getPaginationData(s,a,i),currentQuery:n}},_getPaginationData:function(e,t,n){return{perPage:t,totalPages:Math.ceil(n/t),currentPage:e+1,previousPossible:e>0,nextPossible:(e+1)*t<n}},processDocs:function(e,t,n){if(!e.has("response"))return[];var i=e.get("response").start||n.start||0;return t=c.addPaginationToDocs(t,i)},defaultQueryArguments:{fl:"id",start:0},updateLocalStorage:function(e){e.hasOwnProperty("perPage")&&_.contains([25,50,100,200,500],e.perPage)&&(this.getBeeHive().getObject("User").setLocalStorage({perPage:e.perPage}),console.log("set user's page preferences in localStorage: "+e.perPage))},updatePagination:function(e){var i=_.defaults({},e,{silentIndexUpdate:!1,updateHash:!0}),r=this.model.get("pageData"),s=this.model.get("start"),o={},l=(this.model.get("currentQuery")||new a).get("p_");if(_.isNumber(i.numFound)&&(o.numFound=i.numFound),_.isNumber(i.perPage)&&(o.perPage=i.perPage,this.pagination.perPage=i.perPage),_.isArray(l)&&_.isUndefined(i.page))try{i.page=parseInt(l[0])}catch(e){}if(_.isNumber(i.page)){var u=r&&r.totalPages-1||1;i.page>u?o.page=u:i.page<0?o.page=0:o.page=i.page}else if(_.isEmpty(this.collection.models)&&_.isNumber(s)&&_.isNumber(i.perPage))o.page=c.getPageVal(s,i.perPage);else if(_.isNumber(s)&&_.isNumber(i.perPage)){var d=this.collection.models[0].get("resultsIndex");o.page=c.getPageVal(d,i.perPage)}var h=_.isNumber(o.page)?o.page:this.model.get("page"),p=_.isNumber(o.perPage)?o.perPage:this.model.get("perPage"),f=_.isNumber(o.numFound)?o.numFound:this.model.get("numFound"),m=t.history&&t.history.getFragment&&t.history.getFragment();""+h!==(_.isArray(l)&&l[0])&&i.updateHash&&/search/.test(m)&&n.qs("p_",m)!==""+h&&t.history&&t.history.navigate&&t.history.navigate(n.updateHash("p_",h,m)),o.start=this.getPageStart(h,p,f),o.pageData=this._getPaginationData(h,p,f),o.showRange=[h*p,h*p+p-1],this.model.set(o),this.view.render(),this.hiddenCollection.showRange(o.showRange[0],o.showRange[1],{silent:!!i.silentIndexUpdate}),this.collection.reset(this.hiddenCollection.getVisibleModels()),$(document.documentElement).scrollTop(0)},onAllInternalEvents:function(e,t,n){try{var i=this.getPubSub()}catch(e){}if("pagination:changePerPage"===e)this.updateLocalStorage({perPage:t}),this.updatePagination({page:0,perPage:t}),this.view.model.set("showHighlights","closed");else{if("pagination:select"===e)return this.view.model.set("showHighlights","closed"),this.updatePagination({page:t});"show:missing"===e?_.each(t,function(e){var t=this.model.get("numFound"),n=e.start,i=this.model.get("perPage"),a=this.model.get("start");if(!(!t||n>=t||n!==a&&a>0)){var r=this.model.get("currentQuery").clone();r.unset("hl"),r.unset("hl.fl"),r.unset("hl.maxAnalyzedChars"),r.unset("hl.requireFieldMatch"),r.unset("hl.usePhraseHighlighter"),r.set("__fetch_missing","true"),r.set("start",n),r.set("rows",i-n<=0?i:i-n);var s=this.composeRequest(r);this.executeRequest(s)}},this):"childview:toggleSelect"==e?i.publish(i.PAPER_SELECTION,n.data.identifier):"toggle-highlights"===e&&this.loadHighlights()}},fetchHighlights:function(e){var t=e.start,n=e.rows,i=this.model.get("currentQuery").clone();i.set({hl:"true","hl.fl":"title,abstract,body,ack,*","hl.maxAnalyzedChars":"150000","hl.requireFieldMatch":"true","hl.usePhraseHighlighter":"true",start:t,rows:n});var a=this.composeRequest(i);this.executeRequest(a)},loadHighlights:function(){var e=this.hiddenCollection,t=e.currentEndIndex,n=e.currentStartIndex,i=t-n+1;i>25?(this.fetchHighlights({start:n,rows:25}),this.fetchHighlights({start:n+25,rows:i-25})):this.fetchHighlights({start:n,rows:i})},executeRequest:function(e){this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,e)},reset:function(){this.collection.reset(),this.hiddenCollection.reset(),this.model.set(_.defaults({currentQuery:this.getCurrentQuery(),query:!1},this.pagination,this.model.defaults()))}});return _.extend(h.prototype,c),h}),define("js/mixins/papers_utils",["underscore","jquery-ui","jquery","moment"],function(e,t,n,i){return{formatDate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.format,a=void 0===n?"YYYY/MM":n,r=t.missing,s=_objectSpread({day:"YYYY/MM",month:"YYYY",dayAndMonth:"YYYY"},void 0===r?{}:r),o=_wrapRegExp(/^(\d{4})\x2D(\d{2}|00)\x2D(\d{2}|00)$/,{year:1,month:2,day:3}),l=e.match(o);if(l){var c=l.groups,u=c.year,d=c.month,h=c.day,p="00"===d,f="00"===h,m=[Number.parseInt(u,10),p?0:Number.parseInt(d,10)-1,f?1:Number.parseInt(h,10)],g=i.utc(m);return g.isValid()?p&&f?g.format(s.dayAndMonth):p?g.format(s.month):f?g.format(s.day):g.format(a):u}return null},shortenAbstract:function(e,t){if(t=t||300,!(e.length<=t)){var n=e.slice(0,t).lastIndexOf(" ");return e.slice(0,n+1)+"..."}},prepareDocForViewing:function(t){var n;if(t.author&&t.author.length>3?(t.extraAuthors=t.author.length-3,n=t.author.slice(0,3)):t.author&&(n=t.author),t.author){var i=function(e,t,n){var i=n.length-1;return t===i||0===i?e:e+";"};t.authorFormatted=e.map(n,i),t.allAuthorFormatted=e.map(t.author,i)}return t.formattedDate=t.formattedDate||(t.pubdate?this.formatDate(t.pubdate):void 0),t.shortAbstract=t.abstract?this.shortenAbstract(t.abstract):void 0,t.details=t.details||{shortAbstract:t.shortAbstract,pub:t.pub,abstract:t.abstract},t.num_citations=t["[citations]"]?t["[citations]"].num_citations:void 0,t.identifier=t.bibcode?t.bibcode:t.identifier,t.encodedIdentifier=e.isUndefined(t.identifier)?t.identifier:encodeURIComponent(t.identifier),(t.pubdate||t.shortAbstract)&&(t.popover=!0),this.model&&(t.orderNum=this.model.get("resultsIndex")+1),t}}}),define("js/widgets/list_of_things/details_widget",["./widget","js/mixins/add_stable_index_to_collection","js/mixins/link_generator_mixin","js/mixins/papers_utils","js/components/api_query"],function(e,t,n,i,a){var r=e.extend({defaultQueryArguments:{fl:"title,bibcode,author,keyword,pub,volume,year,[citations],property,pubdate,abstract,esources,data",rows:25,start:0},initialize:function(t){e.prototype.initialize.call(this,t),this.on("page-manager-message",function(e,t){("broadcast-payload"===e&&(this.model.set({title:t.title,showCheckboxes:!1}),this.canLoad=!1,this.ingestBroadcastedPayload(t)),"widget-selected"!==e||t.idAttribute!==this.name||this.canLoad)||_.bind(function(){this.canLoad=!0,setTimeout(_.bind(function(e){this.model.has("title")||this.model.set("title",e)},this),0,this.model.get("title")),this.dispatchRequest(t.bibcode)},this)()}),this.listenTo(this.model,"change:bibcode",function(){this.reset()})},activate:function(t){e.prototype.activate.apply(this,[].slice.apply(arguments));var n=t.getService("PubSub");_.bindAll(this,"dispatchRequest","processResponse"),n.subscribe(n.DISPLAY_DOCUMENTS,this.dispatchRequest),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse)},ingestBroadcastedPayload:_.noop,dispatchRequest:function(t){var n=t;if(t instanceof a||!_.isString(t)||(n=new a({q:"identifier:"+t})),this.canLoad){try{var i=n.get("q");if(i&&i[0]){var r=this.parseIdentifierFromQuery(n);if("null"===r||this.model.get("bibcode")===r)return;this.model.set("bibcode",r)}}catch(e){return void console.error("was unable to parse the bibcode!")}e.prototype.dispatchRequest.call(this,n)}},customizeQuery:function(){var t=e.prototype.customizeQuery.apply(this,arguments);if(Marionette.getOption(this,"sortOrder")&&t.set("sort",Marionette.getOption(this,"sortOrder")),this.model.get("queryOperator")){var n=this.model.get("queryOperator")+"("+t.get("q").join(" ")+")";"trending"===this.model.get("queryOperator")&&(n+="-"+t.get("q")[0])}else n=t.get("q");return t.set("q",n),t},processDocs:function(e,n,i){var a=this,r=e.get("response").start||i.start||0;_.each(n,function(e,t){n[t]=a.prepareDocForViewing(e)});try{n=this.parseLinksData(n)}catch(e){}return t.addPaginationToDocs(n,r)}});return _.extend(r.prototype,n),_.extend(r.prototype,i),r}),define("hbs!js/widgets/list_of_things/templates/expanding-item-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return"                cited by: "+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+"</p>\n"},3:function(e,t,n,i){return'                <li class="article-author">'+this.escapeExpression(this.lambda(e,e))+"</li>\n"},5:function(e,t,n,i){var a;return"            <span>and "+this.escapeExpression("function"==typeof(a=null!=(a=t.extraAuthors||(null!=e?e.extraAuthors:e))?a:t.helperMissing)?a.call(e,{name:"extraAuthors",hash:{},data:i}):a)+" more</span>\n"},7:function(e,t,n,i){var a;return"            <ul>\n"+(null!=(a=t.each.call(e,null!=e?e.highlights:e,{name:"each",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?a:"")+"            </ul>\n"},8:function(e,t,n,i){var a;return"                <li>"+(null!=(a=this.lambda(e,e))?a:"")+"</li>\n"},10:function(e,t,n,i){return"            <ul><li>No snippets available</li></ul>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="buffer">\n    <div class="row ">\n        <div class="col-md-1">\n            <label class="custom-checkbox">\n                <input type="checkbox" value='+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+' name="identifier"> '+this.escapeExpression("function"==typeof(r=null!=(r=t.orderNum||(null!=e?e.orderNum:e))?r:t.helperMissing)?r.call(e,{name:"orderNum",hash:{},data:i}):r)+'\n            </label>\n        </div>\n        <div class="col-md-3">\n            <p class="identifier">'+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+'</p>\n        </div>\n        <div class="col-md-2 col-md-offset-1">\n            <p title="citation count">\n'+(null!=(a=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'            </p>\n        </div>\n        <div class="col-md-3 col-md-offset-2">\n            [options go here]\n\n        </div>\n\n    </div>\n    <div class="row">\n        <div class="col-md-8 col-md-offset-1">\n            <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+'">\n                <h5 class="text-primary">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+'</h5>\n            </a>\n        </div>\n    </div>\n\n    <div class="row">\n        <div class="col-md-8 col-md-offset-1">\n            <ul class="list-inline just-authors">\n'+(null!=(a=t.each.call(e,null!=e?e.authorFormatted:e,{name:"each",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"            </ul>\n"+(null!=(a=t.if.call(e,null!=e?e.extraAuthors:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+'        </div>\n\n    </div>\n\n</div>\n<div class="row">\n    <div class="col-md-10 col-md-offset-1">\n        <div class="more-info panel panel-info hide">\n'+(null!=(a=t.if.call(e,null!=e?e.highlights:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.program(10,i,0),data:i}))?a:"")+"        </div>\n    </div>\n</div>\n</div>\n"},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/expanding-item-template",t),t}),define("hbs!js/widgets/list_of_things/templates/expanding-results-container-template",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="results-controls row hide"><button class="btn btn-default pull-right show-details">Show details</button></div>\n<div class="results-list row"></div>\n<div class="load-more row hide">\n\t<button class="btn btn-primary load-more-results">Load more</button>\n</div>'},useData:!0});return e.registerPartial("js/widgets/list_of_things/templates/expanding-results-container-template",t),t}),define("js/widgets/list_of_things/infinite_view",["marionette","backbone","hbs!js/widgets/list_of_things/templates/expanding-item-template","hbs!js/widgets/list_of_things/templates/expanding-results-container-template"],function(e,t,n,i){var a=e.ItemView.extend({className:function(){return!0===e.getOption(this,"hide")?"hide row results-item":"row results-item"},template:n,serializeData:function(){return this.model.toJSON()},events:{"change input[name=identifier]":"toggleSelect"},toggleSelect:function(){this.$el.toggleClass("chosen")}});return e.CompositeView.extend({initialize:function(e){this.displayNum=e.displayNum,this.paginator=e.paginator},className:"list-of-things",childView:a,childViewOptions:function(e,t){return this.paginator.getCycle()<=1&&t<this.displayNum?{}:{hide:!0}},childViewContainer:".results-list",events:{"click .load-more-results":"fetchMore","click .show-details":"showDetails"},template:i,fetchMore:function(e){e&&e.stopPropagation&&e.stopPropagation(),this.trigger("fetchMore",this.$(".results-item").filter(".hide").length)},displayMore:function(e){this.$(".results-item").filter(".hide").slice(0,e).removeClass("hide")},disableShowMore:function(e){this.$(".load-more:first").addClass("hide")},enableShowMore:function(e){this.$(".load-more:first").removeClass("hide")},toggleDetailsControls:function(e){e?this.$(".results-controls:first").removeClass("hide"):this.$(".results-controls:first").addClass("hide")},showDetails:function(e){e&&e.stopPropagation(),this.$(".more-info").toggleClass("hide"),this.$(".more-info").hasClass("hide")?this.$(".show-details").text("Show details"):this.$(".show-details").text("Hide details")}})}),define("js/widgets/search_bar/autocomplete",["jquery","analytics"],function(e,t){var n=[{value:'author:""',label:"Author",match:'author:"'},{value:'author:"^"',label:"First Author",match:'author:"'},{value:'author:"^"',label:"First Author",match:"first author"},{value:'author:"^"',label:"First Author",match:"^author"},{value:'author:"^"',label:"First Author",match:'author:"^'},{value:'bibstem:""',label:"Publication (must use bibstem)",desc:"e.g. bibstem:ApJ",match:'bibstem:"'},{value:'bibstem:""',label:"Publication (must use bibstem)",desc:"e.g. bibstem:ApJ",match:"publication (bibstem)"},{value:"arXiv:",label:"arXiv ID",match:"arxiv:"},{value:"doi:",label:"DOI",match:"doi:"},{value:'full:""',label:"Full text search",desc:"title, abstract, and body",match:"full:"},{value:'full:""',label:"Full text search",desc:"itle, abstract, and body",match:"fulltext"},{value:'full:""',label:"Full text search",desc:"title, abstract, and body",match:"text"},{value:"year:",label:"Year",match:"year"},{value:"year:",label:"Year Range",desc:"e.g. 1999-2005",match:"year range"},{value:'aff:""',label:"Affiliation",match:"affiliation"},{value:'aff:""',label:"Affiliation",match:"aff:"},{value:'abs:""',label:"Search abstract + title + keywords",match:"abs:"},{value:"collection:astronomy",label:"Limit to papers in the astronomy database",match:"database:astronomy"},{value:"collection:physics",label:"Limit to papers in the physics database",match:"database:physics"},{value:"collection:astronomy",label:"Limit to papers in the astronomy database",match:"collection:astronomy"},{value:"collection:physics",label:"Limit to papers in the physics database",match:"collection:physics"},{value:'title:""',label:"Title",match:"title:("},{value:"orcid:",label:"ORCiD identifier",match:"orcid:"},{value:"object:",label:"SIMBAD object (e.g. object:LMC)",match:"object:"},{value:"citations()",label:"Citations",desc:"Get papers citing your search result set",match:"citations("},{value:"references()",label:"References",desc:"Get papers referenced by your search result set",match:"references("},{value:"trending()",label:"Trending",desc:"the list of documents most read by users who read recent papers on the topic being researched",match:"trending("},{value:"reviews()",label:"Review Articles",desc:"review articles citing most relevant papers",match:"reviews("},{value:"useful()",label:"Useful",desc:"documents frequently cited by the most relevant papers on the topic being researched",match:"useful("},{value:"property:refereed",label:"Limit to refereed",desc:"(property:refereed)",match:"refereed"},{value:"property:refereed",label:"Limit to refereed",desc:"(property:refereed)",match:"property:refereed"},{value:"property:notrefereed",label:"Limit to non-refereed",desc:"(property:notrefereed)",match:"non-refereed"},{value:"property:notrefereed",label:"Limit to non-refereed",desc:"(property:notrefereed)",match:"property:notrefereed"},{value:"property:notrefereed",label:"Limit to non-refereed",desc:"(property:notrefereed)",match:"notrefereed"},{value:"doctype:eprint",label:"Limit to eprints",desc:"(doctype:eprint)",match:"eprint"},{value:"doctype:eprint",label:"Limit to eprints",desc:"(doctype:eprint)",match:"doctype:eprint"},{value:"doctype:eprint",label:"Limit to eprints",desc:"(doctype:eprint)",match:"property:eprint"},{value:"property:openaccess",label:"Limit to open access",desc:"(property:openaccess)",match:"open access"},{value:"property:openaccess",label:"Limit to open access",desc:"(property:openaccess)",match:"property:openaccess"},{value:"property:openaccess",label:"Limit to open access",desc:"(property:openaccess)",match:"openaccess"},{value:"doctype:software",label:"Limit to software",desc:"(doctype:software)",match:"software"},{value:"doctype:software",label:"Limit to software",desc:"(doctype:software)",match:"doctype:software"},{value:"doctype:inproceedings",label:"Limit to papers in conference proceedings",desc:"(doctype:inproceedings)",match:"conference proceedings"},{value:"doctype:inproceedings",label:"Limit to papers in conference proceedings",desc:"(doctype:inproceedings)",match:"doctype:inproceedings"},{value:"doctype:inproceedings",label:"Limit to papers in conference proceedings",desc:"(doctype:inproceedings)",match:"property:inproceedings"}],i=function(e){var t=e.trim().split(/\s+/).filter(function(e){return!!e});return{active:t.pop(),inactive:t.length>0?t.join(" "):""}};return{render:function(a){if(a){var r=e(a);r.autocomplete({minLength:1,autoFocus:!1,delay:0,source:function(t,a){if(r.data("preventSearch"))return r.data("preventSearch",!1),void r.autocomplete("close");var s=t.term;if(r.data("originalTerm",s),/\s+$/.test(s))r.autocomplete("close");else if(r.getCursorPosition()===r.val().length){var o=i(s).active,l=new RegExp("^".concat(e.ui.autocomplete.escapeRegex(o)),"i");a(_.uniq(_.filter(n,function(e){return l.test(e.match)}),!1,_.property("label")))}else r.autocomplete("close")},focus:function(e,t){var n=r.data("ui-autocomplete"),a=i(n.term).inactive,s=t.item.value,o="".concat(a.length>0?a+" ":"").concat(s);return"mouseenter"!==e.originalEvent.originalEvent.type&&r.val(o),r.data("previewSuggestion",o),r.data("didFocus",!0),r.data("focusedItem",t.item),!1},select:function(e,n){var i=r.data("previewSuggestion");return r.val(i),r.selectRange(/[")]$/.test(n.item.value)?i.length-1:i.length),t("send","event","interaction","autocomplete-used",n.item.value),!1}}),r.data("ui-autocomplete")._renderItem=function(t,n){var i=new RegExp("("+this.term+")","i"),a=n.label.replace(i,'<span class="ui-state-highlight">$1</span>');return n.desc?e('<li class="search-bar-suggestion">').append("<a>"+a+'<span class="s-auto-description">&nbsp;&nbsp;'+n.desc+"</span></a>").appendTo(t):e('<li class="search-bar-suggestion">').on("hover",function(e){return e.preventDefault()}).append("<a>"+a+"</a>").appendTo(t)},r.bind({keydown:function(e){var t=r.data().didFocus;"Backspace"===e.key&&/\s+$/.test(r.val())&&r.data("preventSearch",!0),"Tab"===e.key&&t&&(r.data("didFocus",!1),e.preventDefault())},paste:function(){r.data("preventSearch",!0)}})}},autocompleteSource:n}}),define("js/widgets/search_bar/quick-field-desc",{abs:{title:"abstract",description:"Search for word or phrase in abstract, title and keywords",syntax:['abs:"phrase"'],example:['abs:"dark energy"']},abstract:{title:"abstract only",description:"Search for a word or phrase in an abstract only",syntax:['abstract:"phrase"'],example:['abstract:"dark energy"']},ack:{title:"acknowledgements",description:"Search for a word or phrase in the acknowledgements extracted from fulltexts.",syntax:['ack:"phrase"'],example:['ack:"ADS"']},aff:{title:"affiliation",description:"Search for word or phrase in the raw, provided affiliation field",syntax:['aff:"phrase"'],example:['aff:"harvard"']},arxiv_class:{title:"arXiv category",description:"Finds all arXiv pre-prints in the class specified",syntax:["arxiv_class:arxivclass"],example:['arxiv_class:"High Energy Physics - Experiment"']},author_count:{title:"author count",description:"Find records that have a specific number of authors, or a range of author counts",syntax:["author_count:count","author_count:[min_count TO max_count]"],example:["author_count:40","author_count:[10 TO 100]"]},author:{title:"author",description:"Author name may include just lastname and initial, or stricter author search (recommended)",syntax:['author:"Last, F"','author:"Last, First […]"'],example:['author:"huchra, john p"','author:"huchra, john p"']},bibcode:{title:"bibcode",description:"Find a specific record using the ADS bibcode (ADS identifier of a paper)",syntax:["bibcode:adsbib"],example:["bibcode:2003AJ….125..525J"]},bibgroup:{title:"bibliographic group",description:"Limit search to papers in HST bibliography",syntax:["bibgroup:name"],example:["bibgroup:HST"]},bibstem:{title:"bib abbrev",description:"Find records that contain a specific bibstem in their bibcode",syntax:["bibstem:adsbibstem"],example:["bibstem:ApJ"]},body:{title:"body of article",description:"Search for a word or phrase in (only) the full text",syntax:['body:"phrase"'],example:['body:"gravitational waves"']},data:{title:"data archive",description:"Limit search to papers with data from specified",syntax:["data:archive"],example:["data:NED"]},collection:{title:"collection",description:"Search from the astronomy, physics, or general collection",syntax:["collection:collection"],example:["collection:general"]},citation_count:{title:"citation count",description:"Find records that have a specific number of citations, or a range of citation counts",syntax:["citation_count:count","citation_count:[min_count TO max_count]"],example:["citation_count:40","citation_count:[10 TO 100]"]},doctype:{title:"doctype",description:"Limit search to records corresponding to data catalogs",syntax:["doctype:type"],example:["doctype:catalog"]},doi:{title:"doi",description:"finds a specific record using its digital object id",syntax:["doi:DOI"],example:["doi:10.1086/345794"]},entdate:{title:"entdate",description:"Creation date of ADS record in user-friendly format (YYYY-MM-DD)",syntax:["entdate:YYYY-MM-DD"],example:["entdate:2019-05-20"]},"first-author":{title:"first author",description:"Search by first author of the paper",syntax:['author:"^Last, F"'],example:['author:"^huchra, j"']},full:{title:"fulltext",description:"Search for word or phrase in fulltext, acknowledgements, abstract, title and keywords",syntax:['full:"phrase"'],example:['full:"gravitational waves"']},identifier:{title:"identifier",description:"Find a paper using any of its identifiers, arXiv, bibcode, doi, etc.",syntax:["identifier:bibcode"],example:["identifier:2003AJ….125..525J"]},inst:{title:"institution",description:'Search by author\'s canonical affiliation. Click <a href="https://github.com/adsabs/CanonicalAffiliations/blob/master/parent_child.tsv" ref="noopener noreferrer" target="_blank">here</a> for a full list',syntax:["inst:id"],example:["inst:CfA"]},keyword:{title:"keyword",description:"Search publisher- or author-supplied keywords",syntax:['keyword:"phrase"'],example:["keyword:sun"]},object:{title:"object",description:"Search for papers tagged with a specific astronomical object or at or near a set of coordinates",syntax:['object:"object"'],example:["object:Andromeda"]},orcid:{title:"orcid",description:"Search for papers that are associated with a specific ORCiD iD",syntax:["orcid:id"],example:["orcid:0000-0000-0000-0000"]},page:{title:"page",description:"Search for papers with a given page number",syntax:["page:number"],example:["page:410"]},property:{title:"property",description:"An array of miscellaneous flags associated with the record. Possible values include: refereed, notrefereed, article, nonarticle, ads_openaccess, eprint_openaccess, pub_openaccess, openaccess, ocrabstract",syntax:["property:type"],example:["property:openaccess"]},pub:{title:"publication full name",description:"Limit search to a specific publication",syntax:["bibstem:adsbibstem"],example:["bibstem:ApJ"]},pubdate:{title:"date published",description:"Use fine-grained dates for publication range",syntax:["pubdate:[YYYY-MM TO YYYY-MM]"],example:["pubdate:[2005-10 TO 2006-09]"]},title:{title:"title",description:"Search for word or phrase in title field",syntax:['title:"phrase"'],example:['title:"weak lensing"']},volume:{title:"volume",description:"Search for papers with a given volume",syntax:["volume:volume"],example:["volume:10"]},year:{title:"year",description:"Year of publication",syntax:["year:YYYY","year:YYYY-YYYY"],example:["year:2000","year:2000-2005"]},citations:{title:"citations()",description:"Returns list of citations from given papers; use [citations] to get the field contents",syntax:["citations(query)"],example:['citations(author:"huchra, john")']},pos:{title:"pos()",description:"Search for an item within a field by specifying the position in the field. The example for this operator is pos(fieldedquery,position,[endposition]). If no endposition is given, then it is assumed to be endposition = position, otherwise this performs a query within the range [position, endposition].",syntax:["pos(fieldedquery,position,[endposition])"],example:['pos(author:"Oort, J",2)']},references:{title:"references()",description:"Returns list of references from given papers",syntax:["references(query)"],example:["references(bibcode:2003AJ....125..525J)"]},reviews:{title:"reviews()",description:"Returns the list of documents citing the most relevant papers on the topic being researched; these are papers containing the most extensive reviews of the field.",syntax:["reviews(query)"],example:['reviews("weak lensing")']},similar:{title:"similar()",description:"Return similar documents, based on the similarity of the abstract text",syntax:["similar(query)"],example:["similar(bibcode:2000A&AS..143...41K)"]},topn:{title:"topn()",description:"Return the top N number of documents",syntax:["topn(N, query)"],example:["topn(100, database:astronomy, citation_count desc)"]},trending:{title:"trending()",description:"Returns the list of documents most read by users who read recent papers on the topic being researched; these are papers currently being read by people interested in this field.",syntax:["trending(query)"],example:["trending(exoplanets)"]},useful:{title:"useful()",description:"Returns the list of documents frequently cited by the most relevant papers on the topic being researched; these are studies which discuss methods and techniques useful to conduct research in this field.",syntax:["useful(query)"],example:['useful("galaxy surveys")']},"?":{title:"single wildcard: ?",description:"Matches a single character",syntax:["?"],example:["title:(k? star)"]},"*":{title:"wildcard: *",description:"Matches zero or more sequential characters",syntax:["*"],example:["title:(gravit* wave)"]},"=":{title:"exact match: =",description:"Exact match",syntax:["=query"],example:['=author:"murray, stephen"']}}),define("hbs!js/widgets/search_bar/templates/search_bar_template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a,r;return" "+(null!=(a=t.if.call(e,null!=e?e.libraryName:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?a:"")+'            <label for="query-search-input" clas="sr-only">ADS search</label>\n            <input type="text" class="form-control q hasbigquery" name="q" id="query-search-input" autofocus aria-label="Start typing a query here to begin an ADS Search" autocomplete="off" value='+this.escapeExpression("function"==typeof(r=null!=(r=t.currentQueryVal||(null!=e?e.currentQueryVal:e))?r:t.helperMissing)?r.call(e,{name:"currentQueryVal",hash:{},data:i}):r)+'>\n\n\n            <button type="button" class="icon-clear s-clear-control"></button>\n\n'},2:function(e,t,n,i){var a;return'\n            <div class="btn btn-xs btn-info bigquery-tag">\n              <i class="fa fa-book" aria-hidden="true"></i>&nbsp;<span>'+this.escapeExpression("function"==typeof(a=null!=(a=t.libraryName||(null!=e?e.libraryName:e))?a:t.helperMissing)?a.call(e,{name:"libraryName",hash:{},data:i}):a)+'</span>&nbsp;<i class="fa fa-close fa-lg bigquery-close" aria-hidden="true" title="click to remove"></i></div>\n'},4:function(e,t,n,i){return'            <div class="btn btn-xs btn-info bigquery-tag"><i class="fa fa-list-ul" aria-hidden="true"></i>&nbsp;&nbsp;Bulk query&nbsp;&nbsp;<i class="fa fa-close fa-lg bigquery-close" aria-hidden="true" title="click to remove" ></i></div>\n'},6:function(e,t,n,i){var a;return'            <input type="text" class="form-control q" name="q" autofocus id="query-search-input" aria-label="Start typing a query here to begin an ADS Search" autocomplete="off" value='+this.escapeExpression("function"==typeof(a=null!=(a=t.currentQueryVal||(null!=e?e.currentQueryVal:e))?a:t.helperMissing)?a.call(e,{name:"currentQueryVal",hash:{},data:i}):a)+'>\n\n            <button type="button" class="icon-clear s-clear-control"></button>\n\n'},8:function(e,t,n,i){var a;return"      with "+this.escapeExpression("function"==typeof(a=null!=(a=t.citationCount||(null!=e?e.citationCount:e))?a:t.helperMissing)?a.call(e,{name:"citationCount",hash:{},data:i}):a)+" total "+this.escapeExpression("function"==typeof(a=null!=(a=t.citationLabel||(null!=e?e.citationLabel:e))?a:t.helperMissing)?a.call(e,{name:"citationLabel",hash:{},data:i}):a)+"\n"},10:function(e,t,n,i){var a;return'      <span class="search-bar__citation-count"> with <span class="citation-count-container" style="font-weight: bold;">'+this.escapeExpression("function"==typeof(a=null!=(a=t.citationCount||(null!=e?e.citationCount:e))?a:t.helperMissing)?a.call(e,{name:"citationCount",hash:{},data:i}):a)+'</span>\n        <span class="s-light-font description">total '+this.escapeExpression("function"==typeof(a=null!=(a=t.citationLabel||(null!=e?e.citationLabel:e))?a:t.helperMissing)?a.call(e,{name:"citationLabel",hash:{},data:i}):a)+" </span>\n      </span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div role="search">\n  <div class="row">\n    <h2 class="sr-only">Search Bar to Enter New Query</h2>\n    <div class="col-sm-12 s-quick-add" aria-label="quick add fields">\n      <div id="expanded-search-form" class="unselectable">\n        <div id="field-options">\n          <span class="s-field-options">quick field:</span>\n\n          <span class="visible-sm-inline visible-md-inline visible-lg-inline">\n            <button class="btn btn-link btn-sm" title=\'search for an author, e.g. author:"Kurtz,M"\' data-toggle="tooltip" data-field="author" data-punc=\'"\'>Author</button>\n            <button class="btn btn-link btn-sm" title=\'search for a first author, e.g. author:"^Kurtz,M"\' data-toggle="tooltip" data-field="first-author" data-punc=\'"\'>First Author</button>\n            <button class="btn btn-link btn-sm" title="limit search to abstract, title and keyword fields" data-toggle="tooltip" data-field="abs" data-punc=\'"\'>Abstract</button>\n          </span>\n\n          <span class="visible-lg-inline">\n            <button class="btn btn-link btn-sm" title="e.g. year:1999 or year:1999-2016" data-toggle="tooltip" data-field="year">Year</button>\n            <button class="btn btn-link btn-sm" title="search titles, abstract, text, keywords and acknowledgements of the articles" data-toggle="tooltip" data-field="full" data-punc=\'"\'>Fulltext</button>\n          </span>\n\n          \x3c!--container for additional fields/operators--\x3e\n          <span id="option-dropdown-container"></span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="row"></div>\n  <div class="row">\n    <div class="col-sm-12 search-bar-input-row s-search-bar-input-row">\n      <form name="main-query" action="/search/q=%s">\n        <div class="form-group has-feedback">\n          <div class="input-group">\n            '+(null!=(a=t.if.call(e,null!=e?e.bigquery:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(6,i,0),data:i}))?a:"")+'            <span class="input-group-btn">\n                      <button type="submit" class="btn btn-primary search-submit s-search-submit" aria-label="submit">\n                          <i class="fa fa-search" aria-hidden="true"></i></button>\n                  </span>\n\n          </div>\n          \x3c!-- /input-group --\x3e\n        </div>\n        \x3c!-- /form-group--\x3e\n      </form>\n    </div>\n  </div>\n</div>\n<div class="row">\n  <div class="s-num-found" role="status" aria-atomic="true" aria-labelledby="num-found-title">\n    <div class="sr-only" id="num-found-title">\n      Your search returned '+this.escapeExpression("function"==typeof(r=null!=(r=t.numFound||(null!=e?e.numFound:e))?r:t.helperMissing)?r.call(e,{name:"numFound",hash:{},data:i}):r)+" results\n"+(null!=(a=t.if.call(e,null!=e?e.citationCount:e,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?a:"")+'    </div>\n    <span class="s-light-font description">Your search returned</span>\n      <span class="num-found-container" style="font-weight: bold;">'+this.escapeExpression("function"==typeof(r=null!=(r=t.numFound||(null!=e?e.numFound:e))?r:t.helperMissing)?r.call(e,{name:"numFound",hash:{},data:i}):r)+'</span>\n      <span class="s-light-font"> results </span>\n'+(null!=(a=t.if.call(e,null!=e?e.citationCount:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"  </div>\n</div>\n</div>\n"},useData:!0});return e.registerPartial("js/widgets/search_bar/templates/search_bar_template",t),t}),define("hbs!js/widgets/search_bar/templates/search_form_template",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="search-gui"><span style="text-align:right;font-size:small;float:right;">This tool is still experimental.</span>\n</div>\n\n\n\n'},useData:!0});return e.registerPartial("js/widgets/search_bar/templates/search_form_template",t),t}),define("hbs!js/widgets/search_bar/templates/option-dropdown",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<label for="quick-add-dropdown" class="sr-only"\n  >Select a field or operator</label\n>\n<select id="quick-add-dropdown" class="quick-add-dropdown">\n  <optgroup label="fields">\n    <option value="abs">abstract</option>\n    <option value="abstract">abstract only</option>\n    <option value="ack">acknowledgements</option>\n    <option value="aff">affiliation</option>\n    <option value="arxiv_class">arXiv category</option>\n    <option value="author_count">author count</option>\n    <option value="author" data-field="author">author</option>\n    <option value="bibcode">bibcode</option>\n    <option value="bibgroup">bibliographic group</option>\n    <option value="bibstem">bib abbrev, e.g. ApJ</option>\n    <option value="body">body of article</option>\n    <option value="data">data archive</option>\n    <option value="collection">collection</option>\n    <option value="citation_count">citation count</option>\n    <option value="doctype">doctype</option>\n    <option value="doi">doi</option>\n    <option value="entdate" data-default-value="[2000-01-01 TO 2010-01-01]"\n      >entdate</option\n    >\n    <option value="first-author" data-field="first-author">first author</option>\n    <option value="full" data-field="full">fulltext</option>\n    <option value="identifier">identifier</option>\n    <option value="inst">inst</option>\n    <option value="keyword">keyword</option>\n    <option value="object">object</option>\n    <option value="orcid">orcid</option>\n    <option value="page">page</option>\n    <option value="property">property</option>\n    <option value="pub">publication full name</option>\n    <option value="pubdate" data-default-value="[2000-01 TO 2010-01]"\n      >date published</option\n    >\n    <option value="title">title</option>\n    <option value="volume">volume</option>\n    <option value="year" data-field="year">year</option>\n  </optgroup>\n  <optgroup label="operators">\n    <option value="citations">citations()</option>\n    <option value="pos">pos()</option>\n    <option value="references">references()</option>\n    <option value="reviews">reviews()</option>\n    <option value="similar">similar()</option>\n    <option value="topn">topn()</option>\n    <option value="trending">trending()</option>\n    <option value="useful">useful()</option>\n  </optgroup>\n  <optgroup label="special characters">\n    <option value="?">single wildcard: ?</option>\n    <option value="*">wildcard: *</option>\n    <option value="=">exact match: =</option>\n  </optgroup>\n</select>\n'},useData:!0});return e.registerPartial("js/widgets/search_bar/templates/option-dropdown",t),t}),define("js/mixins/formatter",[],function(){var e={formatNum:function(e){var t=[],n=(e+="").split("."),i="";return 2===n.length&&(e=n[0],i="."+n[1]),e.length<4?e+i:(e=e.split("").reverse(),_.each(e,function(n,i){t.unshift(n),(i+1)%3==0&&i!==e.length-1&&t.unshift(",")}),t.join("")+i)}};return e}),define("js/components/query_validator",["underscore"],function(e){function t(e,t){var n=new RegExp(e,t);return function(e){return n.test(e)?null:e}}function n(e,t,n){this.field=e,this.value=t,this.token=n}return function(){var i=function(e){return null!==e};this.validate=function(a){var r={result:!0},s=[i,new t(/^""$/),new t(/^\(\)$/),new t(/^\(\^\)$/),new t(/^\(""\)$/),new t(/^\("\^"\)$/),new t(/^"\^"$/)];try{var o=a.get("q").join(" ").trim();if(!o.length)return r;var l=function(e){for(var t=new RegExp(/:/),i=e.split(/\s+\b/),a=[],r=0;r<i.length;r++){var s=i[r].split(t);2===s.length&&a.push(new n(s[0],s[1],i[r]))}return a}(o)}catch(e){return r}var c=function(t,n){var i=[];for(var a in n){var r=e.compose.apply(e,t)(n[a].value);r||i.push({token:n[a].token,result:r})}return i}(s,l);return r.result=e.every(e.pluck(c,"result")),c.length&&(r.tests=c),r}}}),define("libs/select2/matcher",["jquery"],function(e){return function(t){return function(n,i){var a=e.extend(!0,{},i);if(null==n.term||""===e.trim(n.term))return a;if(i.children){for(var r=i.children.length-1;r>=0;r--){var s=i.children[r];t(n.term,s.text,s)||a.children.splice(r,1)}if(a.children.length>0)return a}return t(n.term,i.text,i)?a:null}}}),define("js/widgets/search_bar/search_bar_widget",["underscore","marionette","bowser","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/search_bar/templates/search_bar_template","hbs!js/widgets/search_bar/templates/search_form_template","hbs!js/widgets/search_bar/templates/option-dropdown","js/components/api_request","js/components/api_targets","js/components/api_feedback","js/mixins/formatter","./autocomplete","./quick-field-desc","bootstrap","jquery-ui","js/mixins/dependon","analytics","js/components/query_validator","select2","libs/select2/matcher"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,m,g,b,v,y,w){var _,x=h.render,S=h.autocompleteSource,E=Backbone.Model.extend({defaults:function(){return{citationCount:void 0,numFound:void 0,bigquery:!1,bigquerySource:void 0}}});var k=t.ItemView.extend({template:r,className:"s-search-bar-widget",initialize:function(t){e.bindAll(this,"fieldInsert"),this.queryValidator=new v,this.defaultDatabases=[]},activate:function(e){this.setBeeHive(e)},modelEvents:{change:"render"},onRender:function(){var e=this;this.$("#option-dropdown-container").append(o);var t=this.$(".quick-add-dropdown");t.select2({placeholder:"All Search Terms",matcher:w(function(e,t){return 0===t.toUpperCase().indexOf(e.toUpperCase())})}).on("change",function(n){var i=n.target.value;if(i){var a=$(this).find('option[value="'+n.target.value+'"]'),r=a.data("defaultValue"),s=a.closest("optgroup").attr("label");t.val(null).trigger("change"),setTimeout(function(){e.selectFieldInsert(i,s,r)},100)}}).val(null).trigger("change");var i=t.data("select2"),a=function(){$(".select2-dropdown").popover("destroy")};i.on("close",function(){document.getElementById("query-search-input").focus(),setTimeout(function(){document.getElementsByClassName("search-term-popover")[0].remove()},10)});var r=n.parse(window.navigator.userAgent).platform.type;"mobile"!==r&&"tablet"!==r&&(i.on("open",a),i.on("results:focus",function(e){var t=e.data.id;a();var n=p[t];if("object"===_typeof(n)){var i=n.syntax.map(function(e){return"<code>".concat(e,"</code>")}).join(", "),r=n.example.map(function(e){return"<code>".concat(e,"</code>")}).join(", ");$(".select2-dropdown").popover({title:"<strong>".concat(n.title,"</strong>"),content:"".concat(n.description,"<br/><br/>Syntax: <br/>").concat(i,"<br/><br/>Example: </br>").concat(r),html:!0,placement:"top right",trigger:"manual",container:"body",animation:!1}).data("bs.popover").tip().attr("class","search-term-popover popover right in"),$(".select2-dropdown").popover("show")}}));var s=this.$("input.q");this.$input=s,x(s),s.popover({placement:"bottom",title:"Empty Search!",content:"Please enter a query to search.",animation:!0,trigger:"manual"}),this.$('[data-toggle="tooltip"]').tooltip()},events:(_={"click #field-options button":"fieldInsert","keyup .q":"toggleClear","click .show-form":"onShowForm","submit form[name=main-query]":"submitQuery","click .icon-clear":"clearInput"},_defineProperty(_,"keyup .q","storeCursorInfo"),_defineProperty(_,"select .q","storeCursorInfo"),_defineProperty(_,"click .q","storeCursorInfo"),_defineProperty(_,"click .bigquery-close","clearBigquery"),_),toggleClear:function(){this.$(".icon-clear").toggleClass("hidden",!this.$input.val())},clearInput:function(){this.$input.val("").focus(),this.toggleClear()},getFormVal:function(){return this.$input.val()},setFormVal:function(e){this.model.get("bigquery")&&"*:*"===e?this.$(".q").val(""):this.$(".q").val(e),this.toggleClear()},serializeData:function(){var e=this.model.toJSON();return e.numFound=e.numFound?this.formatNum(e.numFound):0,e.citationCount=!!e.citationCount&&this.formatNum(e.citationCount),this.model.get("bigquerySource")&&this.model.get("bigquerySource").match(/library/i)&&this.model.set({libraryName:this.model.get("bigquerySource").match(/library:(.*)/i)[1]}),e},onShowForm:function(){this.specifyFormWidth()},toggleFormSection:function(e){var t=$(e.target).parent();t.next().toggleClass("hide"),t.toggleClass("search-form-header-active")},_cursorInfo:{selected:"",startIndex:0},storeCursorInfo:function(e){var t,n,i=(t=e.currentTarget,n="",window.getSelection?n=t.value.substring(t.selectionStart,t.selectionEnd):document.selection&&"Control"!=document.selection.type&&(n=document.selection.createRange().text),n),a=this.$input.getCursorPosition();this._cursorInfo={selected:i,startIndex:a},this.toggleClear()},selectFieldInsert:function(e,t,n){var i,a,r=this._cursorInfo.selected,s=this._cursorInfo.startIndex,o=this.getFormVal(),l='"'+r+'"';switch(0===r.length&&n&&(l=n),t){case"fields":"first-author"===e?(e="author",l=l.replace(/"/,'"^')):"year"===e&&(l=l.replace(/"/g,"")),i=e+":"+l;break;case"operators":i=e+"("+('""'===l?"":l)+")";break;case"special characters":i="="===e?e+l:l+e,a=!0}if(r.length)this.setFormVal(o.substr(0,s)+i+o.substr(s+l.length));else{var c=o?o+" "+i:i;this.setFormVal(c),a?this.$input.selectRange(c.length):this.$input.selectRange(c.length-1)}b("send","event","interaction","field-insert-dropdown-selected",e)},fieldInsert:function(e){var t,n,i=this.getFormVal(),a=$(e.target),r=a.attr("data-field"),s=a.attr("data-punc"),o=this._cursorInfo.startIndex,l=this._cursorInfo.selected;if(r.indexOf("operator-")>-1){if(n=r.split("-").reverse()[0],s="(",!l)return t=n+"("+i+")",i="",void this.setFormVal(t);t=n+"("+l+")"}else"first-author"==r?t=' author:"^'+l+'"':'"'==s?t=r+':"'+l+'"':"("==s?t=r+":("+l+")":s||(t=r+":"+l);if(l)this.setFormVal(i.substr(0,o)+t+i.substr(o+l.length));else{var c=i+" "+t;this.setFormVal(c),s?this.$input.selectRange(c.length-1):this.$input.selectRange(c.length)}return b("send","event","interaction","field-insert-button-pressed",r),!1},submitQuery:function(t){var n,a,r;r=this.getFormVal();var s=$("input",t.currentTarget);if(e.isString(r)&&e.isEmpty(r)&&!this.model.get("bigquery"))return s.popover("show"),s.on("input change blur",function(){$(this).popover("hide")}),!1;s.popover("hide"),r=r.replace(/([A-Z])\w+:/g,function(e){return e.toLowerCase()}),this.original_query=r,!r&&this.model.get("bigquery")&&(r="*:*");var o=new i({q:r}),l=this.queryValidator.validate(o);if(!l.result){var c=e.pluck(l.tests,"token");c=c.length>1?c.join(", "):c[0];var d=this.getPubSub();return d.publish(d.ALERT,new u({code:0,msg:'<p><i class="fa fa-exclamation-triangle fa-2x" aria-hidden="true"></i> Sorry! We aren\'t able to understand: <strong><i>'+c+'</i></strong></p><p><strong><a href="/">Try looking at the search examples on the home page</a></strong> or <strong><a href="/help/search/search-syntax">reading our help page.</a></strong></p>',type:"info",fade:!0})),!1}return this.trigger("start_search",o),n=e.chain(S).pluck("value").map(function(e){var t=e.match(/\w+:|\w+\(/);if(t&&t.length)return t[0]}).unique().value(),a=!1,e.each(n,function(e){r.indexOf(e)>-1&&(a=!0)}),b("send","event","interaction",(a?"fielded":"unfiielded")+"-query-submitted-from-search-bar",r),!1},clearBigquery:function(){this.trigger("clear_big_query")}});e.extend(k.prototype,d,g.BeeHive);var A=a.extend({initialize:function(e){this.model=new E,this.view=new k({model:this.model}),this.listenTo(this.view,"start_search",function(e){this.changeDefaultSort(e),this.navigate(e),this.updateState("loading"),this.view.setFormVal(e.get("q"))}),this.listenTo(this.view,"clear_big_query",function(e){(e=this._currentQuery.clone()).unset("__qid"),e.unset("__bigquerySource"),e.set("__clearBigQuery","true"),this.clearBigQueryPill(),this.navigate(e)}),this.listenTo(this.view,"render",function(){var e="",t=this.getCurrentQuery(),n=t.get("q");n&&(e=t.get("__original_query")?t.get("__original_query")[0]:n.join(" ")),e&&this.view.setFormVal(e),this.view.toggleClear()}),a.prototype.initialize.call(this,e)},activate:function(t){this.setBeeHive(t),this.activateWidget();var n=this.getPubSub();e.bindAll(this,"processResponse"),n.subscribe(n.FEEDBACK,e.bind(this.handleFeedback,this)),n.subscribe(n.NAVIGATE,e.bind(this.onNavigate,this)),this.view.activate(t.getHardenedInstance()),n.subscribe(n.INVITING_REQUEST,e.bind(this.dispatchRequest,this)),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse),n.subscribe(n.USER_ANNOUNCEMENT,e.bind(this.updateFromUserData,this)),n.subscribe(n.CUSTOM_EVENT,e.bind(this.onCustomEvent,this)),n.subscribe(n.START_SEARCH,e.bind(this.onStartSearch,this)),this.updateFromUserData()},getUserData:function(){try{var t=e.isFunction(this.getBeeHive)&&this.getBeeHive(),n=e.isFunction(t.getObject)&&t.getObject("User");return e.isPlainObject(n)?e.isFunction(n.getUserData)&&n.getUserData("USER_DATA"):{}}catch(e){return{}}},onStartSearch:function(){this.model.unset("timing")},onCustomEvent:function(e,t){if("timing:results-loaded"===e)this.model.set("timing",t/1e3);else if("hotkey/search"===e){var n=$("input[name=q]",this.getEl());n.is(":focus")||(t.preventDefault(),n.select(),$(document.documentElement).scrollTop(0))}else if("recommender/update-search-text"===e){var i=t.text;i&&(this.view.setFormVal("".concat(this.view.getFormVal()," ").concat(i)),this.view.$input.focus())}},updateFromUserData:function(){var t=this.getUserData();this.defaultDatabases=e.has(t,"defaultDatabase")?e.map(e.filter(t.defaultDatabase,{value:!0}),"name"):this.defaultDatabases},applyDefaultFilters:function(t){var n=this.defaultDatabases||[];if(n.length>0){var i="{!type=aqp v=$fq_database}",a=t.get("fq");if(a=e.isArray(a)?a:[a],e.indexOf(i)<0&&(a.push(i),t.set("fq",a)),!t.has("fq_database")){var r=e.reduce(n,function(e,t,n){var i=t.toLowerCase();return e.replace(/(\(.*)(\))/,0===n?"$1database:"+i+"$2":"$1 OR database:"+i+"$2")},"()");t.set("fq_database",r)}if(!t.has("__filter_database_fq_database")){var s=e.map(n,function(e){return"database:"+e.toLowerCase()});t.set("__filter_database_fq_database",["OR"].concat(s))}}return t},processResponse:function(t){var n=t.toJSON(),i=n.responseHeader.params.sort;if(n.stats&&/citation.*/.test(i)){var a=e.keys(n.stats.stats_fields)[0],r=n.stats.stats_fields[a].sum;"citation_count_norm"===a?this.model.set({citationCount:r.toFixed(2),citationLabel:"normalized citations"}):"citation_count"===a&&this.model.set({citationCount:r,citationLabel:"citations"})}else this.model.unset("citationCount"),this.model.unset("citationLabel")},defaultQueryArguments:{fl:"id"},dispatchRequest:function(t){var n=t.get("sort");if(/citation_count_norm/i.test(n))this.defaultQueryArguments=e.extend(this.defaultQueryArguments,{stats:"true","stats.field":"citation_count_norm"});else{if(!/citation_count/i.test(n))return this.model.unset("citationCount"),void this.model.unset("citationLabel");this.defaultQueryArguments=e.extend(this.defaultQueryArguments,{stats:"true","stats.field":"citation_count"})}a.prototype.dispatchRequest.call(this,t)},focusInput:function(){this._onIndexPage()&&(this.clearBigQueryPill(),this.view.clearInput())},clearBigQueryPill:function(){this.model.unset("bigquerySource"),this.model.unset("bigquery")},onNavigate:function(e){this.currentPage=e,this.focusInput(e)},handleFeedback:function(e){if(e.code===u.CODES.SEARCH_CYCLE_STARTED||e.code===u.CODES.SEARCH_CYCLE_FAILED_TO_START){var t=e.query?e.query:e.request.get("query"),n=t.get("__original_query")?t.get("__original_query")[0]:t.get("q").join(" ");this.setCurrentQuery(t),this.model.set({bigquerySource:t.get("__bigquerySource")?t.get("__bigquerySource")[0]:"Bulk query",bigquery:!!t.get("__qid"),numFound:e.numFound}),this.view.setFormVal(n),this.updateState("idle")}},changeDefaultSort:function(e){var t=this.getCurrentQuery();if(e.has("sort"))t&&t.has("sort")&&e.set("sort",t.get("sort"));else{var n=e.get("q")[0],i=new RegExp("(".concat(["trending","instructive","useful","references","reviews","similar"].join("|"),")(?=\\()"),"gi"),a=n.match(i),r="date desc";a&&(r="score desc","references"===a[0]&&(r="first_author asc")),e.set("sort",r)}},_onIndexPage:function(){return/(index-page|SearchWidget)/.test(this.currentPage)||!this.currentPage},navigate:function(t){var n=t.toJSON(),a=e.omit(this.getCurrentQuery().toJSON(),function(e,t){return/^hl.*/.test(t)||/^p_$/.test(t)||/^__original_query$/.test(t)});this._onIndexPage()?(t=this.applyDefaultFilters(t)).set("__clearBigQuery","true"):t=new i(e.assign(a,n)),t.has("__clearBigQuery")?t.unset("__qid"):t.has("__qid")&&!this._onIndexPage()&&t.set("__saveBigQuery","true"),this.view.setFormVal(t.get("q")[0]),this.setCurrentQuery(t),this.getPubSub().publish(this.getPubSub().NAVIGATE,"search-page",{q:t})},openQueryAssistant:function(e){e&&this.view.setFormVal(e),this.view.$el.find(".show-form").click()},onShow:function(){if(this._onIndexPage()){var e=this.view.$("input[name=q]");!function t(n){if(e.blur().focus(),e.is(":focus")||n>9)return clearTimeout(void 0);setTimeout(t,500,n+1)}(0)}},onDestroy:function(){this.view.destroy()},onLoading:function(){this.model.set("loading",!0)},onIdle:function(){this.model.set("loading",!1)}});return e.extend(A.prototype,g.BeeHive),A}),define("hbs!js/widgets/facet/graph-facet/templates/graph",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return"\n  \x3c!-- citations section --\x3e\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.section:e,"citations",{name:"compare",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+"  \n  \x3c!-- reads section --\x3e\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.section:e,"reads",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")},2:function(e,t,n,i){var a,r;return'    <div style="display: flex;">\n      <div style="flex: 1; padding-right: 10px"> \n        <p style="font-size: 1.3rem;">'+this.escapeExpression("function"==typeof(r=null!=(r=t.totalCount||(null!=e?e.totalCount:e))?r:t.helperMissing)?r.call(e,{name:"totalCount",hash:{},data:i}):r)+" top cited records with <strong>"+this.escapeExpression("function"==typeof(r=null!=(r=t.subTotal||(null!=e?e.subTotal:e))?r:t.helperMissing)?r.call(e,{name:"subTotal",hash:{},data:i}):r)+'</strong> total citations</p>\n      </div>\n      <div class="s-view-metrics-button-container" style="width:40px"></div>\n    </div>\n'+(null!=(a=t.if.call(e,null!=e?e.showTotalMessage:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")},3:function(e,t,n,i){var a;return'      <p style="font-size: 1.3rem;">(<strong>'+this.escapeExpression("function"==typeof(a=null!=(a=t.statsCount||(null!=e?e.statsCount:e))?a:t.helperMissing)?a.call(e,{name:"statsCount",hash:{},data:i}):a)+"</strong> total citations for full set)</p>\n"},5:function(e,t,n,i){var a,r;return'    <div style="display: flex;">\n      <div style="flex: 1; padding-right: 10px">\n        <p style="font-size: 1.3rem;">'+this.escapeExpression("function"==typeof(r=null!=(r=t.totalCount||(null!=e?e.totalCount:e))?r:t.helperMissing)?r.call(e,{name:"totalCount",hash:{},data:i}):r)+" top read records with <strong>"+this.escapeExpression("function"==typeof(r=null!=(r=t.subTotal||(null!=e?e.subTotal:e))?r:t.helperMissing)?r.call(e,{name:"subTotal",hash:{},data:i}):r)+'</strong> total recent reads </p>\n      </div>\n      <div class="s-view-metrics-button-container" style="width:40px"></div>\n    </div>\n'+(null!=(a=t.if.call(e,null!=e?e.showTotalMessage:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:"")},6:function(e,t,n,i){var a;return'      <p style="font-size: 1.3rem;">(<strong>'+this.escapeExpression("function"==typeof(a=null!=(a=t.statsCount||(null!=e?e.statsCount:e))?a:t.helperMissing)?a.call(e,{name:"statsCount",hash:{},data:i}):a)+"</strong> total recent reads for full set)</p>\n"},8:function(e,t,n,i){return"<hr/>"},10:function(e,t,n,i){return' style="width:80%" '},12:function(e,t,n,i){var a;return(null!=(a=t.if.call(e,null!=e?e.error:e,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.program(15,i,0),data:i}))?a:"")+"\n"},13:function(e,t,n,i){return'    <div class="text-center">\n      <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true"></i>\n      Could not load graph.\n    </div>\n'},15:function(e,t,n,i){return'    <div class="text-center">\n      <i class="fa fa-spin fa-spinner fa-2x" aria-hidden="true"></i> Loading...\n    </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return(null!=(a=t.if.call(e,null!=e?e.statsCount:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.statsCount:e,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?a:"")+'\n\n<div class="graph-legend" '+(null!=(a=t.unless.call(e,null!=e?e.statsCount:e,{name:"unless",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"></div>\n"+(null!=(a=t.unless.call(e,null!=e?e.graphData:e,{name:"unless",hash:{},fn:this.program(12,i,0),inverse:this.noop,data:i}))?a:"")+' <div class="s-svg-container">\n     <svg class="chart s-chart" viewBox="0 0 110 100" preserveAspectRatio="xMinYMin meet">\n     </svg>\n </div>\n\n<div style="position: relative;top: 30px;">\n    <div class="slider s-slider"></div>\n    <div class="graph-controls row">\n        <div class="slider-data col-sm-12">\n        </div>\n</div>\n\n</div>\n<div class="graph-download"></div>\n<a id="download-link" class="hidden"></a> '},useData:!0});return e.registerPartial("js/widgets/facet/graph-facet/templates/graph",t),t}),define("js/widgets/facet/graph-facet/base_graph",["marionette","d3","jquery","jquery-ui","hbs!js/widgets/facet/graph-facet/templates/graph"],function(e,t,n,i,a){return e.ItemView.extend({className:"graph-facet",initialize:function(e){this.name=e.name,this.yAxisTitle=e.yAxisTitle,this.xAxisTitle=e.xAxisTitle,this.graphTitle=e.graphTitle,this.pastTenseTitle=e.pastTenseTitle,this.id=this.graphTitle+"-graph",this.fullWidth=110,this.fullHeight=100,this.width=this.fullWidth-this.margin.left-this.margin.right,this.height=this.fullHeight-this.margin.top-this.margin.bottom,this.currentScale="linear",this.on("facet:active",this.pulseApplyButton)},bins:12,margin:{top:5,right:5,bottom:20,left:20},template:a,insertLegend:function(){this.$(".graph-legend").html(this.legendTemplate({yAxisTitle:this.yAxisTitle}))},events:{"click .apply":"submitFacet","blur input[type=text]":"triggerGraphChange"},modelEvents:{change:"render"},pulseApplyButton:function(){this.$(".apply").addClass("draw-attention-primary-faded"),setTimeout(function(){this.$(".apply").removeClass("draw-attention-primary-faded")},2e3)},addDownloadButton:function(){this.$(".graph-download").html('<button class="btn btn-link download s-download s-download-ur">\n          <i class="fa fa-download fa-lg" aria-hidden="true" title="download data in csv"></i>\n          <span class="sr-only">download data in csv</span>\n        </button>')},download:function(){var e=this.convertGraphDataToCSV(),t=encodeURI(e),n=document.getElementById("download-link");n.setAttribute("href",t),n.setAttribute("download","".concat(this.name,".csv")),n.click()},onRender:function(){var e=this;if(this.model.get("graphData"))if(this.model.get("graphData").length<2)this.$el.html("Too little data to make a useful graph.");else{this.insertLegend(),this.buildGraph(),this.addSliderWindows(),this.buildSlider(),this.addDownloadButton(),this.addToOnRender&&this.addToOnRender();var t=_.debounce(_.bind(this.triggerGraphChange,this),100);n('input[type="text"]',this.$el).on("keyup",function(n){t(),n&&13===n.which&&(e.triggerGraphChange.call(e,!0),e.submitFacet.call(e))})}}})}),define("hbs!js/widgets/facet/graph-facet/templates/h-index-graph-legend",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'H-Index for results: <span class="h-index-container"> </span>\n<div class="ref-nonref hidden pull-right">\n  <div><span class="s-legend-color refereed"></span> refereed</div>\n</div>\n<div class="change-scale">\n  Y-axis:\n  <label class="custom-radio"\n    >linear\n    <input type="radio" name="'+this.escapeExpression("function"==typeof(a=null!=(a=t.yAxisTitle||(null!=e?e.yAxisTitle:e))?a:t.helperMissing)?a.call(e,{name:"yAxisTitle",hash:{},data:i}):a)+'-scale" value="linear" checked\n  /></label>\n  <label class="custom-radio"\n    >log <input type="radio" name="'+this.escapeExpression("function"==typeof(a=null!=(a=t.yAxisTitle||(null!=e?e.yAxisTitle:e))?a:t.helperMissing)?a.call(e,{name:"yAxisTitle",hash:{},data:i}):a)+'-scale" value="log"\n  /></label>\n</div>\n'},useData:!0});return e.registerPartial("js/widgets/facet/graph-facet/templates/h-index-graph-legend",t),t}),define("hbs!js/widgets/facet/graph-facet/templates/h-index-slider-window",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'Limit to top\n<input\n  type="text"\n  class="show-slider-data-first"\n  aria-label="limit papers start year"\n/>\nmost '+this.escapeExpression("function"==typeof(a=null!=(a=t.pastTenseTitle||(null!=e?e.pastTenseTitle:e))?a:t.helperMissing)?a.call(e,{name:"pastTenseTitle",hash:{},data:i}):a)+'\n<button class="apply btn btn-sm btn-primary-faded">Apply</button>\n'},useData:!0});return e.registerPartial("js/widgets/facet/graph-facet/templates/h-index-slider-window",t),t}),define("js/widgets/facet/graph-facet/h_index_graph",["./base_graph","hbs!js/widgets/facet/graph-facet/templates/h-index-graph-legend","hbs!js/widgets/facet/graph-facet/templates/h-index-slider-window","marionette"],function(e,t,n,i){return e.extend({legendTemplate:t,xAxisClassName:"h-index-x-axis-title",addToOnRender:function(){this.hIndex&&this.$(".h-index-container").text(this.hIndex.x)},events:{"click .apply":"submitFacet","blur input[type=text]":"triggerGraphChange","click .download":"download","change input[name*=scale]":"toggleScale"},buildGraph:function(){var e,t,n,a,r,s,o,l;e=_.clone(this.model.get("graphData")),this.hIndex=e[_.indexOf(e,_.findWhere(e,function(e){if(e.x>e.y)return!0}))-1],t=_.pluck(e,"x");var c=_.pluck(e,"y");maxVal=d3.max(c),minVal=d3.min(c);var u=[t[0]-1,t[t.length-1]+1];(n=d3.scale.linear().domain(u).range([0,this.width]),a=d3.scale.linear().domain([minVal-1,maxVal+1]).range([this.height,0]),r=d3.svg.axis().scale(n).orient("bottom"),standardFormatter=d3.format("s"),s=d3.svg.axis().scale(a).orient("left").tickFormat(function(e){return e>=1&&e%1==0?standardFormatter(e):""}),o=d3.select(this.el).select(".chart").attr("width",this.fullWidth).attr("height",this.fullHeight).attr("aria-label",this.yAxisTitle+" graph"),this.innerChart=o.append("g").classed("inner-chart",!0).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.innerChart.append("g").classed({axis:!0,"x-axis":!0}).attr("transform","translate(0,"+this.height+")").call(r).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(e){return"rotate(-65)"}),this.innerChart.append("g").classed({axis:!0,"y-axis":!0}).call(s),e.length>=40)?(l=d3.svg.line().x(function(e){return n(e.x)}).y(function(e){return a(e.y)}),this.innerChart.append("path").datum(e).classed("line",!0).attr("d",l)):(this.$(".ref-nonref").removeClass("hidden"),this.innerChart.selectAll("circle").data(e).enter().append("circle").attr("class","dot").attr("r",2).classed("refereed",function(e){if(e.refereed)return!0}).attr("cx",function(e){return n(e.x)}).attr("cy",function(e){return a(e.y)}));this.hIndex&&(this.innerChart.append("line").classed({"h-index":!0,"h-index-1":!0}).attr("x1",n(this.hIndex.x)).attr("y1",a(minVal-1)).attr("x2",n(this.hIndex.x)).attr("y2",a(this.hIndex.y)),this.innerChart.append("line").classed({"h-index":!0,"h-index-2":!0}).attr("x1",n(t[0]-1)).attr("y1",a(this.hIndex.y)).attr("x2",n(this.hIndex.x)).attr("y2",a(this.hIndex.y))),this.innerChart.append("text").attr("class","s-label").attr("x",this.width/2-20).attr("y",180).text(i.getOption(this,"xAxisTitle")),this.innerChart.append("text").attr("class","s-label").attr("y",-40).attr("x",-this.height/2).attr("transform","rotate(-90)").text(i.getOption(this,"yAxisTitle"))},toggleScale:function(e){var t=$(e.target).attr("value");this.currentScale=t,this.graphChange()},graphChange:function(e){var t,n,i,a,r;e!==(t=_.clone(this.model.get("graphData")))[t.length-1].x?this.trigger("facet:active"):this.trigger("facet:inactive"),e?this.limitVal=e:this.limitVal||(this.limitVal=d3.max(_.pluck(t,"x"))),t=_.filter(t,function(e,t){return"log"===this.currentScale?e.x<=this.limitVal&&e.y>0:e.x<=this.limitVal},this);var s=_.pluck(t,"x"),o=_.pluck(t,"y");maxVal=d3.max(o),minVal=d3.min(o);var l=[s[0]-1,s[s.length-1]+1];if(n=d3.scale.linear().domain(l).range([0,this.width]),a=d3.svg.axis().scale(n).orient("bottom").tickFormat(d3.format("d")),"linear"===this.currentScale?i=d3.scale.linear().domain([minVal-1,maxVal+1]).range([this.height,0]):"log"===this.currentScale&&(i=d3.scale.log().domain([_.max([1,minVal-1]),maxVal+1]).range([this.height,0]).clamp(!0)),d3.select(this.el).select(".x-axis").call(a).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(e){return"rotate(-65)"}),standardFormatter=d3.format("s"),r=d3.svg.axis().scale(i).orient("left"),"log"===this.currentScale){var c=d3.format("s");r.tickFormat(function(e){var t=Math.log(e)/Math.log(10)+1e-6;return Math.abs(t-Math.floor(t))<.7?c(e):""})}else r=d3.svg.axis().scale(i).orient("left").tickFormat(function(e){return e>=1&&e%1==0?standardFormatter(e):""});if(d3.select(this.el).select(".y-axis").transition().call(r),this.hIndex&&(_.contains(t,this.hIndex)?this.innerChart.selectAll(".h-index").classed("hidden",!1):this.innerChart.selectAll(".h-index").classed("hidden",!0),this.innerChart.select(".h-index-1").transition().attr("x1",n(this.hIndex.x)).attr("x2",n(this.hIndex.x)).attr("y2",i(this.hIndex.y)),this.innerChart.select(".h-index-2").transition().attr("y1",i(this.hIndex.y)).attr("x2",n(this.hIndex.x)).attr("y2",i(this.hIndex.y))),t.length>=40)$(".ref-nonref").addClass("hidden"),line=d3.svg.line().x(function(e){return n(e.x)}).y(function(e){return i(e.y)}),this.innerChart.selectAll(".dot").classed("hidden",!0),this.innerChart.selectAll(".line").datum(t).attr("d",line).classed("hidden",!1);else{this.$(".ref-nonref").removeClass("hidden"),this.innerChart.selectAll(".line").classed("hidden",!0),this.innerChart.selectAll(".dot").classed("hidden",!1);var u=this.innerChart.selectAll("circle").data(t);u.exit().remove(),u.enter().append("circle").attr("class","dot").attr("r",2),u.classed("refereed",function(e){if(e.refereed)return!0}).attr("cx",function(e){return n(e.x)}).attr("cy",function(e){return i(e.y)})}},buildSlider:function(){var e=this,t=_.clone(this.model.get("graphData")),n=t[t.length-1].x,i=t[0].x;this.$(".slider").slider({max:n,min:i,value:n,stop:function(t,n){e.graphChange(n.value)},slide:function(t,n){e.$(".show-slider-data-first").val(n.value)},create:function(e){var t=$("a",e.target);t.attr("href","javascript:void(0)"),t.attr("title","slider handle")}}),this.$(".show-slider-data-first").val(n)},addSliderWindows:function(){this.$(".slider-data").html(n({pastTenseTitle:this.pastTenseTitle}))},convertGraphDataToCSV:function(){var e="data:text/csv;charset=utf-8,";return e+="Total, ".concat(Number(this.model.get("statsCount").replace(/,/g,"")),"\n"),e+="Article No., ".concat(this.name,", Refereed"),this.model.get("graphData").forEach(function(t){e+="\n".concat(t.x,",").concat(t.y,",").concat(t.refereed)}),e},triggerGraphChange:function(e){var t=_.clone(this.model.get("graphData"));if(_.isArray(t)){var n=t[0].x,i=t[t.length-1].x,a=this.$(".show-slider-data-first"),r=a.val();r=(r=r<n?n:r)>i?i:r,e&&a.val(r),this.$(".slider").slider("value",r),this.graphChange(r)}},submitFacet:function(){var e=this.model.get("graphData")[this.$(".slider").slider("value")-1].y;this.trigger("facet-applied","["+e+" TO 9999999]")}})}),define("hbs!js/widgets/facet/graph-facet/templates/year-graph-legend",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<span <span class="s-legend-color refereed"></span> refereed</span>&nbsp;&nbsp;\n<span> <span class="s-legend-color nonrefereed"></span> non refereed</span>\n'},useData:!0});return e.registerPartial("js/widgets/facet/graph-facet/templates/year-graph-legend",t),t}),define("js/widgets/facet/graph-facet/year_graph",["./base_graph","hbs!js/widgets/facet/graph-facet/templates/year-graph-legend","marionette","jquery-ui"],function(e,t,n){return e.extend({bins:10,margin:{top:5,right:0,bottom:20,left:10},id:"year-graph",legendTemplate:t,formatXAxisText:function(e){e.style("text-anchor","end").attr("dx","-.8em").attr("dy","-1.1em").attr("transform",function(){return"rotate(-65)"})},events:{"click .download":"download","click .apply":"submitFacet"},buildGraph:function(){var e,t,i,a,r,s,o,l,c,u=this,d=d3.format("s");e=_.clone(this.model.get("graphData")),e=this.binData(e,this.bins),t=_.pluck(e,"x"),c=d3.max(_.pluck(e,"y")),i=d3.scale.ordinal().domain(t).rangeRoundBands([0,this.width],.1),a=d3.scale.linear().domain([0,c]).range([this.height,0]),r=d3.svg.axis().scale(i).orient("bottom"),s=d3.svg.axis().scale(a).ticks(5).orient("left").tickFormat(function(e){return e>=1&&e%1==0?d(e):""}),o=d3.select(this.el).select(".chart").attr("width",this.fullWidth).attr("height",this.fullHeight).attr("aria-label","limit years graph"),this.innerChart=o.append("g").classed("inner-chart",!0).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),(l=this.innerChart.selectAll("g").data(e).enter().append("g").classed("bar",!0).attr("transform",function(e){return"translate("+i(e.x)+",0)"})).append("rect").classed("full-bar",!0).attr("y",function(e){return a(e.y)}).attr("height",function(e){return u.height-a(e.y)}).attr("width",function(e){return i.rangeBand()*e.width/u.binSize}),l.append("rect").classed("refereed",!0).attr("y",function(e){return a(e.refCount)}).attr("height",function(e){return u.height-a(e.refCount)}).attr("width",function(e){return i.rangeBand()*e.width/u.binSize}),this.innerChart.append("g").classed({axis:!0,"x-axis":!0}).attr("transform","translate(0,"+this.height+")").call(r).selectAll("text").call(this.formatXAxisText),this.innerChart.append("g").classed({axis:!0,"y-axis":!0}).call(s).selectAll("text").style("text-anchor","start"),this.innerChart.append("text").attr("class","s-label").attr("x",this.width/2-20).attr("y",212).text(n.getOption(this,"xAxisTitle")),this.innerChart.append("text").attr("class","s-label").attr("y",-40).attr("x",-this.height/2).attr("transform","rotate(-90)").text(n.getOption(this,"yAxisTitle"))},binData:function(e,t){var n,i,a,r,s,o;if(e.length<=t)return this.binSize=1,e=_.map(e,function(e){return{x:""+e.x,y:e.y,width:1,refCount:e.refCount}});n=void 0,a=Math.floor(e.length/t),this.binSize=a,(i=e.length%t)&&(t+=Math.floor(i/a),(i%=a)&&(n=i)),r=[],s=[],o=[];for(var l=0;l<t;l+=1)r.push(a);return n&&r.push(n),_.each(r,function(t){for(var n=0,i=0,a=[];t>=1;){var r=e[0];a.push(r.x),n+=r.y,i+=r.refCount,e.shift(),t-=1}s.push(a),o.push({totalCount:n,refCount:i})}),s=_.map(s,function(e){return e.length>1?{x:e[0]+"-"+e[e.length-1],width:e.length}:{x:e[0]+"",width:1}}),e=_.map(s,function(e,t){return{x:e.x,y:o[t].totalCount,refCount:o[t].refCount,width:e.width}})},graphChange:function(e,t){var n,i,a,r,s,o,l,c,u=this,d=(n=_.clone(this.model.get("graphData")))[0].x,h=n[n.length-1].x;e!==d||t!==h?this.trigger("facet:active"):this.trigger("facet:inactive"),n=_.filter(n,function(n){return n.x>=e&&n.x<=t}),n=this.binData(n,this.bins),!0===this.sizeSort&&(n=_.sortBy(n,function(e){return e.y})),a=_.pluck(n,"x"),c=d3.max(_.pluck(n,"y")),i=d3.scale.ordinal().domain(a).rangeRoundBands([0,this.width],.1),r=d3.scale.linear().domain([0,c]).range([this.height,0]),s=d3.svg.axis().scale(i).orient("bottom");var p=d3.format("s");o=d3.svg.axis().scale(r).orient("left").tickFormat(function(e){return e>=1&&e%1==0?p(e):""}),(l=this.innerChart.selectAll(".bar").data(n)).exit().remove();var f=l.enter().append("g").classed("bar",!0);f.append("rect").classed("full-bar",!0),f.append("rect").classed("refereed",!0);var m=a.length;l.transition(500).attr("transform",function(e){return"translate("+i(e.x)+",0)"}).delay(function(e,t){return 500*t/m}).select("rect").attr("y",function(e){return r(e.y)}).attr("height",function(e){return u.height-r(e.y)}).attr("width",function(e){return i.rangeBand()*e.width/u.binSize}),l.select(".refereed").transition(500).delay(function(e,t){return 500*t/m}).attr("y",function(e){return r(e.refCount)}).attr("height",function(e){return u.height-r(e.refCount)}).attr("width",function(e){return i.rangeBand()*e.width/u.binSize}),d3.select(this.el).select(".x-axis").call(s).selectAll("text").call(this.formatXAxisText),d3.select(this.el).select(".y-axis").transition().call(o).selectAll("text").style("text-anchor","start")},buildSlider:function(){var e=this,t=_.clone(this.model.get("graphData")),n=t[0].x,i=t[t.length-1].x;this.$(".slider").slider({range:!0,min:n,max:i,values:[n,i],stop:function(t,n){var i=n.values[0],a=n.values[1];e.graphChange(i,a)},slide:function(t,n){var i=n.values[0],a=n.values[1];e.$(".show-slider-data-first").val(i),e.$(".show-slider-data-second").val(a)},create:function(e){var t=$("a",e.target);t.attr("href","javascript:void(0)"),t.first().attr("title","start slider handle").html('<span class="sr-only">start slider handle</span>'),t.last().attr("title","end slider handle").html('<span class="sr-only">end slider handle</span>')}}),this.$(".show-slider-data-first").val(n),this.$(".show-slider-data-second").val(i)},addSliderWindows:function(){this.$(".slider-data").html('Limit results to papers from <br/> <input type="text" class="show-slider-data-first" aria-label="limit papers start year"></input> to <input type="text" class="show-slider-data-second" aria-label="limit papers end year"></input> <button class="apply btn btn-sm btn-primary-faded">Apply</button>')},convertGraphDataToCSV:function(){var e="data:text/csv;charset=utf-8,";return e+="Year, Article Count, Ref Count",this.model.get("graphData").forEach(function(t){e+="\n".concat(t.x,",").concat(t.y,",").concat(t.refCount)}),e},triggerGraphChange:function(e){var t=_.clone(this.model.get("graphData"));if(_.isArray(t)){var n=t[0].x,i=t[t.length-1].x,a=this.$(".show-slider-data-first"),r=this.$(".show-slider-data-second"),s=a.val(),o=r.val();s=s<n?n:s,o=o>i?i:o,s=s>i?o:s,o=(o=o<n?s:o)<(s=s>o?o:s)?s:o,e&&(a.val(s),r.val(o)),this.$(".slider").slider("values",[s,o]),this.graphChange(s,o)}},submitFacet:function(){this.trigger("facet-applied",this.$(".slider").slider("values").join("-"))}})}),define("hbs!js/widgets/alerts/templates/modal_template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'        <i class="icon-danger fa-2x" aria-hidden="true"></i>\n        '},3:function(e,t,n,i){return'\n        <i class="icon-success fa-2x" aria-hidden="true"></i>\n        '},5:function(e,t,n,i){return" "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'\x3c!--html for modal alerts--\x3e\n\n<div class="modal-dialog '+this.escapeExpression("function"==typeof(r=null!=(r=t.type||(null!=e?e.type:e))?r:t.helperMissing)?r.call(e,{name:"type",hash:{},data:i}):r)+'">\n  <div class="modal-content" id="modal-alert-content">\n    <div class="modal-header">\n      <button type="button" class="close" data-dismiss="modal">\n        <span aria-hidden="true">&times;</span\n        ><span class="sr-only">Close</span>\n      </button>\n\n      <h4 class="modal-title" id="alert-modal-label">\n'+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"danger",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"success",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"warning",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+" "+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+'\n      </h4>\n    </div>\n    <div class="modal-body">\n      '+(null!=(a="function"==typeof(r=null!=(r=t.msg||(null!=e?e.msg:e))?r:t.helperMissing)?r.call(e,{name:"msg",hash:{},data:i}):r)?a:"")+'\n    </div>\n    <div class="modal-footer">\n      <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">\n        Close\n      </button>\n    </div>\n  </div>\n</div>\n'},useData:!0});return e.registerPartial("js/widgets/alerts/templates/modal_template",t),t}),define("js/widgets/alerts/modal_view",["marionette","hbs!js/widgets/alerts/templates/modal_template"],function(e,t){return e.ItemView.extend({id:"#alert-modal-content",template:t,showModal:function(){$("#alert-modal").modal("show")},closeModal:function(){$("#alert-modal").modal("hide")},modelEvents:{change:"render"},render:function(){if($("#modal-alert-content").length||($("body").append(function(){var e="";return 0===$("#alert-modal-label").length&&(e+='<div id="alert-modal-label" class="sr-only">Alert</div>'),e+='<div class="modal fade" id="alert-modal" tabindex="-1" role="dialog" aria-labelledby="alert-modal-label" aria-hidden="true"></div>'}),this.setElement($("#alert-modal")[0])),this.model.get("modal"))return"danger"===this.model.get("type")&&console.error("error feedback: ",this.model.get("title"),this.model.get("msg")),e.ItemView.prototype.render.apply(this,arguments)},onRender:function(){this.showModal()}})}),define("hbs!js/widgets/alerts/templates/page_top_alert",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a,r;return'<div class="alert alert-'+this.escapeExpression("function"==typeof(r=null!=(r=t.type||(null!=e?e.type:e))?r:t.helperMissing)?r.call(e,{name:"type",hash:{},data:i}):r)+'" id="page-top-alert">\n  <div>\n    '+(null!=(a="function"==typeof(r=null!=(r=t.msg||(null!=e?e.msg:e))?r:t.helperMissing)?r.call(e,{name:"msg",hash:{},data:i}):r)?a:"")+'\n  </div>\n  <div>\n    <button type="button" class="close">\n      <span aria-hidden="true"\n        ><i class="fa fa-times" aria-hidden="true"></i></span\n      ><span class="sr-only">Close</span>\n    </button>\n  </div>\n</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.msg:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:""},useData:!0});return e.registerPartial("js/widgets/alerts/templates/page_top_alert",t),t}),define("js/widgets/alerts/page_top_alert",["marionette","hbs!js/widgets/alerts/templates/page_top_alert"],function(e,t){return e.ItemView.extend({tagName:"span",className:"alert-banner",template:t,modelEvents:{change:"render"},events:{"click #page-top-alert button.close":"close"},close:function(){this.$(".alert").css("display","none")},render:function(){return this.model.get("modal")?this:this.model.get("msg")||this.model.get("title")?e.ItemView.prototype.render.apply(this,arguments):(this.$el.html(""),this)}})}),define("js/components/alerts",["backbone","js/mixins/hardened"],function(e,t){return{TYPE:{ERROR:"error",INFO:"info",WARNING:"warning",SUCCESS:"success",DANGER:"danger"},ACTION:{CALL_PUBSUB:2,TRIGGER_FEEDBACK:1}}}),define("js/widgets/alerts/widget",["marionette","js/widgets/base/base_widget","js/components/api_query","js/components/api_feedback","js/components/alerts","./modal_view","./page_top_alert","jquery","jquery-ui","bootstrap"],function(e,t,n,i,a,r,s,o,l,c){var u=Backbone.Model.extend({defaults:{type:"info",msg:void 0,title:void 0,events:void 0,modal:!1}});function d(){var e=this,t=this.model.get("events"),n=/^(\S+)\s*(.*)$/;this.$el&&this.$el.off(".customEvents"+this.mid),t&&_.each(t,function(t,i){var a=i.match(n),r=a[1],s=a[2],o=i,l=function(e){var t=this.model.get("promise"),n=this.model.get("events");return n[o]?t.resolve(n[o]):t.resolve(o),this.model.get("modal")||this.model.set("msg",null),!1};l=_.bind(l,e),r+=".customEvents"+this.mid,""===s?e.$el.on(r,l):e.$el.on(r,s,l)})}var h=r.prototype.onRender;r.prototype.onRender=function(){d.apply(this,arguments),h&&h.apply(this,arguments)};var p=s.prototype.onRender;return s.prototype.onRender=function(){d.apply(this,arguments),p&&p.apply(this,arguments)},t.extend({initialize:function(e){this.model=new u,this.view=new s({model:this.model}),this.modalView=new r({model:this.model}),t.prototype.initialize.apply(this,arguments)},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.NAVIGATE,this.modalView.closeModal)},alert:function(e){var t=o.Deferred();return this.model.set({msg:e.msg,events:e.events,title:e.title,type:e.type||"info",modal:e.modal,promise:t}),t.promise()},closeView:function(){this.view.close(),this.modalView.closeModal()}})}),define("hbs!js/widgets/abstract/templates/abstract_template",["hbs/handlebars","hbs!js/wraps/widget/loading/template"],function(e){var t=e.template({1:function(e,t,n,i){return'<a target="prev">prev</a>'},3:function(e,t,n,i){return' <a target="next">next</a>'},5:function(e,t,n,i){var a;return" "+(null!=(a=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?a:"")+" "},6:function(e,t,n,i){var a;return" "+(null!=(a=this.invokePartial(n["js/wraps/widget/loading/template"],e,{name:"js/wraps/widget/loading/template",hash:{widgetLoadingSize:"big",hideCloseButton:!0},data:i,helpers:t,partials:n}))?a:"")+" "},8:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.error:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.program(11,i,0),data:i}))?a:""},9:function(e,t,n,i){return"\n<h2>Error loading abstract</h2>\n"},11:function(e,t,n,i){return'<h2 class="s-abstract-title">Abstract Not Found</h2>\n<div class="s-abstract-text">\n  No valid abstract selected for retrieval or abstract not yet indexed in ADS.\n</div>\n'},13:function(e,t,n,i){var a,r;return'\n\n<h2 class="s-abstract-title">\n  '+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+" "+(null!=(a=t.if.call(e,null!=(a=null!=e?e.titleLink:e)?a.href:a,{name:"if",hash:{},fn:this.program(14,i,0),inverse:this.noop,data:i}))?a:"")+'</h2>\n\n<button\n  class="btn btn-xs btn-default-flat s-toggle-aff print-hidden"\n  id="toggle-aff"\n>\n  Show affiliations\n</button>\n<span id="pending-aff" style="display: none;"\n  ><i class="fa fa-spinner fa-spin" aria-hidden="true"></i\n  ><span class="sr-only">Loading affiliations</span></span\n>\n<span id="fail-aff" class="text-danger" style="display: none;"\n  ><i class="fa fa-times" aria-hidden="true"></i\n  ><span class="sr-only">affiliations loading</span></span\n>\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.authorAff:e)?a.length:a,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.noop,data:i}))?a:"")+'\n<div class="s-abstract-text">\n  <h4 class="sr-only">Abstract</h4>\n  <p>\n    '+(null!=(a=t.if.call(e,null!=e?e.abstract:e,{name:"if",hash:{},fn:this.program(36,i,0),inverse:this.program(38,i,0),data:i}))?a:"")+'  </p>\n</div>\n\n<br />\n<dl class="s-abstract-dl-horizontal">\n'+(null!=(a=t.if.call(e,null!=e?e.pub_raw:e,{name:"if",hash:{},fn:this.program(40,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.book_author:e,{name:"if",hash:{},fn:this.program(42,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.formattedDate:e,{name:"if",hash:{},fn:this.program(47,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.doi:e,{name:"if",hash:{},fn:this.program(49,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.arxiv:e,{name:"if",hash:{},fn:this.program(52,i,0),inverse:this.noop,data:i}))?a:"")+'\n  <dt>Bibcode:</dt>\n  <dd>\n    <button\n      class="btn btn-link copy-btn"\n      style="padding: 0px"\n      id="abs-bibcode-copy"\n      data-clipboard-text="'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'"\n      aria-label="copy bibcode"\n    >\n      '+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'\n      <i\n        class="icon-help"\n        aria-hidden="true"\n        data-toggle="popover"\n        data-container="body"\n        data-content="The bibcode is assigned by the ADS as a unique identifier for the paper."\n      ></i>\n    </button>\n    <span id="abs-bibcode-copy-msg" class="text-info" style="display: none;"\n      >Copied!</span\n    >\n  </dd>\n\n'+(null!=(a=t.if.call(e,null!=e?e.keyword:e,{name:"if",hash:{},fn:this.program(54,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.comment:e,{name:"if",hash:{},fn:this.program(60,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.pubnote:e,{name:"if",hash:{},fn:this.program(62,i,0),inverse:this.noop,data:i}))?a:"")+'</dl>\n<br />\n<a\n  class="small pull-right text-faded"\n  href="/feedback/correctabstract?bibcode='+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'"\n  title="Provide feedback or suggest corrections"\n>\n  <span class="fa-stack">\n    <i class="fa fa-comment-o fa-stack-2x" aria-hidden="true"></i>\n    <i class="fa fa-exclamation fa-stack-1x" aria-hidden="true"></i>\n  </span>\n  Feedback/Corrections?\n</a>\n\n'},14:function(e,t,n,i){var a;return'\n  <a href="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.titleLink:e)?a.href:a,e))+'">'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.titleLink:e)?a.text:a,e))+"</a>\n"},16:function(e,t,n,i){var a;return" "+(null!=(a=t.if.call(e,null!=e?e.hasMoreAuthors:e,{name:"if",hash:{},fn:this.program(17,i,0),inverse:this.noop,data:i}))?a:"")+'\n<div id="authors-and-aff" class="s-authors-and-aff">\n  <ul class="list-inline">\n'+(null!=(a=t.each.call(e,null!=e?e.authorAff:e,{name:"each",hash:{},fn:this.program(19,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.hasMoreAuthors:e,{name:"if",hash:{},fn:this.program(32,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.each.call(e,null!=e?e.authorAffExtra:e,{name:"each",hash:{},fn:this.program(34,i,0),inverse:this.noop,data:i}))?a:"")+"  </ul>\n</div>\n"},17:function(e,t,n,i){return'\n<button\n  class="btn btn-xs btn-default-flat s-toggle-authors print-hidden"\n  id="toggle-more-authors"\n>\n  Show all authors\n</button>\n'},19:function(e,t,n,i){var a;return'    <li class="author">\n      <a href="search/q=author:'+this.escapeExpression(this.lambda(null!=e?e[5]:e,e))+'&sort=date%20desc,%20bibcode%20desc">\n        '+this.escapeExpression(this.lambda(null!=e?e[0]:e,e))+"\n      </a>\n      <span>\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e[2]:e,"-",{name:"compare",hash:{operator:"!=="},fn:this.program(20,i,0),inverse:this.program(22,i,0),data:i}))?a:"")+'\n      </span>\n      <span class="affiliation hide"> (<i>'+this.escapeExpression(this.lambda(null!=e?e[1]:e,e))+"</i>)</span>"+(null!=(a=t.if.call(e,i&&i.last,{name:"if",hash:{},fn:this.program(28,i,0),inverse:this.program(30,i,0),data:i}))?a:"")+"\n    </li>\n    "},20:function(e,t,n,i){return'        <a\n          class="orcid-author"\n          href="search/q=orcid:'+this.escapeExpression(this.lambda(null!=e?e[2]:e,e))+'&sort=date%20desc,%20bibcode%20desc"\n        >\n          <img\n            class="inactive"\n            src="../../styles/img/orcid-inactive.svg"\n            alt="search by orcid"\n          />\n          <img\n            class="active hidden"\n            src="../../styles/img/orcid-active.svg"\n            alt="search by orcid"\n          />\n        </a>\n        '},22:function(e,t,n,i){var a;return" "+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e[3]:e,"-",{name:"compare",hash:{operator:"!=="},fn:this.program(23,i,0),inverse:this.program(25,i,0),data:i}))?a:"")+" "},23:function(e,t,n,i){return'\n        <a\n          class="orcid-author"\n          href="search/q=orcid:'+this.escapeExpression(this.lambda(null!=e?e[3]:e,e))+'&sort=date%20desc,%20bibcode%20desc"\n        >\n          <img\n            class="inactive"\n            src="../../styles/img/orcid-inactive.svg"\n            alt="search by orcid"\n          />\n          <img\n            class="active hidden"\n            src="../../styles/img/orcid-active.svg"\n            alt="search by orcid"\n          />\n        </a>\n        '},25:function(e,t,n,i){var a;return" "+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e[4]:e,"-",{name:"compare",hash:{operator:"!=="},fn:this.program(26,i,0),inverse:this.noop,data:i}))?a:"")+" "},26:function(e,t,n,i){return'\n        <a\n          class="orcid-author"\n          href="search/q=orcid:'+this.escapeExpression(this.lambda(null!=e?e[4]:e,e))+'&sort=date%20desc,%20bibcode%20desc"\n        >\n          <img\n            class="inactive"\n            src="../../styles/img/orcid-inactive.svg"\n            alt="search by orcid"\n          />\n          <img\n            class="active hidden"\n            src="../../styles/img/orcid-active.svg"\n            alt="search by orcid"\n          />\n        </a>\n        '},28:function(e,t,n,i){return""},30:function(e,t,n,i){return";"},32:function(e,t,n,i){return'\n    <li class="author">\n      ;\n      <span class="extra-dots">\n        <a data-target="more-authors" title="Show all authors">...</a>\n      </span>\n    </li>\n    '},34:function(e,t,n,i){var a;return'\n\n    <li class="author extra hide">\n      <a href="search/q=author:'+this.escapeExpression(this.lambda(null!=e?e[5]:e,e))+'&sort=date%20desc,%20bibcode%20desc">\n        '+this.escapeExpression(this.lambda(null!=e?e[0]:e,e))+"\n      </a>\n      <span>\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e[2]:e,"-",{name:"compare",hash:{operator:"!=="},fn:this.program(20,i,0),inverse:this.program(22,i,0),data:i}))?a:"")+'\n      </span>\n      <span class="affiliation hide"> (<i>'+this.escapeExpression(this.lambda(null!=e?e[1]:e,e))+"</i>)</span>"+(null!=(a=t.if.call(e,i&&i.last,{name:"if",hash:{},fn:this.program(28,i,0),inverse:this.program(30,i,0),data:i}))?a:"")+"\n    </li>\n"},36:function(e,t,n,i){var a,r;return" "+(null!=(a="function"==typeof(r=null!=(r=t.abstract||(null!=e?e.abstract:e))?r:t.helperMissing)?r.call(e,{name:"abstract",hash:{},data:i}):r)?a:"")+" "},38:function(e,t,n,i){return"\n    <i>No abstract</i>\n"},40:function(e,t,n,i){var a,r;return'  <dt>Publication:</dt>\n  <dd>\n    <div id="article-publication">'+(null!=(a="function"==typeof(r=null!=(r=t.pub_raw||(null!=e?e.pub_raw:e))?r:t.helperMissing)?r.call(e,{name:"pub_raw",hash:{},data:i}):r)?a:"")+"</div>\n  </dd>\n  "},42:function(e,t,n,i){var a;return"\n  <dt>\n    Book Author"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.book_author:e)?a.length:a,1,{name:"compare",hash:{operator:">"},fn:this.program(43,i,0),inverse:this.noop,data:i}))?a:"")+":\n  </dt>\n  <dd>\n    "+(null!=(a=t.each.call(e,null!=e?e.book_author:e,{name:"each",hash:{},fn:this.program(45,i,0),inverse:this.noop,data:i}))?a:"")+"\n  </dd>\n  "},43:function(e,t,n,i){return"(s)"},45:function(e,t,n,i){var a;return'<a href="'+this.escapeExpression("function"==typeof(a=null!=(a=t.href||(null!=e?e.href:e))?a:t.helperMissing)?a.call(e,{name:"href",hash:{},data:i}):a)+'">'+this.escapeExpression("function"==typeof(a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing)?a.call(e,{name:"name",hash:{},data:i}):a)+"</a>"+this.escapeExpression("function"==typeof(a=null!=(a=t.delim||(null!=e?e.delim:e))?a:t.helperMissing)?a.call(e,{name:"delim",hash:{},data:i}):a)},47:function(e,t,n,i){var a;return"\n  <dt>Pub Date:</dt>\n  <dd>"+this.escapeExpression("function"==typeof(a=null!=(a=t.formattedDate||(null!=e?e.formattedDate:e))?a:t.helperMissing)?a.call(e,{name:"formattedDate",hash:{},data:i}):a)+"</dd>\n  "},49:function(e,t,n,i){var a;return"\n  <dt>DOI:</dt>\n  <dd>\n"+(null!=(a=t.each.call(e,null!=e?e.doi:e,{name:"each",hash:{},fn:this.program(50,i,0),inverse:this.noop,data:i}))?a:"")+"  </dd>\n  "},50:function(e,t,n,i){var a;return'    <p class="doi-p">\n      <a\n        data-target="DOI"\n        href="'+this.escapeExpression("function"==typeof(a=null!=(a=t.href||(null!=e?e.href:e))?a:t.helperMissing)?a.call(e,{name:"href",hash:{},data:i}):a)+'"\n        target="_blank"\n        rel="noreferrer noopener"\n        >'+this.escapeExpression("function"==typeof(a=null!=(a=t.doi||(null!=e?e.doi:e))?a:t.helperMissing)?a.call(e,{name:"doi",hash:{},data:i}):a)+'</a\n      >\n      <i class="fa fa-external-link" aria-hidden="true"></i>\n    </p>\n'},52:function(e,t,n,i){var a;return'\n  <dt>arXiv:</dt>\n  <dd>\n    <span>\n      <a\n        data-target="arXiv"\n        href="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.arxiv:e)?a.href:a,e))+'"\n        target="_blank"\n        rel="noreferrer noopener"\n        >'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.arxiv:e)?a.id:a,e))+'</a\n      >\n      <i class="fa fa-external-link" aria-hidden="true"></i>\n    </span>\n  </dd>\n'},54:function(e,t,n,i){var a;return'  <dt>Keywords:</dt>\n  <dd>\n    <ul class="list-inline">\n      '+(null!=(a=t.each.call(e,null!=e?e.keyword:e,{name:"each",hash:{},fn:this.program(55,i,0),inverse:this.noop,data:i}))?a:"")+"\n    </ul>\n  </dd>\n  "},55:function(e,t,n,i){var a;return" "+(null!=(a=t.if.call(e,i&&i.last,{name:"if",hash:{},fn:this.program(56,i,0),inverse:this.program(58,i,0),data:i}))?a:"")+" "},56:function(e,t,n,i){var a;return"\n      <li>"+(null!=(a=this.lambda(e,e))?a:"")+"</li>\n"},58:function(e,t,n,i){var a;return"      <li>"+(null!=(a=this.lambda(e,e))?a:"")+";</li>\n      "},60:function(e,t,n,i){var a,r;return"\n  <dt>Comments:</dt>\n  <dd>\n    "+(null!=(a="function"==typeof(r=null!=(r=t.comment||(null!=e?e.comment:e))?r:t.helperMissing)?r.call(e,{name:"comment",hash:{},data:i}):r)?a:"")+"\n  </dd>\n  "},62:function(e,t,n,i){var a;return"\n  <dt>E-Print Comments:</dt>\n  <dd>\n    "+this.escapeExpression("function"==typeof(a=null!=(a=t.pubnote||(null!=e?e.pubnote:e))?a:t.helperMissing)?a.call(e,{name:"pubnote",hash:{},data:i}):a)+"\n  </dd>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'\x3c!--<div id="article-navigation">'+(null!=(a=t.if.call(e,null!=e?e.hasPrev:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"|"+(null!=(a=t.if.call(e,null!=e?e.hasNext:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"</div>--\x3e\n\n"+(null!=(a=t.unless.call(e,null!=e?e.bibcode:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.program(13,i,0),data:i}))?a:"")},usePartial:!0,useData:!0});return e.registerPartial("js/widgets/abstract/templates/abstract_template",t),t}),define("js/widgets/abstract/widget",["marionette","js/components/api_request","js/components/api_targets","clipboard","backbone","jquery","underscore","cache","js/widgets/base/base_widget","hbs!js/widgets/abstract/templates/abstract_template","js/components/api_query","js/mixins/link_generator_mixin","js/mixins/papers_utils","mathjax","bootstrap","utils","analytics"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,m,g){var b=a.Model.extend({defaults:function(){return{abstract:void 0,title:void 0,authorAff:void 0,page:void 0,pub:void 0,pubdate:void 0,keywords:void 0,bibcode:void 0,pub_raw:void 0,doi:void 0,citation_count:void 0,titleLink:void 0,pubnote:void 0,loading:!0,error:!1}},parse:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=function(t){return d.createUrlByType(e.bibcode,"doi",t)};e.doi=Array.isArray(e.doi)?e.doi.map(function(e){return{doi:e,href:n(e)}}):e.doi?[{doi:e.doi,href:n(e.doi)}]:e.doi,e.aff=Array.isArray(e.aff)?e.aff:[],e.author=Array.isArray(e.author)?e.author:[],e.aff=e.aff.map(s.unescape);var i=e.author.length,a=s.range(i).map(function(){return"-"});if(e.aff.length?(e.hasAffiliation=s.without(e.aff,"-").length,e.authorAff=s.zip(e.author,e.aff,e.orcid_pub?e.orcid_pub:a,e.orcid_user?e.orcid_user:a,e.orcid_other?e.orcid_other:a)):e.author&&(e.hasAffiliation=!1,e.authorAff=s.zip(e.author,s.range(e.author.length),e.orcid_pub?e.orcid_pub:a,e.orcid_user?e.orcid_user:a,e.orcid_other?e.orcid_other:a)),e.page&&e.page.length&&(e.page=e.page[0]),e.authorAff&&(s.each(e.authorAff,function(t,n){e.authorAff[n][5]=encodeURIComponent('"'+t[0]+'"').replace(/%20/g,"+")}),e.authorAff.length>t&&(e.authorAffExtra=e.authorAff.slice(t,e.authorAff.length),e.authorAff=e.authorAff.slice(0,t)),e.hasMoreAuthors=e.authorAffExtra&&e.authorAffExtra.length),e.pubdate&&(e.formattedDate=h.formatDate(e.pubdate,{format:"MMMM DD YYYY",missing:{day:"MMMM YYYY",month:"YYYY"}})),e.title&&e.title.length){e.title=e.title[0];var r=e.title.match(/<a.*href="(.*?)".*?>(.*)<\/a>/i);r&&(e.title=e.title.replace(r[0],"").trim(),e.titleLink={href:r[1],text:r[2]},e.titleLink.href.match(/^\/abs/)&&(e.titleLink.href="#"+e.titleLink.href.slice(1)))}e.comment&&(e.comment=s.unescape(e.comment)),e.pubnote&&(e.pubnote=s.unescape(e.pubnote)),e.book_author&&Array.isArray(e.book_author)&&e.book_author.length>0&&(e.book_author=e.book_author.map(function(t,n){return{name:t,href:'#search?q=book_author:"'.concat(t,'"&sort=date%20desc,%20bibcode%20desc'),delim:n<e.book_author.length-1?"; ":""}}));var o=((Array.isArray(e.identifier)?e.identifier:e.original_identifier)||[]).find(function(e){return e.match(/^arxiv/i)});return o&&(e.arxiv={id:o,href:d.createUrlByType(e.bibcode,"arxiv",o.split(":")[1])}),e}}),v=e.ItemView.extend({tagName:"article",className:"s-abstract-metadata",modelEvents:{change:"render"},template:c,events:{"click #toggle-aff":"toggleAffiliation","click #toggle-more-authors":"toggleMoreAuthors",'click a[data-target="more-authors"]':"toggleMoreAuthors",'click a[target="prev"]':"onClick",'click a[target="next"]':"onClick",'click a[data-target="DOI"]':"emitAnalytics",'click a[data-target="arXiv"]':"emitAnalytics","mouseenter .orcid-author":"highlightOrcidAuthor","mouseleave .orcid-author":"unhighlightOrcidAuthor"},highlightOrcidAuthor:function(e){var t=r(e.currentTarget),n=t.find(".active");n.hasClass("hidden")&&(n.removeClass("hidden"),t.find(".inactive").addClass("hidden"))},unhighlightOrcidAuthor:function(e){var t=r(e.currentTarget),n=t.find(".inactive");n.hasClass("hidden")&&(n.removeClass("hidden"),t.find(".active").addClass("hidden"))},toggleMoreAuthors:function(){return this.$(".author.extra").toggleClass("hide"),this.$(".author .extra-dots").toggleClass("hide"),this.$(".author.extra").hasClass("hide")?this.$("#toggle-more-authors").text("Show all authors"):this.$("#toggle-more-authors").text("Hide authors"),!1},toggleAffiliation:function(){var e=this;return this.$("fail-aff").hide(),this.$("#pending-aff").show(),this.trigger("fetchAffiliations",function(t){if(e.$("#pending-aff").hide(),t)return e.$("#fail-aff").show(),void setTimeout(function(){e.$("#fail-aff").hide()},3e3);e.$(".affiliation").toggleClass("hide"),e.$(".affiliation").hasClass("hide")?e.$("#toggle-aff").text("Show affiliations"):e.$("#toggle-aff").text("Hide affiliations")}),!1},onClick:function(e){return this.trigger(r(e.target).attr("target")),!1},emitAnalytics:function(e){g("send","event","interaction","abs-full-text-link-followed",e.target.dataset.target)},copyBibcode:function(){this.bibcodeClipboard||(this.bibcodeClipboard=new i("#abs-bibcode-copy"),this.bibcodeClipboard.on("success",function(){r("#abs-bibcode-copy-msg").show().fadeOut(1e3)}))},onRender:function(){this.$(".icon-help").popover({trigger:"hover",placement:"right",html:!0,container:"body"}),p&&(p.Hub.Queue(["Typeset",p.Hub,this.$(".s-abstract-title",this.el).get(0)]),p.Hub.Queue(["Typeset",p.Hub,this.$(".s-abstract-text",this.el).get(0)])),this.copyBibcode()}});return l.extend({initialize:function(e){e=e||{},this.model=e.data?new b(e.data,{parse:!0}):new b,this.view=m.withPrerenderedContent(new v({model:this.model})),this.listenTo(this.view,"all",this.onAllInternalEvents),l.prototype.initialize.apply(this,arguments),this._docs={},this.maxAuthors=20,this.isFetchingAff=!1},activate:function(e){this.setBeeHive(e),this.activateWidget(),this.attachGeneralHandler(this.onApiFeedback);var t=e.getService("PubSub");s.bindAll(this,["onNewQuery","dispatchRequest","processResponse","onDisplayDocuments"]),t.subscribe(t.START_SEARCH,this.onNewQuery),t.subscribe(t.INVITING_REQUEST,this.dispatchRequest),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),t.subscribe(t.DISPLAY_DOCUMENTS,this.onDisplayDocuments)},onApiFeedback:function(e){e&&e.error&&(this.showError(),this.updateState(this.STATES.ERRORED))},defaultQueryArguments:{fl:"identifier,[citations],abstract,author,book_author,orcid_pub,orcid_user,orcid_other,bibcode,citation_count,comment,doi,id,keyword,page,property,pub,pub_raw,pubdate,pubnote,read_count,title,volume",rows:1},mergeStashedDocs:function(e){s.each(e,function(e){this._docs[e.bibcode]||(this._docs[e.bibcode]=this.model.parse(e))},this)},onNewQuery:function(e){var t=e.toJSON(),n=s.pick(this.getCurrentQuery().toJSON(),s.keys(t));JSON.stringify(t)!==JSON.stringify(n)&&(this._docs={})},dispatchRequest:function(e){this.setCurrentQuery(e),l.prototype.dispatchRequest.apply(this,arguments)},displayBibcode:function(e){if(!s.isEmpty(this._docs)){this.model.clear({silent:!0}),this.model.set(this._docs[e]),this._current=e;var t=this._docs[e]["[citations]"]||{num_citations:0,num_references:0},n=t?t.num_citations:0;if(this.trigger("page-manager-event","broadcast-payload",{title:this._docs[e].title,abstract:this._docs[e].abstract,bibcode:e,citation_discrepancy:this._docs[e].citation_count-n,citation_count:this._docs[e].citation_count,references_count:t.num_references,read_count:this._docs[e].read_count,property:this._docs[e].property}),this.hasPubSub()){var i=this.getPubSub();i.publish(i.CUSTOM_EVENT,"update-document-title",this._docs[e].title),i.publish(i.CUSTOM_EVENT,"latest-abstract-data",this._docs[e])}this.updateState(this.STATES.IDLE)}},onAbstractPage:function(){return/\/abstract$/.test(a.history.getFragment())},onDisplayDocuments:function(e){this.updateState(this.STATES.LOADING);var t=[];try{t=this.getBeeHive().getObject("DocStashController").getDocs()}catch(e){t=[]}finally{this.mergeStashedDocs(t)}var n=this.parseIdentifierFromQuery(e);if("null"===n){return this.showError({noDocs:!0}),void this.trigger("page-manager-event","widget-ready",{numFound:0,noDocs:!0})}if(this._docs[n])this.displayBibcode(n);else{if(e.has("__show"))return;var i=e.clone();i.set("__show",n),this.dispatchRequest(i)}},onAllInternalEvents:function(e,t){if(("next"===e||"prev"===e)&&this._current){var n=s.keys(this._docs),i=this.getPubSub(),a=s.indexOf(n,this._current);a>-1&&("next"===e&&a+1<n.length?i.publish(i.DISPLAY_DOCUMENTS,n[a+1]):a-1>0&&i.publish(i.DISPLAY_DOCUMENTS,n[a-1]))}"fetchAffiliations"===e&&this.fetchAffiliations(t)},fetchAffiliations:function(e){var i=this;if(this.model.has("aff")&&0!==this.model.get("aff").length||this.isFetchingAff)e();else{this.isFetchingAff=!0;var a=this.getPubSub(),r=this.getCurrentQuery().clone();r.unlock();var s=this.model.toJSON(),o=s.bibcode,l=s.author,c=s.orcid_pub,u=s.orcid_user,d=s.orcid_other;r.set("q","identifier:".concat(o)),r.set("fl",["aff","orcid_pub","orcid_user","orcid_other"]),r.set("rows",1),a.publish(a.EXECUTE_REQUEST,new t({target:n.SEARCH,query:r,options:{always:function(){i.isFetchingAff=!1},done:function(t){if(t&&t.response&&t.response.docs&&t.response.docs.length>0){var n=i.model.parse({author:l,orcid_pub:c,orcid_user:u,orcid_other:d,aff:t.response.docs[0].aff});i._docs[o]=_objectSpread(_objectSpread({},i._docs[o]),n),i.model.set(n)}e()},fail:function(t){e(t)}}}))}},processResponse:function(e){var t=e.toJSON(),n=this;if(t.response&&t.response.docs){var i=t.response.docs,a=e.get("responseHeader.params.__show",!1,"");s.each(i,function(e){var t=n.model.parse(e,n.maxAuthors),r=t.identifier;a&&(r&&r.length>0&&s.contains(r,a)||1===i.length)&&(a=t.bibcode),n._docs[t.bibcode]=t}),a&&this.displayBibcode(a)}var r={};r.numFound=e.get("response.numFound",!1,0),0===r.numFound&&(this.showError({noDocs:!0}),r.noDocs=!0),this.trigger("page-manager-event","widget-ready",r)},showError:function(e){var t=e||{};this.model.set({error:!t.noDocs,loading:!1})}})}),define("hbs!js/widgets/api_query/templates/widget-view",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div id="api-query" class="well well-small">\n    <h5>Query Inspection</h5>\n    <form>\n        <input type="text" placeholder="Copy&Paste serialized query here" id="api-query-input" value="'+this.escapeExpression("function"==typeof(a=null!=(a=t.initialValue||(null!=e?e.initialValue:e))?a:t.helperMissing)?a.call(e,{name:"initialValue",hash:{},data:i}):a)+'"/>\n        <button id="api-query-load">Load</button>\n        <button id="api-query-add">Add</button>\n        <button id="api-query-run">Run</button>\n\n    <table id="api-query-values">\n\n    </table>\n\n    Result: <pre id="api-query-result"></pre>\n    </form>\n</div>'},useData:!0});return e.registerPartial("js/widgets/api_query/templates/widget-view",t),t}),define("hbs!js/widgets/api_query/templates/item-view",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<td class="key"><input type="text" name="key" value="'+this.escapeExpression("function"==typeof(a=null!=(a=t.key||(null!=e?e.key:e))?a:t.helperMissing)?a.call(e,{name:"key",hash:{},data:i}):a)+'"/></td>\n<td class="value"><input type="text" name="value" value="'+this.escapeExpression("function"==typeof(a=null!=(a=t.value||(null!=e?e.value:e))?a:t.helperMissing)?a.call(e,{name:"value",hash:{},data:i}):a)+'"/></td>\n<td> <a class="remove">remove</a></td>'},useData:!0});return e.registerPartial("js/widgets/api_query/templates/item-view",t),t}),define("js/widgets/api_query/widget",["underscore","jquery","backbone","marionette","js/components/api_query","js/components/pubsub_events","hbs!js/widgets/api_query/templates/widget-view","hbs!js/widgets/api_query/templates/item-view","js/mixins/dependon"],function(e,t,n,i,a,r,s,o,l){var c=n.Model.extend({}),u=n.Collection.extend({model:c}),d=i.ItemView.extend({tagName:"tr",template:o,events:{"click .remove":"removeItem","blur input[name=key]":"onChange","blur input[name=value]":"onChange"},onChange:function(n){var i=t(n.target),a=e.clone(this.model.attributes),r=t(n.target).val();"key"==i.attr("name")&&a.key!=r?this.trigger("key-changed",this.model,r):"value"==i.attr("name")&&a.value!=r&&this.trigger("value-changed",this.model,r)},removeItem:function(e){return this.trigger("remove-clicked",this.model),!1}}),h=i.CompositeView.extend({template:s,childView:d,childViewContainer:"#api-query-values",events:{"click button#api-query-load":"loadApiQuery","click button#api-query-add":"addNewItem","click button#api-query-run":"runApiQuery","submit form":"loadApiQuery"},addNewItem:function(e){return this.trigger("add-new-item",this),!1},loadApiQuery:function(t){var n=this.$el.find("input#api-query-input").val();return n&&e.isString(n)&&n.trim().length>0&&this.trigger("load-api-query",n),!1},runApiQuery:function(t){var n=new a;return e.map(this.collection.models,function(e){var t=e.attributes;t.key&&n.set(t.key,t.value.split("|"))}),this.$el.find("#api-query-result").text(n.url()),this.trigger("run-api-query",n),!1},updateInputBox:function(e){this.$el.find("input#api-query-input").val(e)},removeKey:function(e){this.trigger("remove-key",e)}}),p=i.Controller.extend({initialize:function(e){return e&&e instanceof a||(e=new a),this.collection=new u(this.getData(e)),this.view=new h({collection:this.collection,model:new c({initialValue:e.url()||"q=planet"})}),this.listenTo(this.view,"all",this.onAll),this},render:function(){return this.view.render(),this.view},onLoad:function(e){this.collection?this.collection.reset(this.getData(e)):this.initialize(e)},onAll:function(){var e=arguments[0];"childview:remove-clicked"==e?arguments[2].destroy():"childview:key-changed"==e?arguments[2].set("key",arguments[3]):"childview:value-changed"==e?arguments[2].set("value",arguments[3]):"add-new-item"==e?arguments[1].collection.add({key:"",value:""}):"load-api-query"==e?this.onLoad(arguments[1]):"run-api-query"==e&&(this.view.updateInputBox(arguments[1].url()),this.onRun(arguments[1]))},getData:function(t){if(!t)throw Error("Wrong input!");return e.isString(t)&&(t=(new a).load(t)),e.map(t.pairs(),function(e){return{key:e[0],value:e[1].join("|")}})},activate:function(t){this.setBeeHive(t),this.getPubSub().subscribe("all",e.bind(this.onAllPubSub,this))},onAllPubSub:function(){var e=arguments[0];e!=r.START_SEARCH&&e!=r.INVITING_REQUEST||(console.log("[debug:ApiQueryWidget]",arguments[0]),this.view.updateInputBox(arguments[1].url()))},onRun:function(e){this.hasPubSub()&&this.getPubSub().publish(this.getPubSub().START_SEARCH,e)}});return e.extend(p.prototype,l.BeeHive),p}),define("hbs!js/widgets/bubble_chart/templates/container",["hbs/handlebars","hbs!js/wraps/widget/loading/template"],function(e){var t=e.template({1:function(e,t,n,i){var a;return" "+(null!=(a=this.invokePartial(n["js/wraps/widget/loading/template"],e,{name:"js/wraps/widget/loading/template",hash:{hideCloseButton:!0,widgetLoadingSize:"medium"},data:i,helpers:t,partials:n}))?a:"")+" "},3:function(e,t,n,i){return'\n  <svg\n    class="s-bubble-chart-svg bubble-chart-svg"\n    viewBox="0 0 1160 550"\n    preserveAspectRatio="xMinYMin meet"\n  ></svg>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div>\n  <div class="col-xs-12 s-explore-close-container">\n    <div class="s-large-close close-widget close">x</div>\n  </div>\n  <header class="s-network-title">\n    <h3>Results Graph</h3>\n    <button class="btn btn-link download s-download hidden">\n      <i\n        class="fa fa-download fa-2x"\n        aria-hidden="true"\n        title="download data in csv"\n      ></i>\n      <span class="sr-only">download data in csv</span>\n    </button>\n  </header>\n</div>\n<div class="s-bubble-label-container">\n  <div class="graph-select reads-vs-time active">\n    <img src="../../../styles/img/reads_vs_time.png" alt="" />\n  </div>\n  <div class="graph-select citations-vs-time">\n    <img src="../../styles/img/citations_vs_time.png" alt="" />\n  </div>\n  <div class="graph-select reads-vs-citations">\n    <img src="../../styles/img/reads_vs_citations.png" alt="" />\n  </div>\n</div>\n\n<div class="s-bubble-graph-container bubble-graph-container">\n  <div class="d3-tooltip"></div>\n  '+(null!=(a=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+'</div>\n\n<div class="controls s-controls print-hidden">\n  <div>\n    <h6>What is the Paper Graph?</h6>\n    This graph allows you to view metrics for both the long-term influence\n    (citation count) and recent popularity (90 day read count) of the top 1500\n    papers from your search results.\n  </div>\n  <div>\n    <h6>Customize Graph</h6>\n    * Click on a journal name at right to limit papers (click again to return to\n    the unfiltered view)<br />\n    * Click on the y axis log/linear options <br />\n    * Click below to swap y axis and bubble radius <br />\n    * Click on a paper bubble to outline it for tracking purposes throughout the\n    three graphs\n  </div>\n  <div>\n    <h6>Filter Your Search</h6>\n    Select papers by dragging from left to right around bubbles to form a box,\n    then click submit\n    <button class="btn btn-success submit disabled">\n      Submit <i class="icon-go" aria-hidden="true"></i>\n    </button>\n  </div>\n\n  <a id="download-link" class="hidden"></a>\n</div>\n'},usePartial:!0,useData:!0});return e.registerPartial("js/widgets/bubble_chart/templates/container",t),t}),define("hbs!js/widgets/bubble_chart/templates/tooltip",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return"<h5>"+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+"</h5>\n("+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+")</br>\nCitations: <b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+"</b>,\nReads: <b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.read_count||(null!=e?e.read_count:e))?a:t.helperMissing)?a.call(e,{name:"read_count",hash:{},data:i}):a)+"</b><br/>\n"},3:function(e,t,n,i){var a;return'<div class="pull-right">\n  <span class="s-text-bold s-text-italics">..and '+this.escapeExpression("function"==typeof(a=null!=(a=t.extra||(null!=e?e.extra:e))?a:t.helperMissing)?a.call(e,{name:"extra",hash:{},data:i}):a)+" more</span>\n</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return(null!=(a=t.each.call(e,null!=e?e.bibs:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.extra:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return e.registerPartial("js/widgets/bubble_chart/templates/tooltip",t),t}),define("js/widgets/bubble_chart/widget",["d3","marionette","js/widgets/base/base_widget","js/components/api_request","hbs!js/widgets/bubble_chart/templates/container","hbs!js/widgets/bubble_chart/templates/tooltip","js/components/api_targets","js/components/api_query_updater","js/components/api_query"],function(e,t,n,i,a,r,s,o,l){var c=Backbone.Model.extend({initialize:function(e){var t=this;this.on("change:solrData",function(){_.isEmpty(t.get("solrData"))?t.reset(!1):(t.set("loading",!1),t.modifyData())})},modifyData:function(){var e,t;if(!_.isEmpty(this.get("solrData"))){var n=[];_.each(this.get("solrData"),function(e,t){try{e.pubdate=e.pubdate.replace(/(\D)00/g,function(e,t){return t+"01"}),e.date=new Date(e.pubdate),e.year=parseInt(e.bibcode.slice(0,4)),e.citation_count=e.citation_count?e.citation_count:0,e.read_count=e.read_count?e.read_count:0,e.title=e.title?e.title[0]:"",e.pub=e.bibcode.slice(4,9).replace(/\./g,""),n.push(e)}catch(t){console.warn(e,"didn't get added to bibcode list for some reason")}}),e=_.chain(n).pluck("pub").countBy(function(e){return e}).pairs().sortBy(function(e){return e[1]}).value().reverse();var i=0;_.each(e.slice(0,5),function(e){i+=e[1]}),i/n.length>=.25?(t=_.map(e,function(e){return e[0]}).slice(0,5),i/n.length<1&&t.push("other"),this.set("journalNames",t)):this.set("journalNames",[]),this.set("modifiedSolrData",n)}},reset:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.set(this.defaults(),{silent:e})},toggleTracked:function(e){var t=this.get("trackingBibs");_.contains(t,e)?this.set("trackingBibs",_.without(t,e)):(t.push(e),this.set("trackingBibs",t))},defaults:function(){return{solrData:{},modifiedSolrData:[],currentGraphData:{},yScale:"log",xScale:"linear",yLogPossible:!0,xLogPossible:!1,xValue:"date",yValue:"read_count",radius:"citation_count",journalNames:[],trackingBibs:[],selectedBibs:[],timeRange:"year",currentPub:void 0,loading:!0}}}),u=t.ItemView.extend({className:"bubble-chart s-bubble-chart",template:a,reset:function(){this.scales={},this.cache={}},modelEvents:{"change:modifiedSolrData":"render","change:currentPub":"rearrangeGraph","change:yScale":"rearrangeGraph","change:xScale":"rearrangeGraph","change:selectedBibs":"manageSubmitButton"},events:{"click .graph-select":function(e){var t=$(e.currentTarget);this.$(".graph-select").removeClass("active"),t.hasClass("reads-vs-time")?this.model.set({radius:"citation_count",xScale:"linear",xValue:"date",yValue:"read_count",yScale:"log"},{silent:!0}):t.hasClass("citations-vs-time")?this.model.set({radius:"read_count",xValue:"date",xScale:"linear",yValue:"citation_count",yScale:"log"},{silent:!0}):t.hasClass("reads-vs-citations")&&this.model.set({radius:"year",yValue:"read_count",xValue:"citation_count",xScale:"log"},{silent:!0}),this.rearrangeGraph(),t.addClass("active")},"click .submit":function(){this.trigger("filterBibs",this.model.get("selectedBibs"))},"click .download":function(){var e=this.model.get("modifiedSolrData"),t="data:text/csv;charset=utf-8,",n=Object.keys(e[0]);t+=n.join(",")+"\n",e.forEach(function(e){n.forEach(function(n){t+='"'.concat("title"===n?e[n].replace(/"/g,"'"):e[n],'",')}),t=t.slice(0,-1)+"\n"});var i=encodeURI(t),a=document.getElementById("download-link");a.setAttribute("download","results.csv"),a.setAttribute("href",i),a.click()},"click .close":function(){this.trigger("close-widget")}},getConfig:function(){this.config={},this.config.margin={left:80,bottom:40,right:20,top:60},this.config.height=500-(this.config.margin.top+this.config.margin.bottom),this.config.width=1e3-(this.config.margin.left+this.config.margin.right),this.config.animationLength=t.getOption(this,"testing")?0:500},cacheVals:function(){this.cache={},this.cache.svg=e.select(this.$("svg.bubble-chart-svg")[0]).append("g").attr("transform","translate("+this.config.margin.left+","+this.config.margin.top+")"),this.cache.realSvg=e.select(this.$("svg.bubble-chart-svg")[0]),this.cache.tooltip=e.select(this.$(".d3-tooltip")[0])},setScales:function(){this.scales={};var t,n,i,a=this.model.get("currentGraphData"),r=this,s=[];if(this.model.get("journalNames").length&&(this.scales.journalScale=e.scale.ordinal().domain(this.model.get("journalNames")).range(["hsla(282, 80%, 52%, 1)","hsla(1, 80%, 51%, 1)","hsla(152, 80%, 40%, 1)","hsla(193, 80%, 48%, 1)","hsla(220, 80%, 56%, 1)","hsla(0, 0%, 20%, 1)"])),"date"===r.model.get("xValue")){var o;if((t=e.extent(a,function(e){return e.date}))[1].getFullYear()-t[0].getFullYear()>2)this.model.set("timeRange","year"),(o=new Date(t[0])).setMonth(o.getMonth()-12),s.push(o),(o=new Date(t[1])).setMonth(o.getMonth()+12),s.push(o);else this.model.set("timeRange","month"),(o=new Date(t[0])).setMonth(o.getMonth()-1),s.push(o),(o=new Date(t[1])).setMonth(o.getMonth()+1),s.push(o);this.scales.xScale=e.time.scale().domain(s).range([0,r.config.width])}else"citation_count"==r.model.get("xValue")&&(i=e.extent(a,function(e){return e[r.model.get("xValue")]}),"log"===r.model.get("xScale")?this.scales.xScale=e.scale.log().domain(i).range([0,r.config.width]):this.scales.xScale=e.scale.linear().domain(i).range([0,r.config.width]));n=e.extent(a,function(e){return e[r.model.get("yValue")]}),"log"===this.model.get("yScale")?this.scales.yScale=e.scale.log().domain(n).range([r.config.height,0]):this.scales.yScale=e.scale.linear().domain(n).range([r.config.height,0]),"year"==r.model.get("radius")?this.scales.radiusScale=e.scale.linear().domain(e.extent(a,function(e){return e[r.model.get("radius")]})).range([2,14]):this.scales.radiusScale=e.scale.linear().domain(e.extent(a,function(e){return e[r.model.get("radius")]})).range([4,26])},finalProcess:function(){var t,n,i=this,a=this.model.get("modifiedSolrData");t=e.sum(_.pluck(a,i.model.get("yValue"))),n=e.sum(_.pluck(a,i.model.get("xValue"))),t?this.model.set("yLogPossible",!0):(this.model.set("yScale","linear",{silent:!0}),this.model.set("yLogPossible",!1)),n?this.model.set("xLogPossible",!0):(this.model.set("xScale","linear",{silent:!0}),this.model.set("xLogPossible",!1)),a=_.chain(a).filter(function(e){return"linear"===i.model.get("yScale")||(!!e[i.model.get("yValue")]||void 0)}).filter(function(e){return"linear"===i.model.get("xScale")||(!!e[i.model.get("xValue")]||void 0)}).sortBy(function(e){return-e[i.model.get("radius")]}).value(),this.model.set("currentGraphData",a),this.setScales()},resetSelection:function(){this.model.set("selectedBibs",[]),this.cache.svg.selectAll(".paper-circle.selected").classed("selected",!1),this.cache.svg.select("rect.selection").remove()},rearrangeGraph:function(){this.finalProcess(),this.resetSelection();var t,n,i,a,r,s=this.cache.svg,o=this.cache.realSvg,l=this.model.get("journalNames"),c=this;o.select("rect.selection").remove(),t=this.model.get("currentGraphData"),(a=c.model.get("currentPub"))&&(t=_.filter(t,function(e){return"other"===a?!_.contains(c.model.get("journalNames"),e.pub):e.pub===a})),n=e.svg.axis().scale(this.scales.yScale).orient("left").ticks(10).tickFormat(e.format("s")),r="date"===this.model.get("xValue")&&"year"==this.model.get("timeRange")?e.time.format("%Y"):"date"===this.model.get("xValue")&&"month"==this.model.get("timeRange")?e.time.format("%b-%Y"):e.format(""),xAxis=e.svg.axis().scale(this.scales.xScale).orient("bottom").tickFormat(r),s.select(".y-axis").transition().duration(c.config.animationLength).call(n),s.select(".x-axis").transition().duration(c.config.animationLength).call(xAxis),this.renderLabels(o.select(".y-label"),o.select(".x-label")),(i=s.selectAll(".paper-circle").data(t,function(e){return e.bibcode})).exit().remove(),i.transition().duration(c.config.animationLength).attr("r",function(e){return c.scales.radiusScale(e[c.model.get("radius")])+"px"}).attr("cy",function(e){return c.scales.yScale(e[c.model.get("yValue")])}).attr("cx",function(e){return c.scales.xScale(e[c.model.get("xValue")])}),i.enter().append("circle").classed("paper-circle",!0).classed("tracked",function(e){return!!_.contains(c.model.get("trackingBibs"),e.bibcode)}).attr("cx",function(e){return c.scales.xScale(e[c.model.get("xValue")])}).style("fill",function(e){if(l&&_.contains(l,e.pub))return c.scales.journalScale(e.pub)}).attr("cy",function(e){return c.scales.yScale(e[c.model.get("yValue")])}).attr("r",function(e){return c.scales.radiusScale(e[c.model.get("radius")])+"px"}),i.order()},onRender:function(){_.isEmpty(this.model.get("modifiedSolrData"))?this.model.set("loading",!0):(this.renderGraph(),this.$(".download").removeClass("hidden"))},renderLabels:function(e,t){var n=this;function i(e,t){e.append("circle").classed("scale-choice",!0).classed("log",!0).classed("selected",function(){if("log"===n.model.get(t))return!0}).attr("r","6px").attr("cx",200).attr("cy",-10),e.append("text").attr("x",210).attr("y",-5).text("log").classed("log",!0),e.append("circle").classed("scale-choice",!0).classed("linear",!0).classed("selected",function(){if("linear"===n.model.get(t))return!0}).attr("r","6px").attr("cx",250).attr("cy",-10),e.append("text").attr("x",260).attr("y",-5).text("linear")}e.selectAll("*").remove(),e.append("text").text(function(){return"citation_count"===n.model.get("yValue")?"Citation Count":"read_count"===n.model.get("yValue")?"90 Day Read Count":void 0}).classed("axis-title",!0),e.call(i,"yScale"),t.selectAll("*").remove(),t.append("text").text(function(){return"citation_count"===n.model.get("xValue")?"Citation Count":"date"===n.model.get("xValue")?"Date":void 0}).classed("axis-title",!0),"date"!==n.model.get("xValue")&&t.call(i,"xScale"),this.attachLogLinearEventListeners(),this.model.get("yLogPossible")||(e.selectAll(".scale-choice").classed("hidden",!0),e.selectAll("text.log").classed("hidden",!0)),this.model.get("xLogPossible")||(t.selectAll(".scale-choice").classed("hidden",!0),t.selectAll("text.log").classed("hidden",!0))},attachLogLinearEventListeners:function(){var t=this.cache.realSvg,n=this;_.each([{container:".y-label",scale:"yScale"},{container:".x-label",scale:"xScale"}],function(i){t.selectAll(i.container+" .scale-choice").on("click",function(t){e.selectAll(i.container+" .scale-choice").classed("selected",!1);var a=e.select(this);a.classed("linear")?(n.model.set(i.scale,"linear"),a.classed("selected",!0)):(n.model.set(i.scale,"log"),a.classed("selected",!0))},this)})},renderGraph:function(){this.getConfig(),this.cacheVals(),this.finalProcess();var t,n,i,a,s,o=this.cache.svg,l=this.cache.realSvg,c=this,u=c.model.get("journalNames"),d=!1;t=this.model.get("currentGraphData"),i="year"==this.model.get("timeRange")?e.svg.axis().scale(this.scales.xScale).orient("bottom").tickFormat(e.time.format("%Y")):e.svg.axis().scale(this.scales.xScale).orient("bottom").tickFormat(e.time.format("%b-%Y")),s=e.svg.axis().scale(this.scales.yScale).orient("left").tickFormat(e.format("s")),l.attr("aria-label","bubble chart"),o.append("g").attr("class","x-axis").attr("transform","translate(0,"+c.config.height+")").call(i),o.append("g").attr("class","y-axis").call(s),a=l.append("g").attr("transform","translate(35, 400) rotate(-90)").classed("y-label",!0),n=l.append("g").attr("transform","translate("+c.config.width/2+","+(c.config.height+c.config.margin.top+c.config.margin.bottom+10)+")").classed("x-label",!0),this.renderLabels(a,n),o.selectAll(".paper-circle").data(t).enter().append("circle").classed("paper-circle",!0).attr("r",function(e){return c.scales.radiusScale(e.citation_count)+"px"}).attr("cx",function(e){return c.scales.xScale(e.date)}).attr("cy",function(e){return c.scales.yScale(e.read_count)}).style("fill",function(e){if(u&&_.contains(u,e.pub))return c.scales.journalScale(e.pub)});var h=l.append("g").classed("journal-name-key",!0).attr("transform","translate("+(c.config.width+c.config.margin.right+c.config.margin.left)+","+(c.config.height/2-c.config.margin.top)+")");h.selectAll("rect").data(u).enter().append("rect").attr("width",13).attr("height",13).attr("y",function(e,t){return 22*t}).attr("fill",function(e){return"other"===e?"hsla(0, 0%, 20%, 1)":c.scales.journalScale(e)}),h.selectAll("text").data(u).enter().append("text").attr("x",15).attr("y",function(e,t){return 22*t+10}).text(function(e){return e}).on("click",function(t){var n=e.select(this);1==n.classed("journal-selected")?(n.classed("journal-selected",!1),c.model.set("currentPub",void 0)):(l.selectAll(".journal-selected").classed("journal-selected",!1),n.classed("journal-selected",!0),c.model.set("currentPub",t))}),l.on("click.tracking",function(t,n){if(e.select(e.event.target).classed("paper-circle")){var i=e.event.target.__data__.bibcode;c.model.toggleTracked(i),_.contains(c.model.get("trackingBibs"),i)?e.select(e.event.target).classed("tracked",!0):e.select(e.event.target).classed("tracked",!1)}}),l.on("mouseover.tooltip",function(t){if(e.select(e.event.target).classed("paper-circle")&&!d){var n,i,a,s,o=c.model.get("yValue"),l=c.model.get("xValue"),u=c.model.get("radius"),h=e.mouse(this.parentElement)[0],p=e.mouse(this.parentElement)[1],f={},m=e.event.target.__data__;s=e.mouse(this.parentElement)[0]-c.config.margin.left>500?"right":"left",(n=e.selectAll(".paper-circle").filter(function(e){if(e[o]==m[o]&&e[l]==m[l])return!0}).sort(function(e,t){return t[u]-e[u]}).data()).length>3&&(f.extra=n.length-3,n=n.slice(0,3)),f.bibs=n,c.cache.tooltip.html(r(f)),c.cache.tooltip.style({visibility:"hidden",display:"block"}),i=e.select(".d3-tooltip")[0][0].clientHeight,a=e.max([2.5*parseInt(e.select(e.event.target).attr("r")),10]),"left"===s?c.cache.tooltip.style("left",h+a+"px").style("top",p-i/2+"px").style("visibility","visible"):c.cache.tooltip.style("left",h-a-240+"px").style("top",p-i/2+"px").style("visibility","visible")}}),l.on("mousemove.tooltip",function(t){e.event.target.classList.contains("paper-circle")||c.cache.tooltip.style({display:"none"})}),l.on("mousedown.select",function(){if(e.event.target===e.event.currentTarget){d=!0,o.selectAll(".paper-circle.selected").classed("selected",!1),l.select("rect.selection").remove();var t=e.mouse(this);l.append("rect").attr({rx:6,ry:6,class:"selection",x:t[0],y:t[1],width:0,height:0})}}).on("mousemove.select",function(){if(d){var t=l.select("rect.selection");if(!t.empty()){var n=e.mouse(this),i={x:parseInt(t.attr("x"),10),y:parseInt(t.attr("y"),10),width:parseInt(t.attr("width"),10),height:parseInt(t.attr("height"),10)},a={x:n[0]-i.x,y:n[1]-i.y};if(i.width=a.x,i.height=a.y,a.x<0||a.y<0)return;t.attr(i),l.selectAll(".paper-circle").each(function(t,n){var a=e.select(this),r=parseInt(a.attr("cx")),s=parseInt(a.attr("cy"));r+c.config.margin.left>=i.x&&r+c.config.margin.left<=i.x+i.width&&s+c.config.margin.top>=i.y&&s+c.config.margin.top<=i.y+i.height?a.classed("selected",!0):a.classed("selected",!1)})}}}).on("mouseup.select",function(){d=!1;var e=[];o.selectAll(".paper-circle.selected").each(function(t){"none"!==this.style.display&&e.push(t.bibcode)}),c.model.set("selectedBibs",e)})},manageSubmitButton:function(){0===this.model.get("selectedBibs").length?this.$(".submit").addClass("disabled"):this.$(".submit").removeClass("disabled")}});return n.extend({initialize:function(e){var t=this;e=e||{},this.model=new c,this.view=new u({model:this.model,testing:e.testing}),this.listenTo(this.view,"filterBibs",this.onFilterBibs),this.listenTo(this.view,"close-widget",function(){t.resetModel(!0),t.broadcastClose()}),this.widgetName="bubble_chart",this.queryUpdater=new o(this.widgetName)},activate:function(e){this.setBeeHive(e),_.bindAll(this,"setCurrentQuery","processResponse");var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,this.setCurrentQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setCurrentQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},resetModel:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.model.reset(e)},renderWidgetForListOfBibcodes:function(e){this.resetModel();var t=new l;t.unlock(),t.set("q","bibcode:("+e.join(" OR ")+")"),t.set("rows",s._limits.BubbleChart.default),t.set("fl","title,bibcode,citation_count,read_count,pubdate");var n=new i({target:s.SEARCH,query:t});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,n)},renderWidgetForCurrentQuery:function(){this.resetModel();var e=this.getCurrentQuery().clone();e.unlock(),e.set("rows",s._limits.BubbleChart.default),e.set("fl","title,bibcode,citation_count,read_count,pubdate"),e.unset("hl"),e.unset("hl.fl");var t=new i({target:s.SEARCH,query:e});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,t)},processResponse:function(e){this.model.reset(),this.view.reset(),this.model.set("solrData",e.get("response.docs"))},onFilterBibs:function(){var e=this.model.get("selectedBibs"),t=this.getCurrentQuery().clone();if(e.length){var n=this.queryUpdater,i="bibcode:("+e.map(function(e){return n.quoteIfNecessary(e)}).join(" OR ")+")";t.unlock(),this._updateFq(t,i);var a=this.getPubSub();a.publish(a.NAVIGATE,"search-page",{q:t})}},_updateFq:function(e,t){var n="fq_"+this.widgetName;e.unset(n),this.queryUpdater.updateQuery(e,n,"limit",t);var i="{!type=aqp v=$"+n+"}",a=e.get("fq");a?(-1==_.indexOf(a,i)&&a.push(i),e.set("fq",a)):e.set("fq",[i])},broadcastClose:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")}})}),define("hbs!js/widgets/citation_helper/templates/citation_helper_template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.success:a,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?a:""},2:function(e,t,n,i){var a;return'<div class="ch-alert alert-success alert-dismissable" role="alert">\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numRecords:a,e))+" records were added to library <b>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b>\n</div>\n"},4:function(e,t,n,i){var a;return'<div class="ch-alert alert-danger alert-dismissable" role="alert">\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n    No records were added to <b>'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b>: <em>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.error:a,e))+"</em>\n</div>\n"},6:function(e,t,n,i,a,r){var s;return"<div class=\"citation-helper-metadata s-citation-helper-metadata\">\n\n<h4>Suggested Articles</h4>\n<p>These suggestions are based on a 'friends-of-friends' analysis of the citation network for the papers in the library (scores start at 2).</p>\n    <br>\n\n"+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.permission:e,"owner",{name:"compare",hash:{operator:"=="},fn:this.program(7,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'</div>\n<br>\n<ul class="citation-helper-list-container-list-container s-citation-helper-list-container">\n\n'+(null!=(s=t.each.call(e,null!=e?e.items:e,{name:"each",hash:{},fn:this.program(10,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n</ul>\n\n"},7:function(e,t,n,i){var a;return'    <div class="row print-hidden"><div class="col-xs-6"><button class="btn btn-sm btn-success submit-add-to-library" '+(null!=(a=(t.ifSetEmpty||e&&e.ifSetEmpty||t.helperMissing).call(e,null!=e?e.selectedBibs:e,{name:"ifSetEmpty",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?a:"")+">Add selected papers to this library</button></div></div>\n"},8:function(e,t,n,i){return"disabled"},10:function(e,t,n,i,a,r){var s,o;return'    <li class="citation-helper-item s-citation-helper-item">\n        <div class="col-sm-10">\n            <div class="row s-top-row">\n                <div class="col-xs-1 ch-selectbox-col s-top-row-col">\n                    <label class="custom-checkbox">\n                        <input type="checkbox" value="'+this.escapeExpression("function"==typeof(o=null!=(o=t.bibcode||(null!=e?e.bibcode:e))?o:t.helperMissing)?o.call(e,{name:"bibcode",hash:{},data:i}):o)+'" name="identifier" aria-label="select '+this.escapeExpression("function"==typeof(o=null!=(o=t.bibcode||(null!=e?e.bibcode:e))?o:t.helperMissing)?o.call(e,{name:"bibcode",hash:{},data:i}):o)+'" '+(null!=(s=(t.ifInSet||e&&e.ifInSet||t.helperMissing).call(e,null!=r[1]?r[1].selectedBibs:r[1],null!=e?e.bibcode:e,{name:"ifInSet",hash:{},fn:this.program(11,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'/>\n                    </label>\n                </div>\n                <div class="col=sm-3 col-xs-4 s-top-row-col">'+this.escapeExpression("function"==typeof(o=null!=(o=t.bibcode||(null!=e?e.bibcode:e))?o:t.helperMissing)?o.call(e,{name:"bibcode",hash:{},data:i}):o)+'</div>\n                <div class="col-sm-2 s-top-row-col"><b>score: '+this.escapeExpression("function"==typeof(o=null!=(o=t.score||(null!=e?e.score:e))?o:t.helperMissing)?o.call(e,{name:"score",hash:{},data:i}):o)+'</b></div>\n            </div>\n            <div class="row">\n                <div class="col-xs-10 col-xs-offset-1">\n                <a href="#abs/'+this.escapeExpression("function"==typeof(o=null!=(o=t.bibcode||(null!=e?e.bibcode:e))?o:t.helperMissing)?o.call(e,{name:"bibcode",hash:{},data:i}):o)+'">\n                    <h3 class="s-results-title">'+this.escapeExpression("function"==typeof(o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing)?o.call(e,{name:"title",hash:{},data:i}):o)+'</h3>\n                </a>\n                </div>\n            </div>\n            <div class="row">\n                <div class="col-xs-10 col-xs-offset-1">\n                    <ul class="list-inline just-authors s-results-authors">\n                        <li class="article-author">\n                            '+this.escapeExpression("function"==typeof(o=null!=(o=t.author||(null!=e?e.author:e))?o:t.helperMissing)?o.call(e,{name:"author",hash:{},data:i}):o)+"\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n    </li>\n"},11:function(e,t,n,i){return" checked "},13:function(e,t,n,i){var a;return'    <div style="padding-left: 20px; padding-top: 50px;">\n        <div class="row s-message-control-row"><i>'+this.escapeExpression("function"==typeof(a=null!=(a=t.msg||(null!=e?e.msg:e))?a:t.helperMissing)?a.call(e,{name:"msg",hash:{},data:i}):a)+"</i></div>\n    </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,a,r){var s;return(null!=(s=t.if.call(e,null!=e?e.feedback:e,{name:"if",hash:{},fn:this.program(1,i,0,a,r),inverse:this.noop,data:i}))?s:"")+(null!=(s=t.if.call(e,null!=e?e.items:e,{name:"if",hash:{},fn:this.program(6,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n"+(null!=(s=t.if.call(e,null!=e?e.msg:e,{name:"if",hash:{},fn:this.program(13,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n</div>\n"},useData:!0,useDepths:!0});return e.registerPartial("js/widgets/citation_helper/templates/citation_helper_template",t),t}),define("js/widgets/citation_helper/widget",["marionette","js/widgets/base/base_widget","js/components/api_response","js/components/json_response","js/components/api_request","js/components/api_query","js/mixins/dependon","hbs!js/widgets/citation_helper/templates/citation_helper_template","bootstrap","js/components/api_feedback","js/components/api_targets","analytics"],function(e,t,n,i,a,r,s,o,l,c,u,d){var h=Backbone.Model.extend({defaults:{items:[],widgetName:"CitationHelper",libraryID:null,permission:null,libname:null,selectedBibs:new Set}}),p=e.ItemView.extend({template:o,events:{"click .close-widget":"signalCloseWidget","click .submit-add-to-library":"libraryAdd","click .citation-helper-item input[type=checkbox]":"selectionChanged"},modelEvents:{change:"render"},libraryAdd:function(){this.$(".submit-add-to-library").html('<i class="fa fa-spinner fa-pulse" aria-hidden="true"></i>');var e={};e.libraryID=this.model.get("libraryID"),e.libname=this.model.get("libname");var t=this.$("input:checked").map(function(){return this.value}).get();e.recordsToAdd=t,this.trigger("library-add",e)},signalCloseWidget:function(){this.trigger("close-widget")},selectionChanged:function(e){var t=this.model.get("selectedBibs");e.currentTarget.checked?t.add(e.currentTarget.value):t.delete(e.currentTarget.value),this.render()}}),f=t.extend({viewEvents:{"close-widget":"closeWidget","library-add":"libraryAddSubmit"},initialize:function(t){t=t||{},this.model=new h,this.view=new p({model:this.model}),e.bindEntityEvents(this,this.view,e.getOption(this,"viewEvents"))},activate:function(e){this.setBeeHive(e),_.bindAll(this,"setCurrentQuery","processResponse");var t=e.getService("PubSub");t.subscribe(t.INVITING_REQUEST,this.setCurrentQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setCurrentQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},libraryAddSubmit:function(e){var t={},n=this;t.library=e.libraryID,t.bibcodes=e.recordsToAdd,name=e.libname,this.getBeeHive().getObject("LibraryController").addBibcodesToLib(t).done(function(t,i){var a=t.numBibcodesRequested-parseInt(t.number_added);n.model.set("feedback",{success:!0,name:name,id:e.libraryID,numRecords:t.number_added,numAlreadyInLib:a}),n.model.set("selectedBibs",new Set)}).fail(function(t){n.model.set("feedback",{success:!1,name:name,id:e.libraryID,error:JSON.parse(arguments[0].responseText).error})}),this.clearFeedbackWithDelay()},clearFeedbackWithDelay:function(){var e=this;setTimeout(function(){e.model.unset("feedback")},5e3)},getSuggestions:function(e){var t=$.Deferred(),n=this.getPubSub(),i=new a({target:u.SERVICE_CITATION_HELPER,query:new r({bibcodes:e}),options:{type:"POST",contentType:"application/json"}});return n.subscribeOnce(n.DELIVERING_RESPONSE,function(e){t.resolve(e.toJSON())}),n.publish(n.EXECUTE_REQUEST,i),t.promise()},processResponse:function(e){if(e instanceof n){var t=_.map(e.get("response.docs"),function(e){return e.bibcode});this.getSuggestions(t)}else e instanceof i&&this.processSuggestions(e)},processSuggestions:function(e){(e=e.attributes?e.attributes:e).Error&&"Unable to get results!"===e.Error||500==e.status?this.model.set("msg","Citation Helper did not find any suggestions."):this.model.set("items",e)},renderWidgetForCurrentQuery:function(){this.reset(),this.dispatchRequest(this.getCurrentQuery())},reset:function(){this.model.clear({silent:!0}).set("items",[],{silent:!0}).set("selectedBibs",new Set,{silent:!0})},closeWidget:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},renderWidgetForListOfBibcodes:function(e,t){this.reset();var n=new a({target:u.SERVICE_CITATION_HELPER,query:new r({bibcodes:e}),options:{type:"POST",contentType:"application/json"}});this.model.set({libraryID:t.libid,permission:t.permission,libname:t.libname,selectedBibs:new Set}),this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,n)}});return _.extend(f.prototype,s.BeeHive),f}),define("hbs!js/widgets/dropdown-menu/templates/dropdown",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return"pull-right"},3:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.selectedPapers:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:""},4:function(e,t,n,i){var a,r;return'                <div class="s-divider-bottom">\n                    <label><input class="papers" type="radio" '+(null!=(a=t.if.call(e,null!=e?e.onlySelected:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+' name="papers-'+this.escapeExpression("function"==typeof(r=null!=(r=t.dropdownTitle||(null!=e?e.dropdownTitle:e))?r:t.helperMissing)?r.call(e,{name:"dropdownTitle",hash:{},data:i}):r)+'" value="selected"/> selected papers</label>\n                    <label><input class="papers" type="radio" '+(null!=(a=t.unless.call(e,null!=e?e.onlySelected:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+' name="papers-'+this.escapeExpression("function"==typeof(r=null!=(r=t.dropdownTitle||(null!=e?e.dropdownTitle:e))?r:t.helperMissing)?r.call(e,{name:"dropdownTitle",hash:{},data:i}):r)+'" value="all"/> all papers</label>\n                </div>\n'},5:function(e,t,n,i){return" checked "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'\x3c!-- Single button --\x3e\n    <button type="button" class="btn '+this.escapeExpression("function"==typeof(r=null!=(r=t.btnType||(null!=e?e.btnType:e))?r:t.helperMissing)?r.call(e,{name:"btnType",hash:{},data:i}):r)+' dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n       <i class="'+this.escapeExpression("function"==typeof(r=null!=(r=t.iconClass||(null!=e?e.iconClass:e))?r:t.helperMissing)?r.call(e,{name:"iconClass",hash:{},data:i}):r)+'"></i> <h2>'+this.escapeExpression("function"==typeof(r=null!=(r=t.dropdownTitle||(null!=e?e.dropdownTitle:e))?r:t.helperMissing)?r.call(e,{name:"dropdownTitle",hash:{},data:i}):r)+'</h2> <span class="caret"></span>\n    </button>\n    <div class="dropdown-menu '+(null!=(a=t.if.call(e,null!=e?e.pullRight:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'" role="menu">\n'+(null!=(a=t.if.call(e,null!=e?e.selectedOption:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'        <ul class="link-container">\n        </ul>\n    </div>\n'},useData:!0});return e.registerPartial("js/widgets/dropdown-menu/templates/dropdown",t),t}),define("hbs!js/widgets/dropdown-menu/templates/dropdown-item",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a,r;return'<li role="presentation" class="dropdown-header no-hover-style">\n  '+this.escapeExpression("function"==typeof(r=null!=(r=t.section||(null!=e?e.section:e))?r:t.helperMissing)?r.call(e,{name:"section",hash:{},data:i}):r)+"\n"+(null!=(a=t.if.call(e,null!=e?e.icon:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+"</li>\n"},2:function(e,t,n,i){var a;return'    <a href="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.icon:e)?a.href:a,e))+'" class="pull-right dropdown-helper-icon" target="_blank" rel="noreferrer noopener" title="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.icon:e)?a.description:a,e))+'"><i class="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.icon:e)?a.class:a,e))+'"></i></a>\n'},4:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.divider:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.program(7,i,0),data:i}))?a:""},5:function(e,t,n,i){return'  <li role="presentation" class="divider"></li>\n'},7:function(e,t,n,i){return'  <li role="presentation">\n    <a role="menuitem" tabindex="-1" href="'+this.escapeExpression(this.lambda(null!=e?e.href:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.description:e,e))+"</a>\n  </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"\n"+(null!=(a=t.if.call(e,null!=e?e.section:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(4,i,0),data:i}))?a:"")},useData:!0});return e.registerPartial("js/widgets/dropdown-menu/templates/dropdown-item",t),t}),define("js/widgets/dropdown-menu/widget",["marionette","js/widgets/base/base_widget","hbs!js/widgets/dropdown-menu/templates/dropdown","hbs!js/widgets/dropdown-menu/templates/dropdown-item"],function(e,t,n,i){var a=Backbone.Model.extend({defaults:function(){return{selected:!1,href:void 0,description:void 0,navEvent:void 0,pubsubEvent:void 0,section:void 0,hideIfNoItemsSelected:!1}}}),r=Backbone.Collection.extend({initialize:function(e,t){this.on("change:selected",this.removeOtherSelected)},model:a,removeOtherSelected:function(e,t){!1!==t&&this.each(function(t){t!==e&&t.set("selected",!1)})}}),s=e.ItemView.extend({events:{click:"setSelected"},setSelected:function(e){return this.model.set("selected",!0),!1},template:i,onRender:function(){this.setElement(this.el.innerHTML)}}),o=Backbone.Model.extend({defaults:function(){return{selectedOption:!1,selectedPapers:!1,onlySelected:!0}}}),l=e.CompositeView.extend({initialize:function(e){e=e||{}},modelEvents:{"change:selectedOption":"render","change:selectedPapers":"render"},collectionEvents:{"change:selected":function(){this.$el.removeClass("open")}},className:"btn-group dropdown-widget s-dropdown-widget",childView:s,childViewContainer:".link-container",template:n,serializeData:function(){var t=this.model.toJSON();return t.btnType=e.getOption(this,"btnType")||"btn-default",t.dropdownTitle=e.getOption(this,"dropdownTitle"),t.iconClass=e.getOption(this,"iconClass"),t.pullRight=e.getOption(this,"rightAlign"),t},events:{"change input.papers":function(e){"all"==$(e.target).attr("value")?this.model.set("onlySelected",!1):this.model.set("onlySelected",!0)},"click .dropdown-menu label":function(e){e.stopPropagation&&e.stopPropagation()}},onRender:function(){this.$(".dropdown-helper-icon").off().click(function(e){window.open(e.currentTarget.href,"_blank")})}});return t.extend({initialize:function(e){var t=this;if(this.options=_.defaults(e,{updateLinks:_.noop}),!this.options.links)throw new Error("Dropdown menu will be empty!");this.model=new o({selectedOption:this.options.selectedOption}),this.collection=new r(this.options.links),this.view=new l(_.extend({collection:this.collection,model:this.model},this.options)),this.listenTo(this.collection,"change:selected",function(e,n){if(e.has("navEvent"))t.emitNavigateEvent(e,n);else if(e.has("pubsubEvent")){var i=t.getOnlySelected();t.getPubSub().publish(t.getPubSub().CUSTOM_EVENT,e.get("pubsubEvent"),{onlySelected:i})}e.set("selected",!1)})},activate:function(e){_.bindAll(this),this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.STORAGE_PAPER_UPDATE,this.onStoragePaperChange),t.subscribe(t.USER_ANNOUNCEMENT,this.updateFromUserData),this.updateFromUserData()},getUserData:function(){try{var e=_.isFunction(this.getBeeHive)&&this.getBeeHive(),t=_.isFunction(e.getObject)&&e.getObject("User");return _.isPlainObject(t)?_.isFunction(t.getUserData)&&t.getUserData("USER_DATA"):{}}catch(e){return{}}},updateFromUserData:function(){var e=this.getUserData(),t=this.options.updateLinks(e,this.options.links)||this.options.links;this.options.links=t,this.collection.reset(this.options.links)},onStoragePaperChange:function(e){this.model.set("selectedPapers",!!e)},getOnlySelected:function(){return this.model.get("selectedOption")&&this.model.get("selectedPapers")&&this.model.get("onlySelected")},emitNavigateEvent:function(e,t){var n=this.getOnlySelected();if(t){var i=_.extend({onlySelected:n},e.get("params"));this.getPubSub().publish(this.getPubSub().NAVIGATE,e.get("navEvent"),i)}e.set("selected",!1)}})}),define("hbs!js/widgets/filter_visualizer/templates/widget-view",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="filter-visualizer">\n\n</div>'},useData:!0});return e.registerPartial("js/widgets/filter_visualizer/templates/widget-view",t),t}),define("hbs!js/widgets/filter_visualizer/templates/item-view",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return" "+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"category",{name:"compare",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?a:"")+" "},2:function(e,t,n,i){return"\n\n<h5>"+this.escapeExpression(this.lambda(null!=e?e.display:e,e))+"</h5>\n\n"},4:function(e,t,n,i){return'\n<span class="filter-'+this.escapeExpression(this.lambda(null!=e?e.type:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.display:e,e))+'</span>\n<button\n  class="btn btn-xs filter-'+this.escapeExpression(this.lambda(null!=e?e.type:e,e))+'-remove"\n  value="'+this.escapeExpression(this.lambda(null!=e?e.value:e,e))+'"\n  title="remove this filter"\n>\n  <i class="fa fa-remove" aria-hidden="true"></i>\n</button>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return(null!=(a=t.each.call(e,null!=e?e.elements:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n"},useData:!0});return e.registerPartial("js/widgets/filter_visualizer/templates/item-view",t),t}),define("js/widgets/filter_visualizer/widget",["underscore","jquery","backbone","marionette","js/components/api_query","js/components/pubsub_events","hbs!js/widgets/filter_visualizer/templates/widget-view","hbs!js/widgets/filter_visualizer/templates/item-view","js/components/api_feedback","js/mixins/dependon"],function(e,t,n,i,a,r,s,o,l,c){var u=n.Model.extend({}),d=n.Collection.extend({model:u}),h=i.ItemView.extend({tagName:"span",className:"filter-topic-group",template:o,events:{"click button":"onClick"},onClick:function(e){var n=t(e.target);return this.trigger("filter-event",n.attr("value")?n.attr("value"):n.parent().attr("value")),!1}}),p=i.CompositeView.extend({template:s,childView:h,childViewContainer:"#filter-visualizer",events:{}}),f=i.Controller.extend({activate:function(t){e.bindAll(this,"processFeedback","onFilterEvent"),this.setBeeHive(t),pubsub=t.getService("PubSub"),pubsub.subscribe(pubsub.FEEDBACK,this.processFeedback)},initialize:function(t){t=e.defaults(t,{withoutOperators:!0,maxNumberOfTokens:5,maxQueryLen:100}),this.collection=new d({}),this.view=new p({collection:this.collection}),this.listenTo(this.view,"childview:filter-event",this.onFilterEvent),this.knownFilters={fq_aff:"Institutions",fq_author:"Author",fq_database:"Collection",fq_property:"Property",fq_facets180:"Status",fq_keyword_facet:"Keywords",fq_bibstem_facet:"Publication",fq_bibgroup_facet:"BibGroup",fq_data_facet:"Data",fq_vizier_facet:"Vizier",fq_simbad_object_facet_hier:"Object",fq_ned_object_facet_hier:"Object",fq_grant:"Grant",fq_visualization_author:"Author Network",fq_visualization_paper:"Paper Network",fq_wordcloud:"Concept Cloud",fq_bubble_chart:"Results Graph",fq_doctype:"Pubtype"},this.currentQuery=null,this.withoutOperators=t.withoutOperators,this.maxNumberOfTokens=t.maxNumberOfTokens,this.maxQueryLen=t.maxQueryLen},render:function(){return this.view.render(),this.view.el},processFeedback:function(e){switch(e.code){case l.CODES.SEARCH_CYCLE_STARTED:this.processQuery({numFound:e.numFound,q:e.query.clone()})}},processQuery:function(e){var t=e.q;numFound=e.numFound;var n=this.extractFilters(t);this._saveInfo(t,n);var i=this.prepareGUIData(n);this.collection.reset(i)},_saveInfo:function(t,n){this.currentQuery=t,this.currentFilters={},e.each(n,function(e){this.currentFilters[e.filter_name]=e},this)},extractFilters:function(t){var n=t.toJSON(),i=[];if(!n.fq&&!t.get("__qid"))return i;n.fq;var a=e.keys(n);return e.each(a,function(t){if(0==t.indexOf("fq_")){if(!this.knownFilters[t])return;var r={category:this.knownFilters[t],filter_name:t,filter_query:n[t][0]};if(n[t].length>1)return void console.warn("Breach of an api contract, filter contains too many values",t,n[t]);var s=e.filter(a,function(e){if(e.indexOf(t)>-1&&e!==t)return!0});1==s.length?(r.filter_key=s[0],r.filter_value=n[s[0]]):console.warn("no fq metadata available, so presumably query is being loaded from url (if not, there is a problem!) "),i.push(r)}},this),i=e.sortBy(i,function(t){var n=e.indexOf(self.knownFilters,t.category);return n>-1?n:1e3})},prepareGUIData:function(t){if(this.withoutOperators)return this._prepareGUIDataWithoutOperators(t);var n=[];return e.each(t,function(t){var i=[];if(i.push({type:"category",display:t.category,value:t.filter_name+"|category|"+t.category}),t.filter_value.length-1>this.maxNumberOfTokens||t.filter_value.join(" ").length>this.maxQueryLen)return i.push({type:"control",display:t.filter_value.length-1+" custom values",value:t.filter_name+"|control|x"}),void n.push({elements:i});var a=0,r=t.filter_value[0];e.each(t.filter_value.slice(1),function(e){++a>1&&i.push({type:"operator",display:r,value:t.filter_name+"|operator|"+r}),i.push({type:"operand",display:this.beautifyOperand(t.filter_name,e),value:t.filter_name+"|operand|"+e})},this),i.push({type:"control",display:"",value:t.filter_name+"|control|x"}),n.push({elements:i})},this),n},_prepareGUIDataWithoutOperators:function(t){var n=[];return e.each(t,function(t){var i=[];if(i.push({type:"category",display:t.category,value:t.filter_name+"|category|"+t.category}),!t.filter_value||t.filter_value.length-1>this.maxNumberOfTokens||t.filter_value.join(" ").length>this.maxQueryLen)return i.push({type:"operand",display:"custom filter",value:t.filter_name+"|control|x"}),void n.push({elements:i});var a=0,r=t.filter_value[0],s="";"NOT"==r?s="-":"AND"==r&&(s="+"),e.each(t.filter_value.slice(1),function(o){var l=e.clone(i),c=0==a++&&"NOT"==r?"":s;l.push({type:"operand",display:c+this.beautifyOperand(t.filter_name,o),value:t.filter_name+"|operand|"+o}),n.push({elements:l})},this)},this),n},beautifyOperand:function(e,t){for(var n=t;0==n.indexOf("(")&&n.indexOf(")")==n.length-1;)n=n.substr(1,n.length-2);switch(n=n.replace(/0\/|1\/[^/]+\//,""),e){case"fq_author":n=(n=n.replace(/author_facet_hier:/g,"")).replace(/\d+\//g,"");break;case"fq_aff":n=(n=n.replace(/aff_facet_hier:/g,"")).replace(/\d+\//g,"");break;case"fq_database":n=n.replace(/database:/g,"");break;case"fq_facets180":n=n.replace(/property:/g,"");break;case"fq_keyword_facet":n=(n=n.replace(/keyword_facet:/g,"")).replace(/\\/g,"");break;case"fq_bibstem_facet":n=n.replace(/bibstem_facet:/g,"");break;case"fq_bibgroup_facet":n=n.replace(/bibgroup_facet:/g,"");break;case"fq_data_facet":n=n.replace(/data_facet:/g,"");break;case"fq_vizier_facet":n=n.replace(/vizier_facet:/g,"");break;case"fq_grant":n=n.replace(/grant:/g,"");break;case"fq_simbad_object_facet_hier":n=n.replace(/simbad_object_facet_hier:0\\\//g,"");break;case"fq_ned_object_facet_hier":n=n.replace(/ned_object_facet_hier:0\\\//g,"");break;case"fq_doctype":n=n.replace(/doctype:/g,"")}return n=(n=n.replace(/\\?"/g,"")).replace(/\*:\*/,"any")},createModifiedQuery:function(t){var n=t.split("|"),i={};i.name=n[0],i.part=n[1],i.value=n[2];var r=this.currentQuery.toJSON();if(r.fq||r.fq[i.name]){switch(i.part){case"operand":if(r[this.currentFilters[i.name].filter_key].length>2){var s,o=r[this.currentFilters[i.name].filter_key];if(-1==e.indexOf(o,i.value))throw console.error("Cannot find/remove the value: "+i.value,o),Error("Error in modifying the query");if((o=e.reject(o,function(e){return e==i.value})).length>2){var l=" "+o[0]+" ";s="("+o.slice(1).join(l)+")"}else s=o[1];r[i.name]=s,r[this.currentFilters[i.name].filter_key]=o;break}case"control":delete r[i.name],delete r[this.currentFilters[i.name].filter_key],r.fq=e.filter(r.fq,function(e){if(-1==e.indexOf("v=$"+i.name))return!0})}return r.fq&&0==r.fq.length&&delete r.fq,new a(r)}console.error("The current query has no filter: "+i.name)},onLoad:function(e){this.collection?this.collection.reset(this.getData(e)):this.initialize(e)},onFilterEvent:function(e,t){var n=this.createModifiedQuery(t),i=this.getBeeHive().getService("PubSub");i&&i.publish(i.NAVIGATE,"search-page",{q:n})}});return e.extend(f.prototype,c.BeeHive),f}),define("hbs!js/widgets/footer/footer",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<footer>\n  <div class="__footer_wrapper">\n    <div class="__footer_brand">\n      &copy; The SAO/NASA Astrophysics Data System\n      <div class="__footer_brand_extra">\n        <p>\n          <i class="fa fa-envelope" aria-hidden="true"></i>\n          adshelp[at]cfa.harvard.edu\n        </p>\n        <p>\n          The ADS is operated by the Smithsonian Astrophysical Observatory under\n          NASA Cooperative Agreement <em>80NSSC21M0056</em>\n        </p>\n      </div>\n      <div class="__footer_brand_logos">\n        <a href="http://www.nasa.gov" target="_blank" rel="noreferrer noopener">\n          <img src="/styles/img/nasa.svg" alt="NASA logo" id="nasa-logo" />\n        </a>\n        <a href="http://www.si.edu" target="_blank" rel="noreferrer noopener">\n          <img\n            id="smithsonian-logo"\n            src="/styles/img/smithsonian.svg"\n            alt="Smithsonian logo"\n          />\n        </a>\n        <a\n          href="https://www.cfa.harvard.edu/"\n          target="_blank"\n          rel="noreferrer noopener"\n        >\n          <img\n            src="/styles/img/cfa.png"\n            alt="Harvard Center for Astrophysics logo"\n            id="cfa-logo"\n          />\n        </a>\n      </div>\n    </div>\n    <div class="__footer_list">\n      <div class="__footer_list_title">\n        Resources\n      </div>\n      <ul class="__footer_links">\n        <li>\n          <a href="/about/" target="_blank" rel="noreferrer noopener">\n            <i class="fa fa-question-circle" aria-hidden="true"></i> About ADS\n          </a>\n        </li>\n        <li>\n          <a href="/help/" target="_blank" rel="noreferrer noopener">\n            <i class="fa fa-info-circle" aria-hidden="true"></i> ADS Help\n          </a>\n        </li>\n        <li>\n          <a href="/help/whats_new/" target="_blank" rel="noreferrer noopener">\n            <i class="fa fa-bullhorn" aria-hidden="true"></i> What\'s New\n          </a>\n        </li>\n        <li>\n          <a href="/about/careers/" target="_blank" rel="noreferrer noopener">\n            <i class="fa fa-group" aria-hidden="true"></i> Careers@ADS\n          </a>\n        </li>\n        <li>\n          <a\n            href="/help/accessibility/"\n            target="_blank"\n            rel="noreferrer noopener"\n          >\n            <i class="fa fa-universal-access" aria-hidden="true"></i>\n            Accessibility\n          </a>\n        </li>\n      </ul>\n    </div>\n    <div class="__footer_list">\n      <div class="__footer_list_title">\n        Social\n      </div>\n      <ul class="__footer_links">\n        <li>\n          <a\n            href="//twitter.com/adsabs"\n            target="_blank"\n            rel="noreferrer noopener"\n          >\n            <i class="fa fa-twitter" aria-hidden="true"></i> @adsabs\n          </a>\n        </li>\n        <li>\n          <a href="/blog/" target="_blank" rel="noreferrer noopener">\n            <i class="fa fa-newspaper-o" aria-hidden="true"></i> ADS Blog\n          </a>\n        </li>\n      </ul>\n    </div>\n    <div class="__footer_list">\n      <div class="__footer_list_title">\n        Project\n      </div>\n      <ul class="__footer_links">\n        <li>\n          <a href="/core">Switch to basic HTML</a>\n        </li>\n        <li>\n          <a href="/help/privacy/" target="_blank" rel="noreferrer noopener"\n            >Privacy Policy</a\n          >\n        </li>\n        <li>\n          <a href="/help/terms" target="_blank" rel="noreferrer noopener"\n            >Terms of Use</a\n          >\n        </li>\n        <li>\n          <a\n            href="http://www.cfa.harvard.edu/sao"\n            target="_blank"\n            rel="noreferrer noopener"\n            >Smithsonian Astrophysical Observatory</a\n          >\n        </li>\n        <li>\n          <a href="http://www.si.edu" target="_blank" rel="noreferrer noopener"\n            >Smithsonian Institution</a\n          >\n        </li>\n        <li>\n          <a\n            href="http://www.nasa.gov"\n            target="_blank"\n            rel="noreferrer noopener"\n            >NASA</a\n          >\n        </li>\n      </ul>\n    </div>\n  </div>\n</footer>\n'},useData:!0});return e.registerPartial("js/widgets/footer/footer",t),t}),define("js/widgets/footer/widget",["marionette","hbs!js/widgets/footer/footer"],function(e,t){return e.ItemView.extend({template:t,className:"footer s-footer"})}),define("hbs!js/widgets/navbar/template/navbar",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'            <a class="navbar-brand s-navbar-brand" href="#">\n                <img class="s-ads-icon" src="/styles/img/transparent_logo.svg" alt="Astrophysics Data System Home Page"/>\n                <h1 style="font-weight: bold;">ads</h1>\n            </a>\n'},3:function(e,t,n,i){return'            <div class="s-hourly-warning">\n                <a class="navbar-brand s-navbar-brand" href="#"><i class="icon-danger fa-2x" aria-hidden="true"></i> ADS TEST</a>\n                <span> Nothing you do here will be saved!  <a href="/">I want the real ADS <i class="fa fa-arrow-right" aria-hidden="true"></i></a>\n                </span>\n            </div>\n'},5:function(e,t,n,i){var a;return"\n"+(null!=(a=t.if.call(e,null!=e?e.orcidModeOn:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(11,i,0),data:i}))?a:"")+'                \x3c!--end "if/else orcidModeOn"--\x3e\n\n'},6:function(e,t,n,i){var a;return'\n                <li class="dropdown orcid-dropdown s-orcid-dropdown">\n                    <button class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                        <span class="s-orcid-title">\n                         <img src="../../styles/img/orcid-active.svg" alt="orcid symbol"/>\n                            ORCID\n                            <span class="caret"></span></button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style">\n                            '+(null!=(a=t.if.call(e,null!=e?e.orcidLastName:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'\n                            <div class="s-orcid-mode-label" style="font-weight: bold;">ORCID Mode</div>\n                            <div class="s-orcid-label-container">\n                                off\n                                <div class="switch">\n                                    <input id="cmn-toggle-1" class="cmn-toggle cmn-toggle-round orcid-mode" type="checkbox" checked="checked">\n                                    <label for="cmn-toggle-1"></label>\n                                </div>\n                                on\n                            </div>\n                        </li>\n\n                        <li class="divider"></li>\n                        <li>\n                            <a class="orcid-link" href="#user/orcid" >View my ORCID papers in ADS </a>\n                        </li>\n'+(null!=(a=t.if.call(e,null!=e?e.orcidURI:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+'                        <li>\n                            <a href="#orcid-instructions"> <i class="fa fa-info-circle" aria-hidden="true"></i> Learn how to make ORCID claims using ADS</a>\n                        </li>\n                        <li class="divider"></li>\n                        <li>\n                            <a href="javascript:void(0)" class="orcid-logout" >Log out from ORCID in ADS</a>\n                        <li>\n\n                    </ul>\n                </li>\n\n'},7:function(e,t,n,i){var a;return" <h4> Signed in to ORCID as <br/> <strong>"+this.escapeExpression("function"==typeof(a=null!=(a=t.orcidFirstName||(null!=e?e.orcidFirstName:e))?a:t.helperMissing)?a.call(e,{name:"orcidFirstName",hash:{},data:i}):a)+" "+this.escapeExpression("function"==typeof(a=null!=(a=t.orcidLastName||(null!=e?e.orcidLastName:e))?a:t.helperMissing)?a.call(e,{name:"orcidLastName",hash:{},data:i}):a)+"</strong></h4> "},9:function(e,t,n,i){return'                        <li>\n                            <a href="https://orcid.org/my-orcid" target="_blank" rel="noreferrer noopener" >View my ORCID profile on orcid.org </a>\n                        </li>\n'},11:function(e,t,n,i){var a;return'\n                <li class="dropdown orcid-dropdown s-orcid-dropdown">\n                    <button class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                        <span class="s-orcid-title"> <img src="../../styles/img/orcid-inactive.svg"\n                                                          alt="orcid symbol"/> ORCID  <span class="caret"></span></button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style">\n                            '+(null!=(a=t.if.call(e,null!=e?e.orcidLastName:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'\n                            <div class="s-orcid-mode-label" style="font-weight: bold;">ORCID Mode</div>\n                            <div class="s-orcid-label-container">\n                                off\n                                <div class="switch clearfix">\n                                    <input id="cmn-toggle-1" class="cmn-toggle cmn-toggle-round orcid-mode" type="checkbox">\n                                    <label for="cmn-toggle-1"></label>\n                                </div>\n                                on\n                            </div>\n                        </li>\n                        <li style="clear:both" class="no-hover-style">You have turned off the ORCID view for the ADS search results page, but are still logged in.</li>\n                        <li class="divider"></li>\n                        <li>\n                            <a class="orcid-link" href="#user/orcid" > View my ORCID papers in ADS</a>\n                        </li>\n'+(null!=(a=t.if.call(e,null!=e?e.orcidURI:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+'                        <li>\n                            <a href="#orcid-instructions"> <i class="fa fa-info-circle" aria-hidden="true"></i> Learn how to claim ORCID papers</a>\n                        </li>\n                        <li class="divider"></li>\n                        <li>\n                            <a class="orcid-logout" >Log out from ORCID</a>\n                        </li>\n                    </ul>\n                </li>\n\n'},13:function(e,t,n,i){return'\n                <li class="dropdown orcid-dropdown s-orcid-dropdown">\n                    <button class="btn dropdown-toggle btn-link" data-toggle="dropdown" aria-expanded="false">\n                        <span class="s-orcid-title"> <img src="../../styles/img/orcid-inactive.svg"\n                                                          alt="orcid symbol"/>  ORCID  <span class="caret"></span></button>\n                    <ul class="dropdown-menu" role="menu">\n                      <li class="no-hover-style">\n                        <a href="javascript:void(0);" class="orcid-sign-in">Sign in to ORCID to claim papers in the ADS.</a>\n                      </li>\n                    </ul>\n                </li>\n\n                \x3c!--end "if/else orcidLoggedIn"--\x3e\n\n'},15:function(e,t,n,i){var a;return'\n                \x3c!-- Single button --\x3e\n                <li class="dropdown account-dropdown">\n                    <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                     <i class="fa fa-user" aria-hidden="true"></i> Account <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style" style="padding:15px 10px;">You are signed in as <br/> <span class="s-text-bold">'+this.escapeExpression("function"==typeof(a=null!=(a=t.currentUser||(null!=e?e.currentUser:e))?a:t.helperMissing)?a.call(e,{name:"currentUser",hash:{},data:i}):a)+'</span></li>\n                        <li><a href="#user/libraries"> <i class="fa fa-book" aria-hidden="true"></i> ADS Libraries</a></li>\n                        <li><a href="#user/settings"> <i class="fa fa-cog" aria-hidden="true"></i> Settings</a></li>\n                        <li class="divider"></li>\n                        <li><a href="javascript:void(0)" class="logout">Log Out</a></li>\n                    </ul>\n                </li>\n\n'},17:function(e,t,n,i){return'                <li class="register"><a href="#user/account/register">Sign Up</a></li>\n                <li class="login"><a href="#user/account/login">Log In</a></li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<nav class="navbar fluid navbar-inverse" aria-label="main navigation">\n        \x3c!-- Brand and toggle get grouped for better mobile display --\x3e\n        <div class="navbar-header">\n            <button type="button" class="navbar-toggle" data-toggle="collapse"\n                    data-target="#bs-example-navbar-collapse-1">\n                <span class="sr-only">Toggle navigation</span>\n                <span class="icon-bar" aria-hidden="true"></span>\n                <span class="icon-bar" aria-hidden="true"></span>\n                <span class="icon-bar" aria-hidden="true"></span>\n            </button>\n'+(null!=(a=t.unless.call(e,null!=e?e.hourly:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+'        </div>\n\n        \x3c!-- Collect the nav links, forms, and other content for toggling --\x3e\n        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">\n\n            <ul class="nav navbar-nav navbar-right">\n\n                <li class="dropdown">\n                  <button type="button" class="btn btn-link dropdown-toggle feedback-button" data-toggle="dropdown" aria-expanded="false">\n                    <i class="fa fa-comment feedback-icon" aria-hidden="true"></i> Feedback <span class="caret"></span>\n                  </button>\n                  <ul class="dropdown-menu" role="menu">\n                    <li>\n                      <a href="javascript:void(0);" data-target="#feedback-modal" data-toggle="modal" data-feedback-view="list">\n                        <i class="fa fa-pencil" aria-hidden="true"></i> Submit Updates\n                      </a>\n                    </li>\n                    <li>\n                      <a href="javascript:void(0);" data-target="#feedback-modal" data-toggle="modal" data-feedback-view="general">\n                        <i class="fa fa-envelope" aria-hidden="true"></i> General Feedback\n                      </a>\n                    </li>\n                  </ul>\n                </li>\n\n'+(null!=(a=t.if.call(e,null!=e?e.orcidLoggedIn:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.program(13,i,0),data:i}))?a:"")+'\n                <li class="dropdown">\n                    <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                      <i class="fa fa-question-circle about-page-icon" aria-hidden="true"></i> About <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li> <a href="/about/" target="_blank" rel="noreferrer noopener"> <i class="fa fa-question-circle" aria-hidden="true"></i> About ADS </a></li>\n                        <li> <a href="/help/whats_new/" target="_blank" rel="noreferrer noopener"> <i class="fa fa-bullhorn" aria-hidden="true"></i> What\'s New </a></li>\n                        <li> <a href="/blog/" target="_blank" rel="noreferrer noopener"> <i class="fa fa-newspaper-o" aria-hidden="true"></i> ADS Blog </a></li>\n                        <li> <a href="/help/" target="_blank" rel="noreferrer noopener"> <i class="fa fa-info-circle" aria-hidden="true"></i> ADS Help Pages </a></li>\n\t\t\t\t\t\t            <li> <a href="/help/legacy/" target="_blank" rel="noreferrer noopener"> <i class="fa fa-archive" aria-hidden="true"></i> ADS Legacy Services </a></li>\n                        <li> <a href="/about/careers/" target="_blank" rel="noreferrer noopener"> <i class="fa fa-group" aria-hidden="true"></i> Careers@ADS </a></li>\n                    </ul>\n                </li>\n\n\n'+(null!=(a=t.if.call(e,null!=e?e.currentUser:e,{name:"if",hash:{},fn:this.program(15,i,0),inverse:this.program(17,i,0),data:i}))?a:"")+"\n            </ul>\n\n        </div>\n        \x3c!-- /.navbar-collapse --\x3e\n    </div>\n</nav>\n\x3c!-- /.container-fluid --\x3e\n"},useData:!0});return e.registerPartial("js/widgets/navbar/template/navbar",t),t}),define("hbs!js/widgets/navbar/template/feedback",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="modal fade" id="feedback-modal">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button\n          type="button"\n          class="close"\n          data-dismiss="modal"\n          aria-label="Close"\n        >\n          <span aria-hidden="true">&times;</span>\n        </button>\n        <p class="modal-title">\n          <span class="btn-group" id="feedback-back-btn" style="display: none">\n            <button class="btn btn-sm btn-default">\n              <i class="fa fa-chevron-left" aria-hidden="true"></i> Back\n            </button>\n          </span>\n          <span id="feedback-modal-title">How may we help you?</span>\n        </p>\n      </div>\n      <div class="modal-body">\n        <div class="list-group" id="feedback-select-group">\n          <a\n            href="/feedback/correctabstract"\n            id="feedback_submit_abstract_link"\n            class="list-group-item"\n          >\n            <h4>Missing/Incorrect Record</h4>\n            <p>Submit a missing record or correct an existing record.</p>\n          </a>\n          <a\n            href="/feedback/missingreferences"\n            class="list-group-item"\n          >\n            <h4>Missing References</h4>\n            <p>Submit missing references to an existing ADS record.</p>\n          </a>\n          <a\n            href="/feedback/associatedarticles"\n            class="list-group-item"\n          >\n            <h4>Associated Articles</h4>\n            <p>\n              Submit associated articles to an existing record (e.g. arXiv /\n              published paper).\n            </p>\n          </a>\n          <a\n            href="javascript:void(0);"\n            class="list-group-item"\n            id="open-general-feedback"\n          >\n            <h4>General Feedback</h4>\n            <p>Send your comments and suggestions for improvements.</p>\n          </a>\n        </div>\n        <form\n          id="feedback-general-form"\n          class="feedback-form"\n          style="display: none"\n        >\n          <input type="hidden" name="_subject" value="Bumblebee Feedback" />\n          <input type="hidden" name="feedback-type" value="feedback" />\n\n          <input type="text" name="_gotcha" style="display:none" />\n\n          <div class="form-group half-width">\n            <label>\n              Name\n              <input\n                class="form-control"\n                type="text"\n                name="name"\n                required\n                autofocus\n              />\n            </label>\n          </div>\n          <div class="form-group half-width">\n            <label>\n              Email\n              <input\n                class="form-control"\n                type="email"\n                name="_replyto"\n                required\n              />\n            </label>\n          </div>\n\n          <div class="form-group">\n            <label\n              >Feedback <br />\n              <textarea\n                rows="8"\n                cols="50"\n                name="comments"\n                required\n                style="min-width: 500px; min-height: 180px"\n              />\n            </label>\n          </div>\n          <div class="form-group">\n            <button class="btn btn-success" type="submit" value="Send">\n              Submit\n            </button>\n          </div>\n\n          <div class="form-group">\n            <div class="g-recaptcha"></div>\n          </div>\n          <div class="form-group">\n            <p class="alert alert-info text-center">\n              You can also reach us at\n              <span class="s-text-bold">adshelp [at] cfa.harvard.edu</span>\n            </p>\n          </div>\n          <input type="hidden" name="origin" value="bbb_feedback">\n        </form>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default" data-dismiss="modal">\n          Close without submitting\n        </button>\n      </div>\n    </div>\n    \x3c!-- /.modal-content --\x3e\n  </div>\n  \x3c!-- /.modal-dialog --\x3e\n</div>\n\x3c!-- /.modal --\x3e\n'},useData:!0});return e.registerPartial("js/widgets/navbar/template/feedback",t),t}),define("js/widgets/navbar/widget",["underscore","marionette","js/widgets/base/base_widget","hbs!js/widgets/navbar/template/navbar","hbs!js/widgets/navbar/template/feedback","js/components/api_query_updater","js/components/api_query","js/components/api_request","js/components/api_targets","utils","bootstrap"],function(e,t,n,i,a,r,s,o,l,c){var u,d;return d=Backbone.Model.extend({defaults:function(){return{orcidModeOn:!1,orcidLoggedIn:!1,currentUser:void 0,orcidFirstName:void 0,orcidLastName:void 0,hourly:!1,timeout:6e5}}}),u=t.ItemView.extend({initialize:function(){window.__BUMBLEBEE_TESTING_MODE__||(this.onRender=e.debounce(this.onRender,500))},template:i,modelEvents:{change:"render"},events:{"click .orcid-dropdown ul":"stopPropagation","click a.orcid-sign-in":"orcidSignIn","change .orcid-mode":"changeOrcidMode","click .orcid-link":function(){this.trigger("navigate-to-orcid-link")},"click .orcid-logout":function(e){return this.trigger("logout-only-orcid"),!1},"click .logout":function(e){return this.trigger("logout"),!1},"click .login":function(){this.trigger("navigate-login")},"click .register":function(){this.trigger("navigate-register")},"click button.search-author-name":function(e){this.trigger("search-author")}},stopPropagation:function(e){if("button"==e.target.tagName.toLowerCase()||"a"==e.target.tagName.toLowerCase()||"code"==e.target.tagName.toLowerCase())return!0;e&&e.stopPropagation&&e.stopPropagation()},orcidSignIn:function(){this.model.set("orcidModeOn",!0),this.trigger("user-change-orcid-mode")},changeOrcidMode:function(t){var n=e.isBoolean(t)?t:t&&t.currentTarget&&t.currentTarget.checked;this.model.set("orcidModeOn",n),this.trigger("user-change-orcid-mode"),this.render()},_hiddenTmpl:e.template('<input type="hidden" name="<%= name %>" value="<%= value %>" />'),appendToForm:function(t,n){if(!e.isUndefined(n)){var i=$("#feedback-general-form","#feedback-modal"),a=$('input[type=hidden][name="'.concat(t,'"]'),i);a.length>0?a.attr("value",n):i.append(this._hiddenTmpl({name:t,value:n}))}},onRender:function(){var e=this;0===$("#feedback-modal").length&&$("body").append(a());var t=$("#feedback-modal"),n=$("#feedback-modal-title",t),i=$("#feedback-select-group",t),r=$("#feedback-general-form",t),s=$("#feedback-back-btn",t),o=$("a#feedback_submit_abstract_link",i),l=function(){i.show(),r.hide(),s.hide(),n.text("How may we help you today?")},c=function(){i.hide(),r.show(),n.text("General Feedback"),s.show(),s.off().click(function(){return l()}),t.one("shown.bs.modal",function(){$("input[name=name]",r).focus()})};t.on("hidden.bs.modal",function(){$("input, textarea",t).val(""),$("button[type=submit]",t).closest(".form-group").html('<button class="btn btn-success" type="submit" value="Send">Submit</button>'),l()}),t.on("show.bs.modal",function(e){"general"===$(e.relatedTarget).data("feedbackView")&&c()}),t.on("shown.bs.modal",function(){if(e.trigger("activate-recaptcha"),r.off().submit(function(n){return n.preventDefault(),e.trigger("feedback-form-submit",$(n.target),t),!1}),$("#open-general-feedback").off().click(function(){return c(),$("input[name=name]",r).focus(),!1}),e.model.has("currentUser")){var n=e.model.get("currentUser");$("input[name=_replyto]",r).val(n),e.appendToForm("currentuser",n)}else e.appendToForm("currentuser","anonymous");if(e.model.has("browser")){var i=e.model.get("browser"),a=i.browser,s=i.platform,l=i.engine,u=i.os;e.appendToForm("browser.name",a.name),e.appendToForm("browser.version",a.version),e.appendToForm("engine",l.name),e.appendToForm("platform",s.type),e.appendToForm("os",u.name)}e.model.has("page")&&e.appendToForm("current_page",e.model.get("page")),e.appendToForm("url",window.location.href),e.model.has("currentQuery")&&e.appendToForm("current_query",e.model.get("currentQuery")),"ShowAbstract"===e.model.get("page")&&e.model.has("bibcode")?o.attr("href",function(t,n){return n.indexOf("?")>-1?n:n+"?bibcode="+e.model.get("bibcode")}):o.attr("href",function(e,t){return t.replace(/\?.*$/,"")})}),setTimeout(function(){$("a",".account-dropdown").click(function(){$(".dropdown-toggle",".account-dropdown").dropdown("toggle")})},300)}}),n.extend({initialize:function(e){var t=this;e=e||{},this.model=new d,this.view=new u({model:this.model}),n.prototype.initialize.apply(this,arguments),this.qUpdater=new r("NavBar"),c.getBrowserInfo().then(function(e){t.model.set("browser",e)}).fail(function(){t.model.set("browser",null)})},activate:function(t){this.setBeeHive(t),e.bindAll(this,["handleUserAnnouncement","getOrcidUserInfo","storeLatestPage","onCustomEvent","onStartSearch"]);var n=this.getPubSub();n.subscribe(n.USER_ANNOUNCEMENT,this.handleUserAnnouncement),n.subscribe(n.APP_STARTED,this.getOrcidUserInfo),n.subscribe(n.NAVIGATE,this.storeLatestPage),n.subscribe(n.CUSTOM_EVENT,this.onCustomEvent),n.subscribe(n.START_SEARCH,this.onStartSearch),this.setInitialVals(),this.model.get("timer")||this.resetOrcidTimer()},onStartSearch:function(e){this.model.set("currentQuery",e.url())},onCustomEvent:function(e,t){"orcid-action"===e?this.resetOrcidTimer():"latest-abstract-data"===e&&this.onNewAbstractData(t)},storeLatestPage:function(e){this._latestPage=e,this.model.set("page",e)},onNewAbstractData:e.debounce(function(e){this.model.set("bibcode",e.bibcode)},500),resetOrcidTimer:function(){var t=this.model.get("timer"),n=this.model.get("timeout");t&&clearTimeout(t),this.model.get("orcidModeOn")&&(t=setTimeout(e.bind(this.toggleOrcidMode,this,!1),n),this.model.set("timer",t))},viewEvents:{"navigate-login":function(){this._navigate("authentication-page",{subView:"login"})},"navigate-register":function(){this._navigate("authentication-page",{subView:"register"})},"navigate-settings":function(){this._navigate("UserPreferences")},logout:function(){this.getBeeHive().getObject("Session").logout(),this.orcidLogout()},"feedback-form-submit":"submitForm","navigate-to-orcid-link":"navigateToOrcidLink","user-change-orcid-mode":"toggleOrcidMode","logout-only-orcid":"orcidLogout","search-author":"searchAuthor","activate-recaptcha":"activateRecaptcha"},submitForm:function(t,n){var i,a,r=this,s=function(){var e=t.serialize();e+="&user-agent-string="+encodeURIComponent(navigator.userAgent);var i=new o({target:l.FEEDBACK,options:{method:"POST",data:e,dataType:"json",done:function(e){t.find("button[type=submit]").html('<i class="icon-success" aria-hidden="true"></i> Message sent!'),setTimeout(function(){n.modal("hide")},500)},fail:function(e){t.find("button[type=submit]").addClass("btn-danger").html('<i class="icon-danger" aria-hidden="true"></i> There was an error!')},beforeSend:function(){t.find("button[type=submit]").html('<i class="icon-loading" aria-hidden="true"></i> Sending form...')}}});r.getBeeHive().getService("Api").request(i)};i="g-recaptcha-response",a=!1,t.serializeArray().forEach(function(t){if(t.name===i&&!e.isEmpty(t.value))return a=!0}),a?s():this.getBeeHive().getObject("RecaptchaManager").execute().then(s)},navigateToOrcidLink:function(){this._navigate("orcid-page")},_navigate:function(e,t){var n=this.getPubSub();n.publish(n.NAVIGATE,e,t)},setInitialVals:function(){var e=this.getBeeHive().getObject("User"),t=this.getBeeHive().getService("OrcidApi").hasAccess();this.model.set({orcidModeOn:e.isOrcidModeOn()&&t,orcidLoggedIn:t}),this.model.set("currentUser",e.getUserName())},getOrcidUserInfo:function(){var e=this.getBeeHive().getService("OrcidApi");if(this.model.get("orcidLoggedIn")){var t=this;e.getUserBio().done(function(e){var n=e.getFirstName(),i=e.getLastName();t.model.set("orcidFirstName",n),t.model.set("orcidLastName",i),t.model.set("orcidQueryName",i+", "+n),t.model.set("orcidURI",e.getOrcid())})}var n=this.getBeeHive().getObject("AppStorage").getConfigCopy().hourly;this.model.set("hourly",n)},handleUserAnnouncement:function(t,n){var i=this.getBeeHive().getService("OrcidApi"),a=this.getBeeHive().getObject("User");t==a.USER_SIGNED_IN?this.model.set("currentUser",n):t==a.USER_SIGNED_OUT?this.model.set("currentUser",void 0):t==a.USER_INFO_CHANGE&&e.has(n,"isOrcidModeOn")&&(this.model.set({orcidModeOn:n.isOrcidModeOn,orcidLoggedIn:i.hasAccess()}),this.model.get("orcidLoggedIn")&&this.getOrcidUserInfo())},toggleOrcidMode:function(t){var n=this.getBeeHive().getObject("User"),i=this.getBeeHive().getService("OrcidApi"),a=e.isBoolean(t)?t:this.model.get("orcidModeOn");if(this.resetOrcidTimer(),a&&!i.hasAccess())return i.signIn();n.setOrcidMode(a),this.model.set("orcidModeOn",a)},searchAuthor:function(){var e=this.getPubSub();e.publish(e.START_SEARCH,new s({q:"author:"+this.qUpdater.quote(this.model.get("orcidQueryName"))}))},signOut:function(){var e=this.getBeeHive().getObject("User"),t=this.getBeeHive().getService("OrcidApi");t&&t.signOut(),e.setOrcidMode(!1)},orcidLogout:function(){var e=this.getPubSub();this.getBeeHive().getService("OrcidApi").signOut(),this.model.set("orcidLoggedIn",!1),this.getBeeHive().getObject("User").setOrcidMode(!1),"orcid-page"===this._latestPage&&e.publish(e.NAVIGATE,"index-page")},activateRecaptcha:function(){if(!this._activated){this._activated=!0;var e=new t.ItemView({el:"#feedback-modal"});this.getBeeHive().getObject("RecaptchaManager").activateRecaptcha(e)}}})}),define("js/mixins/user_change_rows",["marionette","js/components/api_targets"],function(e,t){var n={};return n.Model=Backbone.Model.extend({initialize:function(e){if(this.on("change:numFound",this.updateMax),this.on("change:rows",this.updateCurrent),!e.widgetName)throw new Error("need to configure with widget name so we can get limit/default info from api_targets._limits");var n={rows:void 0,numFound:void 0,current:void 0,max:void 0,userVal:void 0};_.extend(n,t._limits[e.widgetName]),this.defaults=function(){return n},this.set(this.defaults())},updateMax:function(){var e=_.min([this.get("limit"),this.get("numFound")]);this.set("max",e)},updateCurrent:function(){this.set("current",_.min([this.get("rows"),this.get("numFound")]))}}),n}),define("hbs!js/widgets/network_vis/templates/author-details-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'    <button class="btn btn-sm  btn-default filter-remove">\n      <i class="s-filter-image"></i>remove from filter\n    </button>\n'},3:function(e,t,n,i){return'    <button class="btn btn-sm btn-default filter-add">\n      <i class="s-filter-image"></i> add to filter\n    </button>\n'},5:function(e,t,n,i){var a,r;return'    <li>\n      <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'" target="_blank" rel="noreferrer noopener"\n        ><b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+"</b></a\n      >\n"+(null!=(a=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.numAuthors:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"    </li>\n"},6:function(e,t,n,i){var a;return"      <small> "+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+" citations</small>\n"},8:function(e,t,n,i){return"      <small>no citations</small>\n      "},10:function(e,t,n,i){var a;return"\n      <small>("+this.escapeExpression("function"==typeof(a=null!=(a=t.numAuthors||(null!=e?e.numAuthors:e))?a:t.helperMissing)?a.call(e,{name:"numAuthors",hash:{},data:i}):a)+" authors from this group)</small>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="author-detail-header print-hidden">\n  <div style="border-bottom:4px solid '+this.escapeExpression("function"==typeof(r=null!=(r=t.groupColor||(null!=e?e.groupColor:e))?r:t.helperMissing)?r.call(e,{name:"groupColor",hash:{},data:i}):r)+'">\n    <h4>'+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+"</h4>\n"+(null!=(a=t.if.call(e,null!=e?e.inFilter:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"  </div>\n  <div>\n    Total Papers: "+this.escapeExpression("function"==typeof(r=null!=(r=t.total||(null!=e?e.total:e))?r:t.helperMissing)?r.call(e,{name:"total",hash:{},data:i}):r)+" Most recent Paper: "+this.escapeExpression("function"==typeof(r=null!=(r=t.mostRecentYear||(null!=e?e.mostRecentYear:e))?r:t.helperMissing)?r.call(e,{name:"mostRecentYear",hash:{},data:i}):r)+'\n  </div>\n  <button\n    class="btn btn-default load-author-network"\n    data-query="'+this.escapeExpression("function"==typeof(r=null!=(r=t.dataQuery||(null!=e?e.dataQuery:e))?r:t.helperMissing)?r.call(e,{name:"dataQuery",hash:{},data:i}):r)+'"\n  >\n    View author network for this author\n  </button>\n</div>\n<div class="paper-description">\n  <h5>Papers by this author</h5>\n  <ul class="list-unstyled">\n'+(null!=(a=t.each.call(e,null!=e?e.papers:e,{name:"each",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+"  </ul>\n</div>\n"},useData:!0});return e.registerPartial("js/widgets/network_vis/templates/author-details-template",t),t}),define("hbs!js/widgets/network_vis/templates/container-template",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="container-fluid">\n<div class="row s-control-row">\n    <div class="col-xs-12 s-explore-close-container">\n        <div class="s-large-close close-widget close">x</div>\n    </div>\n    <header class="s-network-title">\n        <h3 class="title"></h3>\n        <button class="btn btn-link download s-download hidden">\n            <i class="fa fa-download fa-2x" aria-hidden="true" title="download data in csv"></i>\n            <span class="sr-only">download data in csv</span>\n        </button>\n    </header>\n    <div class="col-xs-12 col-sm-6">\n        <div class="network-metadata s-network-metadata"></div>\n    </div>\n    <div class="col-xs-12 col-sm-6">\n        <div class="network-filter-container s-network-filter-container"></div>\n    </div>\n</div>\n     <div class="network-container s-network-container row">\n         <div class="col-md-7 graph-container">\n\n         </div>\n         <div class="col-md-5 details-container">\n\n             \x3c!--tabs--\x3e\n\n             <div role="tabpanel">\n\n                 \x3c!-- Nav tabs --\x3e\n                 <ul class="nav nav-tabs" role="tablist">\n                     <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Summary</a></li>\n                     <li role="presentation"><a href="#selected-item" aria-controls="profile" role="tab" data-toggle="tab">Detail </a></li>\n                 </ul>\n\n                 \x3c!-- Tab panes --\x3e\n                 <div class="tab-content">\n                     <div role="tabpanel" class="tab-pane active" id="home"></div>\n                     <div role="tabpanel" class="tab-pane" id="selected-item">\n                         <br/>\n                         <br/>\n                         <b>No item selected</b>\n                         <p> Click on a section in the visualization on the left to see the papers\n                         associated with an author or group of authors.</p>\n                     </div>\n\n                 </div>\n\n             </div>\n\n\n\n         </div>\n\n     </div>\n </div>\n'},useData:!0});return e.registerPartial("js/widgets/network_vis/templates/container-template",t),t}),define("hbs!js/widgets/network_vis/templates/filter-container-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return" "+(null!=(a=t.each.call(e,null!=e?e.limit:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+" "},2:function(e,t,n,i){var a;return" "+this.escapeExpression(this.lambda(e,e))+" "+(null!=(a=t.unless.call(e,i&&i.last,{name:"unless",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"\n    "},3:function(e,t,n,i){return" OR "},5:function(e,t,n,i){return' select an author or group of authors in the visualization\n    below and click the "add to filter" button '},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="print-hidden">\n  <div>\n    <b><i class="s-filter-image"></i> Filter current search:</b>\n    <button class="btn btn-default btn-xs clear-filter">X clear</button>\n  </div>\n  <div class="s-filter-names-container ">\n    '+(null!=(a=t.if.call(e,null!=e?e.limit:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(5,i,0),data:i}))?a:"")+'\n  </div>\n\n  <div class="s-filter-buttons-container">\n    <div>\n      <button class="btn btn-success apply-filter">\n        <i class="icon-go fa-lg" aria-hidden="true"></i>\n      </button>\n    </div>\n  </div>\n</div>\n'},useData:!0});return e.registerPartial("js/widgets/network_vis/templates/filter-container-template",t),t}),define("hbs!js/widgets/network_vis/templates/graph-container-template",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-network-control-panel">\n    <div class="detail-panel s-detail-panel">\n        <h4 style="display:inline-block">Size wedges based on:</h4>\n        <div class="btn-group network-sizes" data-toggle="buttons">\n        <label class="btn btn-primary active">\n            <input type="radio" name="mode" value="size" checked autocomplete="off"> Author Occurrences\n        </label>\n        <label class="btn btn-primary">\n            <input type="radio" name="mode" value="citation_count" autocomplete="off"> Paper Citations\n        </label>\n        <label class="btn btn-primary">\n            <input type="radio" name="mode" value="read_count" autocomplete="off"> Paper Downloads\n        </label>\n        </div>\n        <br/>\n        <label class="custom-checkbox">\n            <input type="checkbox" name="show-link" value="true"> View Link Overlay\n        </label>\n    </div>\n</div>\n\n<div class="s-network-graph-div">\n    <svg id="network-viz-main-chart"\n         class="network-chart s-network-chart"\n         viewBox="0 0 900 900"\n         style="font-family:helvetica,arial,san-serif"\n    >\n    </svg>\n    <a id="download-link" class="hidden"></a> \n\n</div>\n\n\n\n\n\n\n\n'},useData:!0});return e.registerPartial("js/widgets/network_vis/templates/graph-container-template",t),t}),define("hbs!js/widgets/network_vis/templates/group-details-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return'      <button class="btn btn-sm btn-default filter-remove">\n        <i class="s-filter-image"></i>remove from filter\n      </button>\n'},3:function(e,t,n,i){return'      <button class="btn btn-sm btn-default filter-add">\n        <i class="s-filter-image"></i> add to filter\n      </button>\n'},5:function(e,t,n,i){var a,r;return'    <li>\n      <a\n        href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'"\n        data-bypass=""\n        target="_blank"\n        rel="noreferrer noopener"\n        ><b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+"</b></a\n      >\n"+(null!=(a=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.numAuthors:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"\n    </li>\n"},6:function(e,t,n,i){var a;return"      <small> "+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+" citations</small> "},8:function(e,t,n,i){return"\n      <small>no citations</small> "},10:function(e,t,n,i){var a;return"\n      <small>("+this.escapeExpression("function"==typeof(a=null!=(a=t.numAuthors||(null!=e?e.numAuthors:e))?a:t.helperMissing)?a.call(e,{name:"numAuthors",hash:{},data:i}):a)+" authors from this group)</small> "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="author-detail-header">\n  <div style="border-bottom:4px solid '+this.escapeExpression("function"==typeof(r=null!=(r=t.groupColor||(null!=e?e.groupColor:e))?r:t.helperMissing)?r.call(e,{name:"groupColor",hash:{},data:i}):r)+'" class="print-hidden">\n    <h4>Group '+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+'</h4>\n    <span class="pull-right">\n'+(null!=(a=t.if.call(e,null!=e?e.inFilter:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"    </span>\n  </div>\n  <small>Total papers: "+this.escapeExpression("function"==typeof(r=null!=(r=t.total||(null!=e?e.total:e))?r:t.helperMissing)?r.call(e,{name:"total",hash:{},data:i}):r)+"</small>\n  <small>Most recent: "+this.escapeExpression("function"==typeof(r=null!=(r=t.mostRecentYear||(null!=e?e.mostRecentYear:e))?r:t.helperMissing)?r.call(e,{name:"mostRecentYear",hash:{},data:i}):r)+'</small>\n</div>\n<div class="paper-description">\n  <ul class="list-unstyled">\n'+(null!=(a=t.each.call(e,null!=e?e.papers:e,{name:"each",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+"  </ul>\n</div>\n"},useData:!0});return e.registerPartial("js/widgets/network_vis/templates/group-details-template",t),t}),define("hbs!js/widgets/network_vis/templates/not-enough-data-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return'  <button\n    class="btn btn-default load-author-network"\n    data-query="'+this.escapeExpression("function"==typeof(a=null!=(a=t.cachedQuery||(null!=e?e.cachedQuery:e))?a:t.helperMissing)?a.call(e,{name:"cachedQuery",hash:{},data:i}):a)+'"\n  >\n    <i class="fa fa-arrow-left" aria-hidden="true"></i>\n    Go back to previous author network. ('+this.escapeExpression("function"==typeof(a=null!=(a=t.cachedQuery||(null!=e?e.cachedQuery:e))?a:t.helperMissing)?a.call(e,{name:"cachedQuery",hash:{},data:i}):a)+")\n  </button>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="col-xs-12">\n  <br />\n  <p>\n    The network grouping algorithm could not generate group data for your\n    network.\n  </p>\n  <p>\n    This might be because the list of papers was too small or sparse to produce\n    multiple meaningful groups.\n  </p>\n  <p>\n    <a href="/help/actions/visualize">\n      Learn more about how ADS networks are created and how they can be used.\n    </a>\n  </p>\n\n'+(null!=(a=t.if.call(e,null!=e?e.cachedQuery:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"</div>\n"},useData:!0});return e.registerPartial("js/widgets/network_vis/templates/not-enough-data-template",t),t}),define("hbs!js/widgets/network_vis/templates/network_metadata",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return'  <form action="">\n    Change to first\n    <input\n      type="text"\n      class="network-rows s-network-rows form-control input-sm"\n    />\n    papers (max is '+this.escapeExpression("function"==typeof(a=null!=(a=t.max||(null!=e?e.max:e))?a:t.helperMissing)?a.call(e,{name:"max",hash:{},data:i}):a)+').\n    <button type="submit" class="submit-rows btn btn-sm btn-info">\n      Submit\n    </button>\n  </form>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="print-hidden">\n  <h4>Currently viewing data for '+this.escapeExpression("function"==typeof(r=null!=(r=t.current||(null!=e?e.current:e))?r:t.helperMissing)?r.call(e,{name:"current",hash:{},data:i}):r)+" papers.</h4>\n  <br />\n"+(null!=(a=t.if.call(e,null!=e?e.max:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"</div>\n"},useData:!0});return e.registerPartial("js/widgets/network_vis/templates/network_metadata",t),t}),define("hbs!js/widgets/network_vis/templates/loading-template",["hbs/handlebars","hbs!js/wraps/widget/loading/template"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return null!=(a=this.invokePartial(n["js/wraps/widget/loading/template"],e,{name:"js/wraps/widget/loading/template",hash:{hideCloseButton:!0,widgetLoadingSize:"medium"},data:i,helpers:t,partials:n}))?a:""},usePartial:!0,useData:!0});return e.registerPartial("js/widgets/network_vis/templates/loading-template",t),t}),define("hbs!js/widgets/network_vis/templates/default-details-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return'<h3><span class="s-light-font">Author Network</span></h3>\n\n<p>This network visualization finds groups of authors within your search results.\n    You can click on the segments to view the papers connected with a group or a particular author.\n</p>\n\n<h5>Group Activity Over Time (measured in papers published)</h5>\n <div class="time-series-container">\n <svg viewBox="0 0 960 500" id="network-viz-time-series"></svg>\n </div>\n\n<br/>\n<div>\n    <a href="/help/actions/visualize#author-network" target="_blank" rel="noreferrer noopener">Learn more about the author network.</a>\n</div>\n\n\n'+(null!=(a=t.if.call(e,null!=e?e.cachedQuery:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?a:"")+"\n\n\n\n</div>\n\n"},2:function(e,t,n,i){var a;return'<button class="btn btn-default load-author-network" data-query="'+this.escapeExpression("function"==typeof(a=null!=(a=t.cachedQuery||(null!=e?e.cachedQuery:e))?a:t.helperMissing)?a.call(e,{name:"cachedQuery",hash:{},data:i}):a)+'">\n    <i class="fa fa-arrow-left" aria-hidden="true"></i>\n    Go back to previous author network ('+this.escapeExpression("function"==typeof(a=null!=(a=t.cachedQuery||(null!=e?e.cachedQuery:e))?a:t.helperMissing)?a.call(e,{name:"cachedQuery",hash:{},data:i}):a)+")\n</button>\n"},4:function(e,t,n,i){return"\x3c!--only show this for first time view of network--\x3e\n\n<p>If you are interested in seeing the author network for another author, you can do that directly\n    by clicking on the author in the ring visualization, then clicking the button at the top.</p>\n\n<p>You can zoom and drag the visualization to reposition it.</p>\n\n"},6:function(e,t,n,i){var a;return'<h3><span class="s-light-font">Paper Network for Query</span> '+this.escapeExpression("function"==typeof(a=null!=(a=t.currentQuery||(null!=e?e.currentQuery:e))?a:t.helperMissing)?a.call(e,{name:"currentQuery",hash:{},data:i}):a)+'</h3>\n\n<p>The segments of the visualization to the left represent groups of papers from your result set which cite similar papers. </p>\n\n<h5>Group Activity Over Time (measured in papers published)</h5>\n<div class="time-series-container">\n    <svg id="network-chart-main-visualization" viewBox="0 0 960 500"></svg>\n</div>\n\n<br/>\n<p>Click on a group to learn more about the papers within the group, as well as the papers cited by those papers.</p>\n<a href="/help/actions/visualize#paper-network" target="_blank" rel="noreferrer noopener">Learn more about the paper network.</a>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.networkType:e,"author",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.networkType:e,"paper",{name:"compare",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return e.registerPartial("js/widgets/network_vis/templates/default-details-template",t),t}),define("js/widgets/network_vis/network_widget",["marionette","d3","js/components/api_targets","js/mixins/user_change_rows","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","js/components/api_query_updater","hbs!js/widgets/network_vis/templates/author-details-template","hbs!js/widgets/network_vis/templates/container-template","hbs!js/widgets/network_vis/templates/filter-container-template","hbs!js/widgets/network_vis/templates/graph-container-template","hbs!js/widgets/network_vis/templates/group-details-template","hbs!js/widgets/network_vis/templates/not-enough-data-template","hbs!js/widgets/network_vis/templates/network_metadata","hbs!js/widgets/network_vis/templates/loading-template","hbs!js/widgets/network_vis/templates/default-details-template","bootstrap"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,m,g){var b;function v(e){return!isNaN(e)&&(0|(t=parseFloat(e)))===t;var t}var y=Backbone.Model.extend({defaults:{name:void 0},idAttribute:"name"}),w=Backbone.Collection.extend({model:y}),x=e.ItemView.extend({initialize:function(e){this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"reset",this.render)},serializeData:function(){var e=this,t={};return t.limit=this.collection.pluck("name"),_.each(t.limit,function(n,i){v(n)&&"author"==e.options.networkType?t.limit[i]="at least one member of Group "+n:v(n)&&"paper"==e.options.networkType&&(t.limit[i]="Group "+n)}),t},template:u,childViewContainer:".dropdown-menu",events:{"click .apply-filter":"initiateFilter","click .clear-filter":"clearFilter"},initiateFilter:function(){this.trigger("filter:initiated")},clearFilter:function(){this.collection.reset()}}),S=e.ItemView.extend({template:g,serializeData:function(){return{currentQuery:e.getOption(this,"query"),networkType:e.getOption(this,"networkType"),cachedQuery:e.getOption(this,"cachedQuery")}},getData:function(){if("author"==e.getOption(this,"networkType")){var n=[];_.each(e.getOption(this,"graphData").root.children,function(e,i){var a=i;if(!(i>6)){var r=[];_.each(e.children,function(e,t){Array.prototype.push.apply(r,e.papers)}),r=_.uniq(r);var s=_.map(r,function(e){return parseInt(e.slice(0,4))});r=_.countBy(r,function(e){return e.slice(0,4)});var o=_.range.apply(void 0,t.extent(s)),l={};_.each(o,function(e){l[e]=0}),r=_.extend(l,r),r=_.map(r,function(e,t){return{year:parseInt(t),amount:e}}),n.push({name:a,values:r})}})}else if("paper"==e.getOption(this,"networkType")){var i=e.getOption(this,"graphData").summaryGraph,a=e.getOption(this,"graphData").fullGraph,r=(n=[],{}),s=_.pluck(i.nodes,"id"),o=_.pluck(i.nodes,"node_name");_.each(s,function(e,t){var n=[];_.each(a.nodes,function(t,i){t.group===e&&n.push(t.node_name)}),r[o[t]]=n}),_.each(r,function(e,i){if(!(i>6)){o=_.uniq(e);var a=_.map(o,function(e){return parseInt(e.slice(0,4))});o=_.countBy(o,function(e){return e.slice(0,4)});var r=_.range.apply(void 0,t.extent(a)),s={};_.each(r,function(e){s[e]=0});var o=_.extend(s,o);o=_.map(o,function(e,t){return{year:parseInt(t),amount:e}}),n.push({name:parseInt(i)-1,values:o})}})}return n},onRender:function(){var e=this.getData(),n=!0;if(_.each(e,function(e){1!==e.values.length&&(n=!1)}),n){var i=e[0].values[0].year;this.$(".time-series-container").html("Not enough data to show a graph: All papers are from the year "+i)}else{var a=[],r=[];_.each(e,function(e){_.each(e.values,function(e){a.push(e.year),r.push(e.amount)})}),a=_.uniq(a);var s=20,o=80,l=30,c=50,u=960-c-o,d=500-s-l,h=t.scale.linear().range([0,u]),p=t.scale.linear().range([d,0]),f=t.svg.axis().scale(h).orient("bottom").tickFormat(t.format("0f")).ticks(5);a.length<=10&&f.tickValues(a);var m=t.svg.axis().scale(p).tickFormat(t.format("d")).orient("left"),g=t.svg.line().interpolate("bundle").x(function(e){return h(e.year)}).y(function(e){return p(e.amount)}),b=t.select(this.$("svg")[0]).attr("width",u+c+o).attr("height",d+s+l).attr("style","font-family:helvetica,arial,san-serif").attr("id","network-viz-time-series").append("g").attr("transform","translate("+c+","+s+")"),v=t.scale.ordinal().domain([0,1,2,3,4,5,6]).range(["hsla(282, 80%, 52%, 1)","hsla(1, 80%, 51%, 1)","hsla(42, 97%, 48%, 1)","hsla(152, 80%, 40%, 1)","hsla(193, 80%, 48%, 1)","hsla(220, 80%, 56%, 1)","hsla(250, 69%, 47%, 1)"]);h.domain(t.extent(a)),p.domain([0,_.max(r)]),b.attr("aria-label","author network graph").append("g").attr("class","axis").attr("transform","translate(0,"+d+")").call(f),b.append("g").attr("class","axis").call(m);var y=b.selectAll(".group").data(e).enter().append("g").attr("class","group");y.append("path").attr("class","line").attr("d",function(e){return g(e.values)}).style("stroke",function(e){return v(e.name)}),y.append("text").datum(function(e){return{name:e.name,value:e.values[e.values.length-1]}}).attr("transform",function(e){return"translate("+h(e.value.year)+","+p(e.value.amount)+")"}).attr("x",3).attr("dy",".35em").text(function(e){return e.name+1});n=_.filter(e,function(e){if(1==e.values.length)return!0});b.selectAll(".one-year").data(n).enter().append("circle").classed("one-year",!0).attr("r",5).attr("cx",function(e){return h(e.values[0].year)}).attr("cy",function(e){return p(e.values[0].amount)}).attr("fill",function(e){return v(e.name)})}}}),E=e.ItemView.extend((_defineProperty(b={template:c,className:function(){return"network-widget s-network-widget "+e.getOption(this,"networkType")},serializeData:function(t){var n=e.getOption(this,"networkType");return{networkType:n=n[0].toUpperCase()+n.slice(1),helpText:e.getOption(this,"helpText")}},ui:{filterContainer:".network-filter-container",graphContainer:".graph-container",detailsContainerSelected:".details-container #selected-item",detailsContainerHome:".details-container #home"},events:{"click .load-author-network":"forwardNewQueryRequest","click button.limit":"addItem","click .submit-rows":"changeRows","click .close":"triggerClose","click .download":"triggerDownload","click .filter-remove":function(t){if("paper"==e.getOption(this,"networkType")){var n=this.graphModel.get("selectedEntity").__data__.data.node_name;e.getOption(this,"filterCollection").remove({id:n}),this.graphView.showSelectedEntity(this.graphModel.get("selectedEntity"))}else{n=this.graphModel.get("selectedEntity").__data__.name;e.getOption(this,"filterCollection").remove({id:n}),this.showDetailView(this.graphModel.get("selectedEntity"))}},"click .filter-add":function(t){if("paper"==e.getOption(this,"networkType")){var n=this.graphModel.get("selectedEntity").__data__.data.node_name;e.getOption(this,"filterCollection").add({name:n}),this.graphView.showSelectedEntity(this.graphModel.get("selectedEntity"))}else{var i=[],a=this.graphModel.get("selectedEntity").__data__;a.papers?i=a.papers:_.each(a.children,function(e){[].push.apply(i,e.papers)}),e.getOption(this,"filterCollection").add({name:a.name,papers:i}),this.showDetailView(this.graphModel.get("selectedEntity"))}}},modelEvents:{change:"render"},triggerClose:function(){this.$(".network-filter-container").empty(),this.$(".network-container").html(m),this.trigger("close")},triggerDownload:function(){this.trigger("download")},forwardNewQueryRequest:function(e){this.ui.graphContainer.html(m()),this.trigger("new-network-requested",$(e.target).data("query"))},changeRows:function(e){var t=parseInt(this.$(".network-rows").val());if(_.isNumber(t)){var n=_.min([this.model.get("max"),t]);if(this.model.get("userVal")===n)return!1;this.$(".network-container").html(m),this.model.set("userVal",n)}return!1}},"modelEvents",{"change:graphData":"render","change:max":"renderMetadata","change:current":"renderMetadata"}),_defineProperty(b,"onRender",function(){var t,n;this.$(".title").html(this.model.get("title"));try{n=this.model.get("cachedQuery").get("q")[0]}catch(e){}return this.model.get("loading")?(this.$(".network-metadata").html(""),void this.$(".network-container").html(m())):!this.model.get("graphData")||_.isEmpty(this.model.get("graphData"))?(this.$(".network-metadata").html(""),void this.$(".network-container").html(p({cachedQuery:n}))):this.model.get("graphData").summaryGraph||this.model.get("graphData").root?(this.graphModel=new C({graphData:this.model.get("graphData")}),this.filterView=new x({collection:e.getOption(this,"filterCollection"),networkType:e.getOption(this,"networkType")}),this.listenTo(this.filterView,"filter:initiated",function(){this.trigger("filter:initiated")}),t=this.options.graphView?this.options.graphView:A,this.graphView=new t({model:this.graphModel,filterCollection:e.getOption(this,"filterCollection")}),this.graphView.on("show-detail-view",_.bind(this.showDetailView,this)),this.ui.filterContainer.append(this.filterView.render().el),this.ui.graphContainer.append(this.graphView.render().el),this.ui.detailsContainerHome.append(new S({graphData:this.model.get("graphData"),query:this.model.get("query"),networkType:e.getOption(this,"networkType"),cachedQuery:n}).render().el),this.$(".nav-tabs a[href='#home']").tab("show"),this.$(".download").removeClass("hidden"),void this.renderMetadata()):(this.$(".network-metadata").html(""),void this.$(".network-container").html(p({cachedQuery:n})))}),_defineProperty(b,"showDetailView",function(n){var i=n.__data__;(n=t.select(n)).select(".node-label").classed("selected-label",!0),n.select(".node-path").classed("selected-node",!0);var a,r=[],s={},o=[],c=this.model.get("graphData");if(i.children){a=i.children,_.each(a,function(e){Array.prototype.push.apply(r,e.papers)});f=_.sortBy(r,function(e){return e.slice(0,4)}).reverse()[0].slice(0,4);r=_.pairs(_.countBy(r));var u=_.chain(r).map(function(e){return e[1]}).sortBy(function(e){return e}).value(),d=_.chain(r).map(function(e){return e[1]/c.bibcode_dict[e[0]].authors.length}).sortBy(function(e){return e}).value(),p=_.chain(r).map(function(e){return c.bibcode_dict[e[0]].citation_count/c.bibcode_dict[e[0]].authors.length}).sortBy(function(e){return e}).value();r=_.sortBy(r,function(e){return(e[1]-u[0])/(u[u.length-1]-u[0])*(e[1]/c.bibcode_dict[e[0]].authors.length-d[0])/(d[d.length-1]-d[0])*(c.bibcode_dict[e[0]].citation_count/c.bibcode_dict[e[0]].authors.length-p[0])/(p[p.length-1]-p[0])}).reverse(),bibcodes=_.map(r,function(e){return e[0]}),o=_.map(bibcodes,function(e,t){var n={};return n.bibcode=e,n.title=c.bibcode_dict[e].title,n.citation_count=c.bibcode_dict[e].citation_count,n.numAuthors=r[t][1],n}),s.bibcodes=bibcodes,s.papers=o,s.groupColor=i.color,s.total=r.length,s.mostRecentYear=f,s.name=i.name,s.inFilter=!!e.getOption(this,"filterCollection").get(i.name),this.ui.detailsContainerSelected.empty().append(h(s))}else{o=_.map(i.papers,function(e){var t=c.bibcode_dict[e];return t.bibcode=e,_.isArray(t.title)&&(t.title=t.title[0]),t}),o=_.sortBy(o,function(e){return e.citation_count}).reverse();var f=_.chain(o).pluck("bibcode").sortBy(function(e){return e.slice(0,4)}).value().reverse()[0].slice(0,4);s.bibcodes=i.papers,s.mostRecentYear=f,s.papers=o,s.total=o.length,s.name=i.name,s.groupColor=i.parent.color,s.inFilter=!!e.getOption(this,"filterCollection").get(i.name),s.dataQuery='author:"'+i.name+'"',this.ui.detailsContainerSelected.empty().append(l(s))}this.$(".nav-tabs a[href='#selected-item']").tab("show")}),_defineProperty(b,"renderMetadata",function(){var e={};e.max=this.model.get("max"),e.current=this.model.get("current"),this.$(".network-metadata").html(f(e))}),b)),k=i.Model.extend({initialize:function(e){var t=e||{};if(this.on("newMetadata",function(){this.updateCurrent(),this.updateMax()}),!t.widgetName)throw new Error("need to configure with widget name so we can get limit/default info from api_targets._limits");var i={graphData:{},rows:void 0,numFound:void 0,current:void 0,max:void 0,userVal:void 0,cachedQuery:void 0,loading:!0};_.extend(i,n._limits[t.widgetName],t.title),this.defaults=function(){return i},this.set(this.defaults())}}),A=e.ItemView.extend({initialize:function(e){this.listenTo(e.filterCollection,"reset",this.showSelectedEntity)},template:d,events:{"change input[name=mode]":function(e){this.model.set("mode",e.target.value)},"change input[name=show-link]":function(e){this.model.set("linkLayer",e.target.checked)}},modelEvents:{"change:graphData":"renderGraph","change:selectedEntity":"showSelectedEntity","change:linkLayer":"changeLinkLayer","change:mode":"changeMode"},onRender:function(){this.model.get("graphData")&&this.renderGraph()},getConfig:function(){this.config={numberOfLabelsToShow:100,width:900,height:900,noGroupColor:"#a6a6a6"},this.config.radius=Math.min(this.config.width,this.config.height)/3},cachedVals:{partition:void 0,line:void 0,computeLabelPosition:void 0,svg:void 0,arc:void 0},renderGraph:function(){var e=this.model.get("graphData"),n=this;function i(e){var i=(e.x+e.x+e.dx)/2*180/Math.PI-90,a=parseInt(n.config.radius)+10,r=i>90?180:0;return r?t.select(this).attr("text-anchor","end"):t.select(this).attr("text-anchor","start"),"rotate("+i+")translate("+a+")rotate("+r+")"}this.cachedVals.svg=t.select(this.$("svg")[0]),this.getConfig(),this.customizeScales(e),this.cachedVals.computeLabelPosition=i;var a=n.cachedVals.svg.attr("width",n.config.width).attr("height",n.config.height).append("g").classed("network-g",!0),r=a.append("g").classed("real-container-of-stuff",!0),s=t.behavior.zoom().scaleExtent([.7,3]).on("zoom",function(){r.attr("transform","translate("+t.event.translate+")scale("+t.event.scale+")")});a.call(s),a.on("dblclick.zoom",null),a.attr("transform","translate("+n.config.width/2+","+n.config.height/2.1+")");var o=t.layout.partition().value(function(e){return e.size}).size([2*Math.PI,n.config.radius*n.config.radius]).sort(function(e,t){return t.value-e.value});this.cachedVals.partition=o;var l=t.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return 1==e.depth?Math.sqrt(e.y)+40:Math.sqrt(e.y)}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)});this.cachedVals.arc=l,r.append("circle").attr("r",n.config.radius).attr("fill","#fff").style("cursor","move");var c=r.selectAll("g").data(o.nodes(e.root)).enter().append("g").classed("node-containers",!0).each(function(e){e.sortVal=e.value}),u={};c.append("path").attr("d",l).classed("node-path",function(e){return 0!=e.depth}).style("cursor",function(e){if(0==e.depth)return"move"}).style("fill",function(e){if(0==e.depth)return"white";if(1==e.depth){var t=e.parent.children.indexOf(e);return t<7?(e.color=n.scales.color(t),u[e.name]=e.color,e.color):n.config.noGroupColor}return 2==e.depth?e.parent.color?e.parent.color:n.config.noGroupColor:void 0}).each(function(e){e.x0=e.x,e.dx0=e.dx});c.filter(function(e){return!e.children}).classed("author-node",!0).append("text").text(function(e){return e.name}).classed("node-label",!0).on("mouseover",function(e){if(n.model.get("linkLayer")){var i=e;t.selectAll(".link").filter(function(e){if(e[0]==i||e[e.length-1]==i)return!0}).classed("selected-link",!0),t.selectAll(".link").each(function(e){e[0]==i?t.selectAll(".node-label").filter(function(t){return t.name==e[e.length-1].name}).classed("linked-label",!0):e[e.length-1]==i&&t.selectAll(".node-label").filter(function(t){return t.name==e[0].name}).classed("linked-label",!0)})}}).on("mouseout",function(){t.selectAll(".link").classed("selected-link",!1),t.selectAll(".node-label").classed("linked-label",!1)}).attr("font-size",function(e){return n.scales.occurrencesFontScale(e.size)+"px"}).attr("transform",i),_.each(e.root.name,function(t,n){r.append("text").classed("s-connector-node",!0).attr("y",function(){return 25*n-25*e.root.name.length/2}).text(t.nodeName)}),c.on("click",function(e,t){0!=e.depth&&(n.model.get("linkLayer")||(n.model.get("selectedEntity")===this?n.model.set("selectedEntity",null):n.model.set("selectedEntity",this)))}),this.renderLinkLayer()},renderLinkLayer:function(){var e,n,i,a,r=this;svg=t.select(r.$(".real-container-of-stuff")[0]),tooltip=t.select(r.$(".d3-tooltip")[0]),bibDict=this.model.get("graphData").bibcode_dict,e=_.map(r.model.get("graphData").link_data,function(e){var t={};return t.source=svg.selectAll(".node-path").filter(function(t){return t.numberName==e[0]})[0][0].__data__,t.target=svg.selectAll(".node-path").filter(function(t){return t.numberName==e[1]})[0][0].__data__,t.weight=e[2],t}),n=t.layout.bundle(),i=t.svg.line.radial().interpolate("bundle").tension(.9).radius(function(e){return Math.sqrt(e.y+e.dy)}).angle(function(e){return(e.x+e.x+e.dx)/2}),this.cachedVals.line=i,(a=svg.append("g").classed("link-container",!0)).append("circle").attr("r",r.config.radius).classed("link-background",!0),a.selectAll(".link").data(n(e)).enter().append("path").attr("class","link").attr("d",function(e){return i(e)}).attr("stroke-width",function(t){var n=_.filter(e,function(e){return e.source==t[0]&&e.target==t[t.length-1]||e.target==t[0]&&e.source==t[t.length-1]})[0].weight;return r.scales.linkScale(n)})},customizeScales:function(e){this.scales={},this.scales.color=t.scale.ordinal().domain([0,1,2,3,4,5,6]).range(["hsla(282, 60%, 52%, 1)","hsla(349, 61%, 47%, 1)","hsla(26, 95%, 67%, 1)","hsla(152, 60%, 40%, 1)","hsla(193, 64%, 61%, 1)","hsla(220, 70%, 56%, 1)","hsla(250, 50%, 47%, 1)"]);var n=[],i=[],a=[];_.each(e.root.children,function(e){_.each(e.children,function(e){n.push(e.size),i.push(e.citation_count),a.push(e.read_count)})}),i=_.sortBy(i,function(e){return e}).reverse(),a=_.sortBy(a,function(e){return e}).reverse(),this.scales.citationLimit=i[this.config.numberOfLabelsToShow]||i[i.length-1],this.scales.readLimit=a[this.config.numberOfLabelsToShow]||a[a.length-1],this.scales.occurrencesFontScale=t.scale.log().domain([t.min(n),t.max(n)]).range([8,20]),this.scales.citationFontScale=t.scale.linear().domain([t.min(i),t.max(i)]).range([8,20]),this.scales.readFontScale=t.scale.linear().domain([t.min(a),t.max(a)]).range([8,20]);var r=_.map(e.link_data,function(e){return e[2]});this.scales.linkScale=t.scale.pow().exponent(8).domain([t.min(r),t.max(r)]).range([.5,3.5])},showSelectedEntity:function(){var e=this.model.get("selectedEntity"),t=this.$(".network-detail-area");this.cachedVals.svg.selectAll(".node-path").classed("selected-node",!1),this.cachedVals.svg.selectAll(".node-label").classed("selected-label",!1),t.empty(),e&&this.trigger("show-detail-view",e)},changeLinkLayer:function(e,n){n?(this.model.set("cachedEntity",this.model.get("selectedEntity")),this.model.set("selectedEntity",void 0),t.select(this.$(".link-container")[0]).style("display","block").selectAll(".link").call(function(e){3e3/e[0].length}).sort(function(e){return e.weight}).style("display","block")):(this.model.set("selectedEntity",this.model.get("cachedEntity")),t.select(this.$(".link-container")[0]).style("display","none"))},changeMode:function(e,n){var i=this;var a=i.cachedVals.svg.selectAll(".node-containers"),r=i.cachedVals.partition.sort(function(e,t){return t.sortVal-e.sortVal}).value(function(e){return e[n]}).nodes(i.model.get("graphData").root);a.data(r,function(e){return e.name}).selectAll("path").transition().duration(1500).attrTween("d",function(e){var n=t.interpolate({x:e.x0,dx:e.dx0},e);return function(t){var a=n(t);return e.x0=a.x,e.dx0=a.dx,i.cachedVals.arc(a)}}),a.selectAll("text").attr("opacity","0").attr("display",function(e){return"size"==n?"block":"citation_count"==n&&e.citation_count>i.scales.citationLimit?"block":"read_count"==n&&e.read_count>i.scales.readLimit?"block":"none"}).attr("font-size",function(e){return"size"==n?i.scales.occurrencesFontScale(e.size)+"px":"citation_count"==n?i.scales.citationFontScale(e.citation_count)+"px":"read_count"==n?i.scales.readFontScale(e.read_count)+"px":void 0}).attr("transform",i.cachedVals.computeLabelPosition).transition().duration(1500).attr("opacity",1),t.selectAll(".link").transition().duration(1500).attr("d",function(e){return i.cachedVals.line(e)})}}),C=Backbone.Model.extend({defaults:function(){return{graphData:{},selectedEntity:void 0,cachedEntity:void 0,query:void 0,linkLayer:!1,mode:"occurrences"}}});return s.extend({initialize:function(e){if(!e.endpoint)throw new Error("widget was not configured with an endpoint");e.broadcastFilteredQuery&&(this.broadcastFilteredQuery=e.broadcastFilteredQuery),this.model=new k({widgetName:e.widgetName||"AuthorNetwork",title:e.networkType.charAt(0).toUpperCase()+e.networkType.slice(1)+" Network"}),this.listenTo(this.model,"change:userVal",this.requestDifferentRows),this.filterCollection=new w,this.view=new E({graphView:e.graphView,model:this.model,filterCollection:this.filterCollection,networkType:e.networkType,helpText:e.helpText,graphMixin:e.graphMixin,showDetailGraphView:e.showDetailGraphView}),this.listenTo(this.view,"new-network-requested",this.requestDifferentQuery),this.listenTo(this.view,"filter:initiated",this.broadcastFilteredQuery),this.listenTo(this.view,"close",this.broadcastClose),this.listenTo(this.view,"download",this.download),this.widgetName="visualization_"+e.networkType,this.queryUpdater=new o(this.widgetName)},download:function(){var e="data:text/csv;charset=utf-8,",t="author-network.csv";if("AuthorNetwork"===this.model.get("widgetName")){var n=this.model.get("graphData").root;e+="group, author, papers, citation count, download count\n",n.children.forEach(function(t){var n=t.name;t.children.forEach(function(t){e+="".concat(n,',"').concat(t.name,'","').concat(t.papers.join(","),'",').concat(t.citation_count,",").concat(t.read_count,"\n")})})}else if("PaperNetwork"===this.model.get("widgetName")){t="papers-network.csv";var i=this.model.get("graphData").summaryGraph.nodes;i.sort(function(e,t){return e.node_name===t.node_name?0:e.node_name<t.node_name?-1:1}),e+="group,label,paper_count,top_references,citations,download count\n",i.forEach(function(t){e+='"'.concat(t.node_name,'","').concat(Object.keys(t.node_label).join(","),'","').concat(t.paper_count,'","').concat(Object.keys(t.top_common_references).join(","),'","').concat(t.total_citations,'","').concat(t.total_reads,'"\n')})}var a=encodeURI(e),r=document.getElementById("download-link");r.setAttribute("download",t),r.setAttribute("href",a),r.click()},generateApiRequest:function(t){return new a({target:e.getOption(this,"endpoint"),query:new r({query:JSON.stringify(t.toJSON())}),options:{type:"POST",contentType:"application/json"}})},requestDifferentRows:function(e,t){var n=this.getCurrentQuery().clone();n.unlock(),n.set("rows",this.model.get("userVal")),n.unset("hl"),n.unset("hl.fl");var i=this.generateApiRequest(n);this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,i)},requestDifferentQuery:function(e){this.model.set("cachedQuery",this.getCurrentQuery());var t=new r;t.set("q",e),t.set("rows",this.model.get("default")),t.set("sort","date desc");var n=this.generateApiRequest(t);this.setCurrentQuery(t),this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,n)},activate:function(e){this.setBeeHive(e),_.bindAll(this,"setOriginalQuery","processResponse");var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,this.setOriginalQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setOriginalQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery()),this.activateWidget(),this.attachGeneralHandler(this.onApiFeedback)},onApiFeedback:function(e){if(e.error){var t=this;setTimeout(function(){t.broadcastClose()},1e3)}},setOriginalQuery:function(e){this.model.set("cachedQuery",void 0),this._originalQuery=e,this.setCurrentQuery(e)},getOriginalQuery:function(){return this._originalQuery},resetWidget:function(){this.view&&this.view.graphView&&(this.view.$(".network-metadata").empty(),this.view.graphView.$el.empty(),this.view.graphView.stopListening()),this.filterCollection.reset(null,{silent:!0}),this.model.set(_.result(this.model,"defaults"),{silent:!0})},renderWidgetForListOfBibcodes:function(t){this.resetWidget(),this.model.set({graphData:{},loading:!0});var n=new a({target:e.getOption(this,"endpoint"),query:new r({bibcodes:t.slice(0,1e3)}),options:{type:"POST",contentType:"application/json"}});this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,n)},renderWidgetForCurrentQuery:function(){this.resetWidget();var e=this.getCurrentQuery().clone();if(e.unlock(),e.get("__qid")){e.set("fl","bibcode"),e.set("rows","1000");var t=this.composeRequest(e);this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,t)}else{e.set("rows",this.model.get("default")),e.unset("hl"),e.unset("hl.fl");t=this.generateApiRequest(e);this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,t)}},processResponse:function(e){try{e.get("responseHeader.params.__qid");this.renderWidgetForListOfBibcodes(e.get("response").docs.map(function(e){return e.bibcode}))}catch(n){var t=e.toJSON();this.model.set({graphData:t.data,numFound:parseInt(t.msg.numFound),rows:parseInt(t.msg.rows),query:e.getApiQuery().get("q"),loading:!1}),this.model.trigger("newMetadata")}},broadcastFilteredQuery:function(){var e=_.flatten(this.filterCollection.pluck("papers"));this.resetWidget();var t=this.getPubSub();t.publish(t.CUSTOM_EVENT,"second-order-search/limit",{ids:e})},broadcastClose:function(){this.resetWidget(),this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},testing:{detailView:S}})}),define("hbs!js/widgets/query_info/query_info_template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return'<div class="s-right-col-widget-container" style="margin: 0">\n    <div class="currently-selected">\n        <b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.selected||(null!=e?e.selected:e))?a:t.helperMissing)?a.call(e,{name:"selected",hash:{},data:i}):a)+'</b> <span class="s-light-font">selected</span>\n        &nbsp;&nbsp;<button class="btn btn-xs btn-default clear-selected"> <i class="fa fa-times" aria-hidden="true"></i> clear all</button>\n        <button class="btn btn-xs btn-default limit-to-selected"> <i class="fa fa-plus-square" aria-hidden="true"></i> limit to</button>\n        <button class="btn btn-xs btn-default exclude-selected"> <i class="fa fa-minus-square" aria-hidden="true"></i> exclude</button>\n    </div>\n</div>\n'},3:function(e,t,n,i,a,r){var s,o;return'<div class="s-library-area">\n  <div class="panel panel-default">\n    <div class="panel-heading" style="padding:0px;">\n      <div class="panel-title">\n        <button class="library-add-title btn btn-link btn-block" data-toggle="collapse" data-target="#library-console" aria-expanded="false}">\n          <div class="s-library-add-title__title">\n            <span><i class="fa fa-book" aria-hidden="true"></i> Add papers to library</span>\n            <span>\n'+(null!=(s=t.if.call(e,null!=e?e.libraryDrawerOpen:e,{name:"if",hash:{},fn:this.program(4,i,0,a,r),inverse:this.program(6,i,0,a,r),data:i}))?s:"")+'            </span>\n          </div>\n        </button>\n      </div>\n    </div>\n\n    <div class="panel-collapse collapse '+(null!=(s=t.if.call(e,null!=e?e.libraryDrawerOpen:e,{name:"if",hash:{},fn:this.program(8,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'" id="library-console">\n      <div class="panel-body">\n\n'+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selected:e,0,{name:"compare",hash:{operator:">"},fn:this.program(10,i,0,a,r),inverse:this.program(13,i,0,a,r),data:i}))?s:"")+'\n\n        <div class="libraries-container">\n\n'+(null!=(s=t.if.call(e,null!=e?e.libraries:e,{name:"if",hash:{},fn:this.program(15,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'            \n            <div>\n              <label for="create-new">create a new library </label>\n              <input id="create-new"\n                class="form-control input-sm new-library-name s-display-inline"\n                type="text"\n                name="new-library-name"\n                placeholder="New Library Name"\n                value="'+this.escapeExpression("function"==typeof(o=null!=(o=t.newLibraryName||(null!=e?e.newLibraryName:e))?o:t.helperMissing)?o.call(e,{name:"newLibraryName",hash:{},data:i}):o)+'"\n                style="max-width:166px;margin-bottom:10px;"\n                aria-label="enter new library name"/>\n            </div>  \n\n            <button class="btn btn-md btn-primary-faded submit-add-to-library"></i>Add</button>\n\n        </div>\n\n'+(null!=(s=t.if.call(e,null!=e?e.libraries:e,{name:"if",hash:{},fn:this.program(21,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'\n        <div style="margin-top:6px" class="feedback s-feedback">\n\n'+(null!=(s=t.if.call(e,null!=e?e.feedback:e,{name:"if",hash:{},fn:this.program(23,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"        </div>\n      </div>\n    </div>\n  </div>\n    \x3c!--end 'library area' if user is signed in--\x3e\n</div>\n"},4:function(e,t,n,i){return'                <i class="fa fa-caret-down" aria-hidden="true"></i>\n'},6:function(e,t,n,i){return'                <i class="fa fa-caret-right" aria-hidden="true"></i>\n'},8:function(e,t,n,i){return" in "},10:function(e,t,n,i){var a;return'        add\n        <select class="form-control input-sm s-all-vs-selected" name="all-vs-selected" id="all-vs-selected">\n            <option value="selected" '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selectedVsAll:e,"selected",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'> selected papers only </option>\n            <option value="all"  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selectedVsAll:e,"all",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+"> all results</option>\n        </select>\n"},11:function(e,t,n,i){return' selected="true"'},13:function(e,t,n,i){return'        add  <span class="s-text-bold">all results</span> <i class="icon-help" aria-hidden="true" data-toggle="popover" data-container="body" data-content="All papers in your search results will be added, up to 1,000 records. To add only selected papers, click on the checkboxes next to the paper titles."></i>\n        from this query\n'},15:function(e,t,n,i,a,r){var s;return'            <div style="margin-top: 8px" class="">\n                <label for="library-select">to an <span class="s-text-bold">existing library:</span></label>\n                <select id="library-select" name="library-select" class="form-control input-sm s-library-select" aria-label="select existing library">\n                    <option value="0" '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selectedLibrary:e,void 0,{name:"compare",hash:{},fn:this.program(16,i,0,a,r),inverse:this.noop,data:i}))?s:"")+">Select a library...</option>\n"+(null!=(s=t.each.call(e,null!=e?e.libraries:e,{name:"each",hash:{},fn:this.program(18,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'                </select>\n            </div>\n            <div style="margin:10px 0 4px 0">\n                OR\n            </div>\n'},16:function(e,t,n,i){return' selected="true" '},18:function(e,t,n,i,a,r){var s;return'                    <option value="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'" '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.id:e,null!=r[1]?r[1].selectedLibrary:r[1],{name:"compare",hash:{},fn:this.program(16,i,0,a,r),inverse:this.noop,data:i}))?s:"")+">"+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.permission:e,"owner",{name:"compare",hash:{operator:"!=="},fn:this.program(19,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"</option>\n"},19:function(e,t,n,i){return" ("+this.escapeExpression(this.lambda(null!=e?e.owner:e,e))+")"},21:function(e,t,n,i){return'          <div style="margin-top:10px">\n            <a href="#user/libraries">Go to my libraries</a>\n          </div>\n\n'},23:function(e,t,n,i){var a;return"\n"+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.success:a,{name:"if",hash:{},fn:this.program(24,i,0),inverse:this.program(30,i,0),data:i}))?a:"")+"\n"},24:function(e,t,n,i){var a;return'\n              <div class="alert alert-success alert-dismissable" role="alert">\n                  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.create:a,{name:"if",hash:{},fn:this.program(25,i,0),inverse:this.program(27,i,0),data:i}))?a:"")+"              </div>\n\n"},25:function(e,t,n,i){var a;return'                  <a href="#user/libraries/'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.id:a,e))+'"> Library <b>'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b></a> was successfully created and "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numRecords:a,e))+" new records were added.\n"},27:function(e,t,n,i){var a;return"                  "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numRecords:a,e))+' new records were added to  <a href="#user/libraries/'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.id:a,e))+'"> library <b>'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b></a>.\n"+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.numAlreadyInLib:a,{name:"if",hash:{},fn:this.program(28,i,0),inverse:this.noop,data:i}))?a:"")},28:function(e,t,n,i){var a;return"                  ("+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numAlreadyInLib:a,e))+" were already in the library).\n"},30:function(e,t,n,i){var a;return'\n              <div class="alert alert-danger alert-dismissable" role="alert">\n                  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.create:a,{name:"if",hash:{},fn:this.program(31,i,0),inverse:this.program(33,i,0),data:i}))?a:"")+"              </div>\n\n"},31:function(e,t,n,i){var a;return"                  <b>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b> was not created, error occured.\n                  <em>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.error:a,e))+"</em>\n"},33:function(e,t,n,i){var a;return(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.name:a,{name:"if",hash:{},fn:this.program(34,i,0),inverse:this.noop,data:i}))?a:"")+"                  <em>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.error:a,e))+"</em>\n"},34:function(e,t,n,i){var a;return"                  Records were not added to <b>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b>, error occurred.\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,a,r){var s;return(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selected:e,0,{name:"compare",hash:{operator:">"},fn:this.program(1,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n"+(null!=(s=t.if.call(e,null!=e?e.loggedIn:e,{name:"if",hash:{},fn:this.program(3,i,0,a,r),inverse:this.noop,data:i}))?s:"")},useData:!0,useDepths:!0});return e.registerPartial("js/widgets/query_info/query_info_template",t),t}),define("js/widgets/query_info/query_info_widget",["marionette","backbone","underscore","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/query_info/query_info_template","js/mixins/formatter","bootstrap","js/components/api_feedback"],function(e,t,n,i,a,r,s,o,l,c){var u=t.Model.extend({defaults:{selected:0,libraryDrawerOpen:!1,libraries:[],loggedIn:!1,feedback:void 0,newLibraryName:void 0,selectedLibrary:void 0}}),d=e.ItemView.extend({className:"query-info-widget s-query-info-widget",template:s,initialize:function(){this.onOpen=this.onOpen.bind(this),this.onClose=this.onClose.bind(this)},serializeData:function(){var e=this.model.toJSON();return e.selected=this.formatNum(e.selected),e},modelEvents:{"change:selected":"render","change:loggedIn":"render","change:libraries":"render","change:feedback":"render","change:libraryDrawerOpen":"render"},triggers:{"click .clear-selected":"clear-selected","click .limit-to-selected":"limit-to-selected","click .exclude-selected":"exclude-selected"},events:{"change #all-vs-selected":"recordAllVsSelected","change #library-select":"recordLibrarySelection","keyup .new-library-name":"recordNewLibraryName","click .library-add-title":"toggleLibraryDrawer","click .submit-add-to-library":"libraryAddOrCreate"},recordLibrarySelection:function(e){this.model.set("selectedLibrary",$(e.currentTarget).val())},recordNewLibraryName:function(e){this.model.set("newLibraryName",$(e.currentTarget).val())},recordAllVsSelected:function(e){this.model.set("selectedVsAll",$(e.currentTarget).val())},libraryAddOrCreate:function(){var e={},t=this.$("#library-select").val(),n=this.model.get("newLibraryName");t&&"0"!==t&&!n?(e.libraryID=this.$("#library-select").val(),this.model.get("selected")?e.recordsToAdd=this.$("#all-vs-selected").val():e.recordsToAdd="all",this.$(".submit-add-to-library").html('<i class="fa fa-spinner fa-pulse" aria-hidden="true"></i>'),this.trigger("library-add",e)):t&&"0"!==t||!n?t&&"0"!==t&&n?this.model.set("feedback",{success:!1,error:"Either select from an existing or create a new one"}):this.model.set("feedback",{success:!1,error:"Select from an existing library or create a new one"}):(e.name=this.model.get("newLibraryName"),this.model.get("selected")?e.recordsToAdd=this.$("#all-vs-selected").val():e.recordsToAdd="all",e.name=this.model.get("newLibraryName")||"",e.name=e.name.trim(),this.$(".submit-add-to-library").html('<i class="fa fa-spinner fa-pulse" aria-hidden="true"></i>'),this.trigger("library-create",e))},toggleLibraryDrawer:function(){this.model.set("libraryDrawerOpen",!this.model.get("libraryDrawerOpen"),{silent:!0})},onOpen:function(){this.model.set("libraryDrawerOpen",!0),this.model.trigger("change:libraryDrawerOpen")},onClose:function(){this.model.set("libraryDrawerOpen",!1),this.model.trigger("change:libraryDrawerOpen")},onRender:function(){this.$(".icon-help").popover({trigger:"hover",placement:"right",html:!0}),this.$("#library-console").off("show.bs.collapse",this.onOpen).on("show.bs.collapse",this.onOpen).off("hide.bs.collapse",this.onClose).on("hide.bs.collapse",this.onClose)}});return n.extend(d.prototype,o),r.extend({modelConstructor:u,viewConstructor:d,initialize:function(e){e=e||{},this.model=new u,this.view=new d({model:this.model,template:e.template}),r.prototype.initialize.call(this,e)},viewEvents:{"clear-selected":"clearSelected","limit-to-selected":"limitToSelected","exclude-selected":"excludeSelected","library-add":"libraryAddSubmit","library-create":"libraryCreateSubmit"},activate:function(e){this.setBeeHive(e),n.bindAll(this);var t=this,i=this.getPubSub();if(i.subscribe(i.STORAGE_PAPER_UPDATE,this.onStoragePaperChange),i.subscribe(i.LIBRARY_CHANGE,this.processLibraryInfo),i.subscribe(i.USER_ANNOUNCEMENT,this.handleUserAnnouncement),this.getBeeHive().getObject("User").isLoggedIn()){this.model.set("loggedIn",!0);this.getBeeHive().getObject("LibraryController").getLibraryMetadata().done(function(e){t.processLibraryInfo(e)})}},handleUserAnnouncement:function(e,t){var n=this.getBeeHive().getObject("User");e==n.USER_SIGNED_IN?this.model.set("loggedIn",!0):e==n.USER_SIGNED_OUT&&this.model.set("loggedIn",!1)},onStoragePaperChange:function(e){this.model.set("selected",e)},processLibraryInfo:function(e){e.sort(function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())}),this.model.set("libraries",e)},clearSelected:function(){this.getBeeHive().getObject("AppStorage").clearSelectedPapers()},limitToSelected:function(){var e=this.getPubSub();e.publish(e.CUSTOM_EVENT,"second-order-search/limit")},excludeSelected:function(){var e=this.getPubSub();e.publish(e.CUSTOM_EVENT,"second-order-search/exclude")},libraryAddSubmit:function(e){var t={},i=this;t.library=e.libraryID,this.abstractPage?t.bibcodes=[this._bibcode]:t.bibcodes=e.recordsToAdd;var a=n.findWhere(this.model.get("libraries"),{id:e.libraryID}).name;this.getBeeHive().getObject("LibraryController").addBibcodesToLib(t).done(function(t,n){var r=t.numBibcodesRequested-parseInt(t.number_added);i.model.unset("selectedLibrary"),i.model.set("feedback",{success:!0,name:a,id:e.libraryID,numRecords:t.number_added,numAlreadyInLib:r})}).fail(function(t){i.model.set("feedback",{success:!1,name:a,id:e.libraryID,error:JSON.parse(arguments[0].responseText).error})}),this.clearFeedbackWithDelay()},libraryCreateSubmit:function(e){var t={},n=this;this.abstractPage?t.bibcodes=[this._bibcode]:t.bibcodes=e.recordsToAdd,t.name=e.name,this.getBeeHive().getObject("LibraryController").createLibAndAddBibcodes(t).done(function(t,i){n.model.set("newLibraryName",void 0),n.model.set("feedback",{create:!0,success:!0,name:e.name,id:t.id,numRecords:t.bibcode.length})}).fail(function(t){n.model.set("feedback",{success:!1,name:e.name,create:!0,error:JSON.parse(arguments[0].responseText).error})}),this.clearFeedbackWithDelay()},clearFeedbackWithDelay:function(){var e=this;setTimeout(function(){e.model.unset("feedback")},3e4)},processResponse:function(e){var t=e.getApiQuery(),i=[];n.each(t.keys(),function(e){"fq"==e.substring(0,2)&&n.each(t.get(e),function(e){-1==e.indexOf("{!")&&i.push(e)})}),this.view.model.set("fq",i)}})}),define("hbs!js/widgets/results/templates/container-template",["hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e){var t=e.template({1:function(e,t,n,i){return'        <div class="select-all-docs">\n          <label class="custom-checkbox">\n            <input\n              title="select all on this page"\n              type="checkbox"\n              id="select-all-docs-cb"\n            />\n          </label>\n          <label for="select-all-docs-cb" class="sr-only">\n            select all on this page\n          </label>\n        </div>\n'},3:function(e,t,n,i){var a;return" "+(null!=(a=t.if.call(e,null!=e?e.showHighlights:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.showAbstract:e,"open",{name:"compare",hash:{},fn:this.program(9,i,0),inverse:this.program(11,i,0),data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.showSidebars:e,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.program(15,i,0),data:i}))?a:"")+'        <button class="btn-sm btn-link pull-right" id="go-to-bottom">\n          Go To Bottom\n        </button>\n'},4:function(e,t,n,i){var a;return" "+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.showHighlights:e,"open",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.program(7,i,0),data:i}))?a:"")+" "},5:function(e,t,n,i){return'\n        <button class="btn  btn-primary  btn-sm show-highlights">\n          Hide highlights\n        </button>\n'},7:function(e,t,n,i){return'        <button class="btn btn-primary btn-sm btn-inverse show-highlights">\n          Show highlights\n        </button>\n        '},9:function(e,t,n,i){return'\n        <button class="btn show-abstract btn-sm btn-primary">\n          Hide abstracts\n        </button>\n'},11:function(e,t,n,i){return'        <button class="btn show-abstract btn-sm btn-inverse btn-primary">\n          Show abstracts\n        </button>\n        '},13:function(e,t,n,i){return'\n        <button\n          class="btn btn-sm btn-inverse btn-primary toggle-sidebars hidden-xs hidden-sm"\n        >\n          Hide Sidebars\n        </button>\n'},15:function(e,t,n,i){return'        <button\n          class="btn btn-sm btn-primary toggle-sidebars hidden-xs hidden-sm"\n        >\n          Show Sidebars\n        </button>\n'},17:function(e,t,n,i){var a,r;return'    <div class="col-sm-12">\n      <h2 class="s-article-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h2>\n    </div>\n"},19:function(e,t,n,i){var a;return" "+(null!=(a=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,helpers:t,partials:n}))?a:"")+" "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="s-results-widget results-widget">\n  <div class="row s-list-controls">\n    <div class="s-results-border-bottom">\n      <div class="col-xs-1 s-checkbox-col">\n'+(null!=(a=t.unless.call(e,null!=e?e.loading:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'      </div>\n\n      <div class="col-xs-11 s-show-details-container">\n        '+(null!=(a=t.unless.call(e,null!=e?e.loading:e,{name:"unless",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'      </div>\n    </div>\n  </div>\n\n  <div class="row">\n    <h2 class="sr-only">Search Results</h2>\n'+(null!=(a=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(17,i,0),inverse:this.noop,data:i}))?a:"")+'    <ul\n      class="col-sm-12 results-list  s-results-list list-unstyled s-display-block"\n      aria-label="list of results"\n    ></ul>\n  </div>\n  '+(null!=(a=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(19,i,0),inverse:this.noop,data:i}))?a:"")+"\n</div>\n"},usePartial:!0,useData:!0});return e.registerPartial("js/widgets/results/templates/container-template",t),t}),define("js/mixins/expose_metadata",["underscore","js/components/api_targets","js/components/api_query","js/components/api_request"],function(e,t,n,i){return{__exposeMetadata:function(){var a=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];window.__EXPORT_RESULTS_AS_BIBTEX__=e.once(function(){return new Promise(function(s,o){var l=r.map(function(t){return e.isArray(t.identifier)?t.identifier[0]:t.identifier}),c=a.getPubSub(),u=new i({target:t.EXPORT+"bibtex",query:new n({bibcode:l}),options:{type:"POST",done:function(e){var t=e.export;s({identifiers:l,bibtexString:t})},fail:function(e){return o(e)}}});c.publish(c.EXECUTE_REQUEST,u)})})}}}),define("js/modules/orcid/work",["underscore","jsonpath"],function(e,t){var n={status:"$.status",title:"$.title",publicationDateMonth:"$.pubmonth",publicationDateYear:"$.pubyear",lastModifiedDate:"$.updated",sourceName:"$.source",putCode:"$.putcode",identifier:"$.identifier"},i={createdDate:'$["created-date"].value',lastModifiedDate:'$["last-modified-date"].value',sourceOrcidIdUri:'$.source["source-orcid"].uri',sourceOrcidIdPath:'$.source["source-orcid"].path',sourceOrcidIdHost:'$.source["source-orcid"].host',sourceClientIdUri:'$.source["source-client-id"].uri',sourceClientIdPath:'$.source["source-client-id"].path',sourceClientIdHost:'$.source["source-client-id"].host',sourceName:'$.source["source-name"].value',putCode:'$["put-code"]',path:"$.path",title:'$["title"].title.value',subtitle:'$["title"].subtitle.value',translatedTitle:'$["title"]["translated-title"].value',translatedTitleLang:'$["title"]["translated-title"]["language-code"]',journalTitle:'$["journal-title"].value',shortDescription:'$["short-description"]',citationType:'$.citation["citation-type"]',citationValue:'$.citation["citation-value"]',type:"$.type",publicationDateYear:'$["publication-date"].year.value',publicationDateMonth:'$["publication-date"].month.value',publicationDateDay:'$["publication-date"].day.value',publicationDateMedia:'$["publication-date"]["media-type"]',url:"$.url.value",contributorOrcidUri:'$["contributors"].contributor..["contributor-orcid"].uri',contributorOrcidPath:'$["contributors"].contributor..["contributor-orcid"].path',contributorOrcidHost:'$["contributors"].contributor..["contributor-orcid"].host',contributorName:'$["contributors"].contributor..["credit-name"].value',contributorEmail:'$["contributors"].contributor..["contributor-email"].value',contributorAttributes:'$["contributors"].contributor..["contributor-attributes"]',contributorSequence:'$["contributors"].contributor..["contributor-attributes"]["contributor-sequence"]',contributorRole:'$["contributors"].contributor..["contributor-attributes"]["contributor-role"]',externalIdValue:'$["external-ids"]["external-id"]..["external-id-value"]',externalIdType:'$["external-ids"]["external-id"]..["external-id-type"]',externalIdUrl:'$["external-ids"]["external-id"]..["external-id-url"]',externalIdRelationship:'$["external-ids"]["external-id"]..["external-id-relationship"]',country:"$.country.value",visibility:"$.visibility.value",identifier:"$.identifier"},a=function(a,r){a=a||{},this.useOrcidPaths=r,this._root=a,this.sources=[],this.getSources=function(){return e.isEmpty(this.sources)?[this.getSourceName()]:this.sources},this.setSources=function(t){return e.isArray(t)&&(this.sources=t),this.sources},this.get=function(n){var i=t.query(this._root,n);return e.isEmpty(i)?null:e.isArray(i)&&i.length<=1?i[0]:i},this.getAsOrcid=function(){return e.reduce(i,e.bind(function(n,i){var a=this.get(i);return a&&(e.isArray(a)?e.forEach(a,function(e,a){t.value(n,i.replace("..","["+a+"]"),e)}):t.value(n,i,a)),n},this),{})},this.toADSFormat=function(){var t;return this.useOrcidPaths&&((t=this.getExternalIds()).doi&&(t.doi=[t.doi]),t.identifier=e.values(t)[0]),e.extend({},{title:[this.getTitle()],formattedDate:this.getFormattedPubDate(),source_name:this.getSources().join("; "),identifier:this.getIdentifier(),_work:this},t)},this.getExternalIds=function(){var t=this.getExternalIdType(),n=this.getExternalIdValue();return t=e.isArray(t)?t:[t],n=e.isArray(n)?n:[n],t.length!==n.length?{}:e.reduce(t,function(e,t,i){return e[t]=n[i],e},{})},this.getFormattedPubDate=function(){return(this.getPublicationDateYear()||"????")+"/"+(this.getPublicationDateMonth()||"??")};var s=this.useOrcidPaths?i:n;e.reduce(s,function(t,n,i){e.isString(i)&&i.slice&&(t["get"+(i[0].toUpperCase()+i.slice(1))]=e.partial(t.get,n));return t},this)};return a.adsToOrcid=function(n,a){var r="$.pubdate",s="$.abstract",o="$.bibcode",l="$.pub",c="$.doi[0]",u="$.author[*]",d="$.title[0]",h="$.doctype",p="$.all_ids",f=function(n,i,a){return a&&(e.isArray(a)?e.forEach(a,function(e,a){t.value(n,i.replace("..","["+a+"]"),e)}):t.value(n,i,a)),n},m=function(i){var a=t.query(n,i);return e.isEmpty(a)?null:e.isArray(a)&&a.length<=1?a[0]||"":a||""},g={};try{var b={types:[],values:[],relationships:[]},v=m(o),y=m(c);v&&(b.types.push("bibcode"),b.values.push(v),b.relationships.push("SELF")),y&&(b.types.push("doi"),b.values.push(y),b.relationships.push("SELF"));var w=m(p),_=!1;e.isArray(w)&&(_=w.find(function(e){return e.toLowerCase().startsWith("arxiv")})),_&&(_=_.substr(6),b.types.push("arxiv"),b.values.push(_),b.relationships.push("SELF")),f(g,i.publicationDateYear,m(r).split("-")[0]),"00"===m(r).split("-")[1]?f(g,i.publicationDateMonth,null):f(g,i.publicationDateMonth,m(r).split("-")[1]),f(g,i.shortDescription,m(s).slice(0,4997)+"..."),f(g,i.externalIdType,b.types),f(g,i.externalIdValue,b.values),f(g,i.externalIdRelationship,b.relationships),f(g,i.journalTitle,m(l)),f(g,i.type,{article:"JOURNAL_ARTICLE",inproceedings:"CONFERENCE_PAPER",abstract:"CONFERENCE_ABSTRACT",eprint:"WORKING_PAPER",phdthesis:"DISSERTATION",techreport:"RESEARCH_TECHNIQUE",inbook:"BOOK_CHAPTER",circular:"RESEARCH_TOOL",misc:"OTHER",book:"BOOK",proceedings:"BOOK",bookreview:"BOOK_REVIEW",erratum:"JOURNAL_ARTICLE",proposal:"OTHER",newsletter:"NEWSLETTER_ARTICLE",catalog:"DATA_SET",intechreport:"RESEARCH_TECHNIQUE",mastersthesis:"DISSERTATION",obituary:"OTHER",pressrelease:"OTHER",software:"RESEARCH_TECHNIQUE",talk:"LECTURE_SPEECH"}[m(h)]||"JOURNAL_ARTICLE");var x=m(u);x=e.isArray(x)?x:[x],f(g,i.contributorName,x);var S=e.map(x,function(){return"AUTHOR"});f(g,i.contributorRole,S),f(g,i.title,m(d)),a&&f(g,i.putCode,a)}catch(e){return null}return g},a}),define("js/modules/orcid/extension",["underscore","js/components/api_query","js/components/api_request","js/components/api_query_updater","js/components/api_targets","js/modules/orcid/work","js/components/api_feedback","js/mixins/dependon"],function(e,t,n,i,a,r,s){return function(s){var o=new i("OrcidExtension"),l=s.prototype.processDocs,c=s.prototype.activate,u=s.prototype.onAllInternalEvents;return s.prototype.activate=function(t){this.setBeeHive(t),c.apply(this,arguments);var n=t.hasService("PubSub")&&t.getService("PubSub");n.subscribe(n.CUSTOM_EVENT,e.bind(this.onCustomEvent))},s.prototype.onCustomEvent=function(t,n){var i=e.bind(function(t,n){var i=e.filter(this.collection.models,function(t){return e.contains(n,t.get("bibcode"))});e.forEach(i,e.bind(function(n){var i=e.map(n.get("orcid").actions,"action");if(e.contains(i,t)){var a=this.view.children.findByModel(n);a&&a.trigger("OrcidAction",{action:t,view:a,model:n})}},this))},this);switch(t){case"orcid-bulk-claim":i("orcid-add",n);break;case"orcid-bulk-update":i("orcid-update",n);break;case"orcid-bulk-delete":i("orcid-delete",n)}},s.prototype._getOrcidInfo=e.memoize(function(e){var t={actions:{},provenance:null};return e.isCreatedByOthers&&e.isCreatedByADS?(t.actions.update={title:"update in ORCID",caption:"Update ADS version with latest data",action:"orcid-update"},t.actions.delete={title:"delete from ORCID",caption:"Delete ADS version from ORCID",action:"orcid-delete"},t.actions.view={title:"view in ORCID",caption:"Another version exists (we don't have rights to update it)",action:"orcid-view"}):e.isCreatedByOthers&&!e.isCreatedByADS?(e.isKnownToADS&&(t.actions.add={title:"add ADS version ORCID",caption:"ORCID already has a record for this article (we don't have rights to update it).",action:"orcid-add"}),t.actions.view={title:"view in ORCID",caption:"Another version exists (we don't have rights to update it)",action:"orcid-view"}):!e.isCreatedByOthers&&e.isCreatedByADS?(t.actions.update={title:"update in ORCID",caption:"Update ADS version with latest data",action:"orcid-update"},t.actions.delete={title:"delete from ORCID",caption:"Delete ADS version from ORCID",action:"orcid-delete"}):t.actions.add={title:"add to ORCID",caption:"Add ADS version to ORCID",action:"orcid-add"},e.isCreatedByADS&&e.isCreatedByOthers?t.provenance="ads":e.isCreatedByADS?t.provenance="ads":e.isCreatedByOthers?t.provenance="others":t.provenance=null,t},function(e){return[e.isCreatedByADS,e.isCreatedByOthers,e.isKnownToADS,e.provenance]}),s.prototype._setDocsToPending=function(t,n){e.forEach(t,function(t){var i=!e.isBoolean(n)||n;t.orcid=e.extend({},t.orcid,{pending:i})})},s.prototype.addOrcidInfo=function(t){var n=this,i=!1,a=e.noop,r=this.getBeeHive().getService("OrcidApi");if(!r||!r.hasAccess())return t;var s=e.debounce(function(){e.forEach(n.hiddenCollection.models,function(t){var n=t.get("orcid");n.pending&&(n=e.extend({},n,{pending:!1,error:"Error while applying Orcid Data"}),t.set("orcid",n))})},100),o=(e.debounce(function(){var t=n._getOrcidInfo({});e.forEach(n.hiddenCollection.models,function(e){e.get("orcid")&&e.get("orcid").pending&&e.set("orcid",t)})},100),function t(i,a){e.forEach(e.rest(arguments),function(r,s){var o=i[s],l=n._getOrcidInfo(r);r.sourcedByADS&&e.isUndefined(o.source_name)&&(o.source_name="NASA Astrophysics Data System"),o.orcid=e.extend({},o.orcid,l,{pending:!1}),e.isUndefined(o.identifier)&&(o.identifier=o._work.getIdentifier());var c,u=e.find(n.hiddenCollection.models,function(t){return e.isPlainObject(o._work)&&o._work===t.get("_work")||!e.isUndefined(o.identifier)&&o.identifier===t.get("identifier")});u?(e.isPlainObject(o._work)&&(c=o._work.getSources()),e.isUndefined(u.get("identifier"))&&n.orcidWidget&&u.set("identifier",o.identifier),u.set({orcid:l,source_name:e.isArray(c)?c.join("; "):u.get("source_name")})):a<60&&e.delay(e.bind(t,n,[o],a+1),500);e.isArray(r.children)&&e.forEach(r.children,function(t){var i=e.find(n.hiddenCollection.models,function(n){return e.isString(t)&&t===n.get("_work").getPutCode()});i&&n.removeModel(i)})})}),l=function(t){return i?e.defer(s):(i=!0,a(t))};return(a=function(t){var i=e.map(t,function(t){return r.getRecordInfo(t).done(function(i){i.sourcedByADS&&e.isUndefined(t.source_name)&&(t.source_name="NASA Astrophysics Data System"),t.orcid=e.extend({},t.orcid,n._getOrcidInfo(i),{pending:!1})})});n._setDocsToPending(t),$.when.apply($,i).then(e.partial(o,t),e.partial(l,t))})(t),t},s.prototype._paginationUpdate=function(){var t=this;e.forEach(this.hiddenCollection.models,function(n){var i=e.find(t.collection.models,function(e){return e.get("_work")===n.get("_work")});i&&i.get("orcid").pending&&i.set("orcid",n.get("orcid"))})},s.prototype._updateModelsWithOrcid=function(t,n){var i=e.filter(t||this.hiddenCollection.models,function(e){return!e.has("_work")&&e.has("identifier")});e.isEmpty(i)?n<60&&e.delay(e.bind(self._updateModelsWithOrcid,self,null,n+1),500):this.getBeeHive().getService("OrcidApi").getUserProfile().done(function(t){var a=t.getWorks();e.forEach(i,function(t){var i=e.flatten(e.values(e.pick(t.attributes,["identifier"])));e.forEach(a,function(a){var r=e.flatten(e.values(a.getIdentifier()));e.intersection(i,r).length>0?t.set({source_name:a.getSources().join("; "),_work:a}):n<60&&e.delay(e.bind(self._updateModelsWithOrcid,self,[t],n+1),500)})})})},s.prototype.processDocs=function(t,n,i){n=l.apply(this,arguments);var a=this.getBeeHive().getObject("User");if(a&&a.isOrcidModeOn()||this.orcidWidget){var r=t.get("responseHeader.params"),s=parseInt(r.start)+parseInt(r.rows),o=this.addOrcidInfo(n,s);return i.numFound!==o.length&&e.extend(i,this.getPaginationInfo(t,n)),e.delay(e.bind(this._updateModelsWithOrcid,this,0),1e3),o}return n},s.prototype.mergeADSAndOrcidData=function(i){var s=this,l=$.Deferred(),c=s.getBeeHive().getService("OrcidApi"),u=function(t,n){var a=n.response&&n.response.docs&&n.response.docs[0],s=(t=new r(t._root,!0)).toADSFormat();s=e.isPlainObject(s)?s:{},a=e.isPlainObject(a)?a:{},i.set(e.extend({},i.attributes,s,a)),l.resolve(i)},d=function(){l.reject.apply(l,arguments)},h=function(){l.reject.apply(l,arguments)},p=function(r){var l=i.get("identifier"),c=new t({q:"identifier:"+o.quoteIfNecessary(l),fl:"title,abstract,bibcode,author,pub,pubdate,doi,doctype"}),h=new n({query:c,target:a.SEARCH,options:{done:e.partial(u,r),fail:d}}),p=s.getPubSub();p.publish(p.EXECUTE_REQUEST,h)},f=i.get("_work");return f?c.getWork(f.getPutCode()).done(p).fail(h):this._findWorkByModel(i).done(function(e){c.getWork(e.getPutCode()).done(p).fail(h)}).fail(h),l.promise()},s.prototype._findWorkByModel=function(t,n){var i=$.Deferred(),a=this.getBeeHive().getService("OrcidApi"),s=e.pick(t.attributes,["identifier"]),o=e.pick(t.attributes,["all_ids"]),l=e.clone(t.get("orcid")||{}),c=null;e.isUndefined(n)&&(c=a.getUserProfile());var u=function(n){var c=n.getWorks(),u=!0,d=null,h=e.find(c,function(t){var n=t.getIdentifier();return u=s.identifier===n,d=t.getPutCode(),e.contains(o.all_ids,n)});if(h){if(!u){var p=r.adsToOrcid(t.attributes,d);a.updateWork(p)}i.resolve(h)}else{i.reject();var f="Could not find a matching ORCiD Record";console.error.apply(console,[f].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:f}))}};return e.isUndefined(n)?(c.done(u),c.fail(function(){i.reject.apply(i,arguments);var n="Error retrieving ORCiD profile";console.error.apply(console,[n].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:n}))})):u(n),i.promise()},s.prototype.removeModel=function(t){var n=t.resultsIndex;this.hiddenCollection.remove(t);var i=this.hiddenCollection.models;e.forEach(e.rest(i,n),function(e){e.set("resultsIndex",e.get("resultsIndex")-1),e.set("indexToShow",e.get("indexToShow")-1)});var a=this.model.get("showRange"),r=e.range(a[0],a[1]+1),s=[];e.forEach(r,function(e){i[e]&&i[e].set&&(i[e].set("visible",!0),i[e].resultsIndex=e,i[e].set("resultsIndex",e),i[e].set("indexToShow",e+1),s.push(i[e]))}),this.hiddenCollection.reset(i),this.collection.reset(s),this.model.set("totalPapers",i.length)},s.prototype.onAllInternalEvents=function(t,n,i){if("childview:OrcidAction"===t){var a=this,s=i.action,o=this.getBeeHive().getService("OrcidApi"),l=e.clone(i.model.get("orcid")||{}),c=this.getPubSub();c.publish(c.CUSTOM_EVENT,"orcid-action",s);var d={"orcid-add":function(t){t.set("orcid",{pending:!0});var n,i=function(){a._findWorkByModel(t).done(function(e){t.set({orcid:a._getOrcidInfo({isCreatedByADS:!0,isCreatedByOthers:!1,isKnownToADS:!0,provenance:"ads"}),source_name:e.getSources().join("; ")}),a.trigger("orcidAction:"+s,t)})},c=r.adsToOrcid(t.attributes);if(c)n=c,o.addWork(n).done(i).fail(function(n,a,r){if("CONFLICT"===r)return i();var s="Failed to add entry, please try again";console.error.apply(console,[s].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:s}))});else{var u="There was a problem adding the record, try again";console.error.apply(console,[u].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:u}))}},"orcid-delete":function(t){t.set("orcid",{pending:!0});var n=function(){a.orcidWidget?a.removeModel(t):t.set("orcid",a._getOrcidInfo({})),a.trigger("orcidAction:"+s,t)},i=function(i){o.deleteWork(i.getPutCode()).done(n).fail(function(i,a,r){if("NOT FOUND"===r)return n();var s="Error deleting record, please try again";console.error.apply(console,[s].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:s}))})},r=t.get("_work");r?i(r):a._findWorkByModel(t).done(i)},"orcid-update":function(t){t.set("orcid",{pending:!0});var n=function(){var n="Error updating record, please try again";console.error.apply(console,[n].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:n}))};a.mergeADSAndOrcidData(t).done(function(t){var i=t.get("_work").getPutCode(),l=r.adsToOrcid(t.attributes,i);if(e.isNull(l))return n(l);o.updateWork(l).done(function(e){var n=new r(e,!0);o.getRecordInfo(n.toADSFormat()).done(function(e){t.set("orcid",a._getOrcidInfo(e)),a.trigger("orcidAction:"+s,t)})}).fail(n),t.set(t.attributes,{silent:!0})}).fail(function(){var n="Failed to merge ORCiD and ADS data";console.error.apply(console,[n].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:n}))})},"orcid-login":function(){o.signIn()},"orcid-logout":function(){o.signOut()},"orcid-view":function(t){var n=t.get("orcidWorkPath");e.isString(n)&&window.open(n,"_blank").focus()}};d[s]&&d[s](i.model)}return u.apply(this,arguments)},s}}),define("js/widgets/results/widget",["js/widgets/list_of_things/widget","js/widgets/abstract/widget","js/mixins/add_stable_index_to_collection","js/mixins/link_generator_mixin","js/mixins/formatter","hbs!js/widgets/results/templates/container-template","js/mixins/papers_utils","js/mixins/expose_metadata","js/modules/orcid/extension","js/mixins/dependon","js/components/api_feedback"],function(e,t,n,i,a,r,s,o,l,c,u){var d=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.view.template=r,this.view.model.defaults=function(){return{mainResults:!0,title:void 0,showAbstract:"closed",showSidebars:!0,showCheckboxes:!0,showHighlights:"closed",pagination:!0}},this.model.set(this.model.defaults(),{silent:!0}),this.view.toggleAll=function(e){var t=e.target.checked?"add":"remove";this.trigger("toggle-all",t)},_.extend(this.view.events,{"click input#select-all-docs-cb":"toggleAll"}),this.view.resultsWidget=!0,this.view.delegateEvents(),this.listenTo(this.collection,"reset",this.checkDetails),this.listenTo(this.view,"toggle-all",this.triggerBulkAction),this.minAuthorsPerResult=3,this.model.on("change:showSidebars",_.bind(this._onToggleSidebars,this));var n=t.prototype.defaultQueryArguments.fl.split(","),i=this.defaultQueryArguments.fl.split(","),a=(i=_.union(n,i)).indexOf("aff");a>-1&&i.splice(a,1),this.defaultQueryArguments.fl=i.join(","),this.on("page-manager-message",_.bind(this.onPageManagerMessage,this))},defaultQueryArguments:{fl:"title,abstract,bibcode,author,keyword,id,links_data,property,esources,data,citation_count,citation_count_norm,[citations],pub,email,volume,pubdate,doi,doctype,identifier",rows:25,start:0},activate:function(t){e.prototype.activate.apply(this,[].slice.apply(arguments));var n=t.getService("PubSub");_.bindAll(this,"dispatchRequest","processResponse","onUserAnnouncement","onStoragePaperUpdate","onCustomEvent","onStartSearch"),n.subscribe(n.INVITING_REQUEST,this.dispatchRequest),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse),n.subscribe(n.USER_ANNOUNCEMENT,this.onUserAnnouncement),n.subscribe(n.STORAGE_PAPER_UPDATE,this.onStoragePaperUpdate),n.subscribe(n.CUSTOM_EVENT,this.onCustomEvent),n.subscribe(n.START_SEARCH,this.onStartSearch),this.queryTimer=+new Date},onPageManagerMessage:function(e,t){"side-bars-update"===e&&this._onSidebarsUpdate(t)},_clearResults:function(){this.hiddenCollection.reset(),this.view.collection.reset()},onStartSearch:function(e){try{var t=this.getBeeHive(),n=t.getObject("AppStorage"),i=t.getService("HistoryManager"),a=n.getCurrentQuery().toJSON(),r=e.toJSON(),s=i.getCurrentNav()}catch(e){return}if(_.isEqual(a,r)){if(_.isArray(s)&&"ShowAbstract"===s[0]){clearInterval(this.focusInterval);var o=setInterval(function(){var e=$('a[href$="'+s[1].href+'"]');e&&(clearInterval(o),$(document.documentElement).animate({scrollTop:e.offset().top},"fast"))},100);setTimeout(function(){clearInterval(o)},1e4),this.focusInterval=o}}else this._clearResults();this.queryTimer=+new Date},_onToggleSidebars:function(){this.trigger("page-manager-event","side-bars-update",this.model.get("showSidebars"))},_onSidebarsUpdate:function(e){this.model.set("showSidebars",e)},onUserAnnouncement:function(e,t){if("user_info_change"==e&&_.has(t,"isOrcidModeOn")){var n=this.hiddenCollection.toJSON(),i=_.map(n,function(e){return delete e.orcid,e});t.isOrcidModeOn&&this.addOrcidInfo(i),this.hiddenCollection.reset(i),this.view.collection.reset(this.hiddenCollection.getVisibleModels())}this.updateMinAuthorsFromUserData()},onCustomEvent:function(e){if("add-all-on-page"===e){var t=this.collection.pluck("bibcode"),n=this.getPubSub();n.publish(n.BULK_PAPER_SELECTION,t)}},dispatchRequest:function(t){this.reset(),this.setCurrentQuery(t),this.model.set("loading",!0),e.prototype.dispatchRequest.call(this,t)},customizeQuery:function(e){var t=e.clone();return t.unlock(),this.defaultQueryArguments&&(t=this.composeQuery(this.defaultQueryArguments,t)),t},checkDetails:function(){for(var e=0;e<this.collection.models.length;e++){if(this.collection.models[e].attributes.highlights){!0;break}}},getUserData:function(){try{var e=_.isFunction(this.getBeeHive)&&this.getBeeHive(),t=_.isFunction(e.getObject)&&e.getObject("User");return _.isPlainObject(t)?_.isFunction(t.getUserData)&&t.getUserData("USER_DATA"):{}}catch(e){return{}}},updateMinAuthorsFromUserData:function(){var e=this.getUserData(),t=_.has(e,"minAuthorsPerResult")?e.minAuthorsPerResult:this.minAuthorsPerResult;"ALL"===String(t).toUpperCase()?this.minAuthorsPerResult=Number.MAX_SAFE_INTEGER:"NONE"===String(t).toUpperCase()?this.minAuthorsPerResult=0:this.minAuthorsPerResult=Number(t)},processDocs:function(e,t,i){var a=e.get("responseHeader.params"),r=a.start||0,s=(t=n.addPaginationToDocs(t,r),e.has("highlighting")?e.get("highlighting"):{}),o=this,l=this.getBeeHive().getObject("User").getUserData("USER_DATA").link_server;this.__exposeMetadata(t),this.updateMinAuthorsFromUserData();var c=null;this.hasBeeHive()&&this.getBeeHive().hasObject("AppStorage")&&(c=this.getBeeHive().getObject("AppStorage"));var u=/citation_count_norm/gi.test(a.sort);this.getBeeHive().getObject("DocStashController").stashDocs(t),t=_.map(t,function(e){if(e.normCiteSort=u,u)try{e.citationCountNorm=e.citation_count_norm.toFixed(2)}catch(t){e.citationCountNorm=0}e.link_server=l,e.identifier=e.bibcode?e.bibcode:e.identifier,e.encodedIdentifier=_.isUndefined(e.identifier)?e.identifier:encodeURIComponent(e.identifier);var t,n,i={};_.keys(s).length&&(t=s[e.id],n=[],_.each(_.pairs(t),function(e){n=n.concat(e[1])}),i={highlights:n}),e.highlights=i.highlights;var a,r=o.minAuthorsPerResult;if(e.author&&e.author.length>r?(e.extraAuthors=e.author.length-r,a=e.author.slice(0,r)):e.author&&(a=e.author),e.author){var d=function(e,t,n){var i=n.length-1;return t===i||0===i?e:e+";"};e.authorFormatted=_.map(a,d),e.allAuthorFormatted=_.map(e.author,d)}return e.formattedDate=e.pubdate?o.formatDate(e.pubdate):void 0,e.shortAbstract=e.abstract?o.shortenAbstract(e.abstract):void 0,c&&c.isPaperSelected(e.identifier)&&(e.chosen=!0),e});try{t=this.parseLinksData(t)}catch(e){console.warn(e.message)}if(this.pagination&&this.pagination.perPage===+a.start+ +a.rows){var d=this.getPubSub();d.publish(d.CUSTOM_EVENT,"timing:results-loaded",+new Date-this.queryTimer)}return this.model.set("loading",!1),t},onStoragePaperUpdate:function(){var e;if(this.hasBeeHive()&&this.getBeeHive().hasObject("AppStorage")){if(e=this.getBeeHive().getObject("AppStorage"),this.collection.each(function(t){e.isPaperSelected(t.get("identifier"))?t.set("chosen",!0):t.set("chosen",!1)}),this.hiddenCollection.each(function(t){e.isPaperSelected(t.get("identifier"))?t.set("chosen",!0):t.set("chosen",!1)}),0==this.collection.where({chosen:!0}).length){var t=this.view.$("input#select-all-docs-cb");t.length>0&&(t[0].checked=!1)}}else console.warn("AppStorage object disapperared!")},triggerBulkAction:function(e){var t=this.collection.pluck("bibcode");this.getPubSub().publish(this.getPubSub().BULK_PAPER_SELECTION,t,e)},reset:function(){var t=this.model.get("showSidebars");e.prototype.reset.apply(this,arguments),this.model.set("showSidebars",t)}});return _.extend(d.prototype,i),_.extend(d.prototype,a),_.extend(d.prototype,s,o,c.BeeHive),l(d)}),define("hbs!js/widgets/tabs/templates/tabs_inner",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return" active "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="tab-pane '+(null!=(a=t.if.call(e,null!=e?e.default:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'" id= '+this.escapeExpression("function"==typeof(r=null!=(r=t.id||(null!=e?e.id:e))?r:t.helperMissing)?r.call(e,{name:"id",hash:{},data:i}):r)+">"+this.escapeExpression("function"==typeof(r=null!=(r=t.view||(null!=e?e.view:e))?r:t.helperMissing)?r.call(e,{name:"view",hash:{},data:i}):r)+"</div>\n"},useData:!0});return e.registerPartial("js/widgets/tabs/templates/tabs_inner",t),t}),define("hbs!js/widgets/tabs/templates/tabs_outer",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="tab-widget">\n    \x3c!-- Nav tabs --\x3e\n    <ul class="nav nav-tabs">\n    </ul>\n\n    \x3c!-- Tab panes --\x3e\n    <div class="tab-content">\n    </div>\n</div>'},useData:!0});return e.registerPartial("js/widgets/tabs/templates/tabs_outer",t),t}),define("hbs!js/widgets/tabs/templates/tabs_title",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){return" active "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<li class="'+(null!=(a=t.if.call(e,null!=e?e.default:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'">\n  <a href="#'+this.escapeExpression("function"==typeof(r=null!=(r=t.id||(null!=e?e.id:e))?r:t.helperMissing)?r.call(e,{name:"id",hash:{},data:i}):r)+'" data-toggle="tab"> <h3 class="h5">'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+"</h3></a>\n</li>\n"},useData:!0});return e.registerPartial("js/widgets/tabs/templates/tabs_title",t),t}),define("js/widgets/tabs/tabs_widget",["underscore","marionette","bootstrap","hbs!js/widgets/tabs/templates/tabs_inner","hbs!js/widgets/tabs/templates/tabs_outer","hbs!js/widgets/tabs/templates/tabs_title"],function(e,t,n,i,a,r){return t.ItemView.extend({className:"s-tabs-widget",activate:function(t){var n,i=[];return e.each(this.widgets,function(e){e.activate(n=t.getHardenedInstance()),i.push({name:e.title,object:e,beehive:n})}),i},initialize:function(t){this.tabs=t.tabs||[],this.widgets=e.map(this.tabs,function(e,t){if(!e.widget)throw new Error('Missing "widget" for: '+e.title+" ["+t+"]");return e.widget.trigger(e.default?"active":"hidden"),e.widget}),this.on("active",this.onActive),this.on("hidden",this.onHidden)},render:function(){this.beforeRender&&this.beforeRender(),this.trigger("before:render",this);var t=$(a()),n=t.find("ul.nav"),s=t.find("div.tab-content");return e.each(this.tabs,function(e){n.append(r({id:e.id,title:e.title,default:e.default})),s.append(i({id:e.id,default:e.default}))},this),this.$el.html(t.html()),e.each(this.tabs,function(e){var t=this;this.$("#"+e.id).append(e.widget.getEl()),this.$('a[href="#'+e.id+'"]').on("show.bs.tab",function(){t.trigger("active",e)}).on("hide.bs.tab",function(){t.trigger("hidden",e)})},this),this.bindUIElements(),this.onRender&&this.onRender(),this.trigger("render",this),this},onDestroy:function(){e.each(this.tabs,function(e){e.widget.destroy?e.widget.destroy():e.widget.remove&&e.widget.remove()},this)},getEl:function(){return this.el&&this.$el.children().length?this.el:this.render().el},onActive:function(e){e.widget.trigger("active"),"function"==typeof e.onActive&&e.onActive()},onHidden:function(e){e.widget.trigger("hidden"),"function"==typeof e.onHidden&&e.onHidden()}})}),define("js/widgets/widget_states",[],function(){return{READY:0,LOADING:1,IDLE:2,FAILED:3}}),define("hbs!js/widgets/wordcloud/templates/wordcloud-template",["hbs/handlebars","hbs!js/wraps/widget/loading/template"],function(e){var t=e.template({1:function(e,t,n,i){var a;return null!=(a=this.invokePartial(n["js/wraps/widget/loading/template"],e,{name:"js/wraps/widget/loading/template",hash:{hideCloseButton:!0,widgetLoadingSize:"medium"},data:i,indent:"      ",helpers:t,partials:n}))?a:""},3:function(e,t,n,i){return'    <div style="position:relative">\n        <svg id="wordcloud-svg" viewBox="0 0 1000 600" class="s-wordcloud-svg">\n        </svg>\n    </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div>\n<div class="col-xs-12 s-explore-close-container">\n    <div class="s-large-close close-widget close">x</div>\n</div>\n<header class="s-network-title">\n    <h3>Word Cloud</h3>\n    <button class="btn btn-link download s-download hidden">\n        <i class="fa fa-download fa-2x" aria-hidden="true" title="download data in csv"></i>\n        <span class="sr-only">download data in csv</span>\n    </button>\n</header>\n</div>\n\n<div class="col-xs-11 col-sm-2" id="wordcloud-controlpanel">\n\n    <div>\n        This visualization shows you unique and frequent words from\n        a set of the top 100 search results.\n        <br/>\n        <b><a href="/help/actions/visualize#word-cloud" target="_blank" rel="noreferrer noopener">\n            Learn more about the concept cloud</a></b>\n        <br/>\n        <br/>\n    </div>\n\n    <div class="s-vis-item-format clearfix print-hidden"><span style="font-size:14px"> Recalculate Cloud</span><br/><br/>\n        <div id= "ticker">\n\n        </div>\n        <div id="word-choice">\n\n        </div>\n        <div class="s-wordcloud-tick-container">\n            <span style="display:inline-block;margin-left: 0%;">|</span>\n            <span style="display:inline-block;margin-left: 24%;">|</span>\n            <span style="display:inline-block;margin-left: 23%;">|</span>\n            <span style="display:inline-block;margin-left: 22%;">|</span>\n            <span style="display:block;float:right;">|</span>\n        </div>\n        <div class="s-wordcloud-slider-labels"><span class="pull-left">Unique</span><span class="pull-right">Frequent</span></div>\n\n    </div>\n    <div class="selected-word-list">\n\n    </div>\n</div>\n\n\n\n<div class="s-wordcloud-container col-xs-12 col-sm-9" id="wordcloud-container">\n'+(null!=(a=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+'</div>\n<a id="download-link" class="hidden"></a> \n</div>\n'},usePartial:!0,useData:!0});return e.registerPartial("js/widgets/wordcloud/templates/wordcloud-template",t),t}),define("hbs!js/widgets/wordcloud/templates/selected-list-template",["hbs/handlebars"],function(e){var t=e.template({1:function(e,t,n,i){var a;return" "+(null!=(a=t.each.call(e,null!=e?e.selectedWords:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+" "},2:function(e,t,n,i){return'\n\n    <li>\n      <span class="selected-word">'+this.escapeExpression(this.lambda(e,e))+'</span> <i class="close">&times;</i>\n    </li>\n\n    '},4:function(e,t,n,i){return"\n\n    <li>Click on a term to add it to this list.</li>\n    <li>Click again on the term to remove it.</li>\n\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="print-hidden">\n  <h5>Selected Terms:</h5>\n  <ul class="vis-select-list s-vis-select-list">\n    '+(null!=(a=t.if.call(e,null!=e?e.selectedWords:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(4,i,0),data:i}))?a:"")+'  </ul>\n\n  <button class="btn btn-info apply-vis-facet">Apply Filter to Search</button>\n</div>\n'},useData:!0});return e.registerPartial("js/widgets/wordcloud/templates/selected-list-template",t),t}),define("js/widgets/wordcloud/widget",["jquery","backbone","marionette","d3","js/components/api_request","js/widgets/base/base_widget","hbs!js/widgets/wordcloud/templates/wordcloud-template","hbs!js/widgets/wordcloud/templates/selected-list-template","js/components/api_targets","js/components/api_query_updater","js/components/api_query","js/components/api_feedback","jquery-ui","bootstrap","d3-cloud"],function(e,t,n,i,a,r,s,o,l,c,u,d){var h=t.Model.extend({initialize:function(){this.on("selected",function(e){this.add(e)}),this.on("unselected",function(e){this.remove(e)})},add:function(e){this.get("selectedWords").push(e),this.trigger("userChange:selectedWords",e)},remove:function(e){e=e.trim();var t=_.without(this.get("selectedWords"),e);this.set("selectedWords",t),this.trigger("userChange:selectedWords",e)},reset:function(){this.set("selectedWords",[])},defaults:{selectedWords:[]}}),p=t.View.extend({initialize:function(e){e=e||{},this.model=new h,this.listenTo(this.model,"userChange:selectedWords",this.render)},template:o,render:function(){return this.$el.html(this.template(this.model.toJSON())),this},events:{"click .close":"removeWord","click .apply-vis-facet":"submitFacet"},removeWord:function(t){var n=e(t.target).parent().find(".selected-word").text();this.model.remove(n)},submitFacet:function(){this.model.get("selectedWords").length&&this.trigger("submitFacet")}}),f=n.ItemView.extend({className:"s-wordcloud-widget clearfix",events:{"click .close-widget":"signalCloseWidget","click .download":"signalDownload"},initialize:function(e){e=e||{},this.listView=e.listView,this.listenTo(this.model,"change:processedWordList",this.onProcessedWordChange),this.listenTo(this.listView.model,"userChange:selectedWords",this.toggleHighlight)},signalCloseWidget:function(){this.trigger("close-widget")},signalDownload:function(){this.trigger("download")},toggleHighlight:function(e){var t=e.trim();i.selectAll(this.$("text")).filter(function(){if(this.textContent.trim()==t){var e=i.select(this);e.classed("selected",!e.classed("selected"))}})},template:s,render:function(){return this.$el.html(s({helpText:"<p>This word cloud allows you to view interesting words from the titles and abstracts of your search results.</p><p> Move the slider towards <strong> Frequent</strong> to view a word cloud that is simply composed of the words that appeared most frequently in your results. (This word cloud is likely to feature generic terms like 'observations' prominently.) </p> <p>Move the slider towards <strong>Unique</strong> to see a word cloud that shows words that appeared in your results but which appear very rarely in the rest of the ADS corpus.</p><p>To facet your ADS search, select words from the word cloud and click the 'Apply Filter to Search' button.</p>",loading:this.model.get("processedWordList").length<=0})),this.listView.setElement(this.$(".selected-word-list")).render(),this.$(".icon-help").popover({trigger:"hover",placement:"right",html:!0}),this},onProcessedWordChange:function(){this.render(),this.model.get("processedWordList").length>0&&(this.buildSlider(),this.buildCloudLayout())},buildCloudLayout:function(){i.layout.cloud().size([1e3,600]).words(this.model.get("processedWordList")).padding(3).rotate(function(){return 0}).font("Arial").fontSize(function(e){return e.size}).on("end",_.bind(this.draw,this)).start()},buildSlider:function(){var t=this;this.$("#word-choice").slider({value:t.model.get("currentSliderVal"),min:1,max:5,step:1,slide:function(e,n){t.model.set({currentSliderVal:n.value})},create:function(t){e("a",t.target).attr("href","javascript:void(0)").attr("aria-label","slider handle")}})},draw:function(){var e=this,t=this.model.get("renderVals"),n=i.select(this.$("#wordcloud-svg")[0]),a=this.model.get("processedWordList");if(this.$("#words-group").length)r=i.select(this.$("#wordcloud-svg")[0]).select("#words-group");else{var r=n.attr("aria-label","wordcloud chart").append("g").attr("id","words-group").attr("width",1e3).attr("height",600).attr("transform",function(){return"translate(500 300)"});n[0][0].addEventListener("click",function(t){var n=t.target.classList;n.contains("s-wordcloud-text")&&(n.contains("selected")?e.listView.model.trigger("unselected",t.target.textContent):e.listView.model.trigger("selected",t.target.textContent))})}var s=r.selectAll("text").data(a,function(e){return e.text}),o=this.listView.model.get("selectedWords");s.enter().append("text").classed("s-wordcloud-text",!0).text(function(e){return e.text}).style("fill",function(e,n){return t.fill(e.origSize)}).classed("selected",function(e,t){if(_.contains(o,e.text))return!0}).attr("transform",function(e,t){return t<15?"translate("+[1e3*Math.random(),-300]+")":t<30?"translate("+[1e3*Math.random(),300]+")":t<45?"translate("+[-500,600*+Math.random()]+")":"translate("+[500,600*-Math.random()]+")"}),s.exit().style("opacity",0).remove();e=this;s.attr("font-size",function(e){return e.size}).style("fill",function(e,n){return t.fill(e.origSize)}).transition().duration(1e3).attr("transform",function(e){return"translate("+[e.x,e.y]+")"}),this.$(".download").removeClass("hidden")}}),m=t.Model.extend({initialize:function(){var e=this;this.on("change:tfidfData",function(t){return t.has("tfidfData")?e.buildWCDict():e.reset(!1)}),this.on("change:currentSliderVal",this.buildWCDict)},defaults:{tfidfData:void 0,currentSliderVal:3,processedWordList:[],renderVals:{fill:void 0,glowScale:void 0,blur:void 0},colorRange:["#80E6FF","#7575FF","#7575FF","#47008F"],sliderRange:{1:[1,0],2:[.75,.25],3:[.5,.5],4:[.25,.75],5:[0,1]}},reset:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.set(this.defaults,{silent:e})},buildWCDict:function(){var e,t,n,a,r,s,o,l,c,u,d,h,p;e=this.get("tfidfData"),t=_.size(e),n=_.reduce(_.map(_.values(e),function(e){return e.total_occurrences}),function(e,t){return e+t},0)/t,a=_.reduce(_.map(_.values(e),function(e){return e.idf?e.idf:0}),function(e,t){return e+t},0)/t,l=this.get("sliderRange"),c=this.get("currentSliderVal"),r=_.map(e,function(e,t){return u=e.total_occurrences/n,d=e.idf/a,[t,l[c][0]*d+l[c][1]*u||0]}),r=_.last(_.sortBy(r,function(e){return e[1]}),50),r=_.object(r),s=_.min(_.values(r)),o=_.max(_.values(r)),h=[],(p={}).fill=i.scale.log().domain([s,o]),p.fill.domain([0,.25,.5,.75,1].map(p.fill.invert)).range(this.get("colorRange")).clamp(!0);var f=i.scale.log().domain([s,o]).range([30,70]);for(var m in r)h.push({text:m,size:f(r[m]),select:!1,origSize:r[m]});this.set("renderVals",p),this.set("processedWordList",h),this.set("downloadableData",e)}});return r.extend({initialize:function(e){e=e||{},this.listView=new p,this.model=new m,this.view=new f({model:this.model,listView:this.listView}),this.max_rows=l._limits.ConceptCloud.limit,this.on("all",this.onAllInternalEvents),this.listenTo(this.listView,"all",this.onAllInternalEvents),this.listenTo(this.view,"close-widget",_.bind(this.closeWidget,this)),this.listenTo(this.view,"download",_.bind(this.download,this)),this.widgetName="wordcloud",this.queryUpdater=new c(this.widgetName)},activate:function(e){_.bindAll(this,"setCurrentQuery","processResponse"),this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,this.setCurrentQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setCurrentQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},renderWidgetForCurrentQuery:function(){this.model.unset("tfidfData");var e=this.getCurrentQuery(),t=this;if(e.get("__qid"))setTimeout(function(){t.getPubSub().publish(t.getPubSub().ALERT,new d({code:d.CODES.ALERT,msg:"The concept cloud endpoint cannot handle such a large query at this time",modal:!0}),1)});else{var i=new a({target:n.getOption(this,"endpoint")||l.SERVICE_WORDCLOUD,query:this.customizeQuery(e),options:{type:"POST",contentType:"application/json"}});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,i)}},renderWidgetForListOfBibcodes:function(e){this.model.unset("tfidfData"),e=e.slice(0,100);var t=new u;t.unlock(),t.set("q","bibcode:("+e.join(" OR ")+")"),t.set("rows",this.max_rows);var i=new a({target:n.getOption(this,"endpoint")||l.SERVICE_WORDCLOUD,query:new u({query:JSON.stringify(t.toJSON())}),options:{type:"POST",contentType:"application/json"}});this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,i)},customizeQuery:function(e){var t=e.clone();t.unlock(),this.defaultQueryArguments&&(t=this.composeQuery(this.defaultQueryArguments,t));var n=this.max_rows;return t.has("rows")&&(n=t.get("rows")[0]),t.set("rows",Math.min(n,this.max_rows)),t},processResponse:function(e){try{e.get("responseHeader.params.__qid");this.renderWidgetForListOfBibcodes(e.get("response").docs.map(function(e){return e.bibcode}))}catch(t){data=e.toJSON(),this.model.set("tfidfData",data)}},close:function(){this.listView.destroy(),this.view.destroy(),n.Controller.prototype.destroy.apply(this,arguments)},setCurrentQuery:function(){this.listView.model.reset(),this.model.reset(),r.prototype.setCurrentQuery.apply(this,arguments)},onAllInternalEvents:function(e){if("submitFacet"===e){var t,n;t=this.listView.model.get("selectedWords"),(n=(n=this.getCurrentQuery()).clone()).unlock();var i=this.queryUpdater,a=t.map(function(e){return i.quoteIfNecessary(e)}).join(" OR ");this._updateFq(n,a);var r=this.getPubSub();r.publish(r.NAVIGATE,"search-page",{q:n})}},closeWidget:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},download:function(){var e=this.model.get("downloadableData"),t="data:text/csv;charset=utf-8,";t+="Word, Idf, Record Count, Total Occurrences\n",Object.entries(e).forEach(function(e){var n=_slicedToArray(e,2),i=n[0],a=n[1];t+="".concat(i,", ").concat(a.idf,", ").concat(a.record_count,", ").concat(a.total_occurrences,"\n")});var n=encodeURI(t),i=document.getElementById("download-link");i.setAttribute("download","wordcloud.csv"),i.setAttribute("href",n),i.click()},_updateFq:function(e,t){var n="fq_"+this.widgetName;e.unset(n),this.queryUpdater.updateQuery(e,n,"limit",t);var i="{!type=aqp v=$"+n+"}",a=e.get("fq");a?(-1==_.indexOf(a,i)&&a.push(i),e.set("fq",a)):e.set("fq",[i])}})}),define("js/components/generic_module",["backbone","underscore"],function(e,t){var n=["className","activate"],i=function(e){e=e||{},this.mid=t.uniqueId("module"),t.extend(this,t.pick(e,n)),this.initialize.call(this,e)};return t.extend(i.prototype,e.Events,{className:"GenericModule",initialize:function(){},destroy:function(){},activate:function(e){t.extend(this,t.pick(e,n))}}),i.extend=e.Model.extend,i}),define("js/components/alerts_mediator",["underscore","jquery","cache","js/components/generic_module","js/mixins/dependon","js/components/api_feedback","js/mixins/hardened","js/components/alerts"],function(e,t,n,i,a,r,s,o){var l=i.extend({initialize:function(t){e.extend(this,e.pick(t,["debug","widgetName"]))},activate:function(t,n){this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();i.subscribe(i.ALERT,e.bind(this.onAlert,this)),i.subscribe(i.NAVIGATE,e.bind(this.onNavigate,this)),this.getWidget().fail(function(){console.error("If you want to use AlertController, you also need to have a Widget capable of displaying the messages (default: AlertsWidget)"),i.publish(i.BIG_FIRE,"Alerts Widget not available")})},onNavigate:function(e){var t=this,n=this.getPubSub();"authentication-page"===e&&n.subscribeOnce(n.NAVIGATE,function(){var e=t.getWidget();e&&e.closeView&&e.closeView()})},onAlert:function(t,n){var i=this;return this.alert(t).done(function(t){if(e.isFunction(t))t();else if(e.isObject(t)&&t.action){switch(t.action){case o.ACTION.TRIGGER_FEEDBACK:i.getPubSub().publish(i.getPubSub().FEEDBACK,new r(t.arguments));break;case o.ACTION.CALL_PUBSUB:i.getPubSub().publish(t.signal,t.arguments);break;default:throw new Error("Unknown action type:"+t)}i._widget&&i._widget.closeView&&i._widget.closeView()}})},getWidget:function(){var e=t.Deferred(),n=this;return this._widget?e.resolve(this._widget):this.getApp()._getWidget(this.widgetName||"AlertsWidget").done(function(t){n._widget=t,e.resolve(t)}).fail(function(){e.reject()}),e.promise()},alert:function(e){var n=t.Deferred();return this.getWidget().done(function(t){t?t.alert(e).done(function(){n.resolve.apply(n,arguments)}):(console.warn('"AlertsWidget" has disappeared, we cant display messages to the user'),n.reject("AlertsWidget has disappeared"))}).fail(function(){n.reject("AlertsWidget not available")}),n.promise()},hardenedInterface:{debug:"state of the alerts",getHardenedInstance:"allow to create clone of the already hardened instance"}});return e.extend(l.prototype,a.BeeHive,a.App),e.extend(l.prototype,s),l}),define("js/wraps/alerts_mediator",["underscore","jquery","js/components/alerts_mediator","js/components/api_feedback","js/widgets/widget_states","js/components/alerts","js/components/api_response"],function(e,t,n,i,a,r,s){return n.extend({activate:function(t,i){n.prototype.activate.apply(this,arguments);var a=this.getPubSub();a.subscribe(a.APP_STARTED,e.bind(this.displaySiteMessageWithDelay,this))},onAlert:function(e,t){this._dirty=!0,n.prototype.onAlert.apply(this,arguments)},displaySiteMessageWithDelay:function(){var e=this;setTimeout(function(){e.checkAndDisplaySiteMessage()},500)},onDestroy:function(){clearInterval(this.timerId)},onStartSearch:function(){this._dirty=!1},checkAndDisplaySiteMessage:function(){var t=this,n=t.getBeeHive().getObject("User");n&&n.getSiteConfig("site_wide_message").done(function(a){if(a&&e.isString(a)&&!t._dirty){if(n.isLoggedIn())if(n.getUserData().last_seen_message==a)return;var r=t.getBeeHive().getService("PersistentStorage");if(r){var s=r.get("last_seen_message");if(s&&s==a)return}t.alert(new i({msg:a,events:{"click button.close":"dismissed"}})).done(function(e){"dismissed"==e&&(n&&n.isLoggedIn()&&n.setMyADSData({last_seen_message:a}),r&&r.set("last_seen_message",a))})}})}})}),define("js/components/feedback_mediator",["underscore","jquery","cache","js/components/generic_module","js/components/api_request","js/components/api_response","js/components/api_query_updater","js/components/api_feedback","js/components/pubsub_key","js/mixins/dependon"],function(e,t,n,i,a,r,s,o,l,c){var u=i.extend({initialize:function(e){this._cache=this._getNewCache(e.cache),this.debug=e.debug||!1,this._handlers={},this.app=null},_getNewCache:function(t){return new n(e.extend({maximumSize:150,expiresAfterWrite:1800},e.isObject(t)?t:{}))},activate:function(t,n){if(!n)throw new Error("This controller absolutely needs access to the app");this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();i.subscribe(i.FEEDBACK,e.bind(this.receiveFeedback,this))},receiveFeedback:function(e,t){this.debug&&console.log("[EM]: received feedback:",e.toJSON(),t?t.getId():null);var n=this._getCacheKey(e,t),i=this._retrieveCacheEntry(n);i||(i=this.createNewCacheEntry(n),this._cache.put(n,i));var a=this.getFeedbackHandler(e,i);if(a){if(a.execute&&a.execute(e,i))return;if(a.call(this,e,i))return}this.handleFeedback(e,i)},removeFeedbackHandler:function(e){e.toString()in this._handlers&&delete this._handlers[e.toString()]},addFeedbackHandler:function(t,n){if(!t&&!e.isNumber(t))throw new Error("first argument must be code or code:string or string");if(!e.isFunction(n))throw new Error("second argument must be executable");this._handlers[t.toString()]=n},getFeedbackHandler:function(e,t){for(var n=[e.code+":"+t.id,t.id,e.code?e.code.toString():Date.now()],i=0;i<n.length;i++)if(n[i]in this._handlers)return this._handlers[n[i]]},_retrieveCacheEntry:function(e){return this._cache.getSync(e)},_getCacheKey:function(t,n){if(!t)throw new Error("ApiFeedback cannot be empty");if(t.getSenderKey())return t.getSenderKey();if(n){if(n instanceof l)return n.getId();if(e.isString(n))return n}var i=t.getApiRequest();if(i)return i.url();throw new Error("We cannot identify the origin (recipient) of this feedback")},createNewCacheEntry:function(e){return{waiting:0,max:0,errors:0,counter:0,created:Date.now(),id:e}},handleFeedback:function(e,t){var n=o.CODES;switch(t.counter+=1,e.code){case n.ALL_FINE:t.errors=0;break;case n.KEEP_WAITING:t.waiting+=t.started;break;case n.SERVER_ERROR:break;case n.ALERT:this.getApp().getController("AlertsController").onAlert(e,t)}}});return e.extend(u.prototype,c.BeeHive,c.App),u}),define("js/wraps/discovery_mediator",["underscore","jquery","js/components/feedback_mediator","js/components/api_feedback","js/widgets/widget_states","js/components/alerts","js/components/api_response","analytics"],function(e,t,n,i,a,r,s,o){var l={};return l[i.CODES.MAKE_SPACE]=function(){this.getBeeHive().getService("PubSub").once(this.getPubSub().DELIVERING_REQUEST,e.bind(function(e,t){this._tmp.callOnce[t.getId()]||(this._tmp.callOnce[t.getId()]=!0)},this))},l[i.CODES.SEARCH_CYCLE_STARTED]=function(t){this._tmp.cycle_started=!0;var n=this.getApp();if(t.query?(n.getObject("AppStorage").setCurrentQuery(t.query),n.getObject("AppStorage").setCurrentNumFound(t.numFound)):n.getObject("AppStorage").setCurrentQuery(null),t.request&&t.request.get("target").indexOf("search")>-1&&t.query&&!t.numFound)t.query;else{t.numFound>1e3&&n.getWidget("SearchWidget").done(function(e){e.view&&e.view.highlightFields&&e.view.highlightFields()});e.keys(t.cycle.waiting);this.getAlerter().alert(new i({type:r.TYPE.INFO,msg:null}))}},l[i.CODES.SEARCH_CYCLE_FAILED_TO_START]=function(t){var n=t.request,a=t.error.jqXHR||{},r=this.getApp(),l=this.getAlerter(),c=this,u={target:"",msg:a.statusText};function d(){var e=r.getService("Api");return e&&e.access_token?e.access_token.slice(30):"no access token"}if(o("send","event","error","search",a.statusText),a&&n){var h=n.get("target");switch(u.target=h,u.query=n.get("query").toJSON(),console.log(a,n,u),a.status){case 403:return o("send","event","error","access-denied","request="+n.url()+" token=..."+d()),void l.alert(new i({code:i.CODES.ALERT,msg:a.responseJSON&&a.responseJSON.error?a.responseJSON.error:"We are sorry, you do not have permission to access: "+h+". This is likely our fault (misconfiguration) and the ADS team has been notified.",modal:!0}));case 429:return void l.alert(new i({code:i.CODES.ALERT,msg:"We are sorry, it looks like you have exhausted allowed quota for: "+h+". The limits will be reset in (usually) in 24 hours. If you believe this is an error or if you need to do something special, please contact us using the feedback button and describe what you are trying to accomplish. We may be able to help or provide efficient way of searching through ADS database. We also have an API that can be useful!",modal:!0}));case 405:return o("send","event","error","access-denied","request="+n.url()+" token=..."+d),void l.alert(new i({code:i.CODES.ALERT,msg:"I am afraid you have just discovered a glitch in our system. (Congratulations!). What you are trying to do should be possible. It is likely a mis-configuration. Please try to reload the webpage; if problem persists - then send us an angry email and wait for a day.",modal:!0}));case 401:return void r.getApiAccess({reconnect:!0}).done(function(){r.getService("Api").request(n,{done:function(){r.getController("QueryMediator").resetFailures();var e=c.getPubSub();e&&e.publish(e.NAVIGATE,"search-page",{q:n.get("query")})},fail:function(){o("send","event","error","unauthorized","request="+n.url()+" token=..."+d()),l.alert(new i({msg:"Seems like you are not authorized to access: "+h,modal:!0,type:"danger"}))}})}).fail(function(){l.alert(new i({code:i.CODES.DANGER,msg:"The security token used to access our API has expired and we are unable to refresh it (though we tried). You will have to reload the webpage. Sorry about that!",modal:!0}))})}if(h.indexOf("search")>-1){if(400==a.status){var p=n.get("query"),f="";return a.responseJSON&&a.responseJSON.error&&a.responseJSON.error.msg&&(f=e.escape(a.responseJSON.error.msg)).indexOf("SyntaxError")>-1&&(f=(f=(f=(f=(f=(f=f.replace("org.apache.solr.search.SyntaxError:","")).replace("org.apache.solr.common.SolrException:","")).replace("INVALID_SYNTAX_CANNOT_PARSE:","")).replace(": The parser reported a syntax error, antlrqueryparser hates errors!","")).trim()).replace("Syntax Error, cannot parse","Syntax Error, cannot parse<b>")+"</b>"),void l.alert(new i({msg:(f||"There is something wrong with the query:")+'<b><a href="#">&nbsp;&nbsp;Try looking at the search examples on the home page</a></b>  or <b><a href="/help/search/search-syntax" target="_blank" rel="noreferrer noopener">reading our help page</a>.</b>',events:{"click a#query-assistant":"query-assistant"}})).done(function(e){"query-assistant"==e&&c.getApp().getWidget("SearchWidget").done(function(e){var t=p.get("q").join(" ");t?e.openQueryAssistant(t):e.openQueryAssistant("ooops, the query is complex (we are not yet ready for that)")})})}if(500==a.status&&a.responseJSON){var m=a.responseJSON;if(m.error&&m.error.msg&&m.error.msg.indexOf("maxClauseCount")>-1){var g=new s(m),b=t.cycle,v=e.keys(b.inprogress)[0],y=b.inprogress[v];return g.setApiQuery(y.request.get("query")),b.done[v]=b.inprogress[v],delete b.inprogress[v],c.getPubSub().publish(c.getPubSub().DELIVERING_RESPONSE+v,g),b.running=!1,void r.getController("QueryMediator").startExecutingQueries()}}}}o("send","event","error","unrecoverable-"+a.status,"request="+n.url()+" token=..."+d);var w,_=["We are having trouble accessing: "+h+". The ADS backend service is probably down, or else we’ve been struck by an asteroid.","We are having trouble accessing: "+h+". A solar flare must have taken down our servers! Or else the ADS backend service is down momentarily.","Was that a supernova or are our servers just down? We are having trouble accessing: "+h+" but we should be back in a flash.","The alien mothership has arrived! Or else the ADS backend service is down momentarily. We are having trouble accessing: "+h+" but should be back up soon.","The server response seems to be highly redshifted, may require another observation to record. (The ADS backend service is down momentarily and we are having trouble accessing: "+h+" but we should be back up soon.)","A singularity has formed inside our server, and we are having trouble accessing: "+h+".","Universal Translator Malfunction: Unable to Communicate with ADS Droids. (The ADS backend service is down momentarily and we are having trouble accessing: "+h+" but we should be back up soon.","UV catastrophe detected! (The ADS backend service is down momentarily and we are having trouble accessing: "+h+" but we should be back up soon.)","The ADS Droids got distracted by the Missing Mass Problem instead of working on: "+h+". Be back in a minute."];switch(a.status){case 504:case 408:f="This particular query is taking too long. Please wait a moment and retry. If the problem persits, our backend is likely overwhelmed and will be sluggish for a little longer.";break;case 500:case 502:case 503:w=Math.floor(Math.random()*_.length),f=_[w];break;default:f="Today, you are doubly unlucky. Not only are you experiencing an 'unrecoverable' error, but you have to read this default error message. Sorry about that! We have been notified about the problem."}l.alert(new i({code:i.CODES.ALERT,msg:f,modal:!1}))},l[i.CODES.API_REQUEST_ERROR]=function(e){var t=e.request,n=t.get("query"),a=t.get("target"),r=e.psk,s={error:e.errorThrown,errorCode:e.error.status,destination:a,query:n?n.toJSON():void 0},l=this.getApp(),c=this.getAlerter();if(o("send","event","error","api-request",JSON.stringify(s)),r){var u=l.getPluginOrWidgetName(r.getId());if(u){if(console.error("Query failed for widget: "+u,s),/orcid/.exec(a)&&401==e.error.status){c.alert(new i({code:i.CODES.ALERT,msg:"Your connection with Orcid is no longer valid, it may be that you revoked your token. To continue using this feature, please log back in to Orcid.",modal:!0}));var d=l.getService("OrcidApi"),h=l.getObject("User");return d.signOut(),void h.setOrcidMode(0)}this._tmp.api_failures=this._tmp.api_failures||{},this._tmp.api_failures[u]=this._tmp.api_failures[u]||0,this._tmp.api_failures[u]+=1;this._tmp.api_failures[u]}else if(!e.beVerbose)return;this._tmp.cycle_started}else console.error("We are not going to handle the error (PSK is empty, can't identify the component")},l[i.CODES.QUERY_ASSISTANT]=function(e){this.getApp().getWidget("SearchWidget").done(function(t){var n=null;e.query&&(n=e.query.get("q").join(" ")),t.openQueryAssistant(n)})},function(){var t=new(n.extend({_tmp:{},activate:function(){n.prototype.activate.apply(this,arguments);var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,e.bind(this.onNewCycle,this)),t.subscribe(t.ARIA_ANNOUNCEMENT,e.bind(this.onPageChange,this)),t.subscribe(t.APP_EXIT,e.bind(this.onAppExit,this)),t.subscribeOnce(t.APP_STARTING,e.bind(this.onAppStarting,this))},onAppStarting:function(){var t=this.getBeeHive().getService("PubSub"),n=this.getApp().getController("QueryMediator");t.unsubscribe(n.getPubSub().getCurrentPubSubKey(),t.START_SEARCH),this.getPubSub().subscribe(t.START_SEARCH,e.bind(function(e,t){var n,i,a=this.getPubSub(),r=this.getApp();if(a&&(n=r.getController("QueryMediator"))){if((i=r.getObject("AppStorage"))&&i.getCurrentQuery())try{console.log("URL: ",i.getCurrentQuery().url())}catch(e){}var s=!0;if(i&&i.hasCurrentQuery()&&e.url()==i.getCurrentQuery().url()&&"widget:SearchWidget"!=r.getPluginOrWidgetName(t.getId())&&r.getWidgetRefCount("Results")>=1&&r.hasService("Navigator")&&(r.getService("Navigator").navigate("results-page",{replace:!0}),s=!1),"SearchPage"!==this.getCurrentPage()&&r.getWidgetRefCount("Results")<=0){var o=arguments;r.getService("Navigator").navigate("results-page",{replace:!1}).then(function(){n.getQueryAndStartSearchCycle.apply(n,o)}),s=!1}s&&n.getQueryAndStartSearchCycle.apply(n,arguments)}},this))},onNewCycle:function(){this.reset()},onPageChange:function(e){e=e.replace("Switching to: ",""),this._currentPage=e},getCurrentPage:function(){return this._currentPage||"LandingPage"},onAppExit:function(e){console.log("App exit requested to: "+e);var t=this.getAlerter();e&&e.url&&("orcid"==e.type?t.alert(new i({code:i.CODES.WARNING,msg:'<p>You will be redirected to ORCID.</p> <p>Please sign in with your ORCID credentials and click on the "authorize" button.</p><button class="btn btn-primary" id="okOrcid">Take me to ORCID</button>',modal:!0,events:{"click button#okOrcid":"OK"}})).done(function(t){"OK"==t&&(window.location=e.url)}):window.location=e.url)},getAlerter:function(){return this.getApp().getController(this.alertsController||"AlertsController")},createFeedback:function(e){return new i(e)},reset:function(){this._tmp={callOnce:{}}}}));return e.each(e.pairs(l),function(e){t.addFeedbackHandler(e[0],e[1])}),t}}),define("js/widgets/config",[],function(){return{export:{formats:[{value:"bibtex",label:"BibTeX",help:"BibTeX format",ext:"bib"},{value:"ads",label:"ADS",help:"ADS format",ext:"txt"},{value:"bibtexabs",label:"BibTeX ABS",help:"BibTeX with abstracts",ext:"bib"},{value:"endnote",label:"EndNote",help:"EndNote format",ext:"enw"},{value:"procite",label:"ProCite",help:"ProCite format",ext:"txt"},{value:"ris",label:"RIS",help:"Research Information Systems (RIS) format",ext:"txt"},{value:"refworks",label:"RefWorks",help:"RefWorks format",ext:"txt"},{value:"rss",label:"RSS",help:"RSS format",ext:"rss"},{value:"medlars",label:"MEDLARS",help:"Medical Literature Analysis and Retrieval System (MEDLARS) format",ext:"txt"},{value:"dcxml",label:"DC-XML",help:"Dublin Core XML format",ext:"xml"},{value:"jatsxml",label:"JATSXML",help:"JATS Journal Publishing XML",ext:"xml"},{value:"refxml",label:"REF-XML",help:"ADS link data in XML format",ext:"xml"},{value:"refabsxml",label:"REFABS-XML",help:"ADS records in XML format",ext:"xml"},{value:"aastex",label:"AASTeX",help:"LaTeX format for AAS journals",ext:"txt"},{value:"ieee",label:"IEEE",help:"IEEE format",ext:"txt"},{value:"icarus",label:"Icarus",help:"LaTeX format for use in Icarus",ext:"txt"},{value:"mnras",label:"MNRAS",help:"LaTeX format for use in MNRAS",ext:"txt"},{value:"soph",label:"Solar Physics",help:"LaTeX format for use in Solar Physics",ext:"txt"},{value:"votable",label:"VOTable",help:"VOTable XML format",ext:"xml"},{value:"custom",label:"Custom Format",help:"Enter Your Own Custom Format",ext:"txt"}]}}}),define("js/wraps/export_dropdown",["underscore","js/widgets/config","js/widgets/dropdown-menu/widget"],function(e,t,n){var i=[{description:"in BibTeX",navEvent:"export",params:{format:"bibtex"}},{description:"in AASTeX",navEvent:"export",params:{format:"aastex"}},{description:"in EndNote",navEvent:"export",params:{format:"endnote"}},{description:"in RIS",navEvent:"export",params:{format:"ris"}},{description:"Author Affiliation",navEvent:"show-author-affiliation-tool"},{description:"Other Formats",navEvent:"export",params:{format:"other"}}];return function(){return new n({links:i,btnType:"btn-primary-faded",dropdownTitle:"Export",iconClass:"icon-export",rightAlign:!1,selectedOption:!0,updateLinks:function(n){var a=n.defaultExportFormat,r=e.find(t.export.formats,{label:a}).value;if(a){var s;if(e.forEach(i,function(e,t){if(e.params&&e.params.format&&e.params.format===r)return s=t,!1}),0===s)return i;var o=e.assign({},i[0],{description:"in "+a,params:e.assign({},i[0].params,{format:r})});return s?[o].concat(i.slice(0,s)).concat(i.slice(s+1)):[o].concat(i.slice(0))}return i}})}}),define("js/wraps/graph_tabs",["js/widgets/tabs/tabs_widget","js/widgets/facet/factory","js/widgets/facet/graph-facet/year_graph","js/widgets/facet/graph-facet/h_index_graph","js/mixins/formatter","analytics"],function(e,t,n,i,a,r){return function(){var s=t.makeGraphFacet({graphView:n,facetField:"year",defaultQueryArguments:{"facet.pivot":"property,year",facet:"true","facet.minCount":"1","facet.limit":"2000"},graphViewOptions:{yAxisTitle:"article count",xAxisTitle:"years",name:"Years"},processResponse:function(e){var t=this;this.setCurrentQuery(e.getApiQuery());var n=function(){t.model.set({graphData:[]}),t.updateState(t.STATES.IDLE)};if(e.get("response.numFound")<=1)return n();var i=e.get("facet_counts.facet_pivot.property,year"),a=new Map;i.forEach(function(e){var t=e.value,n=e.pivot;["refereed","notrefereed"].includes(t)&&n.forEach(function(e){var n=e.value,i=e.count,r=void 0===i?0:i,s=parseInt(n,10);a.set(s,_objectSpread(_objectSpread({refereed:0,notrefereed:0},a.get(s)),{},_defineProperty({},t,r)))})});var r=Array.from(a.keys()),s=Math.min.apply(Math,r),o=Math.max.apply(Math,r),l=Array.from({length:o-s+1},function(e,t){return s+t}).map(function(e){if(a.has(e)){var t=a.get(e),n=t.refereed;return{x:e,y:n+t.notrefereed,refCount:n}}return{x:e,y:0,refCount:0}});if(l.length<=1)return n();this.model.set({graphData:l}),this.updateState(this.STATES.IDLE)}}),o=t.makeGraphFacet({graphView:i,facetField:"citation_count",defaultQueryArguments:{"json.facet":'{"citation_count":{"type":"terms","field":"citation_count","sort":{"index":"desc"},"limit":2000}}',stats:"true","stats.field":"citation_count"},graphViewOptions:{yAxisTitle:"citations",xAxisTitle:"number of records",pastTenseTitle:"cited",name:"Citations"},processResponse:function(e){var t=this;this.setCurrentQuery(e.getApiQuery());var n=function(){t.model.set({graphData:[]}),t.updateState(t.STATES.IDLE)};if(e.get("response.numFound")<=1)return n();var i=[],r=0,s=0;e.get("facets.citation_count.buckets").some(function(e){for(r+=e.count;r>i.length&&i.length<2e3;)s+=e.val,i.push({y:e.val,x:i.length+1});return i.length>2e3});var o=e.toJSON().stats?a.formatNum(e.get("stats.stats_fields.citation_count.sum")):0;if(i.length<=1)return n();this.model.set({section:"citations",graphData:i,statsCount:o.toLocaleString(),totalCount:i.length.toLocaleString(),subTotal:s.toLocaleString(),showTotalMessage:2e3===i.length})}}),l=t.makeGraphFacet({graphView:i,facetField:"read_count",defaultQueryArguments:{"json.facet":'{"read_count":{"type":"terms","field":"read_count","sort":{"index":"desc"},"limit":2000}}',stats:"true","stats.field":"read_count"},graphViewOptions:{yAxisTitle:"recent reads",xAxisTitle:"number of records",pastTenseTitle:"read",name:"Reads"},processResponse:function(e){var t=this;this.setCurrentQuery(e.getApiQuery());var n=function(){t.model.set({graphData:[]}),t.updateState(t.STATES.IDLE)};if(e.get("response.numFound")<=1)return n();var i=[],r=0,s=0;e.get("facets.read_count.buckets").some(function(e){for(s+=e.count;s>i.length&&i.length<2e3;)r+=e.val,i.push({y:e.val,x:i.length+1});return i.length>2e3});var o=e.toJSON().stats?a.formatNum(e.get("stats.stats_fields.read_count.sum")):0;if(i.length<=1)return n();this.model.set({section:"reads",graphData:i,statsCount:o.toLocaleString(),totalCount:i.length.toLocaleString(),subTotal:r.toLocaleString(),showTotalMessage:2e3===i.length})}}),c=new e({tabs:[{title:"Years",widget:s,id:"year-facet",default:!0},{title:"Citations",widget:o,id:"citations-facet",onActive:function(){r("send","event","interaction","graph-tab-active","Citations")}},{title:"Reads",widget:l,id:"reads-facet",onActive:function(){r("send","event","interaction","graph-tab-active","Reads")}}]});return c.yearGraphWidget=s,c.citationGraphWidget=o,c.readsGraphWidget=l,c}}),define("hbs!js/page_managers/templates/results-page-layout",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="results-page-layout" class="s-results-page-layout">\n  <div class="row s-stable-search-bar-height">\n    <div class="s-search-bar-full-width-container" role="search">\n      <div class="col-xs-0 col-sm-12 col-md-2 s-back-button-container">\n        <a href="/" class="back-button btn btn-sm btn-default">\n          <i class="fa fa-arrow-left" aria-hidden="true"></i> Start New\n          Search</a\n        >\n      </div>\n      <div\n        class="col-xs-12 col-sm-9 col-md-7 s-search-bar-row"\n        id="search-bar-row"\n        data-widget="SearchWidget"\n      ></div>\n    </div>\n  </div>\n  <div class="row s-message-control-row" id="message-control-row">\n    <span data-widget="AlertsWidgetx"></span>\n  </div>\n  <div class="row s-results-control-row" id="results-control-row"></div>\n  <div class="row">\n    <div class="col-xs-12 s-dynamic-page-body" id="dynamic-page-body" style="overflow: hidden">\n      <div class="max-width-wrapper">\n        <div>\n          <div\n            class="hidden-xs col-sm-3 col-md-2 s-left-column s-results-column"\n            id="results-left-column"\n          >\n            <h2 class="sr-only">Filters for the Current Search</h2>\n            <div class="left-col-container s-left-col-container">\n              <div data-widget="AuthorFacet" />\n              <div data-widget="DatabaseFacet" />\n              <div data-widget="RefereedFacet" />\n              <div data-widget="AffiliationFacet" />\n              <div data-widget="KeywordFacet" />\n              <div data-widget="BibstemFacet" />\n              <div data-widget="BibgroupFacet" />\n              <div data-widget="ObjectFacet" />\n              <div data-widget="NedObjectFacet" />\n              <div data-widget="DataFacet" />\n              <div data-widget="VizierFacet" />\n              <div data-widget="PubtypeFacet" />\n            </div>\n          </div>\n\n          <div\n            class="col-sm-9 col-md-7  s-results-middle-column s-results-column"\n            id="results-middle-column"\n          >\n            <div\n              class="main-content-container s-main-content-container"\n              id="main-content"\n              tabindex="-1"\n              role="main"\n              aria-label="container for search results and other main content"\n            >\n              <div data-widget="Results" />\n              <div data-widget="AuthorAffiliationTool" />\n              <div data-widget="ExportWidget" data-origin="results-page" />\n              <div data-widget="AuthorNetwork" />\n              <div data-widget="PaperNetwork" />\n              <div data-widget="Metrics" data-allow-redirect="true" />\n              <div data-widget="BubbleChart" />\n              <div data-widget="ConceptCloud" />\n              <div data-widget="CitationHelper" />\n            </div>\n          </div>\n          \n          <div id="results-right-column">\n            <div data-widget="QueryInfo" class="s-right-column col-sm-3" id="query-info-container"/>\n            <div\n              class="hidden-xs col-sm-3 col-md-3 results-right-column s-right-column s-results-column"\n            >\n              <h2 class="sr-only">\n                Additional Functionality (Information about your query, and more\n                search filters)\n              </h2>\n\n              <div data-widget="MyAdsFreeform" />\n              <div data-widget="OrcidSelector" />\n              <div data-widget="GraphTabs" />\n              <div data-widget="QueryDebugInfo" data-debug="true" />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},useData:!0});return e.registerPartial("js/page_managers/templates/results-page-layout",t),t}),define("hbs!js/page_managers/templates/results-control-row",["hbs/handlebars"],function(e){var t=e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-results-control-row-container">\n    <div class="col-sm-6">\n        <div data-widget="BreadcrumbsWidget" class="s-display-inline-block"/>\n    </div>\n\n\n    <div class="col-xs-12 col-sm-6" style="padding-right:0; padding-left:0;">\n        <div class="s-results-action-buttons">\n            <div id="search-results-sort" class="col-xs-12 col-md-5 clearfix" style="margin-bottom:10px;">\n                <div data-widget="Sort" class="s-display-inline-block pull-right"/>\n            </div>\n            <div id="search-results-actions" class="col-xs-12 col-md-7">\n                <div><button id="results-actions-toggle" class="btn btn-primary-faded s-display-inline-block pull-right">\n                    <i class="fa fa-book" alt="open actions"></i> Actions\n                </button></div>\n                <div data-widget="VisualizationDropdown" class="s-display-inline-block pull-right"/>\n                <div data-widget="ExportDropdown" class="s-display-inline-block pull-right"/>\n            </div>\n        </div>\n    </div>\n\n</div>\n'},useData:!0});return e.registerPartial("js/page_managers/templates/results-control-row",t),t}),define("js/page_managers/three_column_view",["underscore","marionette","hbs!js/page_managers/templates/results-page-layout","hbs!js/page_managers/templates/results-control-row","js/widgets/base/base_widget"],function(e,t,n,i){var a=Backbone.Model.extend({defaults:function(){return{left:"open",right:"open",user_left:null,user_right:null}}});return t.ItemView.extend({initialize:function(e){e=e||{};this.widgets=e.widgets,this.model=new a},destroy:function(){t.ItemView.prototype.destroy.call(this,arguments)},template:n,modelEvents:{"change:left":"_updateColumnView","change:right":"_updateColumnView"},events:{"click .btn-expand":"onClickToggleColumns"},onRender:function(){this.$("#results-control-row").append(i()),this.displaySearchBar(this.options.displaySearchBar),this.displayControlRow(this.options.displayControlRow),this.displayLeftColumn(this.options.displayLeftColumn),this.displayRightColumn(this.options.displayRightColumn),this.displayMiddleColumn(this.options.displayMiddleColumn)},onShow:function(){this.displaySearchBar(!0)},displaySearchBar:function(e){$("#search-bar-row").toggle(void 0===e||e)},displayLeftColumn:function(e){this.$(".s-left-col-container").toggle(void 0===e||e)},displayControlRow:function(e){this.$("#results-control-row").toggle(void 0===e||e)},displayRightColumn:function(e){this.$(".s-left-col-container").toggle(void 0===e||e)},displayMiddleColumn:function(e){this.$(".s-left-col-container").toggle(void 0===e||e)},_returnBootstrapClasses:function(){var t=this.classList,n=[];return e.each(t,function(e){-1!==e.indexOf("col-")&&n.push(e)}),n.join(" ")},showCols:function(e){e=e||{left:!0,right:!0,force:!1};for(var t=["left","right"],n=0;n<t.length;n++){var i=t[n];if(i in e)null===this.model.get("user_"+i)?this.model.set(i,e[i]?"open":"closed"):e.force&&(this.model.set(i,e[i]?"open":"closed"),this.model.set("user_"+i,null))}},_updateColumnView:function(){var t,n,i,a,r;t=this.model.get("left"),n=this.model.get("right"),i=this.$("#results-left-column"),a=this.$("#results-right-column"),r=this.$("#results-middle-column"),e.each([["left",t,i],["right",n,a]],function(e){if("open"==e[1]){e[2].removeClass("hidden");var t=e[2];setTimeout(function(){t.children().show(0)},200)}else e[2].addClass("hidden")}),"open"===t&&"open"===n?r.removeClass(this._returnBootstrapClasses).addClass("col-sm-9 col-md-7"):"closed"===t&&"closed"===n&&r.removeClass(this._returnBootstrapClasses).addClass("col-md-12 col-sm-12")}})}),define("js/page_managers/view_mixin",["underscore","jquery"],function(e,t){return{getWidgetsFromTemplate:function(n,i){var a={},r=t(n).find("[data-widget]");return r.length>0&&e.each(r,function(e){var t=e.getAttribute("data-widget"),n=e.getAttribute("data-debug");n&&"true"==n&&!n||(a[t]=e)}),a}}}),define("js/page_managers/controller",["jquery","underscore","marionette","hbs!js/page_managers/templates/results-page-layout","hbs!js/page_managers/templates/results-control-row","js/widgets/base/base_widget","./three_column_view","./view_mixin","js/mixins/dependon"],function(e,t,n,i,a,r,s,o,l){var c=["ShowAbstract"],u=r.extend({initialize:function(e){this.widgets={},this.widgetDoms={},this.initialized=!1,this.widgetId=null,this.assembled=!1,t.extend(this,t.pick(e,["debug","widgetId"]))},activate:function(e){this.setBeeHive(e),this.debug=e.getDebug(),this.view=this.createView({debug:this.debug,widgets:this.widgets})},setWidgetId:function(e){this.widgetId=e},createView:function(e){return new s(e)},assemble:function(n){var i=e.Deferred();if(this.assembled)return i.resolve(this.view.el),i.promise();this.assembled=!0,this.view.render();var a,r=this;t.extend(r.widgetDoms,r.getWidgetsFromTemplate(r.view.$el));var s=[],o={};return t.each(r.widgetDoms,function(i,l){if(!n.hasWidget(l))return delete r.widgetDoms[l],void delete r.widgets[l];var u=n._getWidget(l).done(function(s){if(r.persistentWidgets&&r.persistentWidgets.indexOf(l)>-1&&n.incrRefCount("widget",l),s){var u=function(){t.assign(s,{componentParams:e(i).data()});var n=e('*[data-widget="'+l+'"]'),r=n.length>0?n.html().trim():"";window.__PRERENDERED&&s.view&&c.indexOf(l)>-1&&n.length>0&&r.length>0?("function"==typeof s.view.handlePrerenderedContent&&s.view.handlePrerenderedContent(r,n),window.__PRERENDERED=!1):(a=s.getEl?s.getEl():s.render().el,o[l]=a)};s.assemble?s.assemble(n).done(u):u(),r.widgets[l]=s}});s.push(u)},this),e.when.apply(e,s).then(function(){t.forEach(o,function(t,n){e(r.widgetDoms[n]).html(t)}),i.resolve()}).fail(function(){console.error("Generic error - we were not successul in assembling page"),arguments.length&&console.error(arguments),i.reject()}),i.promise()},disAssemble:function(n){t.each(t.keys(this.widgets),function(t){var i=this.widgets[t];i.disAssemble&&i.disAssemble(),n.returnWidget(t),n._isBarbarianAlive("widget:"+t)?e(this.widgetDoms[t]).detach():e(this.widgetDoms[t]).empty(),delete this.widgets[t],delete this.widgetDoms[t]},this),this.assembled=!1},show:function(e){var n=this;if(e){this.hideAll();var i=[].slice.apply(arguments);t.each(i,function(e){if(n.widgets[e]){var i=n.widgets[e],a=n.view.$el.find('[data-widget="'+e+'"]');if(a.length){var r=a.data("debug");if(void 0!==r&&r&&!n.debug)return;a.append(i.el?i.el:i.view.el),t.assign(i,{componentParams:a.data()});try{n.widgets[e].triggerMethod("show")}catch(t){console.error("Error when displaying widget: "+e,t.message,t.stack)}}else console.warn("Cannot insert widget: "+e+' (no selector [data-widget="'+e+'"])')}else n.debug&&console.error("Cannot show widget: "+e+"(because, frankly... there is no such widget there!)")})}else this.showAll();return this.triggerMethod("show"),this.view},hideAll:function(){return t.each(this.widgets,function(e){e.noDetach||("detach"in e&&t.isFunction(e.detach)?e.detach():e.view&&e.view.$el?e.view.$el.detach():e.$el&&e.$el.detach())}),this.view},showAll:function(){var e=this;return t.each(t.keys(e.widgets),function(n){var i=e.widgets[n],a=e.view.$el.find('[data-widget="'+n+'"]');a.append(i.el?i.el:i.view.el),t.assign(i,{componentParams:a.data()}),e.widgets[n].triggerMethod("show")}),this.view},broadcast:function(){var e=arguments;t.each(this.widgets,function(t,n){t.trigger.apply(t,e)},this)}});return t.extend(u.prototype,o,l.BeeHive,{getPubSub:function(){return this._ps&&this.hasPubSub()?this._ps:(this._ps=this.getBeeHive().getHardenedInstance().getService("PubSub"),this._ps)}}),u}),define("js/mixins/side_bar_manager",["backbone","js/components/api_feedback"],function(e,t){var n=new(e.Model.extend({defaults:{recent:!0,show:!0}}));return{_getUpdateFromUserData:function(){try{var e=this.getBeeHive().getObject("User").getUserData();return!!e&&(!!e.defaultHideSidebars&&/show/i.test(e.defaultHideSidebars))}catch(e){return!1}},init:function(){this.setSidebarState(this._getUpdateFromUserData()),_.bindAll(this,["_onFeedback","_onUserAnnouncement","_updateSidebarState"]);var e=this.getPubSub();e&&(e.subscribe(e.FEEDBACK,this._onFeedback),e.subscribe(e.USER_ANNOUNCEMENT,this._onUserAnnouncement),n.on("change:show",this._updateSidebarState))},_updateSidebarState:_.throttle(function(){var e=this.getSidebarState(),t=this.view;t&&t.showCols&&t.showCols({left:e,right:e}),this.broadcast("page-manager-message","side-bars-update",e),this.trigger("page-manager-message","side-bars-update",e)},100),_onUserAnnouncement:function(e,t){_.contains(_.keys(t),"defaultHideSidebars")&&this.setSidebarState(!t.defaultHideSidebars||/show/i.test(t.defaultHideSidebars))},_onFeedback:function(e){switch(e.code){case t.CODES.MAKE_SPACE:return this.onMakeSpace();case t.CODES.UNMAKE_SPACE:return this.onUnMakeSpace();default:return null}},onMakeSpace:function(){n.has("recent")||n.set("recent",this.getSidebarState()),this.setSidebarState(!1)},onUnMakeSpace:function(){n.has("recent")&&(this.setSidebarState(n.get("recent")),n.unset("recent"))},toggleSidebarState:function(){this.setSidebarState(!this.getSidebarState())},setSidebarState:function(e){n.set("show",e),n.trigger("change:show")},getSidebarState:function(){return n.get("show")}}}),define("js/wraps/results_page_manager",["js/page_managers/controller","js/page_managers/three_column_view","hbs!js/page_managers/templates/results-page-layout","js/mixins/side_bar_manager","jquery","utils"],function(e,t,n,i,a,r){var s=e.extend({initialize:function(){var t=this;e.prototype.initialize.apply(this,arguments),this.resultsTimer=new r.TimingEvent("all-results-loaded","workflow"),this.fullResultsTimer=new r.TimingEvent("all-results-and-auxillary-loaded","workflow"),this._referrer=null,this.observer=new IntersectionObserver(function(){t.adjustStickyElements()},{threshold:0}),this.observing=!1,_.bindAll(this,"adjustStickyElements"),a(window).on("resize",_.throttle(this.adjustStickyElements,200))},persistentWidgets:["PubtypeFacet","SearchWidget","BreadcrumbsWidget","Sort","ExportDropdown","VisualizationDropdown","AffiliationFacet","AuthorFacet","DatabaseFacet","RefereedFacet","KeywordFacet","BibstemFacet","BibgroupFacet","DataFacet","VizierFacet","GrantsFacet","Results","OrcidBigWidget","QueryInfo","GraphTabs","OrcidSelector"],activate:function(){e.prototype.activate.apply(this,arguments);var t=this.getPubSub();t.subscribe(t.START_SEARCH,_.bind(this.onStartSearch,this)),t.subscribe(t.USER_ANNOUNCEMENT,_.bind(this.onUserUpdate,this)),this.init()},adjustStickyElements:function(){if(window.matchMedia("(max-width: 788px)").matches&&a("#search-results-sort").get(0)&&a("#search-results-sort").get(0).getBoundingClientRect().bottom<=0){var e=a("#search-results-actions").outerHeight(!0);this.stickElements(e)}else this.unStickElements()},stickElements:function(e){a("#search-results-actions").addClass("sticky"),a("#query-info-container").attr("style","position:fixed;top:".concat(e,"px;right:0"))},unStickElements:function(){a("#search-results-actions").removeClass("sticky"),a("#query-info-container").attr("style","")},onStartSearch:function(){this.resultsTimer.start(),this.fullResultsTimer.start()},onUserUpdate:function(e){e===this.getBeeHive().getObject("User").USER_SIGNED_OUT&&(a("#results-actions-toggle").addClass("disabled"),a("#query-info-container").removeClass("show"),a("#results-actions-toggle").html('<i class="fa fa-book" alt="open actions"></i> Actions'))},createView:function(e){return(e=e||{}).template=e.template||n,new t({template:n})},show:function(){var t=this.getBeeHive().getObject("User").isLoggedIn(),n=e.prototype.show.apply(this,arguments),i=this,a=n.$el.find(".s-back-button-container");a.empty().off("click").html('<a href="javascript:void(0);" class="back-button btn btn-sm btn-default"> <i class="fa fa-arrow-left" aria-hidden="true"></i> Start New Search</a>'),a.click(function(){var e=i.getPubSub();return e.publish(e.CUSTOM_EVENT,"start-new-search"),e.publish(e.NAVIGATE,i._referrer||"index-page"),i._referrer=null,!1}),!this.observing&&n.$el.find("#search-results-sort")[0]&&(this.observer.observe(n.$el.find("#search-results-sort")[0]),this.observing=!0);var r=n.$el.find("#results-actions-toggle")[0];return r.innerHTML='<i class="fa fa-book" alt="open actions" aria-hidden="true"></i> Actions',t?r.classList.remove("disabled"):r.classList.add("disabled"),n.$el.find("#query-info-container")[0].classList.remove("show"),n},provideContext:function(e){e.referrer&&(this._referrer=e.referrer)},setUpIntercepts:function(){var e=this;["AuthorFacet","RefereedFacet","DatabaseFacet","GraphTabs"].map(function(t){return function(t){var n=t;t.widgets&&t.widgets.length>0&&(n=t.widgets[0]);var i=n.getPubSub(),a=i.publish;i.publish=function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];var l;t!==i.DELIVERING_REQUEST||e.getSidebarState()?a.call.apply(a,[n,t].concat(s)):(i.subscribeOnce(i.INVITING_REQUEST,function(){return window.clearTimeout(l)}),function i(){if(e.getSidebarState())return a.call.apply(a,[n,t].concat(s));l=setTimeout(function(){return requestAnimationFrame(i)},1e3)}())}}(e.widgets[t])})},assemble:function(){var t=this;return e.prototype.assemble.apply(this,arguments).done(function(){t.setUpIntercepts(),_.each(_.keys(t.widgets),function(e){t.listenTo(t.widgets[e],"page-manager-event",_.bind(t.onPageManagerEvent,t,t.widgets[e]))},t),t.setSidebarState(t._getUpdateFromUserData());var e=["Results","AuthorFacet","RefereedFacet","DatabaseFacet","GraphTabs"];try{_.forEach(_.keys(t.widgets),function(n){var i=t.widgets[n],a=function(){"Results"===n&&t.resultsTimer.stop(),_.remove(e,function(e){return e===n}),0===e.length&&t.fullResultsTimer.stop()};i.widgets&&i.widgets.length>0&&_.forEach(i.widgets,function(e){e.onIdle=a}),i.onIdle=a})}catch(e){}})},broadcastTo:_.curry(function(e,t){var n=arguments,i=_.pick(this.widgets,e);_.each(i,function(e){e.trigger.apply(e,["page-manager-message",t].concat(_.toArray(n).slice(2)))})},2),onPageManagerEvent:function(e,t,n){"side-bars-update"===t&&this.setSidebarState(n)}});return _.extend(s.prototype,i),s}),define("js/wraps/visualization_dropdown",["js/widgets/dropdown-menu/widget"],function(e){var t=[{section:"Visualizations"},{description:"Citation Metrics",navEvent:"show-metrics"},{description:"Author Network",navEvent:"show-author-network"},{description:"Paper Network",navEvent:"show-paper-network"},{description:"Concept Cloud",navEvent:"show-concept-cloud"},{description:"Results Graph",navEvent:"show-bubble-chart"},{divider:!0},{section:"Operations",icon:{class:"icon-help",href:"/help/search/second-order",description:"Discover more about second-order operators"}},{description:"Co-reads",pubsubEvent:"second-order-search/trending"},{description:"Reviews",pubsubEvent:"second-order-search/reviews"},{description:"Useful",pubsubEvent:"second-order-search/useful"},{description:"Similar",pubsubEvent:"second-order-search/similar"}];return function(){return new e({links:t,btnType:"btn-primary-faded",dropdownTitle:"Explore",iconClass:"icon-explore",rightAlign:!0,selectedOption:!0})}}),define("landing-page.bundle",function(){});