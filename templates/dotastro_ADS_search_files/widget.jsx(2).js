define(["jquery","underscore","backbone","react","react-dom","redux","react-redux","redux-thunk","js/widgets/base/base_widget","./reducers/index","./actions/index","./containers/App.jsx","js/components/api_query","js/components/api_targets","js/components/api_feedback","js/widgets/config"],function(t,e,r,o,s,i,a,n,u,b,h,c,f,m,d,x){var l=r.View.extend({initialize:function(t){e.assign(this,t)},render:function(){return s.render(o.createElement(a.Provider,{store:this.store},o.createElement(c,null)),this.el),this},destroy:function(){s.unmountComponentAtNode(this.el)}});return u.extend({initialize:function(t){this.options=t||{};var e=i.applyMiddleware(n.default.withExtraArgument(this)),r=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.compose;this.store=i.createStore(b,r(e)),this.view=new l({store:this.store}),this.defaultFormat="BibTeX",this.customFormats=[],this.bibtexKeyFormat=null,this.bibtexMaxAuthors=0,this.bibtexABSKeyFormat=null,this.bibtexABSMaxAuthors=0,this.bibtexAuthorCutoff=200,this.bibtexABSAuthorCutoff=200,this.bibtexJournalFormat=1},activate:function(t){this.setBeeHive(t);var r=this.getPubSub(),o=this.store.dispatch,s=h.setQuery;this.activateWidget(),r.subscribe(r.INVITING_REQUEST,function(t){return o(s(t.toJSON()))}),this.attachGeneralHandler(this.onApiFeedback),r.subscribe(r.USER_ANNOUNCEMENT,e.bind(this.getFieldsFromUserData,this))},onApiFeedback:function(t){this.store.dispatch(h.requestFailed(t))},getUserData:function(){try{var t=e.isFunction(this.getBeeHive)&&this.getBeeHive(),r=e.isFunction(t.getObject)&&t.getObject("User");if(e.isPlainObject(r))return e.isFunction(r.getUserData)&&r.getUserData("USER_DATA")}catch(t){}return{}},getFieldsFromUserData:function(){var t=this,r=this.getUserData();return e.reduce(["defaultExportFormat","customFormats","bibtexKeyFormat","bibtexMaxAuthors","bibtexABSKeyFormat","bibtexABSMaxAuthors","bibtexAuthorCutoff","bibtexABSAuthorCutoff","bibtexJournalFormat"],function(o,s){var i=e.has(r,s)?r[s]:t[s];if("defaultExportFormat"===s){var a=e.find(x.export.formats,{label:i});o[s]=a?a.value:x.export.formats[0]}else o[s]=i;return t[s]=i,o},{})},getJournalFormatValue:function(t){switch(t){case"Use AASTeX macros":return 1;case"Use Journal Abbreviations":return 2;case"Use Full Journal Name":return 3;default:return 1}},renderWidgetForCurrentQuery:function(t){var e=t.currentQuery,r=t.numFound,o=t.format,s=this.store.dispatch,i=h.fetchUsingQuery,a=h.fetchUsingIds,n=h.findAndSetFormat,u=h.hardReset,b=h.setCount,c=h.setQuery,f=h.setTotalRecs,m=h.takeSnapshot,d=h.setOrigin,x=h.setCustomFormats,l=h.setBibtexKeyFormat,A=h.setBibtexMaxAuthors,F=h.setBibtexABSKeyFormat,g=h.setBibtexABSMaxAuthors,S=h.setBibtexAuthorCutoff,p=h.setBibtexABSAuthorCutoff,B=h.setBibtexJournalFormat,E=this.getFieldsFromUserData(),y=E.customFormats,v=E.defaultFormat,C=E.bibtexMaxAuthors,U=E.bibtexKeyFormat,_=E.bibtexABSMaxAuthors,O=E.bibtexABSKeyFormat,M=E.bibtexAuthorCutoff,N=E.bibtexABSAuthorCutoff,w=E.bibtexJournalFormat,D="default"===o||"other"===o?v:o;s(u()),s(x(y)),s(A(C)),s(g(_)),s(l(U)),s(F(O)),s(S(M)),s(p(N)),s(B(this.getJournalFormatValue(w))),s(d(this.componentParams&&this.componentParams.origin)),s(c(e.toJSON())),s(n(o)),s(b(r)),s(f(r)),"other"!==D?(s(m()),s(i()).then(function(){return s(a()).always(function(){return s(m())})})):s(m())},closeWidget:function(){var t=this.getPubSub();t.publish(t.NAVIGATE,"results-page")},_executeApiRequest:function(e){var r=t.Deferred(),o=this.getPubSub();return o.subscribeOnce(o.DELIVERING_RESPONSE,function(t){return r.resolve(t)}),o.publish(o.EXECUTE_REQUEST,e),r.promise()},renderWidgetForListOfBibcodes:function(t,e){var r=this.store.dispatch,o=h.receiveIds,s=h.findAndSetFormat,i=h.fetchUsingIds,a=h.hardReset,n=h.setSort,u=h.setCount,b=h.setTotalRecs,c=h.takeSnapshot,f=h.setOrigin,m=h.setCustomFormats,d=h.setBibtexKeyFormat,x=h.setBibtexMaxAuthors,l=h.setBibtexABSKeyFormat,A=h.setBibtexABSMaxAuthors,F=h.setBibtexAuthorCutoff,g=h.setBibtexABSAuthorCutoff,S=h.setBibtexJournalFormat,p=this.getFieldsFromUserData(),B=p.customFormats,E=p.defaultExportFormat,y=p.bibtexMaxAuthors,v=p.bibtexKeyFormat,C=p.bibtexABSMaxAuthors,U=p.bibtexABSKeyFormat,_=p.bibtexAuthorCutoff,O=p.bibtexABSAuthorCutoff,M=p.bibtexJournalFormat,N="default"===e.format||"other"===e.format?E:e.format,w=e.sort||"date desc, bibcode desc";r(a()),r(m(B)),r(x(y)),r(A(C)),r(d(v)),r(l(U)),r(F(_)),r(g(O)),r(S(this.getJournalFormatValue(M))),r(n(w)),r(f(this.componentParams&&this.componentParams.origin)),r(o(t)),r(s(N.toLowerCase())),r(u(t.length)),r(b(t.length)),"other"!==e.format?r(i()).done(function(){return r(c())}):r(c())},processResponse:e.noop})});